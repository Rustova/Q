import{j as e,r as n}from"./react-ZpOpdbvF.js";import{r as pe,a as kt}from"./react-dom-BFJMa1Yr.js";import{E as Pt}from"./jspdf-BVD6OXYK.js";import{D as Et,C as $t,P as Ot}from"./@hello-pangea-BHoMb5q8.js";import"./core-js--yVVgAJ6.js";import"./scheduler-SPyfQU6S.js";import"./@babel-CpGVvVoG.js";import"./fflate-BO5HMHBV.js";import"./redux-CqoN-cwI.js";import"./react-redux-DzurNSeR.js";import"./use-sync-external-store-DGADeII1.js";import"./css-box-model-SSI6wf-B.js";import"./tiny-invariant-BaFNuDhB.js";import"./raf-schd-CmoV45_-.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&t(f)}).observe(document,{childList:!0,subtree:!0});function o(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function t(s){if(s.ep)return;s.ep=!0;const c=o(s);fetch(s.href,c)}})();const Dt=r=>{if(!r)return null;try{const i=new Date(r);if(isNaN(i.getTime()))return console.warn("Invalid date string received for formatting:",r),{timeDescription:"Invalid Date",tooltip:r};const t=Math.round((new Date().getTime()-i.getTime())/1e3),s=i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})+", "+i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});let c;if(t<0){const f=i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),b=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});c=`${f}, ${b}`}else if(t<60)c="just now";else if(t<3600)c=`${Math.floor(t/60)} min ago`;else if(t<86400)c=`${Math.floor(t/3600)} h ago`;else{const f=i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),b=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});c=`${f}, ${b}`}return{timeDescription:c,tooltip:s}}catch(i){return console.error("Error formatting date:",i),{timeDescription:"Error in timestamp",tooltip:r||"Error formatting timestamp"}}},Rt=()=>e.jsx("div",{className:"h-14 w-14 sm:h-16 sm:w-16 rounded-full border-2 border-[var(--bg-header)] shadow-md transition-transform duration-200 ease-in-out hover:scale-110 flex items-center justify-center bg-[var(--text-primary)] shrink-0","aria-label":"App Logo Q",children:e.jsx("span",{className:"text-[var(--bg-primary)] font-bold text-[2rem] sm:text-[2.4rem] select-none",style:{fontFamily:"Roboto, sans-serif"},children:"Q"})}),qt=({contextTitle:r,isAdminView:i,isAdminAuthenticated:o,currentAppViewMode:t,onSwitchToAdminView:s,onSwitchToUserView:c,onAdminLogout:f,dataTimestamp:b,onShowTimestampModal:z})=>{const N=Dt(b),g="211, 195, 185",v=i&&o&&e.jsx("button",{onClick:f,className:"p-2.5 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white border border-[var(--accent-red-hover)] rounded-full transition-colors shrink-0 text-xs sm:text-sm flex items-center justify-center h-9 w-9 sm:h-10 sm:w-10 focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)] focus:ring-offset-2 focus:ring-offset-[var(--bg-header)]","aria-label":"Logout from Admin Panel",title:"Admin Logout",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket fa-fw text-base"})}),w=i?e.jsxs("button",{onClick:c,className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-transparent hover:bg-[var(--text-primary)] text-[var(--text-primary)] hover:text-[var(--bg-primary)] border border-[var(--text-primary)] rounded-md transition-colors shrink-0 text-xs sm:text-sm flex items-center","aria-label":"Switch to User View",children:[e.jsx("i",{className:"fa-solid fa-user-graduate fa-fw mr-1.5 sm:mr-2"}),e.jsx("span",{children:"User View"})]}):e.jsxs("button",{onClick:s,className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-transparent hover:bg-[var(--text-primary)] text-[var(--text-primary)] hover:text-[var(--bg-primary)] border border-[var(--text-primary)] rounded-md transition-colors shrink-0 text-xs sm:text-sm flex items-center","aria-label":"Switch to Admin Panel",children:[e.jsx("i",{className:"fa-solid fa-headset mr-1.5 sm:mr-2"}),e.jsx("span",{children:"Admin Panel"})]}),T=N&&e.jsx("button",{onClick:z,className:"text-[var(--text-primary)] text-[0.6rem] sm:text-xs opacity-80 hover:opacity-100 cursor-pointer focus:outline-none focus:ring-1 focus:ring-[var(--text-primary)] rounded p-0.5",title:N.tooltip,"aria-label":`Content update details: ${N.tooltip}`,children:e.jsx("span",{className:"block",children:`last updated : ${N.timeDescription}`})});return e.jsx("header",{className:"bg-[var(--bg-header)] sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[" ",e.jsx(Rt,{}),T]}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[v,w]})]}),e.jsx("div",{style:{height:"1px",width:"100%",backgroundImage:`linear-gradient(to right, transparent, rgba(${g},0.5) 25%, rgba(${g},0.5) 75%, transparent)`}}),e.jsx("div",{className:"text-center pt-2.5",children:e.jsx("span",{className:"text-[var(--text-primary)] text-sm sm:text-base font-semibold truncate block",title:r,children:r})})]})})},Ft=({appName:r})=>{const i=new Date().getFullYear();return e.jsx("footer",{className:"bg-[var(--bg-secondary)] text-[var(--text-secondary)] text-center py-4 sm:py-5 border-t border-[var(--border-color)]",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6",children:e.jsxs("p",{className:"text-xs sm:text-sm",children:["Â© ",i," ",r,". Made with ",e.jsx("i",{className:"fa-solid fa-heart text-[var(--accent-red)] animate-heartbeat"})]})})})},Lt=({onLogin:r,onClose:i,error:o})=>{const[t,s]=n.useState(""),c=z=>{z.preventDefault(),r(t)},f=e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"admin-login-title",children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",children:[e.jsx("h2",{id:"admin-login-title",className:"text-2xl font-semibold text-[var(--accent-primary)] mb-6 text-center",children:"Admin Login"}),e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"adminPassword",className:"block text-sm font-medium text-[var(--text-secondary)] mb-1",children:"Password"}),e.jsx("input",{type:"password",id:"adminPassword",value:t,onChange:z=>s(z.target.value),className:"w-full p-3 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)] text-[var(--input-text)] focus:ring-2 focus:ring-[var(--input-focus-ring)] focus:border-[var(--input-focus-ring)] placeholder-[var(--placeholder-color)]",placeholder:"Enter admin password",required:!0})]}),o&&e.jsx("p",{className:"text-red-500 text-sm text-center -mt-2",children:o}),e.jsxs("div",{className:"flex flex-col sm:flex-row-reverse gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Login"}),e.jsx("button",{type:"button",onClick:i,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Cancel"})]})]})]})}),b=document.getElementById("modal-root");return b?pe.createPortal(f,b):(console.error("Modal root element 'modal-root' not found."),null)},Mt=({isOpen:r,onClose:i,allQuizzes:o,initiallySelectedQuizIds:t,onApplySelection:s})=>{const[c,f]=n.useState([]);n.useEffect(()=>{r&&f([...t])},[r,t]);const b=n.useMemo(()=>o.reduce((j,$)=>{const I=$.subjectId;return j[I]||(j[I]={subjectName:$.subjectName,quizzes:[]}),j[I].quizzes.push($),j},{}),[o]);if(!r)return null;const z=j=>{f($=>$.includes(j)?$.filter(I=>I!==j):[...$,j])},N=()=>{const j=o.map($=>$.id);f(j)},g=()=>{f([])},v=()=>{s(c)},w=()=>c.length===0?"No quizzes selected. All quizzes from chosen subjects will be included if applied now.":c.length===o.length&&o.length>0?`All ${o.length} available quizzes selected.`:`${c.length} of ${o.length} available quizzes selected.`,T=document.getElementById("modal-root");return T?pe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[51] p-4",role:"dialog","aria-modal":"true","aria-labelledby":"quiz-multiselect-modal-title",onClick:i,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:j=>j.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl shrink-0",children:[e.jsx("h2",{id:"quiz-multiselect-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:"Select Quizzes for Export"}),e.jsx("button",{onClick:i,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close quiz selection modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 overflow-y-auto custom-scrollbar flex-grow",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-3",children:[e.jsx("p",{className:"text-sm text-[var(--text-secondary)] p-2 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md flex-grow",children:w()}),e.jsxs("div",{className:"flex space-x-2 shrink-0",children:[e.jsx("button",{onClick:N,disabled:o.length===0,className:"px-3 py-1.5 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors disabled:opacity-50",children:"Select All"}),e.jsx("button",{onClick:g,disabled:o.length===0||c.length===0,className:"px-3 py-1.5 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors disabled:opacity-50",children:"Deselect All"})]})]}),o.length===0?e.jsx("p",{className:"text-center text-[var(--text-secondary)] py-4",children:"No quizzes available from selected subjects to choose from."}):e.jsx("div",{className:"space-y-3 max-h-[calc(85vh-260px)] overflow-y-auto custom-scrollbar pr-2",children:Object.entries(b).map(([j,{subjectName:$,quizzes:I}])=>e.jsxs("div",{className:"py-1",children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--accent-primary)] mb-1.5 pb-1 border-b border-[var(--border-color)]",children:$}),e.jsx("div",{className:"space-y-1.5",children:I.map(q=>{const Y=c.includes(q.id);return e.jsxs("label",{className:`flex items-center space-x-3 p-2.5 rounded-md transition-all duration-150 text-sm border cursor-pointer 
                            ${Y?"bg-[var(--accent-primary)] bg-opacity-25 border-[var(--accent-primary)] text-[var(--text-primary)] font-medium":"bg-[var(--bg-primary)] border-[var(--border-color)] text-[var(--text-secondary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-10 hover:border-[var(--accent-secondary)]"}`,title:`${q.subjectName} - ${q.name}`,children:[e.jsx("input",{type:"checkbox",checked:Y,onChange:()=>z(q.id),className:"h-4 w-4 text-[var(--accent-primary)] bg-transparent border-[var(--input-border)] rounded focus:ring-1 focus:ring-offset-0 focus:ring-[var(--accent-primary)] shrink-0"}),e.jsx("span",{className:"truncate flex-grow text-left",children:q.name})]},q.id)})})]},j))})]}),e.jsxs("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-between items-center shrink-0",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 text-sm font-medium bg-transparent hover:bg-[var(--accent-red)] hover:bg-opacity-20 text-[var(--accent-red)] border border-[var(--accent-red)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]",children:"Clear Current Selection"}),e.jsxs("div",{className:"space-x-3",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)]",children:"Cancel"}),e.jsx("button",{onClick:v,disabled:o.length===0&&c.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50",children:"Apply Selection"})]})]})]})}),T):(console.error("Modal root element 'modal-root' not found for QuizMultiSelectModal."),null)},vt={title:"#233239",questionText:"#000000",answerText:"#474747",correctAnswer:"#48BB78"},Ut="p-2 border rounded-md focus:ring-1 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)] text-sm",yt="block text-sm font-medium text-[var(--text-secondary)] mb-1",pt="text-md font-semibold text-[var(--accent-primary)] mb-2",ke=595.28,je=841.89,me=40,Ie=ke-2*me,we=1.4,jt="#000000",We=18,Ye=135,Bt=({isOpen:r,onClose:i,subjects:o})=>{const[t,s]=n.useState({showAnswers:!0,fontSize:12,colors:{...vt},selectedSubjectIds:[]}),[c,f]=n.useState(!1),[b,z]=n.useState(!1),[N,g]=n.useState(!1),[v,w]=n.useState(null);n.useEffect(()=>{r&&(s({showAnswers:!0,fontSize:12,colors:{...vt},selectedSubjectIds:o.map(x=>x.id)}),f(!1),z(!1),g(!1),w(null))},[r,o]);const T=n.useMemo(()=>{if(!r)return[];const x=[];return o.forEach(p=>{t.selectedSubjectIds.includes(p.id)&&p.quizzes.filter(y=>y.isStartable).forEach(y=>{x.push({id:y.id,name:y.name,subjectName:p.name,subjectId:p.id})})}),x},[o,t.selectedSubjectIds,r]);if(!r&&!N)return null;const j=x=>{const{name:p,value:y,type:C}=x.target;if(C==="checkbox"){const{checked:A}=x.target;s(H=>({...H,[p]:A}))}else s(C==="number"?A=>({...A,[p]:parseInt(y,10)}):A=>({...A,[p]:y}))},$=(x,p)=>{s(y=>({...y,colors:{...y.colors,[x]:p}}))},I=x=>{s(p=>{const y=p.selectedSubjectIds.includes(x)?p.selectedSubjectIds.filter(C=>C!==x):[...p.selectedSubjectIds,x];return w(null),{...p,selectedSubjectIds:y}})},q=()=>{if(t.selectedSubjectIds.length===0){alert("Please select at least one subject before selecting specific quizzes.");return}g(!0)},Y=x=>{w(x.length>0?x:null),g(!1)},J=async(x,p)=>{let y;try{y=await fetch(x)}catch(A){throw console.error(`Network error loading file ${x}:`,A),new Error(`Network error loading file ${x}: ${A instanceof Error?A.message:String(A)}`)}if(!y.ok){const A=await y.text().catch(()=>"Could not retrieve error body.");throw console.error(`Failed to load file ${x}: ${y.status} ${y.statusText}. Body: ${A.substring(0,200)}`),new Error(`Failed to load file ${x}: ${y.status} ${y.statusText}`)}const C=y.headers.get("Content-Type");try{const A=await y.blob();return new Promise((H,F)=>{const te=new FileReader;te.onloadend=()=>{let O=te.result;const K="data:application/octet-stream;base64,",B=p.startsWith("data:image/");if(O.startsWith(p))H(O);else if(B&&O.startsWith(K))console.warn(`File ${x} (expected ${p}) was received as octet-stream. Correcting MIME type for PDF.`),O=p+O.substring(K.length),H(O);else{const _=O.substring(0,Math.min(O.indexOf(";")+8,O.length,50))+"...",R=`File ${x} loaded with unexpected type. Expected prefix: ${p}, but got: ${_} (Full Content-Type from server: ${C||"N/A"}). Check if the file is correct and accessible.`;console.error(R),F(new Error(R))}},te.onerror=O=>{var B,_;const K=`FileReader error for ${x}: ${((_=(B=O.target)==null?void 0:B.error)==null?void 0:_.message)||"Unknown FileReader error"}`;console.error(K,O),F(new Error(K))},te.readAsDataURL(A)})}catch(A){throw console.error(`Error processing blob for ${x}:`,A),new Error(`Error processing blob for ${x}: ${A instanceof Error?A.message:String(A)}`)}},ee=async()=>{if(t.selectedSubjectIds.length===0){alert("Please select at least one subject to include in the PDF.");return}f(!0);let x=!1;try{const p=new Pt({orientation:"p",unit:"pt",format:"a4"});try{const R=await J("https://rustova.github.io/Q/assets/Amiri-Regular.ttf","data:font/ttf;base64,"),D=R.substring(R.indexOf(",")+1);p.addFileToVFS("Amiri-Regular.ttf",D),p.addFont("Amiri-Regular.ttf","Amiri","normal"),p.addFont("Amiri-Regular.ttf","Amiri","bold"),p.setFont("Amiri","normal"),x=!0,z(!0)}catch(R){console.warn("Failed to load Amiri-Regular.ttf. PDF will be generated with default fonts.",R),p.setFont("Helvetica","normal")}const y=await J("https://rustova.github.io/Q/assets/main.PNG","data:image/png;base64,"),C=await J("https://rustova.github.io/Q/assets/regular.PNG","data:image/png;base64,");let A=me;const H=t.fontSize*1.5,F=(R,D,L=!1)=>{p.setFontSize(R),p.setTextColor(D),x?p.setFont("Amiri",L?"bold":"normal"):p.setFont("Helvetica",L?"bold":"normal")},te=(R=t.fontSize*we)=>{A+R>je-me&&(p.addPage(),p.addImage(C,"PNG",0,0,ke,je,void 0,"FAST"),A=Ye)},O=(R,D,L,G,Q,ae=!1,re=!1)=>{F(G,Q,ae);const Z=p.splitTextToSize(R,L),se=re?we*1.1:we,ne=Z.length*G*(ae?1.05:1)*se*.8;re||te(ne),p.text(Z,D,A),A+=ne+G*(se*.2)};p.addImage(y,"PNG",0,0,ke,je,void 0,"FAST"),A=416+We*we*1.1,F(We,jt,!0),p.text("Subjects included:",28,416);const K=o.filter(R=>t.selectedSubjectIds.includes(R.id));K.length>0&&K.forEach(R=>{A+We*we*1.1>je-me&&(p.addPage(),p.addImage(C,"PNG",0,0,ke,je,void 0,"FAST"),A=Ye),O(`- ${R.name}`,me+20,Ie-20,We,jt,!1,!0)});let B=[];o.forEach(R=>{t.selectedSubjectIds.includes(R.id)&&R.quizzes.filter(D=>D.isStartable&&D.questions.length>0).forEach(D=>{(v===null||v.includes(D.id))&&B.push({...D,subjectName:R.name,subjectId:R.id})})});let _=!0;for(const R of B){if(_)p.addPage(),p.addImage(C,"PNG",0,0,ke,je,void 0,"FAST"),A=Ye,_=!1;else{const L=H*we+t.fontSize*1.2*we;te(L)}const D=Ie-(70-me);O(R.subjectName,70,D,H,t.colors.title,!0),A+=t.fontSize*.2,O(R.name,me,Ie,t.fontSize*1.2,t.colors.title,!0),A+=t.fontSize*.7,R.questions.forEach((L,G)=>{O(`${G+1}. ${L.questionText}`,me,Ie,t.fontSize,t.colors.questionText),A+=t.fontSize*.3,L.type==="mcq"&&L.options&&L.options.forEach((Q,ae)=>{let Z=`${String.fromCharCode(65+ae)}. ${Q.text}`,se=t.colors.answerText;t.showAnswers&&Q.id===L.correctOptionId&&(se=t.colors.correctAnswer),O(Z,me+20,Ie-20,t.fontSize*.9,se),A+=t.fontSize*.1}),A+=t.fontSize*.5})}B.length===0&&t.selectedSubjectIds.length>0&&(_&&(p.addPage(),p.addImage(C,"PNG",0,0,ke,je,void 0,"FAST")),A=Ye,O("No quizzes match the current selection criteria.",me,Ie,t.fontSize,t.colors.questionText)),p.save("Quiz_Export.pdf")}catch(p){console.error("Error generating PDF:",p),alert(`Failed to generate PDF. Check console for details. Error: ${p instanceof Error?p.message:String(p)}`)}finally{f(!1),i()}},U=document.getElementById("modal-root");if(!U&&r)return console.error("Modal root element 'modal-root' not found for PdfPreferencesModal."),null;if(!r)return null;const l=[{key:"title",label:"Title Color (Content)"},{key:"questionText",label:"Question Text Color"},{key:"answerText",label:"Answer Text Color"},{key:"correctAnswer",label:"Correct Answer Highlight"}],k=()=>v===null?"Select Specific Quizzes... (All from selected subjects)":v.length===0?"Select Specific Quizzes... (None selected)":`${v.length} Quizzes Selected`;return pe.createPortal(e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"pdf-prefs-modal-title",onClick:c?void 0:i,children:[e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:x=>x.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl shrink-0",children:[e.jsx("h2",{id:"pdf-prefs-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:"PDF Export Preferences"}),e.jsx("button",{onClick:c?void 0:i,disabled:c,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)] disabled:opacity-50","aria-label":"Close PDF preferences modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-5 overflow-y-auto custom-scrollbar flex-grow",children:[e.jsxs("fieldset",{disabled:c,children:[e.jsx("legend",{className:pt,children:"General Options"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 items-end",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)]",children:[e.jsx("input",{type:"checkbox",id:"showAnswers",name:"showAnswers",checked:t.showAnswers,onChange:j,className:"h-4 w-4 text-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] rounded cursor-pointer"}),e.jsx("label",{htmlFor:"showAnswers",className:"text-sm text-[var(--input-text)] cursor-pointer",children:"Show Answers in PDF"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fontSize",className:yt,children:"Base Font Size (Content Pages)"}),e.jsx("input",{type:"number",id:"fontSize",name:"fontSize",value:t.fontSize,onChange:j,min:"8",max:"32",step:"1",className:`${Ut} w-full`})]})]})]}),e.jsxs("fieldset",{disabled:c,children:[e.jsx("legend",{className:pt,children:"Color Scheme (Content Pages)"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-3",children:l.map(x=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:x.key,className:`${yt} truncate`,title:x.label,children:x.label}),e.jsx("input",{type:"color",id:x.key,name:x.key,value:t.colors[x.key],onChange:p=>$(x.key,p.target.value),className:"w-full h-9 p-0.5 border rounded-md cursor-pointer bg-[var(--input-bg)] border-[var(--input-border)] focus:outline-none focus:ring-1 focus:ring-[var(--input-focus-ring)]"})]},x.key))})]}),e.jsxs("fieldset",{disabled:c,children:[e.jsx("legend",{className:pt,children:"Select Content"}),o.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3 items-center",children:e.jsx("button",{onClick:q,disabled:t.selectedSubjectIds.length===0,className:"px-3 py-1.5 text-xs bg-[var(--accent-primary)] hover:bg-[var(--accent-primary-hover)] text-[var(--btn-primary-text)] rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed truncate max-w-xs",title:k(),children:k()})}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 pr-2 custom-scrollbar border border-[var(--input-border)] bg-[var(--input-bg)] rounded-md p-3",children:o.map(x=>{const p=x.quizzes.filter(y=>y.isStartable).length;return e.jsxs("label",{className:"flex items-center space-x-2 p-2 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md cursor-pointer hover:bg-[var(--accent-secondary)] hover:bg-opacity-10",children:[e.jsx("input",{type:"checkbox",checked:t.selectedSubjectIds.includes(x.id),onChange:()=>I(x.id),className:"h-4 w-4 text-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] rounded"}),e.jsx("span",{className:"text-sm text-[var(--input-text)] flex-grow truncate",title:x.name,children:x.name}),e.jsxs("span",{className:"text-xs text-[var(--text-secondary)] shrink-0",children:["(",p," quiz",p!==1?"zes":"",")"]})]},x.id)})}),t.selectedSubjectIds.length===0&&e.jsx("p",{className:"text-xs text-[var(--text-secondary)] italic mt-1",children:"Select subjects to enable quiz selection."})]}):e.jsx("p",{className:"text-sm text-[var(--text-secondary)]",children:"No subjects available to select."})]})]}),e.jsxs("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-end space-x-3 shrink-0",children:[e.jsx("button",{onClick:c?void 0:i,disabled:c,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:ee,disabled:c||o.length===0||t.selectedSubjectIds.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50 flex items-center justify-center min-w-[120px]",children:c?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"Generating..."]}):"Generate PDF"})]})]}),N&&e.jsx(Mt,{isOpen:N,onClose:()=>g(!1),allQuizzes:T,initiallySelectedQuizIds:v||[],onApplySelection:Y})]}),U)},_t=500,wt=({subjects:r,onSelectSubject:i,playAnimation:o,onAnimationComplete:t})=>{const[b,z]=n.useState(!1),[N,g]=n.useState("idle"),v=n.useRef(null),w=n.useRef(null),[T,j]=n.useState(!1),$=n.useRef(null),I=()=>{z(!0)},q=()=>{z(!1)};let Y=0,J=0,ee=0;r.length===0&&(Y=.1+.1,J=Y+.1,ee=J+.1);const U=n.useMemo(()=>{if(r.length===0)return ee+.075+.2;{let l;const k=.2+(r.length-1)*.075;return r.length<4?l=.2+r.length*.075:l=k,l+.075+.2}},[r.length,.1,.075,4,ee]);return n.useEffect(()=>{if(v.current&&!w.current&&r.length>0&&!T){const l=U*1e3+_t+300,k=setTimeout(()=>{v.current&&(w.current=v.current.getBoundingClientRect(),j(!0))},l);return()=>clearTimeout(k)}r.length===0&&T&&(j(!1),w.current=null,g("idle"))},[r.length,U,T]),n.useEffect(()=>{const l=document.getElementById("shine-sound");l&&($.current=l)},[]),n.useEffect(()=>{o&&N==="idle"&&T&&r.length>0&&v.current&&v.current&&g("growing");const l=v.current;if(!l)return;const k=w.current;if(!k&&["growing","shining","returning"].includes(N)){console.error("Animation stage attempted without initial rect. Resetting."),g("idle"),j(!1),o&&t();return}let x;l.classList.remove("pdf-button-growing","pdf-button-shining","pdf-button-returning");const p=k?window.innerWidth/2-(k.left+k.width/2):0,y=k?window.innerHeight/2-(k.top+k.height/2):0;if(N==="growing"){if(!k)return;l.style.position="fixed",l.style.top=`${k.top}px`,l.style.left=`${k.left}px`,l.style.width=`${k.width}px`,l.style.height=`${k.height}px`,l.style.margin="0",l.style.zIndex="1000",l.style.transformOrigin="center center",l.style.setProperty("--translate-to-center-x",`${p}px`),l.style.setProperty("--translate-to-center-y",`${y}px`),l.style.transform="translate(0px, 0px) scale(1)",l.offsetWidth,l.classList.add("pdf-button-growing"),x=window.setTimeout(()=>{g("shining")},800)}else if(N==="shining"){if(!k)return;l.style.position="fixed",l.style.top=`${k.top}px`,l.style.left=`${k.left}px`,l.style.width=`${k.width}px`,l.style.height=`${k.height}px`,l.style.margin="0",l.style.zIndex="1000",l.style.transformOrigin="center center",l.style.transform="translate(var(--translate-to-center-x), var(--translate-to-center-y)) scale(1.5)",l.style.overflow="hidden",l.offsetWidth,l.classList.add("pdf-button-shining"),$.current&&($.current.currentTime=0,$.current.play().catch(C=>console.warn("Audio play failed:",C.name,C.message))),x=window.setTimeout(()=>{g("returning")},1500)}else if(N==="returning"){if(!k)return;l.style.overflow="",l.offsetWidth,l.classList.add("pdf-button-returning"),x=window.setTimeout(()=>{g("finished")},600)}else N==="finished"&&(l.style.transform="translate(0px, 0px) scale(1)",l.offsetWidth,l.style.position="",l.style.top="",l.style.left="",l.style.width="",l.style.height="",l.style.margin="",l.style.zIndex="",l.style.transformOrigin="",l.style.overflow="",l.style.removeProperty("--translate-to-center-x"),l.style.removeProperty("--translate-to-center-y"),l.style.transform="",t(),g("idle"));return()=>{window.clearTimeout(x)}},[o,N,T,r.length,t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full max-w-2xl mx-auto px-4 sm:px-6 pb-4 sm:pb-6 flex flex-col flex-grow",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-primary)] text-center mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)] mt-4 sm:mt-6 shrink-0 animate-fadeInUp",style:{animationDelay:`${.1}s`},children:"Select a Subject"}),r.length===0?e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center py-10 px-4",children:[e.jsx("i",{className:"fa-solid fa-box-open text-5xl sm:text-6xl text-[var(--text-secondary)] opacity-60 mb-6 animate-fadeInUp",style:{animationDelay:`${Y}s`}}),e.jsx("p",{className:"text-xl sm:text-2xl font-semibold text-[var(--text-primary)] mb-2 animate-fadeInUp",style:{animationDelay:`${J}s`},children:"It's a bit quiet here..."}),e.jsx("p",{className:"text-sm sm:text-md text-[var(--text-secondary)] max-w-md animate-fadeInUp",style:{animationDelay:`${ee}s`},children:"No subjects are available at the moment. Administrators can add new subjects and quizzes through the Admin Panel. Please check back soon!"})]}):e.jsxs("div",{className:`flex-grow flex flex-col items-center ${r.length<4?"justify-center":"justify-start"}`,children:[e.jsx("div",{className:"w-full space-y-3 py-4",children:r.map((l,k)=>{const x=l.quizzes.filter(y=>y.isStartable).length,p=.1+.1+k*.075;return e.jsxs("button",{onClick:()=>i(l.id),className:"w-full text-left p-4 bg-[var(--bg-primary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20 border border-[var(--border-color)] hover:border-[var(--accent-secondary)] rounded-lg text-[var(--text-primary)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] animate-fadeInUp",style:{animationDelay:`${p}s`},"aria-label":`Select subject: ${l.name}, ${x} quiz${x!==1?"zes":""} available`,children:[e.jsx("span",{className:"text-lg font-semibold text-[var(--accent-primary)]",children:l.name}),e.jsxs("span",{className:"block text-sm text-[var(--text-secondary)] mt-1",children:[x," quiz",x!==1?"zes":""," available"]})]},l.id)})}),r.length<4&&e.jsx("p",{className:"text-center text-xs sm:text-sm text-[var(--text-secondary)] mt-4 mb-4 italic animate-fadeInUp",style:{animationDelay:`${.1+.1+r.length*.075}s`},children:"More subjects and quizzes are on the way. Stay tuned!"})]}),e.jsx("div",{className:"mt-auto pt-6 border-t border-[var(--border-color)] text-center animate-fadeInUp",style:{animationDelay:`${U}s`},children:e.jsxs("button",{ref:v,onClick:I,className:"px-6 py-3 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-lg transition-colors text-sm font-medium focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] flex items-center justify-center mx-auto","aria-label":"Open PDF export preferences",disabled:N!=="idle"&&N!=="finished",children:[e.jsx("i",{className:"fa-solid fa-file-pdf fa-lg mr-2.5"}),"Export Quizzes to PDF"]})})]}),e.jsx(Bt,{isOpen:b,onClose:q,subjects:r})]})},Qt=({subject:r,onSelectQuiz:i,onBackToSubjectList:o})=>{const t=r.quizzes.filter(s=>s.isStartable);return e.jsxs("div",{className:"w-full p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)]",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-primary)] truncate mb-2 sm:mb-0",title:`Quizzes in ${r.name}`,children:["Quizzes in ",r.name]}),e.jsx("button",{onClick:o,className:"px-4 py-2 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors text-sm sm:text-base w-full sm:w-auto focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]","aria-label":"Back to subject list",children:"â Back to Subject List"})]}),r.quizzes.length===0?e.jsx("p",{className:"text-lg text-[var(--text-secondary)] text-center py-6",children:"No quizzes created yet for this subject."}):t.length===0?e.jsx("p",{className:"text-lg text-[var(--text-secondary)] text-center py-6",children:"No quizzes are currently available for users in this subject. Please check back later."}):e.jsx("div",{className:"space-y-3",children:t.map(s=>e.jsxs("button",{onClick:()=>i(s.id),className:"quiz-select-button w-full text-left p-4 bg-[var(--bg-primary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-30 border border-[var(--border-color)] hover:border-[var(--accent-secondary)] rounded-lg text-[var(--text-primary)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]","aria-label":`Select quiz: ${s.name}, ${s.questions.length} question${s.questions.length!==1?"s":""}`,children:[e.jsx("span",{className:"text-lg font-semibold text-[var(--accent-primary)]",children:s.name}),e.jsxs("span",{className:"block text-sm text-[var(--text-secondary)] mt-1",children:[s.questions.length," question",s.questions.length!==1?"s":""]})]},s.id))})]})},St=({question:r,questionNumber:i,selectedOptionId:o,isSubmitted:t,onOptionSelect:s,correctOptionIdForDisplay:c})=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 text-[var(--text-primary)] whitespace-pre-wrap",id:`question-${r.id}-text`,children:[i,". ",r.questionText]}),r.type==="mcq"&&r.options&&e.jsx("div",{className:"space-y-3",role:"radiogroup","aria-labelledby":`question-${r.id}-text`,children:r.options.map((f,b)=>{const z=o===f.id,N=String.fromCharCode(65+b);let g="w-full text-left p-3 rounded-md transition-all duration-150 flex items-center text-sm sm:text-base ",v="",w="";if(t){g+=" border-2 ";const j=f.id===c;j?(v="border-[var(--accent-green)] text-[var(--accent-green)] bg-[var(--accent-green-bg-soft)] font-medium",w="fa-solid fa-check-circle text-[var(--accent-green)]",z&&(v+=" ring-2 ring-[var(--accent-green)] ring-offset-1 ring-offset-[var(--bg-primary)]")):z&&!j?(v="border-[var(--accent-red)] text-[var(--accent-red)] bg-[var(--accent-red-bg-soft)] font-medium",w="fa-solid fa-times-circle text-[var(--accent-red)]"):(v="border-[var(--border-color)] text-[var(--text-secondary)] bg-[var(--bg-primary)] opacity-60 cursor-not-allowed",w="fa-regular fa-circle text-[var(--text-secondary)] opacity-60")}else g+=" border ",z?(v="bg-[var(--accent-primary-bg-selection)] border-[var(--accent-primary)] text-[var(--btn-primary-text)] font-medium",w="fa-solid fa-dot-circle text-[var(--btn-primary-text)]"):(v="bg-[var(--bg-primary)] border-[var(--border-color)] text-[var(--text-secondary)]",w="fa-regular fa-circle text-[var(--text-secondary)]");const T=g+v;return e.jsxs("button",{"data-option-id":f.id,className:`user-option-button ${T}`,onClick:()=>s(f.id),disabled:t,role:"radio","aria-checked":z&&!t,"aria-label":`Option ${N}: ${f.text}`,children:[e.jsx("i",{className:`${w} mr-2.5 text-lg w-5 text-center`})," ",e.jsxs("span",{className:"font-semibold mr-1.5",children:[N,"."]}),e.jsx("span",{children:f.text})]},f.id)})}),r.type==="written"&&e.jsx("div",{className:"p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md",children:e.jsx("p",{className:"text-[var(--text-primary)] italic",children:"This is a written response question."})})]}),Gt=({quiz:r,currentQuestionIndex:i,userAnswers:o,currentUserSelectionAttempt:t,isQuizComplete:s,onOptionSelect:c,onListedOptionSelect:f,onSubmitAnswer:b,onNextQuestion:z,onPreviousQuestion:N,onBackToQuizList:g,onRestartQuiz:v,userCorrectionMode:w,userQuestionDisplayMode:T,onTogglePrefsModal:j})=>{const[$,I]=n.useState(!0);n.useEffect(()=>{I(!0);const D=setTimeout(()=>{I(!1)},1200);return()=>clearTimeout(D)},[r.id]);const q=T==="oneByOne"?r.questions[i]:null,Y=T==="oneByOne"?o[i]:null,J=(q==null?void 0:q.type)==="mcq",ee=Y!=null,U=!!(Y&&Y.feedback!==null),l=w==="immediate"?U:s,k=ee?Y.selectedOptionId:t,x=(w==="immediate"||s)&&U?Y.feedback:null,p=r.questions.length>0&&T==="oneByOne"?(i+1)/r.questions.length*100:0,y=!s&&i>0&&T==="oneByOne",C=T==="oneByOne"&&i===r.questions.length-1,A=!s&&q&&T==="oneByOne",H=!s&&q&&J&&!U&&w==="immediate"&&T==="oneByOne",F=t===null,te=w==="immediate"&&H,O=()=>{s&&T==="oneByOne"&&!q||z()},K="p-3 text-[var(--accent-primary)] transition-colors rounded-full focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] disabled:opacity-40 disabled:cursor-not-allowed",B="px-10 py-4 sm:px-12 sm:py-4 text-[var(--btn-primary-text)] bg-[var(--accent-primary)] transition-colors rounded-lg shadow-sm border border-[var(--accent-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] disabled:opacity-40 disabled:cursor-not-allowed",_="w-full sm:w-auto mt-8 px-8 py-3 text-lg font-semibold text-[var(--btn-primary-text)] bg-[var(--accent-primary)] hover:bg-[var(--accent-primary-hover)] transition-colors rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)]",R=()=>e.jsxs("div",{className:"py-6",children:[e.jsxs("h3",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-green)] text-center mb-6",children:['Quiz Results for: "',r.name,'"']}),e.jsx("div",{className:"space-y-4 max-h-[calc(55vh+5rem)] sm:max-h-[calc(55vh+3rem)] overflow-y-auto pr-2 custom-scrollbar",children:r.questions.map((D,L)=>{const G=o[L];return e.jsxs("div",{className:"p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md shadow-sm",children:[e.jsxs("p",{className:"text-md font-semibold text-[var(--text-primary)] mb-2 whitespace-pre-wrap",children:[L+1,". ",D.questionText," ",e.jsxs("span",{className:"text-xs text-[var(--accent-secondary)]",children:["(",D.type.toUpperCase(),")"]})]}),D.type==="mcq"&&D.options&&e.jsxs("div",{className:"text-sm space-y-2 mt-1",children:[!(G!=null&&G.selectedOptionId)&&D.type==="mcq"&&e.jsx("p",{className:"text-sm text-[var(--accent-amber)] italic mb-1.5",children:"You did not answer this question."}),e.jsx("ul",{className:"space-y-1.5",children:D.options.map((Q,ae)=>{const re=G?G.selectedOptionId===Q.id:!1,Z=D.correctOptionId===Q.id,se=String.fromCharCode(65+ae);let ne="p-2 rounded-md border flex items-center text-sm transition-all duration-150 ",ce=null,ue=null;return Z?(ne+="bg-green-500 bg-opacity-20 border-green-600 text-green-300 font-medium ",ce=e.jsx("i",{className:"fa-solid fa-check fa-fw mr-2 text-green-400"}),ue=e.jsx("span",{className:"ml-auto text-xs font-normal",children:"(Correct answer)"}),re&&(ne+="ring-2 ring-green-500 shadow-md ",ce=e.jsx("i",{className:"fa-solid fa-check fa-fw mr-2 text-green-300"}),ue=e.jsx("span",{className:"ml-auto text-xs font-semibold",children:"(Your correct choice)"}))):re?(ne+="bg-red-500 bg-opacity-20 border-red-600 text-red-300 font-medium shadow-md ",ce=e.jsx("i",{className:"fa-solid fa-times-circle fa-fw mr-2 text-red-400"}),ue=e.jsx("span",{className:"ml-auto text-xs font-semibold",children:"(Your incorrect choice)"})):(ne+="bg-[var(--bg-secondary)] border-[var(--border-color)] text-[var(--text-secondary)] ",ce=e.jsx("i",{className:"fa-regular fa-circle fa-fw mr-2 text-[var(--text-secondary)] opacity-70"})),e.jsxs("li",{className:ne,children:[ce,e.jsxs("span",{className:"font-semibold mr-1.5",children:[se,"."]}),e.jsx("span",{className:"flex-grow min-w-0 break-words",children:Q.text}),ue]},Q.id)})})]}),D.type==="written"&&((G==null?void 0:G.feedback)==="Seen"||s&&!G?e.jsx("p",{className:"text-sm text-[var(--text-secondary)] italic mt-1",children:"You viewed this written response question."}):e.jsx("p",{className:"text-sm text-[var(--text-secondary)] italic mt-1",children:"This is a written response question."}))]},D.id)})}),e.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4",children:[e.jsx("button",{onClick:v,className:"px-6 py-2.5 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-sm sm:text-base bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] w-full sm:w-auto",children:"Restart Quiz"}),e.jsx("button",{onClick:g,className:"px-6 py-2.5 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-sm sm:text-base bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] w-full sm:w-auto",children:"Back to Quiz List"})]})]});return e.jsxs("div",{className:"w-full p-4 sm:p-6",children:[!s&&e.jsxs("div",{className:"flex items-center justify-between mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)]",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-xs sm:text-sm bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] shrink-0","aria-label":"Back to quiz list",children:"â Back to Quiz List"}),!s&&e.jsx("button",{onClick:j,className:"text-[var(--text-secondary)] hover:text-[var(--accent-primary)] focus:outline-none p-1 rounded-full mx-2","aria-label":"Quiz Preferences",title:"Quiz Preferences",children:e.jsx("i",{className:`fa-solid fa-gear text-base ${$?"animate-settings-init":""}`})})]}),r.questions.length===0?e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-lg text-[var(--text-secondary)]",children:"This quiz has no questions yet."})}):s?R():T==="oneByOne"&&q?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm text-[var(--text-secondary)] mb-1",children:[e.jsxs("span",{className:"flex-1",children:["Question ",i+1," of ",r.questions.length]}),J&&x&&e.jsx("span",{className:`font-semibold flex-1 text-right ${x==="Correct"?"text-[var(--accent-green)]":"text-[var(--accent-red)]"}`,children:x})]}),e.jsx("div",{className:"bg-[var(--border-color)] rounded-full h-2.5 w-full",role:"progressbar","aria-valuenow":i+1,"aria-valuemin":1,"aria-valuemax":r.questions.length,"aria-label":"Quiz progress",children:e.jsx("div",{className:"bg-[var(--accent-primary)] h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${p}%`}})})]}),e.jsx(St,{question:q,questionNumber:i+1,selectedOptionId:k,isSubmitted:l,onOptionSelect:c,correctOptionIdForDisplay:x&&J?q.correctOptionId:void 0}),e.jsxs("div",{className:"mt-8 sm:mt-10 flex justify-between items-center",children:[e.jsx("div",{className:"w-14 h-14 flex items-center justify-center",children:y&&e.jsx("button",{onClick:N,className:K,"aria-label":"Previous Question",title:"Previous Question",children:e.jsx("i",{className:"fa-solid fa-chevron-left fa-lg"})})}),e.jsx("div",{className:"flex-grow flex justify-center items-center min-h-[3.5rem] sm:min-h-[4rem]",children:H&&e.jsx("button",{onClick:b,disabled:F,className:`${B} focus:ring-offset-[var(--bg-primary)]`,"aria-label":"Submit Answer",title:"Submit Answer",children:e.jsx("i",{className:"fa-solid fa-circle-check fa-xl"})})}),e.jsx("div",{className:"w-14 h-14 flex items-center justify-center",children:A&&e.jsx("button",{onClick:O,disabled:te,className:K,"aria-label":C?"Finish Quiz":"Next Question",title:C?"Finish Quiz":"Next Question",children:e.jsx("i",{className:`fa-solid ${C?"fa-flag-checkered":"fa-chevron-right"} fa-lg`})})})]})]}):T==="listed"?e.jsxs("div",{className:"space-y-8",children:[r.questions.map((D,L)=>{const G=o[L],Q=G!=null,ae=!!(G&&G.feedback!==null),re=w==="immediate"?ae:s,Z=Q?G.selectedOptionId:null,se=(w==="immediate"||s)&&ae&&D.type==="mcq"?D.correctOptionId:void 0;return e.jsx("div",{className:"py-4 border-b border-[var(--border-color)] last:border-b-0",children:e.jsx(St,{question:D,questionNumber:L+1,selectedOptionId:Z,isSubmitted:re,onOptionSelect:ne=>f(ne,L),correctOptionIdForDisplay:se})},D.id)}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:O,className:_,"aria-label":"Finish Quiz",title:"Finish Quiz",children:[e.jsx("i",{className:"fa-solid fa-flag-checkered fa-lg mr-2"}),"Finish Quiz"]})})]}):e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-lg text-[var(--text-secondary)]",children:"Loading questions..."})})]})},Nt="w-full p-3 border rounded-md focus:ring-2 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",bt="block text-sm font-medium text-[var(--text-secondary)] mb-1",Ht="bg-[var(--bg-secondary)] p-4 sm:p-6 rounded-lg shadow-lg",Vt="w-full py-2.5 px-4 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",It=({subjectId:r,quizId:i,quizName:o,existingQuestion:t,onSaveQuestion:s,maxOptions:c})=>{var ee;const[f,b]=n.useState("mcq"),[z,N]=n.useState(""),[g,v]=n.useState(Array(c).fill(null).map(()=>({text:""}))),[w,T]=n.useState(null),[j,$]=n.useState(null),I=U=>{if(b(U?"mcq":(t==null?void 0:t.type)||"mcq"),N(U?"":(t==null?void 0:t.questionText)||""),!U&&(t==null?void 0:t.type)==="mcq"&&(t!=null&&t.options)){const l=Array(c).fill(null).map(()=>({text:""}));let k=null;t.options.forEach((p,y)=>{y<c&&(l[y]={text:p.text})});const x=t.options.find(p=>p.id===t.correctOptionId);if(x){const p=l.findIndex(y=>y.text===x.text);p!==-1&&(k=p)}v(l),T(k)}else v(Array(c).fill(null).map(()=>({text:""}))),T(null);$(null)};n.useEffect(()=>{I(!t)},[t,c]);const q=(U,l)=>{const k=[...g];k[U]={text:l},v(k),l.trim()===""&&w===U&&T(null)},Y=U=>{if(U.preventDefault(),$(null),!z.trim()){$("Question text cannot be empty.");return}let l;if(f==="mcq"){const k=g.map((A,H)=>({text:A.text.trim(),originalIndex:H})).filter(A=>A.text!=="");if(k.length<2){$("Please provide at least two answer options for an MCQ.");return}if(w===null||g[w].text.trim()===""){$("Please select a correct answer from the non-empty options for an MCQ.");return}const x=k.map((A,H)=>({id:`option-${H}`,text:A.text})),p=g[w].text.trim(),y=x.find(A=>A.text===p);if(!y){$("Error determining correct option ID. The selected correct option might be empty or not among the provided options.");return}const C=y.id;l={questionText:z.trim(),type:"mcq",options:x,correctOptionId:C}}else l={questionText:z.trim(),type:"written",options:void 0,correctOptionId:void 0};t?s(r,i,{...l,id:t.id}):(s(r,i,l),I(!0))},J=t?"Update Question":"Add Question";return e.jsxs("div",{className:`${Ht} mt-3 mb-3 sm:mt-4 sm:mb-4`,children:[t&&e.jsxs("p",{className:"text-sm text-[var(--text-secondary)] mb-3 -mt-2",children:['Editing: "',t.questionText.substring(0,50),'..." (',(ee=t.type)==null?void 0:ee.toUpperCase(),")"]}),e.jsxs("form",{onSubmit:Y,className:"space-y-6 p-4 bg-[var(--bg-secondary)] rounded-md border border-[var(--border-color)] shadow-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:`${bt} text-[var(--text-primary)]`,children:"Question Type"}),e.jsxs("div",{className:"flex space-x-4 text-[var(--text-primary)]",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"questionType",value:"mcq",checked:f==="mcq",onChange:()=>b("mcq"),className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{children:"Multiple Choice (MCQ)"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"questionType",value:"written",checked:f==="written",onChange:()=>b("written"),className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{children:"Written Response"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"questionText",className:bt,children:"Question Text"}),e.jsx("textarea",{id:"questionText",rows:3,value:z,onChange:U=>N(U.target.value),className:Nt,placeholder:"Enter the question"})]}),f==="mcq"&&e.jsxs("fieldset",{children:[e.jsxs("legend",{className:`text-md font-medium ${bt} mb-2`,children:["Answer Options (Provide 2 to ",c,")"]}),e.jsx("div",{className:"space-y-3",children:g.map((U,l)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",id:`correctAnswer-${l}-${t?t.id:"new"}`,name:`correctAnswer-${t?t.id:"new"}`,value:l,checked:w===l,onChange:()=>T(l),disabled:U.text.trim()==="",className:"h-4 w-4 text-[var(--accent-primary)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] shrink-0 cursor-pointer bg-[var(--input-bg)]","aria-label":`Mark option ${String.fromCharCode(65+l)} as correct`}),e.jsxs("label",{htmlFor:`optionText-${l}-${t?t.id:"new"}`,className:"text-[var(--text-primary)] w-6 text-left font-medium",children:[String.fromCharCode(65+l),"."]}),e.jsx("input",{id:`optionText-${l}-${t?t.id:"new"}`,type:"text",value:U.text,onChange:k=>q(l,k.target.value),className:`${Nt} flex-grow option-text-input`,placeholder:`Option ${String.fromCharCode(65+l)} text`,"data-option-index":l})]},l))})]}),j&&e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mt-2",children:j}),e.jsx("div",{className:"flex flex-col pt-2",children:e.jsx("button",{type:"submit",className:Vt,children:J})})]})]})},Wt=({question:r,questionNumber:i,onEdit:o,onDelete:t})=>{var f,b,z;let s="";if(r.type==="written")s="Type: Written";else{const N=((b=(f=r.options)==null?void 0:f.find(g=>g.id===r.correctOptionId))==null?void 0:b.text)||"N/A";s=`${((z=r.options)==null?void 0:z.length)||0} options, Correct: ${N.substring(0,25)}${N.length>25?"...":""}`}const c={userSelect:"none",transition:"background-color 0.2s ease, border-color 0.2s ease"};return e.jsxs("li",{className:"flex items-center justify-between p-3 bg-[var(--bg-primary)] rounded-md border border-[var(--border-color)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20 hover:border-[var(--accent-secondary)] shadow-sm",style:c,children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-primary)] truncate",title:r.questionText,children:[e.jsxs("span",{className:"font-semibold",children:[i,"."]})," ",r.questionText,e.jsxs("span",{className:"text-xs text-[var(--text-secondary)] ml-1",children:["(",r.type==="written"?"Written":"MCQ",")"]})]}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)]",children:s})]}),e.jsxs("div",{className:"flex space-x-2 ml-2 shrink-0",children:[e.jsx("button",{onClick:o,className:"edit-question-button px-3 py-1 text-xs bg-[var(--accent-amber)] hover:bg-[var(--accent-amber-hover)] text-[var(--btn-amber-text)] rounded-md transition-colors","aria-label":`Edit question: ${r.questionText.substring(0,30)}...`,children:"Edit"}),e.jsxs("button",{onClick:t,className:"delete-question-button px-3 py-1 text-xs bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white rounded-md transition-colors flex items-center space-x-1","aria-label":`Delete question: ${r.questionText.substring(0,30)}...`,children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw"}),e.jsx("span",{children:"Delete"})]})]})]})},Yt=({onConfirm:r,label:i,holdTimeMs:o=3e3})=>{const[t,s]=n.useState(!1),[c,f]=n.useState(0),[b,z]=n.useState(i),N=n.useRef(null),g=n.useRef(null),v=n.useRef(null),w=n.useCallback(()=>{s(!1),f(0),z(i),N.current&&clearTimeout(N.current),v.current&&cancelAnimationFrame(v.current),g.current=null},[i]),T=n.useCallback(()=>{if(!g.current){w();return}const $=Date.now()-g.current,I=Math.min($/o*100,100);f(I);const q=Math.ceil(Math.max(0,o-$)/1e3);z(`${q}s`),I>=100?(r(),w()):v.current=requestAnimationFrame(T)},[o,r,w]),j=n.useCallback(()=>{t||(s(!0),g.current=Date.now(),f(0),v.current&&cancelAnimationFrame(v.current),v.current=requestAnimationFrame(T))},[t,T]);return n.useEffect(()=>()=>{w()},[w]),n.useEffect(()=>{t||z(i)},[i,t]),e.jsxs("button",{type:"button",className:"relative w-full px-3 py-1.5 text-sm text-white rounded-md transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center space-x-2 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] focus:ring-[var(--accent-red)] focus:ring-offset-[var(--bg-secondary)] overflow-hidden",onMouseDown:j,onMouseUp:w,onMouseLeave:w,onTouchStart:j,onTouchEnd:w,onTouchCancel:w,"aria-label":`Hold to confirm ${i}`,children:[e.jsx("span",{className:"button-hold-progress",style:{width:`${c}%`}}),e.jsxs("span",{className:"relative z-10 flex items-center space-x-1.5 select-none",children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw shrink-0"}),e.jsx("span",{className:"button-label truncate",children:b})]})]})},Jt=({isOpen:r,title:i,message:o,requiredPassword:t,onConfirm:s,onCancel:c,confirmButtonText:f="Confirm",cancelButtonText:b="Cancel"})=>{const[z,N]=n.useState(""),[g,v]=n.useState(null);if(n.useEffect(()=>{r&&(N(""),v(null))},[r]),!r)return null;const w=j=>{j==null||j.preventDefault(),t?z===t?s():v("Incorrect password. Please try again."):s()},T=document.getElementById("modal-root");return T?pe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"confirmation-modal-title",onClick:c,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",onClick:j=>j.stopPropagation(),children:[e.jsx("h2",{id:"confirmation-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)] mb-4 text-center",children:i}),e.jsx("div",{className:"text-sm text-[var(--text-primary)] mb-6 text-center",children:o}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[t&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-[var(--text-secondary)] mb-1",children:"Enter Password to Confirm"}),e.jsx("input",{type:"password",id:"confirmPassword",value:z,onChange:j=>N(j.target.value),className:"w-full p-3 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)] text-[var(--input-text)] focus:ring-2 focus:ring-[var(--input-focus-ring)] focus:border-[var(--input-focus-ring)] placeholder-[var(--placeholder-color)]",placeholder:"Enter confirmation password",required:!0})]}),g&&e.jsx("p",{className:"text-red-500 text-sm text-center -mt-2",children:g}),e.jsxs("div",{className:"flex flex-col sm:flex-row-reverse gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:f}),e.jsx("button",{type:"button",onClick:c,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:b})]})]})]})}),T):(console.error("Modal root element 'modal-root' not found for ConfirmationModal."),null)},Kt="YOUR_GITHUB_RAW_DATA_JSON_URL_HERE_OR_LEAVE_EMPTY_TO_ALWAYS_USE_LOCAL_FALLBACK",Xt="YOUR_GOOGLE_APPS_SCRIPT_URL_FOR_PAT_HERE_IF_NOT_USING_DEFAULT",Zt="YOUR_APPS_SCRIPT_SHARED_SECRET_HERE",Me={GITHUB_DATA_URL:"https://github.com/Rustova/Q/blob/main/data.json",DEFAULT_THEME:"dark",GOOGLE_APPS_SCRIPT_PAT_FETCHER_URL:"https://script.google.com/macros/s/AKfycbz-AFYjxhI7KH_IfXAfm1dr5C5XM3D1YKw8AkyljTvDS-dPbKDnYPYMlWnloQTvifDzdw/exec",APPS_SCRIPT_SHARED_SECRET:Zt},er=({isOpen:r,onClose:i,subjectId:o,quizId:t,quizName:s,existingQuestion:c,onSaveQuestion:f,maxOptions:b})=>{if(!r)return null;const z=document.getElementById("modal-root");if(!z)return console.error("Modal root element 'modal-root' not found."),null;const N=(g,v,w)=>{f(g,v,w)};return pe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"edit-question-modal-title",onClick:i,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:g=>g.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl",children:[e.jsxs("h2",{id:"edit-question-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:['Edit Question in: "',s,'"']}),e.jsx("button",{onClick:i,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close edit question modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsx("div",{className:"p-1 overflow-y-auto flex-grow custom-scrollbar",children:e.jsx(It,{subjectId:o,quizId:t,quizName:s,existingQuestion:c,onSaveQuestion:N,maxOptions:b},c.id)})]})}),z)},tr=({isOpen:r,quizName:i,initialQuestions:o,onConfirmReorder:t,onClose:s})=>{const[c,f]=n.useState([]);if(n.useEffect(()=>{f([...o])},[o,r]),n.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]),!r)return null;const b=g=>{if(!g.destination)return;const v=Array.from(c),[w]=v.splice(g.source.index,1);v.splice(g.destination.index,0,w),f(v)},z=()=>{t(c)},N=document.getElementById("modal-root");return N?pe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-[51] p-4",role:"dialog","aria-modal":"true","aria-labelledby":"reorder-questions-modal-title",onClick:s,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:g=>g.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl",children:[e.jsxs("h2",{id:"reorder-questions-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)] truncate min-w-0 mr-2",title:`Reorder Questions for: "${i}"`,children:['Reorder Questions for: "',e.jsx("span",{className:"truncate",children:i}),'"']}),e.jsx("button",{onClick:s,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close reorder questions modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-xl"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 overflow-y-auto flex-grow custom-scrollbar",children:[e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-4",children:"Drag and drop the questions to change their order."}),e.jsx(Et,{onDragEnd:b,children:e.jsx($t,{droppableId:"questionsReorderList",children:g=>e.jsxs("ul",{...g.droppableProps,ref:g.innerRef,className:"space-y-2",children:[c.map((v,w)=>e.jsx(Ot,{draggableId:v.id,index:w,children:(T,j)=>e.jsxs("li",{ref:T.innerRef,...T.draggableProps,className:`border rounded-md flex 
                            ${j.isDragging?"bg-[var(--accent-primary)] bg-opacity-20 shadow-lg border-[var(--accent-primary)]":"bg-[var(--bg-primary)] border-[var(--border-color)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20"}`,children:[e.jsx("div",{className:"p-3 flex-grow min-w-0",children:e.jsxs("span",{className:"text-sm text-[var(--text-primary)] truncate block",title:v.questionText,children:[e.jsxs("span",{className:"font-medium mr-1",children:[w+1,"."]}),v.questionText,e.jsxs("span",{className:"text-xs text-[var(--accent-secondary)] ml-1.5",children:["(",v.type==="mcq"?"MCQ":"Written",")"]})]})}),e.jsx("div",{...T.dragHandleProps,className:"px-5 py-3 bg-[var(--accent-secondary)] hover:bg-[var(--accent-secondary-hover)] text-[var(--text-primary)] rounded-r-md cursor-grab active:cursor-grabbing flex items-center justify-center shrink-0","aria-label":"Drag to reorder question",children:e.jsx("i",{className:"fa-solid fa-sort fa-fw fa-xl text-[var(--text-primary)]"})})]})},v.id)),g.placeholder]})})}),o.length===0&&e.jsx("p",{className:"text-[var(--text-secondary)] text-center py-4",children:"This quiz has no questions to reorder."})]}),e.jsx("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-end space-x-3",children:e.jsx("button",{onClick:z,disabled:o.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50",children:"Save Order"})})]})}),N):(console.error("Modal root element 'modal-root' not found."),null)},At=({textToType:r,speed:i=50,className:o,title:t})=>{const[s,c]=n.useState("");return n.useEffect(()=>{c("");const f=r||"";if(f){let b=0;const z=setInterval(()=>{b++,c(f.substring(0,b)),b>=f.length&&clearInterval(z)},i);return()=>clearInterval(z)}else c("")},[r,i]),e.jsx("span",{className:o,title:t||r,children:s})},Je="w-full p-3 border rounded-md focus:ring-2 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",Ct="w-full p-3 border rounded-md focus:ring-2 bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",zt="px-4 py-2 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)]",ht="px-4 py-2 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)]",rr="px-4 py-2 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]",sr="px-4 py-2 bg-[var(--accent-green)] hover:bg-[var(--accent-green-hover)] text-white rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--accent-green)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",Fe="block text-sm font-medium text-[var(--text-secondary)] mb-1",Ke="bg-[var(--bg-secondary)] p-4 sm:p-6 rounded-lg shadow-lg border border-[var(--border-color)]",ar="a7f39d5b1c",nr=r=>{try{const i=new URL(r);if(i.hostname==="raw.githubusercontent.com"){const o=i.pathname.split("/").filter(Boolean);return o.length<4?(console.error("Invalid GitHub Raw URL: Path too short. Expected owner/repo/branch/path... Given:",r),null):{owner:o[0],repo:o[1],branch:o[2],path:o.slice(3).join("/")}}if(i.hostname==="github.com"){const o=/^\/([^\/]+)\/([^\/]+)\/blob\/([^\/]+)\/(.+)$/,t=i.pathname.match(o);if(t){const[,s,c,f,b]=t;return{owner:s,repo:c,branch:f,path:b.replace(/\?.*$/,"")}}}if(i.hostname==="api.github.com"&&i.pathname.startsWith("/repos/")){const o=i.pathname.split("/").filter(Boolean);if(o.length>=5&&o[0]==="repos"&&o[3]==="contents"){const s=new URLSearchParams(i.search).get("ref")||"main";return{owner:o[1],repo:o[2],branch:s,path:o.slice(4).join("/")}}}return console.warn(`URL (${r}) is not a recognized GitHub raw, blob, or API URL for saving. Saving via GitHub API might fail.`),null}catch(i){return console.error("Error parsing GitHub URL for saving:",r,i),null}},or=r=>{const{subjects:i,allSubjectsData:o,activeSubjectId:t,activeQuizId:s,editingQuestion:c,setEditingQuestion:f,onSetActiveSubjectId:b,onCreateSubject:z,onUpdateSubjectName:N,onDeleteSubject:g,onSetActiveQuizId:v,onCreateQuiz:w,onUpdateQuizName:T,onDeleteQuiz:j,onToggleQuizStartable:$,onAddQuestion:I,onUpdateQuestion:q,onDeleteQuestion:Y,onReorderQuestions:J,onReorderAllQuizzesByTypeGlobal:ee,maxOptions:U,showManageSubjectsSection:l,setShowManageSubjectsSection:k,showManageQuizzesSection:x,setShowManageQuizzesSection:p,activeAdminSubject:y,activeAdminQuiz:C,githubPat:A,setGithubPat:H}=r,[F,te]=n.useState(""),[O,K]=n.useState(""),[B,_]=n.useState(""),[R,D]=n.useState(""),[L,G]=n.useState(!0),[Q,ae]=n.useState(!1),[re,Z]=n.useState(null),se=Me.GITHUB_DATA_URL!==Kt,[ne,ce]=n.useState(!1),[ue,xe]=n.useState(!1),[ie,fe]=n.useState(!1),[oe,be]=n.useState(null),he=Me.GOOGLE_APPS_SCRIPT_PAT_FETCHER_URL!==Xt,[Se,de]=n.useState(!1),[Ue,Pe]=n.useState(null),[Xe,Ze]=n.useState(""),[et,Be]=n.useState("");n.useEffect(()=>{ce(!!c)},[c]),n.useEffect(()=>{K((y==null?void 0:y.name)||"")},[y]),n.useEffect(()=>{D((C==null?void 0:C.name)||"")},[C]);const Ee=n.useCallback(async()=>{fe(!0),be({message:"Fetching PAT...",type:"info"});try{const S=Me.GOOGLE_APPS_SCRIPT_PAT_FETCHER_URL,V=await fetch(S,{method:"GET"}),X=await V.json().catch(async()=>({error:`Non-JSON response from server: ${(await V.text()).substring(0,150)}...`}));if(!V.ok){const ge=X.error||`${V.status} ${V.statusText}`;throw new Error(`Failed to fetch PAT: ${ge}`)}if(X&&typeof X.pat=="string"&&X.pat.trim()!=="")H(X.pat.trim()),be({message:"PAT fetched and updated successfully!",type:"success"});else throw X.error?new Error(`Error from source: ${X.error}`):new Error('Invalid PAT data received. Expected a "pat" field with a non-empty string.')}catch(S){console.error("Error fetching PAT from sheet:",S);const V=S instanceof Error?S.message:String(S);be({message:`Error fetching PAT: ${V}`,type:"error"})}finally{fe(!1)}},[he,be,H]);n.useEffect(()=>{Ee()},[he,Ee]);const Ne=(S,V,X)=>{Ze(S),Be(V),Pe(()=>X),de(!0)},_e=()=>{Ue&&Ue(),de(!1),Pe(null)},$e=()=>{de(!1),Pe(null)},Ae=()=>{if(!F.trim()){alert("Subject name cannot be empty.");return}if(i.some(S=>S.name.toLowerCase()===F.trim().toLowerCase())){alert(`A subject with the name "${F.trim()}" already exists. Please choose a different name.`);return}Ne("Confirm Create Subject",e.jsxs("p",{children:["Are you sure you want to create the subject: ",e.jsx("strong",{children:F.trim()}),"?"]}),()=>{z(F.trim()),te("")})},tt=S=>{b(S.target.value||null)},rt=()=>{if(!t||!O.trim()){alert("No subject selected or name is empty.");return}const S=y==null?void 0:y.name;Ne("Confirm Update Subject Name",e.jsxs("p",{children:['Are you sure you want to rename the subject from "',e.jsx("strong",{children:S}),'" to "',e.jsx("strong",{children:O.trim()}),'"?']}),()=>{N(t,O.trim())})},st=()=>{t&&y?Ne("Confirm Delete Subject",e.jsxs("p",{children:["Are you sure you want to delete the subject: ",e.jsx("strong",{children:y.name}),"? This action cannot be undone and will delete all its quizzes and questions."]}),()=>g(t)):alert("No subject selected to delete.")},at=()=>{if(!t||!B.trim()){alert("No subject selected or quiz name is empty.");return}w(t,B.trim()),_("")},nt=S=>{v(S.target.value||null)},ot=()=>{if(!t||!s||!R.trim()){alert("No subject/quiz selected or name is empty.");return}T(t,s,R.trim())},it=()=>{t&&s&&C?j(t,s):alert("No quiz selected to delete.")},lt=()=>{t&&s&&$(t,s)},ct=S=>{f(S)},dt=S=>{console.log("[AdminView] handleDeleteQuestionClick called for question ID:",S),t&&s&&C?C.questions.find(X=>X.id===S)?Y(t,s,S):(alert(`Question not found in the current quiz (ID: ${S}). It might have already been deleted.`),console.warn(`[AdminView] Attempted to delete question ID ${S}, but it was not found in activeAdminQuiz.questions.`)):(alert("Cannot delete question: context missing (subject/quiz). Please ensure a quiz is selected."),console.error(`[AdminView] handleDeleteQuestionClick: Context missing. activeSubjectId: ${t}, activeQuizId: ${s}.`))},Qe=(S,V,X)=>{"id"in X?q(S,V,X):I(S,V,X),f(null)},mt=()=>{C&&xe(!0)},ut=S=>{t&&s&&J(t,s,S),xe(!1)},Ge=()=>{Ne("Confirm Global Question Reorder",e.jsxs("span",{children:["This will reorder questions in ",e.jsx("strong",{children:"ALL quizzes"})," across ",e.jsx("strong",{children:"ALL subjects"}),". Written questions will be moved before MCQ questions within each quiz. This action cannot be undone. Please enter the password to confirm."]}),()=>{ee()})},ft=async()=>{if(!A){Z({message:"A PAT is required to save data. Please ensure it is fetched successfully.",type:"error"});return}ae(!0),Z({message:"Saving Data...",type:"info"});const S=nr(Me.GITHUB_DATA_URL);if(!S){Z({message:"Could not parse GitHub URL. Check console for details and ensure it's a raw, blob, or API URL.",type:"error"}),ae(!1);return}console.log("GitHub Repo Info for Save:",S);const{owner:V,repo:X,branch:ge,path:xt}=S,De=`https://api.github.com/repos/${V}/${X}/contents/${xt}`,le="Quiz App: Update application data via Web Editor",Re={lastUpdated:new Date().toISOString(),subjects:o},ve=JSON.stringify(Re,null,2),He=btoa(unescape(encodeURIComponent(ve)));try{let ye;const qe=new URL(De);qe.searchParams.append("ref",ge),qe.searchParams.append("_cb_sha",Date.now().toString());try{const m=await fetch(qe.toString(),{method:"GET",headers:{Authorization:`token ${A}`,Accept:"application/vnd.github.v3+json"}});if(m.ok)ye=(await m.json()).sha,console.log("Fetched current file SHA:",ye);else if(m.status!==404){const a=await m.text();throw new Error(`Failed to get current file SHA: ${m.status} - ${a}`)}else console.log("File not found (404) when fetching SHA. Will attempt to create a new file.")}catch(m){throw console.error("Error fetching file SHA:",m),new Error(`Network or unexpected error fetching file SHA: ${m.message}`)}const Te=await fetch(De,{method:"PUT",headers:{Authorization:`token ${A}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({message:le,content:He,sha:ye,branch:ge})});if(!Te.ok){const m=await Te.json();throw console.error("GitHub API Error Data during PUT:",m),new Error(`GitHub API error: ${Te.status} - ${m.message||"Unknown error"}`)}const d=await Te.json();console.log("Save successful:",d),Z({message:"Data saved successfully!",type:"success"})}catch(ye){console.error("Error saving data:",ye),Z({message:`Error saving data: ${ye.message}`,type:"error"})}finally{ae(!1)}},Oe=S=>{S(V=>!V)};let Ce="fa-cloud-arrow-down",ze="Fetch PAT";return ie?(Ce="fa-spinner fa-spin",ze="Fetching PAT..."):(oe==null?void 0:oe.type)==="success"&&A?(Ce="fa-check",ze="PAT Synced"):(oe==null?void 0:oe.type)==="error"&&(Ce="fa-rotate-right",ze="Fetch Failed. Retry?"),e.jsxs("div",{className:"space-y-6 sm:space-y-8 pb-8",children:[e.jsxs("section",{className:Ke,"aria-labelledby":"manage-subjects-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Oe(k),children:[e.jsx("h2",{id:"manage-subjects-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:"Manage Subjects"}),e.jsx("i",{className:`fa-solid ${l?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newSubjectName",className:Fe,children:"Create New Subject"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",id:"newSubjectName",value:F,onChange:S=>te(S.target.value),placeholder:"Enter name for new subject",className:Je}),e.jsxs("button",{onClick:Ae,className:zt,"aria-label":"Create New Subject",children:[e.jsx("i",{className:"fa-solid fa-plus fa-fw"})," Create Subject"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectSubjectToManage",className:Fe,children:"Select Subject to Manage"}),e.jsxs("select",{id:"selectSubjectToManage",value:t||"",onChange:tt,className:Ct,children:[e.jsx("option",{value:"",children:"-- Select a Subject --"}),i.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),t&&y&&e.jsxs("div",{className:"p-3 border border-[var(--border-color)] bg-[var(--bg-primary)] rounded-md space-y-3 mt-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:["Managing:",e.jsx(At,{textToType:y.name,className:"font-semibold text-[var(--text-primary)] truncate max-w-[200px] sm:max-w-xs inline-block align-bottom",title:y.name},y.id)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",value:O,onChange:S=>K(S.target.value),placeholder:"New name for selected subject",className:Je,"aria-label":"New name for selected subject"}),e.jsxs("button",{onClick:rt,className:ht,"aria-label":"Update Selected Subject Name",children:[e.jsx("i",{className:"fa-solid fa-pen-to-square fa-fw"})," Update Name"]})]}),e.jsxs("button",{onClick:st,className:`${rr} w-full`,"aria-label":"Delete Selected Subject",children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw"})," Delete Subject"]})]}),!t&&e.jsx("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:"Select a subject above to manage its details and quizzes."})]})]}),t&&y&&e.jsxs("section",{className:Ke,"aria-labelledby":"manage-quizzes-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Oe(p),children:[e.jsxs("h2",{id:"manage-quizzes-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:["Manage Quizzes for: ",e.jsx("span",{className:"truncate",children:y.name})]}),e.jsx("i",{className:`fa-solid ${x?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),x&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newQuizName",className:Fe,children:"Create New Quiz"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",id:"newQuizName",value:B,onChange:S=>_(S.target.value),placeholder:"Enter name for new quiz",className:Je}),e.jsxs("button",{onClick:at,className:zt,"aria-label":"Create New Quiz",children:[e.jsx("i",{className:"fa-solid fa-plus fa-fw"})," Create Quiz"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectQuizToManage",className:Fe,children:"Select Quiz to Manage"}),e.jsxs("select",{id:"selectQuizToManage",value:s||"",onChange:nt,className:Ct,children:[e.jsx("option",{value:"",children:"-- Select a Quiz --"}),y.quizzes.map(S=>e.jsxs("option",{value:S.id,children:[S.name,!S.isStartable&&" (Not Available)"]},S.id))]})]}),s&&C&&e.jsxs("div",{className:"p-3 border border-[var(--border-color)] bg-[var(--bg-primary)] rounded-md space-y-3 mt-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:["Managing:",e.jsx(At,{textToType:C.name,className:"font-semibold text-[var(--text-primary)]",title:C.name},C.id)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",value:R,onChange:S=>D(S.target.value),placeholder:"New name for selected quiz",className:Je,"aria-label":"New name for selected quiz"}),e.jsxs("button",{onClick:ot,className:ht,"aria-label":"Update Selected Quiz Name",children:[e.jsx("i",{className:"fa-solid fa-pen-to-square fa-fw"})," Update Name"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md bg-[var(--input-bg)] border border-[var(--input-border)]",children:[e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"Available to users"}),e.jsx("button",{onClick:lt,className:`rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--input-bg)]
                          ${C.isStartable?"focus:ring-[var(--accent-green)]":"focus:ring-[var(--accent-secondary)]"} flex items-center justify-center p-1`,"aria-checked":C.isStartable,role:"switch",title:C.isStartable?"Click to make unavailable to users":"Click to make available to users",children:e.jsxs("div",{className:"relative inline-block w-12 h-6 select-none",children:[e.jsx("div",{className:`toggle-track absolute w-12 h-6 rounded-full shadow-inner transition-colors duration-200 ease-in-out ${C.isStartable?"bg-[var(--accent-green)]":"bg-[var(--accent-secondary)]"}`}),e.jsx("div",{className:`toggle-knob absolute w-5 h-5 bg-white rounded-full shadow top-0.5 left-0.5 transition-transform duration-200 ease-in-out transform ${C.isStartable?"translate-x-6":"translate-x-0"}`})]})})]}),e.jsx(Yt,{onConfirm:()=>it(),label:"Delete Quiz",holdTimeMs:3e3})]}),!s&&y.quizzes.length>0&&e.jsx("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:"Select a quiz above to manage its questions and details."}),y.quizzes.length===0&&e.jsxs("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:['No quizzes created yet for "',y.name,'".']})]})]}),t&&s&&C&&e.jsxs("section",{className:`${Ke} mt-6`,"aria-labelledby":"manage-questions-heading",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h2",{id:"manage-questions-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:["Manage Questions for: ",e.jsx("span",{className:"truncate",children:C.name})]})}),e.jsx(It,{subjectId:t,quizId:s,quizName:C.name,existingQuestion:null,onSaveQuestion:Qe,maxOptions:U}),ne&&c&&e.jsx(er,{isOpen:ne,onClose:()=>f(null),subjectId:t,quizId:s,quizName:C.name,existingQuestion:c,onSaveQuestion:Qe,maxOptions:U}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center mb-3",children:[e.jsxs("h3",{className:"text-lg font-medium text-[var(--text-primary)]",children:["Current Questions (",C.questions.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[C.questions.length>0&&e.jsxs("button",{onClick:Ge,className:"px-2.5 py-1 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center space-x-1","aria-label":"Sort all questions globally by type (Written then MCQ)",title:"Sort All Quizzes by Type (Global)",children:[e.jsx("i",{className:"fa-solid fa-arrow-up-wide-short"}),e.jsx("span",{children:"Sort All by Type (Global)"})]}),C.questions.length>1&&e.jsxs("button",{onClick:mt,className:"px-2.5 py-1 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center space-x-1","aria-label":"Reorder questions for current quiz",title:"Reorder Questions (Current Quiz)",children:[e.jsx("i",{className:"fa-solid fa-sort"})," ",e.jsx("span",{children:"Reorder"})]})]})]}),C.questions.length===0?e.jsx("p",{className:"text-[var(--text-secondary)] text-center py-3",children:"No questions added yet. Use the form above to add some!"}):e.jsx("ul",{className:"space-y-2",children:C.questions.map((S,V)=>e.jsx(Wt,{question:S,questionNumber:V+1,onEdit:()=>ct(S),onDelete:()=>dt(S.id)},S.id))}),ue&&C&&e.jsx(tr,{isOpen:ue,quizName:C.name,initialQuestions:C.questions,onConfirmReorder:ut,onClose:()=>xe(!1)})]})]}),e.jsxs("section",{className:Ke,"aria-labelledby":"app-data-management-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Oe(G),children:[e.jsx("h2",{id:"app-data-management-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:"Application Data Management"}),e.jsx("i",{className:`fa-solid ${L?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),L&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:Fe,children:"Personal Access Token (PAT)"}),e.jsxs("p",{className:"text-xs text-[var(--text-secondary)] mt-1 mb-2",children:["Your PAT is stored in browser localStorage. It needs 'repo' scope (Classic PAT) or 'Contents: Read & Write' (Fine-Grained PAT) for the repository containing the application data.",e.jsx("a",{href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens",target:"_blank",rel:"noopener noreferrer",className:"text-[var(--accent-primary)] hover:underline ml-1",children:"More info"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:Ee,disabled:ie||!he,className:`${ht} w-full sm:w-auto ${ie||!he?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("i",{className:`fa-solid ${Ce} fa-fw`}),ze]}),oe&&e.jsx("p",{className:`text-xs mt-1.5 text-center ${oe.type==="error"?"text-red-400":oe.type==="success"?"text-green-400":"text-[var(--text-secondary)]"}`,children:oe.message})]}),e.jsxs("button",{onClick:ft,disabled:Q||!se||!A,className:`${sr} w-full sm:w-auto ${Q||!se||!A?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("i",{className:`fa-solid ${Q?"fa-spinner fa-spin":"fa-save"} fa-fw`}),Q?"Saving Data...":"Save Data"]}),!se,!A&&se&&e.jsx("p",{className:"text-xs text-[var(--text-secondary)] text-center mt-1",children:'A PAT is required to enable saving. Please use the "Fetch PAT" button or ensure automatic fetching is successful.'}),re&&e.jsx("p",{className:`text-sm mt-2 text-center ${re.type==="error"?"text-red-400":re.type==="success"?"text-green-400":"text-[var(--text-secondary)]"}`,children:re.message}),e.jsx("div",{className:"mt-4 p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("i",{className:"fa-solid fa-circle-info text-[var(--accent-secondary)] mt-1 text-lg"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-[var(--text-primary)]",children:"Saving Your Work"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)]",children:"Manage your subjects, quizzes, and questions using the sections above. If data saving is configured, ensure your PAT is fetched successfully and click 'Save Data' to store all changes."})]})]})})]})]}),Se&&e.jsx(Jt,{isOpen:Se,title:Xe,message:et,requiredPassword:ar,onConfirm:_e,onCancel:$e})]})},ir=({isOpen:r,onClose:i,timestamp:o})=>{if(!r)return null;let t="N/A",s="N/A",c="Timestamp not available.";if(o)try{const b=new Date(o);isNaN(b.getTime())?c="Invalid timestamp provided.":(t=b.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),s=b.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"}),c=`This content was last updated on: ${b.toString()}`)}catch(b){console.error("Error formatting timestamp for modal:",b),c="Error displaying timestamp."}const f=document.getElementById("modal-root");return f?pe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"timestamp-modal-title",onClick:i,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",onClick:b=>b.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between pb-4 mb-4 border-b border-[var(--border-color)]",children:[e.jsx("h2",{id:"timestamp-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)]",children:"Content Update Information"}),e.jsx("button",{onClick:i,className:"p-1.5 text-[var(--text-secondary)] hover:text-[var(--accent-red)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close timestamp information modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"text-sm text-[var(--text-primary)] space-y-2",children:[e.jsx("p",{children:c}),o&&!isNaN(new Date(o).getTime())&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",t]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",s]})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-[var(--border-color)] flex justify-end",children:e.jsx("button",{type:"button",onClick:i,className:"px-5 py-2 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] text-sm",children:"Close"})})]})}),f):(console.error("Modal root element 'modal-root' not found for TimestampModal."),null)},lr=({isOpen:r,onClose:i,currentCorrectionMode:o,onSetCorrectionMode:t,currentQuestionDisplayMode:s,onSetQuestionDisplayMode:c})=>{const[f,b]=n.useState(o),[z,N]=n.useState(s);if(n.useEffect(()=>{r&&(b(o),N(s))},[r,o,s]),!r)return null;const g=j=>{b(j.target.value)},v=j=>{N(j.target.value)},w=()=>{t(f),c(z)},T=document.getElementById("modal-root");return T?pe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"quiz-prefs-modal-title",onClick:i,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-lg border border-[var(--border-color)] max-h-[90vh] flex flex-col",onClick:j=>j.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between pb-4 mb-4 border-b border-[var(--border-color)] shrink-0",children:[e.jsx("h2",{id:"quiz-prefs-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)]",children:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§ÙØ§Ø®ØªØ¨Ø§Ø± (Quiz Preferences)"}),e.jsx("button",{onClick:i,className:"p-1.5 text-[var(--text-secondary)] hover:text-[var(--accent-red)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close preferences modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"space-y-6 mb-6 overflow-y-auto custom-scrollbar pr-1 flex-grow",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--text-primary)] mb-2",children:"ÙÙØ· Ø§ÙØªØµØ­ÙØ­ (Correction Mode)"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-2",children:"Choose how you want quiz answers to be graded:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"correctionMode",value:"immediate",checked:f==="immediate",onChange:g,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙÙØ°Ø§ÙØ±Ø© : ØªØµØ­ÙØ­ Ø§ÙØ³Ø¤Ø§Ù Ø§ÙÙ Ø¨Ø§ÙÙ"})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"correctionMode",value:"atEnd",checked:f==="atEnd",onChange:g,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙÙØ±Ø§Ø¬Ø¹Ø© : ØªØµØ­ÙØ­ Ø§ÙÙÙÙØ² Ø¹ÙØ¯ Ø§ÙØªØ³ÙÙÙ"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--text-primary)] mb-2",children:"ÙÙØ· Ø¹Ø±Ø¶ Ø§ÙØ£Ø³Ø¦ÙØ© (Question Display Mode)"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-2",children:"Choose how questions are presented during the quiz:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"questionDisplayMode",value:"oneByOne",checked:z==="oneByOne",onChange:v,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙØ³Ø¤Ø§Ù Ø§ÙÙØ§Ø­Ø¯: Ø¹Ø±Ø¶ Ø§ÙØ£Ø³Ø¦ÙØ© Ø³Ø¤Ø§ÙÙØ§ ØªÙÙ Ø§ÙØ¢Ø®Ø±"})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"questionDisplayMode",value:"listed",checked:z==="listed",onChange:v,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙÙØ§Ø¦ÙØ©: Ø¹Ø±Ø¶ Ø¬ÙÙØ¹ Ø£Ø³Ø¦ÙØ© Ø§ÙØ§Ø®ØªØ¨Ø§Ø± ÙÙ ÙØ§Ø¦ÙØ© ÙØ§Ø­Ø¯Ø©"})]})]})]})]}),e.jsxs("div",{className:"mt-auto pt-4 border-t border-[var(--border-color)] flex flex-col sm:flex-row-reverse gap-3 shrink-0",children:[e.jsx("button",{type:"button",onClick:w,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Save Preferences"}),e.jsx("button",{type:"button",onClick:i,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Cancel"})]})]})}),T):(console.error("Modal root element 'modal-root' not found for QuizPreferencesModal."),null)},cr="e2c841f407",gt="Q",dr=5;function Le(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}async function mr(r){const i=/^https:\/\/github\.com\/([^\/]+)\/([^\/]+)\/blob\/([^\/]+)\/(.+)$/,o=r.match(i);if(o){const[,t,s,c,f]=o,b=`https://api.github.com/repos/${t}/${s}/contents/${f.replace(/\?.*$/,"")}?ref=${c}`;return console.log(`Resolved GitHub blob URL to API raw content URL: ${b}`),b}try{return new URL(r),/^https:\/\/raw\.githubusercontent\.com\//.test(r)||/^https:\/\/api\.github\.com\/repos\/[^\/]+\/[^\/]+\/contents\//.test(r)||!/^https:\/\/github\.com\//.test(r)?r:(console.warn(`The provided GITHUB_DATA_URL (${r}) is a github.com URL but not a 'blob' URL. This format is not directly processable for raw content in this version. Please use a blob URL or a raw content URL.`),null)}catch{return console.warn(`The GITHUB_DATA_URL (${r}) is not a valid absolute URL or a recognized GitHub format. Fallback will likely occur.`),null}}const ur=()=>{const[r,i]=n.useState(()=>localStorage.getItem("isAdminAuthenticated")==="true"),[o,t]=n.useState(()=>localStorage.getItem("isAdminAuthenticated")==="true"&&localStorage.getItem("wasAdminViewBeforeRefresh")==="true"?"AdminPanel":"SubjectSelection"),[s,c]=n.useState(()=>localStorage.getItem("githubPat")||""),[f,b]=n.useState([]),[z,N]=n.useState(null),[g,v]=n.useState(null),[w,T]=n.useState(null),[j,$]=n.useState(null),[I,q]=n.useState(null),[Y,J]=n.useState(!1),[ee,U]=n.useState(!1),[l,k]=n.useState(null),[x,p]=n.useState(null),[y,C]=n.useState(!0),[A,H]=n.useState("Gathering all the necessary app information, please hold on a moment..."),[F,te]=n.useState(0),[O,K]=n.useState(null),[B,_]=n.useState([]),[R,D]=n.useState(!1),[L,G]=n.useState("immediate"),[Q,ae]=n.useState("oneByOne"),[re,Z]=n.useState(!1),[se,ne]=n.useState(!0),[ce,ue]=n.useState(!0),[xe,ie]=n.useState(!1),[fe,oe]=n.useState(()=>localStorage.getItem("pdfButtonAnimationPlayedOnce")==="true"),be=n.useRef(!1);n.useEffect(()=>{s?localStorage.setItem("githubPat",s):localStorage.removeItem("githubPat")},[s]),n.useEffect(()=>{(o==="UserQuiz"||o==="QuizSelection")&&window.scrollTo(0,0)},[o]);const he=(d,m)=>{d&&typeof d=="object"&&!Array.isArray(d)?(Array.isArray(d.subjects)?b(d.subjects):(console.warn(`Loaded ${m} data object does not contain a 'subjects' array. Initializing with empty subjects.`),b([])),typeof d.lastUpdated=="string"?N(d.lastUpdated):(N(null),d.lastUpdated!==void 0&&console.warn(`Loaded ${m} 'lastUpdated' field found but is not a string. Timestamp will not be set.`))):Array.isArray(d)?(b(d),N(null),console.log(`Loaded ${m} data is in old array format. No timestamp available from data.json.`)):(console.warn(`Loaded ${m} data.json is not in the expected array or {lastUpdated, subjects} object format. Initializing with empty data.`),b([]),N(null))},Se=n.useCallback(async d=>{console.warn(d||"Falling back to local data.json.");try{const a=`./data.json?_cb_local=${Date.now().toString()}`,u=await fetch(a,{cache:"no-cache"});if(u.ok){const h=await u.json();he(h,"local"),console.log("Successfully processed local data.json")}else if(u.status===404)console.warn("Local data.json not found, initializing with empty subjects array."),b([]),N(null);else{const h=await u.text();console.error(`Failed to fetch local data.json: ${u.status} ${u.statusText}. Response: ${h}`),b([]),N(null)}}catch(m){m instanceof Error?console.error(`Error loading or parsing local data.json: Name: ${m.name}, Message: ${m.message}. Stack: ${m.stack}`):console.error("Error loading or parsing local data.json (non-Error object):",m),b([]),N(null)}},[]);n.useEffect(()=>{(async()=>{if(be.current){console.log("Data fetch already attempted for this component instance. Skipping.");return}be.current=!0,C(!0),H("Gathering all the necessary app information, please hold on a moment...");const m=await mr(Me.GITHUB_DATA_URL);if(m){console.info(`Attempting to fetch data from: ${m}`);try{const a=new URL(m);a.searchParams.append("_cb_data",Date.now().toString());const u=a.toString();console.log("Fetching final data from:",u);const h={cache:"no-cache"};let P=!1;a.hostname==="api.github.com"&&a.pathname.includes("/repos/")&&a.pathname.includes("/contents/")?(h.headers={Accept:"application/vnd.github.v3.raw"},P=!0,console.log("Using GitHub API raw content fetch method.")):console.log("Using standard fetch method for non-API or raw.githubusercontent.com URL.");const E=await fetch(u,h);if(!E.ok){const W=await E.text();throw new Error(`Failed to fetch from ${u}: ${E.status} ${E.statusText}. Body: ${W}`)}let M;if(P){const W=await E.text();M=JSON.parse(W)}else M=await E.json();he(M,"remote"),console.log("Successfully processed data from remote source")}catch(a){a instanceof Error?console.error(`Error fetching or parsing data from (${m}). Type: ${a.name}, Message: ${a.message}. Stack: ${a.stack}`):console.error(`Error fetching or parsing data from (${m}). Caught non-Error object:`,a),await Se(`Failed to load from remote source (${m}).`)}finally{C(!1),H(null)}}else console.info("No remote GITHUB_DATA_URL configured, URL is invalid/placeholder, or processing error prevented getting a usable URL."),await Se("No remote data URL usable or remote fetch failed."),C(!1),H(null)})()},[Se]);const de=()=>{te(0),K(null),_([]),D(!1)},Ue=()=>{t("AdminPanel"),$(null),q(null),de(),ie(!1),r?localStorage.setItem("wasAdminViewBeforeRefresh","true"):J(!0)},Pe=()=>{t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"),v(null),T(null),p(null),ie(!1)},Xe=d=>{d===cr?(i(!0),localStorage.setItem("isAdminAuthenticated","true"),t("AdminPanel"),localStorage.setItem("wasAdminViewBeforeRefresh","true"),J(!1),k(null)):k("Incorrect password. Please try again.")},Ze=()=>{i(!1),localStorage.removeItem("isAdminAuthenticated"),t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"),v(null),T(null),p(null),ie(!1)},et=()=>{J(!1),k(null),r||(t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"),ie(!1))},Be=()=>{U(d=>!d)},Ee=d=>{G(d)},Ne=d=>{ae(d),Z(!1)},_e=()=>{Z(d=>!d)},$e=d=>{v(d),T(null),p(null)},Ae=d=>{T(d),p(null)},tt=d=>{const m={id:Le(),name:d,quizzes:[]};b(a=>[...a,m])},rt=(d,m)=>f.some(a=>a.name.toLowerCase()===m.toLowerCase()&&a.id!==d)?(alert(`A subject with the name "${m}" already exists. Please choose a different name.`),!1):(b(a=>a.map(u=>u.id===d?{...u,name:m}:u)),!0),st=d=>{b(m=>{const a=m.findIndex(h=>h.id===d);if(a===-1)return m;const u=m.filter(h=>h.id!==d);if(g===d)if(u.length>0){const h=Math.min(a,u.length-1);$e(u[h].id)}else $e(null);return u})},at=(d,m)=>{const a=f.find(h=>h.id===d);if(!a){alert("Error: Could not find the subject to add the quiz to. Please try again.");return}if(a.quizzes.some(h=>h.name.toLowerCase()===m.toLowerCase())){alert(`A quiz with the name "${m}" already exists in subject "${a.name}". Please choose a different name.`);return}const u={id:Le(),name:m,questions:[],isStartable:!0};b(h=>h.map(P=>P.id===d?{...P,quizzes:[...P.quizzes,u]}:P)),Ae(u.id)},nt=(d,m,a)=>{var h;let u=!1;if(b(P=>P.map(E=>E.id===d?E.quizzes.some(M=>M.name.toLowerCase()===a.toLowerCase()&&M.id!==m)?(u=!0,E):{...E,quizzes:E.quizzes.map(M=>M.id===m?{...M,name:a}:M)}:E)),u){const P=((h=f.find(E=>E.id===d))==null?void 0:h.name)||"the current subject";return alert(`A quiz with the name "${a}" already exists in ${P}. Please choose a different name.`),!1}return!0},ot=(d,m)=>{b(a=>a.map(u=>{if(u.id===d){const h=u.quizzes.findIndex(E=>E.id===m);if(h===-1)return u;const P=u.quizzes.filter(E=>E.id!==m);if(w===m)if(P.length>0){const E=Math.min(h,P.length-1);Ae(P[E].id)}else Ae(null);return{...u,quizzes:P}}return u}))},it=(d,m)=>{b(a=>a.map(u=>u.id===d?{...u,quizzes:u.quizzes.map(h=>h.id===m?{...h,isStartable:!h.isStartable}:h)}:u))},lt=d=>{p(d)},ct=(d,m,a)=>{var h,P;const u={...a,id:Le()};if(u.type==="mcq"&&u.options){u.options=u.options.map((W,Ve)=>({...W,id:`option-${Le()}-${Ve}`}));const E=(P=(h=a.options)==null?void 0:h.find(W=>W.id===a.correctOptionId))==null?void 0:P.text,M=u.options.find(W=>W.text===E);if(u.correctOptionId=M?M.id:void 0,!u.correctOptionId&&typeof a.correctOptionId=="string"){const W=a.correctOptionId.match(/^option-(\d+)$/);if(W&&W[1]){const Ve=parseInt(W[1],10);u.options[Ve]&&(u.correctOptionId=u.options[Ve].id)}}!u.correctOptionId&&u.options.length>0&&(console.warn("Could not determine correct option for new MCQ, defaulting to first option."),u.correctOptionId=u.options[0].id)}b(E=>E.map(M=>M.id===d?{...M,quizzes:M.quizzes.map(W=>W.id===m?{...W,questions:[...W.questions,u]}:W)}:M)),p(null)},dt=(d,m,a)=>{var u;if(a.type==="mcq"&&a.options){if(a.options=a.options.map((h,P)=>({id:h.id&&h.id.startsWith("option-")?h.id:`option-${Le()}-${P}`,text:h.text})),typeof a.correctOptionId=="string"&&!a.options.find(h=>h.id===a.correctOptionId)){const h=(u=x==null?void 0:x.options)==null?void 0:u.find(M=>M.id===a.correctOptionId),P=h==null?void 0:h.text;let E=a.options.find(M=>M.text===P);if(E)a.correctOptionId=E.id;else{const M=a.correctOptionId.match(/^option-(\d+)$/);if(M&&M[1]){const W=parseInt(M[1],10);a.options[W]?a.correctOptionId=a.options[W].id:(console.warn("Correct option index out of bounds after update. Defaulting."),a.correctOptionId=a.options.length>0?a.options[0].id:void 0)}else console.warn("Correct option ID seems invalid after update and couldn't be re-mapped by text or index. Defaulting."),a.correctOptionId=a.options.length>0?a.options[0].id:void 0}}a.type==="mcq"&&a.options.length>0&&!a.options.find(h=>h.id===a.correctOptionId)&&(console.warn("Updated MCQ question has options, but correctOptionId is invalid. Defaulting to the first option."),a.correctOptionId=a.options[0].id)}b(h=>h.map(P=>P.id===d?{...P,quizzes:P.quizzes.map(E=>E.id===m?{...E,questions:E.questions.map(M=>M.id===a.id?a:M)}:E)}:P)),p(null)},Qe=(d,m,a)=>{b(u=>u.map(h=>h.id===d?{...h,quizzes:h.quizzes.map(P=>P.id===m?{...P,questions:P.questions.filter(E=>E.id!==a)}:P)}:h)),(x==null?void 0:x.id)===a&&p(null)},mt=(d,m,a)=>{b(u=>u.map(h=>h.id===d?{...h,quizzes:h.quizzes.map(P=>P.id===m?{...P,questions:a}:P)}:h))},ut=()=>{b(d=>d.map(m=>({...m,quizzes:m.quizzes.map(a=>{const u=a.questions.filter(P=>P.type==="written"),h=a.questions.filter(P=>P.type==="mcq");return{...a,questions:[...u,...h]}})}))),alert("All quizzes have been successfully reordered (Written questions first, then MCQ).")},Ge=d=>{const m=f.find(a=>a.id===d);$(m||null),q(null),de(),t("QuizSelection"),ie(!1)},ft=d=>{const m=j==null?void 0:j.quizzes.find(a=>a.id===d);q(m||null),de(),m&&_(Array(m.questions.length).fill(null)),t("UserQuiz")},Oe=()=>{$(null),q(null),de(),t("SubjectSelection"),fe||ie(!0)},Ce=()=>{q(null),de(),t("QuizSelection")},ze=()=>{de(),I&&_(Array(I.questions.length).fill(null))},S=d=>{if(K(d),I&&L==="atEnd"&&I.questions[F].type==="mcq"){const a=[...B];a[F]={selectedOptionId:d,feedback:null},_(a)}},V=(d,m)=>{if(I){const a=I.questions[m];if(a.type==="mcq"){const u=[...B];let h=null;L==="immediate"&&(h=d===a.correctOptionId?"Correct":"Incorrect"),u[m]={selectedOptionId:d,feedback:h},_(u)}}},X=()=>{if(I&&L==="immediate"&&B[F]===null){const d=I.questions[F];if(d.type==="mcq"){if(!O){console.warn("Submit called for MCQ without a selection attempt.");return}const m=O===d.correctOptionId?"Correct":"Incorrect",a=[...B];a[F]={selectedOptionId:O,feedback:m},_(a)}}},ge=()=>{if(I){const a=I.questions[F];if(Q==="oneByOne"&&(a==null?void 0:a.type)==="written"&&B[F]===null){const u=[...B],h={selectedOptionId:null,feedback:"Seen"};u[F]=h,_(u)}else if(Q==="oneByOne"&&L==="atEnd"&&(a==null?void 0:a.type)==="mcq"&&O&&B[F]===null){const u=[...B],h={selectedOptionId:O,feedback:null};u[F]=h,_(u)}}K(null);const d=Q==="oneByOne"&&I&&F>=I.questions.length-1,m=Q==="listed";if(d||m){if(L==="atEnd"&&I){const a=B.map((u,h)=>{if(!u&&I.questions[h].type==="written")return{selectedOptionId:null,feedback:"Seen"};if(!u)return null;const P=I.questions[h];if(P.type==="mcq"&&u.selectedOptionId&&u.feedback===null){const E=u.selectedOptionId===P.correctOptionId?"Correct":"Incorrect";return{selectedOptionId:u.selectedOptionId,feedback:E}}return u});_(a)}else if(L==="immediate"&&m&&I){const a=B.map((u,h)=>!u&&I.questions[h].type==="written"?{selectedOptionId:null,feedback:"Seen"}:u);_(a)}D(!0)}else Q==="oneByOne"&&I&&F<I.questions.length-1&&te(a=>a+1)},xt=()=>{if(I&&L==="atEnd"&&Q==="oneByOne"&&I.questions[F].type==="mcq"&&O&&B[F]===null){const m=[...B],a={selectedOptionId:O,feedback:null};m[F]=a,_(m)}K(null),F>0&&te(d=>d-1)},De=()=>{ie(!1),fe||(oe(!0),localStorage.setItem("pdfButtonAnimationPlayedOnce","true"))},le=f.find(d=>d.id===g),Re=le==null?void 0:le.quizzes.find(d=>d.id===w);let ve=gt;const He=o==="AdminPanel"&&r;if(He?ve=Re?`Admin: ${(le==null?void 0:le.name)||"Unknown Subject"} > ${Re.name}`:le?`Admin: ${le.name}`:"Admin: Subject Management":o==="UserQuiz"&&I?ve=`${(j==null?void 0:j.name)||"Quiz"}: ${I.name}`:o==="QuizSelection"&&j?ve=`${j.name}: Select Quiz`:ve=gt,y)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-[var(--bg-primary)] p-4 text-center",children:[e.jsx("div",{className:"h-20 w-20 rounded-full flex items-center justify-center bg-[var(--text-primary)] mb-6 shadow-md","aria-label":"App Logo Q",children:e.jsx("span",{className:"text-[var(--bg-primary)] font-bold text-4xl select-none",style:{fontFamily:"Roboto, sans-serif"},children:"Q"})}),e.jsx("h1",{className:"text-3xl font-bold text-[var(--text-primary)] mb-4",children:"Loading Application Data"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce"})]}),A&&e.jsx("p",{className:"text-[var(--text-secondary)] text-sm mt-3",children:A})]});const qe=`flex-grow p-4 sm:p-6 lg:p-8 max-w-5xl w-full mx-auto ${o==="UserQuiz"||o==="QuizSelection"?"pt-4 sm:pt-6":"pt-2 sm:pt-3"}`,Te=()=>{switch(o){case"AdminPanel":return r?e.jsx(or,{subjects:f,allSubjectsData:f,activeSubjectId:g,activeQuizId:w,editingQuestion:x,setEditingQuestion:lt,onSetActiveSubjectId:$e,onCreateSubject:tt,onUpdateSubjectName:rt,onDeleteSubject:st,onSetActiveQuizId:Ae,onCreateQuiz:at,onUpdateQuizName:nt,onDeleteQuiz:ot,onToggleQuizStartable:it,onAddQuestion:ct,onUpdateQuestion:dt,onDeleteQuestion:Qe,onReorderQuestions:mt,onReorderAllQuizzesByTypeGlobal:ut,maxOptions:dr,showManageSubjectsSection:se,setShowManageSubjectsSection:ne,showManageQuizzesSection:ce,setShowManageQuizzesSection:ue,activeAdminSubject:le,activeAdminQuiz:Re,githubPat:s,setGithubPat:c}):e.jsx(wt,{subjects:f,onSelectSubject:Ge,playAnimation:xe&&!fe,onAnimationComplete:De});case"UserQuiz":return I?e.jsx(Gt,{quiz:I,currentQuestionIndex:F,userAnswers:B,currentUserSelectionAttempt:O,isQuizComplete:R,onOptionSelect:S,onListedOptionSelect:V,onSubmitAnswer:X,onNextQuestion:ge,onPreviousQuestion:xt,onBackToQuizList:Ce,onRestartQuiz:ze,userCorrectionMode:L,userQuestionDisplayMode:Q,onTogglePrefsModal:_e}):(t("QuizSelection"),null);case"QuizSelection":return j?e.jsx(Qt,{subject:j,onSelectQuiz:ft,onBackToSubjectList:Oe}):(t("SubjectSelection"),null);case"SubjectSelection":default:return e.jsx(wt,{subjects:f,onSelectSubject:Ge,playAnimation:xe&&!fe,onAnimationComplete:De})}};return e.jsxs(e.Fragment,{children:[e.jsx(qt,{contextTitle:ve,isAdminView:He,isAdminAuthenticated:r,currentAppViewMode:o,onSwitchToAdminView:Ue,onSwitchToUserView:Pe,onAdminLogout:Ze,dataTimestamp:z,onShowTimestampModal:Be}),e.jsx("main",{className:qe,children:Te()}),e.jsx(Ft,{appName:gt}),Y&&e.jsx(Lt,{onLogin:Xe,onClose:et,error:l}),ee&&z&&e.jsx(ir,{isOpen:ee,onClose:Be,timestamp:z}),re&&e.jsx(lr,{isOpen:re,onClose:_e,currentCorrectionMode:L,onSetCorrectionMode:Ee,currentQuestionDisplayMode:Q,onSetQuestionDisplayMode:Ne}),e.jsx("div",{className:`pdf-animation-overlay ${xe&&!fe?"visible":""}`,"aria-hidden":!(xe&&!fe)})]})},Tt=document.getElementById("app-root");Tt?kt.createRoot(Tt).render(e.jsx(ur,{})):console.error("Failed to find the root element with ID 'app-root'");

import{j as e,r as o}from"./react-ZpOpdbvF.js";import{r as we,a as $t}from"./react-dom-BFJMa1Yr.js";import{E as Ot}from"./jspdf-BVD6OXYK.js";import{D as Ft,C as Dt,P as Rt}from"./@hello-pangea-BHoMb5q8.js";import"./core-js--yVVgAJ6.js";import"./scheduler-SPyfQU6S.js";import"./@babel-CpGVvVoG.js";import"./fflate-BO5HMHBV.js";import"./redux-CqoN-cwI.js";import"./react-redux-DzurNSeR.js";import"./use-sync-external-store-DGADeII1.js";import"./css-box-model-SSI6wf-B.js";import"./tiny-invariant-BaFNuDhB.js";import"./raf-schd-CmoV45_-.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&t(p)}).observe(document,{childList:!0,subtree:!0});function i(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function t(a){if(a.ep)return;a.ep=!0;const d=i(a);fetch(a.href,d)}})();const Lt=r=>{if(!r)return null;try{const c=new Date(r);if(isNaN(c.getTime()))return console.warn("Invalid date string received for formatting:",r),{timeDescription:"Invalid Date",tooltip:r};const t=Math.round((new Date().getTime()-c.getTime())/1e3),a=c.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})+", "+c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});let d;if(t<0){const p=c.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),x=c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});d=`${p}, ${x}`}else if(t<60)d="just now";else if(t<3600)d=`${Math.floor(t/60)} min ago`;else if(t<86400)d=`${Math.floor(t/3600)} h ago`;else{const p=c.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),x=c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});d=`${p}, ${x}`}return{timeDescription:d,tooltip:a}}catch(c){return console.error("Error formatting date:",c),{timeDescription:"Error in timestamp",tooltip:r||"Error formatting timestamp"}}},Mt=()=>e.jsx("div",{className:"h-14 w-14 sm:h-16 sm:w-16 rounded-full border-2 border-[var(--bg-header)] shadow-md transition-transform duration-200 ease-in-out hover:scale-110 flex items-center justify-center bg-[var(--text-primary)] shrink-0","aria-label":"App Logo Q",children:e.jsx("span",{className:"text-[var(--bg-primary)] font-bold text-[2rem] sm:text-[2.4rem] select-none",style:{fontFamily:"Roboto, sans-serif"},children:"Q"})}),qt=({contextTitle:r,isAdminView:c,isAdminAuthenticated:i,currentAppViewMode:t,onSwitchToAdminView:a,onSwitchToUserView:d,onAdminLogout:p,dataTimestamp:x,onShowTimestampModal:k})=>{const A=Lt(x),v="211, 195, 185",w=c&&i&&e.jsx("button",{onClick:p,className:"p-2.5 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white border border-[var(--accent-red-hover)] rounded-full transition-colors shrink-0 text-xs sm:text-sm flex items-center justify-center h-9 w-9 sm:h-10 sm:w-10 focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)] focus:ring-offset-2 focus:ring-offset-[var(--bg-header)]","aria-label":"Logout from Admin Panel",title:"Admin Logout",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket fa-fw text-base"})}),C=c?e.jsxs("button",{onClick:d,className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-transparent hover:bg-[var(--text-primary)] text-[var(--text-primary)] hover:text-[var(--bg-primary)] border border-[var(--text-primary)] rounded-md transition-colors shrink-0 text-xs sm:text-sm flex items-center","aria-label":"Switch to User View",children:[e.jsx("i",{className:"fa-solid fa-user-graduate fa-fw mr-1.5 sm:mr-2"}),e.jsx("span",{children:"User View"})]}):e.jsxs("button",{onClick:a,className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-transparent hover:bg-[var(--text-primary)] text-[var(--text-primary)] hover:text-[var(--bg-primary)] border border-[var(--text-primary)] rounded-md transition-colors shrink-0 text-xs sm:text-sm flex items-center","aria-label":"Switch to Admin Panel",children:[e.jsx("i",{className:"fa-solid fa-headset mr-1.5 sm:mr-2"}),e.jsx("span",{children:"Admin Panel"})]}),T=A&&e.jsx("button",{onClick:k,className:"text-[var(--text-primary)] text-[0.6rem] sm:text-xs opacity-80 hover:opacity-100 cursor-pointer focus:outline-none focus:ring-1 focus:ring-[var(--text-primary)] rounded p-0.5",title:A.tooltip,"aria-label":`Content update details: ${A.tooltip}`,children:e.jsx("span",{className:"block",children:`last updated : ${A.timeDescription}`})});return e.jsx("header",{className:"bg-[var(--bg-header)] sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[" ",e.jsx(Mt,{}),T]}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[w,C]})]}),e.jsx("div",{style:{height:"1px",width:"100%",backgroundImage:`linear-gradient(to right, transparent, rgba(${v},0.5) 25%, rgba(${v},0.5) 75%, transparent)`}}),e.jsx("div",{className:"text-center pt-2.5",children:e.jsx("span",{className:"text-[var(--text-primary)] text-sm sm:text-base font-semibold truncate block",title:r,children:r})})]})})},Ut=({appName:r})=>{const c=new Date().getFullYear();return e.jsx("footer",{className:"bg-[var(--bg-secondary)] text-[var(--text-secondary)] text-center py-4 sm:py-5 border-t border-[var(--border-color)]",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6",children:e.jsxs("p",{className:"text-xs sm:text-sm",children:["Â© ",c," ",r,". Made with ",e.jsx("i",{className:"fa-solid fa-heart text-[var(--accent-red)] animate-heartbeat"})]})})})},Bt=({onLogin:r,onClose:c,error:i})=>{const[t,a]=o.useState(""),d=k=>{k.preventDefault(),r(t)},p=e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"admin-login-title",children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",children:[e.jsx("h2",{id:"admin-login-title",className:"text-2xl font-semibold text-[var(--accent-primary)] mb-6 text-center",children:"Admin Login"}),e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"adminPassword",className:"block text-sm font-medium text-[var(--text-secondary)] mb-1",children:"Password"}),e.jsx("input",{type:"password",id:"adminPassword",value:t,onChange:k=>a(k.target.value),className:"w-full p-3 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)] text-[var(--input-text)] focus:ring-2 focus:ring-[var(--input-focus-ring)] focus:border-[var(--input-focus-ring)] placeholder-[var(--placeholder-color)]",placeholder:"Enter admin password",required:!0})]}),i&&e.jsx("p",{className:"text-red-500 text-sm text-center -mt-2",children:i}),e.jsxs("div",{className:"flex flex-col sm:flex-row-reverse gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Login"}),e.jsx("button",{type:"button",onClick:c,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Cancel"})]})]})]})}),x=document.getElementById("modal-root");return x?we.createPortal(p,x):(console.error("Modal root element 'modal-root' not found."),null)},_t=({isOpen:r,onClose:c,allQuizzes:i,initiallySelectedQuizIds:t,onApplySelection:a})=>{const[d,p]=o.useState([]);o.useEffect(()=>{r&&p([...t])},[r,t]);const x=o.useMemo(()=>i.reduce((g,$)=>{const z=$.subjectId;return g[z]||(g[z]={subjectName:$.subjectName,quizzes:[]}),g[z].quizzes.push($),g},{}),[i]);if(!r)return null;const k=g=>{p($=>$.includes(g)?$.filter(z=>z!==g):[...$,g])},A=()=>{const g=i.map($=>$.id);p(g)},v=()=>{p([])},w=()=>{a(d)},C=()=>d.length===0?"No quizzes selected. All quizzes from chosen subjects will be included if applied now.":d.length===i.length&&i.length>0?`All ${i.length} available quizzes selected.`:`${d.length} of ${i.length} available quizzes selected.`,T=document.getElementById("modal-root");return T?we.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[51] p-4",role:"dialog","aria-modal":"true","aria-labelledby":"quiz-multiselect-modal-title",onClick:c,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:g=>g.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl shrink-0",children:[e.jsx("h2",{id:"quiz-multiselect-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:"Select Quizzes for Export"}),e.jsx("button",{onClick:c,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close quiz selection modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 overflow-y-auto custom-scrollbar flex-grow",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-3",children:[e.jsx("p",{className:"text-sm text-[var(--text-secondary)] p-2 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md flex-grow",children:C()}),e.jsxs("div",{className:"flex space-x-2 shrink-0",children:[e.jsx("button",{onClick:A,disabled:i.length===0,className:"px-3 py-1.5 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors disabled:opacity-50",children:"Select All"}),e.jsx("button",{onClick:v,disabled:i.length===0||d.length===0,className:"px-3 py-1.5 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors disabled:opacity-50",children:"Deselect All"})]})]}),i.length===0?e.jsx("p",{className:"text-center text-[var(--text-secondary)] py-4",children:"No quizzes available from selected subjects to choose from."}):e.jsx("div",{className:"space-y-3 max-h-[calc(85vh-260px)] overflow-y-auto custom-scrollbar pr-2",children:Object.entries(x).map(([g,{subjectName:$,quizzes:z}])=>e.jsxs("div",{className:"py-1",children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--accent-primary)] mb-1.5 pb-1 border-b border-[var(--border-color)]",children:$}),e.jsx("div",{className:"space-y-1.5",children:z.map(P=>{const W=d.includes(P.id);return e.jsxs("label",{className:`flex items-center space-x-3 p-2.5 rounded-md transition-all duration-150 text-sm border cursor-pointer 
                            ${W?"bg-[var(--accent-primary)] bg-opacity-25 border-[var(--accent-primary)] text-[var(--text-primary)] font-medium":"bg-[var(--bg-primary)] border-[var(--border-color)] text-[var(--text-secondary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-10 hover:border-[var(--accent-secondary)]"}`,title:`${P.subjectName} - ${P.name}`,children:[e.jsx("input",{type:"checkbox",checked:W,onChange:()=>k(P.id),className:"h-4 w-4 text-[var(--accent-primary)] bg-transparent border-[var(--input-border)] rounded focus:ring-1 focus:ring-offset-0 focus:ring-[var(--accent-primary)] shrink-0"}),e.jsx("span",{className:"truncate flex-grow text-left",children:P.name})]},P.id)})})]},g))})]}),e.jsxs("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-between items-center shrink-0",children:[e.jsx("button",{onClick:v,className:"px-4 py-2 text-sm font-medium bg-transparent hover:bg-[var(--accent-red)] hover:bg-opacity-20 text-[var(--accent-red)] border border-[var(--accent-red)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]",children:"Clear Current Selection"}),e.jsxs("div",{className:"space-x-3",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)]",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:i.length===0&&d.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50",children:"Apply Selection"})]})]})]})}),T):(console.error("Modal root element 'modal-root' not found for QuizMultiSelectModal."),null)},At={title:"#233239",questionText:"#000000",answerText:"#474747",correctAnswer:"#48BB78",modelAnswerLabel:"#1a202c",modelAnswerHighlightColor:"#cccccc"},Qt="p-2 border rounded-md focus:ring-1 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)] text-sm",Ge="block text-sm font-medium text-[var(--text-secondary)] mb-1",We="text-md font-semibold text-[var(--accent-primary)] mb-2",$e=595.28,Ce=841.89,me=40,ve=$e-2*me,ye=1.4,Ct="#000000",Ve=18,Ye=135,Ht=({isOpen:r,onClose:c,subjects:i})=>{const[t,a]=o.useState({showAnswers:!0,fontSize:12,colors:{...At},selectedSubjectIds:[],modelAnswerHighlightOpacity:.3}),[d,p]=o.useState(!1),[x,k]=o.useState(!1),[A,v]=o.useState(!1),[w,C]=o.useState(null);o.useEffect(()=>{r&&(a({showAnswers:!0,fontSize:12,colors:{...At},selectedSubjectIds:i.map(s=>s.id),modelAnswerHighlightOpacity:.3}),p(!1),k(!1),v(!1),C(null))},[r,i]);const T=o.useMemo(()=>{if(!r)return[];const s=[];return i.forEach(l=>{t.selectedSubjectIds.includes(l.id)&&l.quizzes.filter(S=>S.isStartable).forEach(S=>{s.push({id:S.id,name:S.name,subjectName:l.name,subjectId:l.id})})}),s},[i,t.selectedSubjectIds,r]);if(!r&&!A)return null;const g=s=>{const{name:l,value:S,type:j}=s.target;if(j==="checkbox"){const{checked:y}=s.target;a(Y=>({...Y,[l]:y}))}else j==="number"||s.target.step==="0.05"?a(y=>({...y,[l]:parseFloat(S)})):a(y=>({...y,[l]:S}))},$=(s,l)=>{a(S=>({...S,colors:{...S.colors,[s]:l}}))},z=s=>{a(l=>{const S=l.selectedSubjectIds.includes(s)?l.selectedSubjectIds.filter(j=>j!==s):[...l.selectedSubjectIds,s];return C(null),{...l,selectedSubjectIds:S}})},P=()=>{if(t.selectedSubjectIds.length===0){alert("Please select at least one subject before selecting specific quizzes.");return}v(!0)},W=s=>{C(s.length>0?s:null),v(!1)},V=async(s,l)=>{let S;try{S=await fetch(s)}catch(y){throw console.error(`Network error loading file ${s}:`,y),new Error(`Network error loading file ${s}: ${y instanceof Error?y.message:String(y)}`)}if(!S.ok){const y=await S.text().catch(()=>"Could not retrieve error body.");throw console.error(`Failed to load file ${s}: ${S.status} ${S.statusText}. Body: ${y.substring(0,200)}`),new Error(`Failed to load file ${s}: ${S.status} ${S.statusText}`)}const j=S.headers.get("Content-Type");try{const y=await S.blob();return new Promise((Y,O)=>{const G=new FileReader;G.onloadend=()=>{let F=G.result;const J="data:application/octet-stream;base64,",q=l.startsWith("data:image/");if(F.startsWith(l))Y(F);else if(q&&F.startsWith(J))console.warn(`File ${s} (expected ${l}) was received as octet-stream. Correcting MIME type for PDF.`),F=l+F.substring(J.length),Y(F);else{const B=F.substring(0,Math.min(F.indexOf(";")+8,F.length,50))+"...",L=`File ${s} loaded with unexpected type. Expected prefix: ${l}, but got: ${B} (Full Content-Type from server: ${j||"N/A"}). Check if the file is correct and accessible.`;console.error(L),O(new Error(L))}},G.onerror=F=>{var q,B;const J=`FileReader error for ${s}: ${((B=(q=F.target)==null?void 0:q.error)==null?void 0:B.message)||"Unknown FileReader error"}`;console.error(J,F),O(new Error(J))},G.readAsDataURL(y)})}catch(y){throw console.error(`Error processing blob for ${s}:`,y),new Error(`Error processing blob for ${s}: ${y instanceof Error?y.message:String(y)}`)}},ne=async()=>{if(t.selectedSubjectIds.length===0){alert("Please select at least one subject to include in the PDF.");return}p(!0);let s=!1;try{const l=new Ot({orientation:"p",unit:"pt",format:"a4"});try{const L=await V("https://rustova.github.io/Q/assets/Amiri-Regular.ttf","data:font/ttf;base64,"),E=L.substring(L.indexOf(",")+1);l.addFileToVFS("Amiri-Regular.ttf",E),l.addFont("Amiri-Regular.ttf","Amiri","normal"),l.addFont("Amiri-Regular.ttf","Amiri","bold"),l.setFont("Amiri","normal"),s=!0,k(!0)}catch(L){console.warn("Failed to load Amiri-Regular.ttf. PDF will be generated with default fonts.",L),l.setFont("Helvetica","normal")}const S=await V("https://rustova.github.io/Q/assets/main.PNG","data:image/png;base64,"),j=await V("https://rustova.github.io/Q/assets/regular.PNG","data:image/png;base64,");let y=me;const Y=t.fontSize*1.5,O=(L,E,R=!1)=>{l.setFontSize(L),l.setTextColor(E),s?l.setFont("Amiri",R?"bold":"normal"):l.setFont("Helvetica",R?"bold":"normal")},G=(L=t.fontSize*ye)=>{y+L>Ce-me&&(l.addPage(),l.addImage(j,"PNG",0,0,$e,Ce,void 0,"FAST"),y=Ye)},F=(L,E,R,U,_,ae=!1,te=!1,ee)=>{s?l.setFont("Amiri",ae?"bold":"normal"):l.setFont("Helvetica",ae?"bold":"normal"),l.setFontSize(U);const K=l.splitTextToSize(L,R),oe=te?ye*1.1:ye,le=U*oe,de=K.length*le;if(te||G(de),ee&&K.some(re=>re.trim()!=="")){l.saveGraphicsState(),l.setFillColor(ee.color),l.setGState(new l.GState({opacity:ee.opacity}));for(let re=0;re<K.length;re++){const he=K[re];if(he.trim()!==""){const je=y+re*le,ie=l.getStringUnitWidth(he)*U/l.internal.scaleFactor,xe=U*1.05,ge=je-U*.82;l.rect(E,ge,ie,xe,"F")}}l.restoreGraphicsState()}l.setTextColor(_),l.text(K,E,y),y+=de,te||(y+=U*(ye*.15))};l.addImage(S,"PNG",0,0,$e,Ce,void 0,"FAST"),y=416+Ve*ye*1.1,O(Ve,Ct,!0),l.text("Subjects included:",28,416);const J=i.filter(L=>t.selectedSubjectIds.includes(L.id));J.length>0&&J.forEach(L=>{let E=y;E+Ve*ye*1.1>Ce-me&&(l.addPage(),l.addImage(j,"PNG",0,0,$e,Ce,void 0,"FAST"),y=Ye,E=y),F(`- ${L.name}`,me+20,ve-20,Ve,Ct,!1,!0)});let q=[];i.forEach(L=>{t.selectedSubjectIds.includes(L.id)&&L.quizzes.filter(E=>E.isStartable&&E.questions.length>0).forEach(E=>{(w===null||w.includes(E.id))&&q.push({...E,subjectName:L.name,subjectId:L.id})})});let B=!0;for(const L of q){if(B)l.addPage(),l.addImage(j,"PNG",0,0,$e,Ce,void 0,"FAST"),y=Ye,B=!1;else{const R=Y*ye+t.fontSize*1.2*ye;G(R)}const E=ve-(70-me);F(L.subjectName,70,E,Y,t.colors.title,!0),y+=t.fontSize*.2,F(L.name,me,ve,t.fontSize*1.2,t.colors.title,!0),y+=t.fontSize*.7,L.questions.forEach((R,U)=>{F(`${U+1}. ${R.questionText}`,me,ve,t.fontSize,t.colors.questionText),y+=t.fontSize*.3,R.type==="mcq"&&R.options?R.options.forEach((_,ae)=>{let ee=`${String.fromCharCode(65+ae)}. ${_.text}`,K=t.colors.answerText;t.showAnswers&&_.id===R.correctOptionId&&(K=t.colors.correctAnswer),F(ee,me+20,ve-20,t.fontSize*.9,K),y+=t.fontSize*.1}):R.type==="written"&&t.showAnswers&&R.modelAnswer&&R.modelAnswer.trim()!==""&&(y+=t.fontSize*.2,F("Model Answer:",me+10,ve-10,t.fontSize*.85,t.colors.modelAnswerLabel,!0),F(R.modelAnswer,me+20,ve-20,t.fontSize*.9,t.colors.answerText,!1,!1,{color:t.colors.modelAnswerHighlightColor,opacity:t.modelAnswerHighlightOpacity}),y+=t.fontSize*.1),y+=t.fontSize*.5})}q.length===0&&t.selectedSubjectIds.length>0&&(B&&(l.addPage(),l.addImage(j,"PNG",0,0,$e,Ce,void 0,"FAST")),y=Ye,F("No quizzes match the current selection criteria.",me,ve,t.fontSize,t.colors.questionText)),l.save("Quiz_Export.pdf")}catch(l){console.error("Error generating PDF:",l),alert(`Failed to generate PDF. Check console for details. Error: ${l instanceof Error?l.message:String(l)}`)}finally{p(!1),c()}},Z=document.getElementById("modal-root");if(!Z&&r)return console.error("Modal root element 'modal-root' not found for PdfPreferencesModal."),null;if(!r)return null;const se=[{key:"title",label:"Title Color (Content)"},{key:"questionText",label:"Question Text Color"},{key:"answerText",label:"Answer Text Color"},{key:"correctAnswer",label:"Correct Answer Highlight"},{key:"modelAnswerLabel",label:"Model Answer Label Color"},{key:"modelAnswerHighlightColor",label:"Model Ans. Highlight Bg"}],m=()=>w===null?"Select Specific Quizzes... (All from selected subjects)":w.length===0?"Select Specific Quizzes... (None selected)":`${w.length} Quizzes Selected`;return we.createPortal(e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"pdf-prefs-modal-title",onClick:d?void 0:c,children:[e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:s=>s.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl shrink-0",children:[e.jsx("h2",{id:"pdf-prefs-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:"PDF Export Preferences"}),e.jsx("button",{onClick:d?void 0:c,disabled:d,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)] disabled:opacity-50","aria-label":"Close PDF preferences modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-5 overflow-y-auto custom-scrollbar flex-grow",children:[e.jsxs("fieldset",{disabled:d,children:[e.jsx("legend",{className:We,children:"General Options"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 items-end",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)]",children:[e.jsx("input",{type:"checkbox",id:"showAnswers",name:"showAnswers",checked:t.showAnswers,onChange:g,className:"h-4 w-4 text-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] rounded cursor-pointer"}),e.jsx("label",{htmlFor:"showAnswers",className:"text-sm text-[var(--input-text)] cursor-pointer",children:"Show Answers in PDF"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fontSize",className:Ge,children:"Base Font Size (Content)"}),e.jsx("input",{type:"number",id:"fontSize",name:"fontSize",value:t.fontSize,onChange:g,min:"8",max:"32",step:"1",className:`${Qt} w-full`})]})]})]}),e.jsxs("fieldset",{disabled:d,children:[e.jsx("legend",{className:We,children:"Written Answer Highlight (PDF)"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"modelAnswerHighlightColor",className:Ge,children:"Highlight Background Color"}),e.jsx("input",{type:"color",id:"modelAnswerHighlightColor",name:"modelAnswerHighlightColor",value:t.colors.modelAnswerHighlightColor,onChange:s=>$("modelAnswerHighlightColor",s.target.value),className:"w-full h-9 p-0.5 border rounded-md cursor-pointer bg-[var(--input-bg)] border-[var(--input-border)] focus:outline-none focus:ring-1 focus:ring-[var(--input-focus-ring)]"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"modelAnswerHighlightOpacity",className:Ge,children:["Highlight Opacity: ",e.jsx("span",{className:"font-mono text-[var(--accent-primary)]",children:t.modelAnswerHighlightOpacity.toFixed(2)})]}),e.jsx("input",{type:"range",id:"modelAnswerHighlightOpacity",name:"modelAnswerHighlightOpacity",min:"0",max:"1",step:"0.05",value:t.modelAnswerHighlightOpacity,onChange:g,className:"w-full h-5 accent-[var(--accent-primary)] bg-[var(--input-bg)] rounded-lg appearance-none cursor-pointer"})]})]})]}),e.jsxs("fieldset",{disabled:d,children:[e.jsx("legend",{className:We,children:"Color Scheme (Content Pages Text)"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-3",children:se.filter(s=>s.key!=="modelAnswerHighlightColor").map(s=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:s.key,className:`${Ge} truncate`,title:s.label,children:s.label}),e.jsx("input",{type:"color",id:s.key,name:s.key,value:t.colors[s.key],onChange:l=>$(s.key,l.target.value),className:"w-full h-9 p-0.5 border rounded-md cursor-pointer bg-[var(--input-bg)] border-[var(--input-border)] focus:outline-none focus:ring-1 focus:ring-[var(--input-focus-ring)]"})]},s.key))})]}),e.jsxs("fieldset",{disabled:d,children:[e.jsx("legend",{className:We,children:"Select Content"}),i.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3 items-center",children:e.jsx("button",{onClick:P,disabled:t.selectedSubjectIds.length===0,className:"px-3 py-1.5 text-xs bg-[var(--accent-primary)] hover:bg-[var(--accent-primary-hover)] text-[var(--btn-primary-text)] rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed truncate max-w-xs",title:m(),children:m()})}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 pr-2 custom-scrollbar border border-[var(--input-border)] bg-[var(--input-bg)] rounded-md p-3",children:i.map(s=>{const l=s.quizzes.filter(S=>S.isStartable).length;return e.jsxs("label",{className:"flex items-center space-x-2 p-2 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md cursor-pointer hover:bg-[var(--accent-secondary)] hover:bg-opacity-10",children:[e.jsx("input",{type:"checkbox",checked:t.selectedSubjectIds.includes(s.id),onChange:()=>z(s.id),className:"h-4 w-4 text-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] rounded"}),e.jsx("span",{className:"text-sm text-[var(--input-text)] flex-grow truncate",title:s.name,children:s.name}),e.jsxs("span",{className:"text-xs text-[var(--text-secondary)] shrink-0",children:["(",l," quiz",l!==1?"zes":"",")"]})]},s.id)})}),t.selectedSubjectIds.length===0&&e.jsx("p",{className:"text-xs text-[var(--text-secondary)] italic mt-1",children:"Select subjects to enable quiz selection."})]}):e.jsx("p",{className:"text-sm text-[var(--text-secondary)]",children:"No subjects available to select."})]})]}),e.jsxs("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-end space-x-3 shrink-0",children:[e.jsx("button",{onClick:d?void 0:c,disabled:d,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:ne,disabled:d||i.length===0||t.selectedSubjectIds.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50 flex items-center justify-center min-w-[120px]",children:d?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"Generating..."]}):"Generate PDF"})]})]}),A&&e.jsx(_t,{isOpen:A,onClose:()=>v(!1),allQuizzes:T,initiallySelectedQuizIds:w||[],onApplySelection:W})]}),Z)},Gt=500,zt=({subjects:r,onSelectSubject:c,onAnimationComplete:i,hasPdfButtonAnimationPlayedOnceGlobal:t,userHasInteractedWithWelcome:a})=>{const[k,A]=o.useState(!1),[v,w]=o.useState("idle"),C=o.useRef(null),T=o.useRef(null),[g,$]=o.useState(!1),z=o.useRef(null),P=()=>{A(!0)},W=()=>{A(!1)};let V=0,ne=0,Z=0;r.length===0&&(V=.1+.1,ne=V+.1,Z=ne+.1);const se=o.useMemo(()=>{if(r.length===0)return Z+.075+.2;{let m;const s=.2+(r.length-1)*.075;return r.length<4?m=.2+r.length*.075:m=s,m+.075+.2}},[r.length,.1,.075,4,Z]);return o.useEffect(()=>{if(C.current&&!T.current&&r.length>0&&!g){const m=se*1e3+Gt+300,s=setTimeout(()=>{C.current&&(T.current=C.current.getBoundingClientRect(),$(!0))},m);return()=>clearTimeout(s)}r.length===0&&g&&($(!1),T.current=null,w("idle"))},[r.length,se,g]),o.useEffect(()=>{const m=document.getElementById("shine-sound");m&&(z.current=m)},[]),o.useEffect(()=>{!t&&a&&v==="idle"&&g&&r.length>0&&C.current&&w("growing");const m=C.current;if(!m)return;const s=T.current;if(!s&&["growing","shining","returning"].includes(v)){console.error("Animation stage attempted without initial rect. Resetting animation state."),w("idle"),$(!1);return}let l;m.classList.remove("pdf-button-growing","pdf-button-shining","pdf-button-returning");const S=s?window.innerWidth/2-(s.left+s.width/2):0,j=s?window.innerHeight/2-(s.top+s.height/2):0;if(v==="growing"){if(!s)return;m.style.position="fixed",m.style.top=`${s.top}px`,m.style.left=`${s.left}px`,m.style.width=`${s.width}px`,m.style.height=`${s.height}px`,m.style.margin="0",m.style.zIndex="1000",m.style.transformOrigin="center center",m.style.setProperty("--translate-to-center-x",`${S}px`),m.style.setProperty("--translate-to-center-y",`${j}px`),m.style.transform="translate(0px, 0px) scale(1)",m.offsetWidth,m.classList.add("pdf-button-growing"),l=window.setTimeout(()=>{w("shining")},800)}else if(v==="shining"){if(!s)return;m.style.position="fixed",m.style.top=`${s.top}px`,m.style.left=`${s.left}px`,m.style.width=`${s.width}px`,m.style.height=`${s.height}px`,m.style.margin="0",m.style.zIndex="1000",m.style.transformOrigin="center center",m.style.transform="translate(var(--translate-to-center-x), var(--translate-to-center-y)) scale(1.5)",m.style.overflow="hidden",m.offsetWidth,m.classList.add("pdf-button-shining"),z.current&&(z.current.currentTime=0,z.current.play().catch(y=>console.warn("Audio play failed:",y.name,y.message))),l=window.setTimeout(()=>{w("returning")},1500)}else if(v==="returning"){if(!s)return;m.style.overflow="",m.offsetWidth,m.classList.add("pdf-button-returning"),l=window.setTimeout(()=>{w("finished")},600)}else v==="finished"&&(m.style.transform="translate(0px, 0px) scale(1)",m.offsetWidth,m.style.position="",m.style.top="",m.style.left="",m.style.width="",m.style.height="",m.style.margin="",m.style.zIndex="",m.style.transformOrigin="",m.style.overflow="",m.style.removeProperty("--translate-to-center-x"),m.style.removeProperty("--translate-to-center-y"),m.style.transform="",i(),w("idle"));return()=>{window.clearTimeout(l)}},[t,a,v,g,r.length,i]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full max-w-2xl mx-auto px-4 sm:px-6 pb-4 sm:pb-6 flex flex-col flex-grow",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-primary)] text-center mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)] mt-4 sm:mt-6 shrink-0 animate-fadeInUp",style:{animationDelay:`${.1}s`},children:"Select a Subject"}),r.length===0?e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center py-10 px-4",children:[e.jsx("i",{className:"fa-solid fa-box-open text-5xl sm:text-6xl text-[var(--text-secondary)] opacity-60 mb-6 animate-fadeInUp",style:{animationDelay:`${V}s`}}),e.jsx("p",{className:"text-xl sm:text-2xl font-semibold text-[var(--text-primary)] mb-2 animate-fadeInUp",style:{animationDelay:`${ne}s`},children:"It's a bit quiet here..."}),e.jsx("p",{className:"text-sm sm:text-md text-[var(--text-secondary)] max-w-md animate-fadeInUp",style:{animationDelay:`${Z}s`},children:"No subjects are available at the moment. Administrators can add new subjects and quizzes through the Admin Panel. Please check back soon!"})]}):e.jsxs("div",{className:`flex-grow flex flex-col items-center ${r.length<4?"justify-center":"justify-start"}`,children:[e.jsx("div",{className:"w-full space-y-3 py-4",children:r.map((m,s)=>{const l=m.quizzes.filter(j=>j.isStartable).length,S=.1+.1+s*.075;return e.jsxs("button",{onClick:()=>c(m.id),className:"w-full text-left p-4 bg-[var(--bg-primary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20 border border-[var(--border-color)] hover:border-[var(--accent-secondary)] rounded-lg text-[var(--text-primary)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] animate-fadeInUp",style:{animationDelay:`${S}s`},"aria-label":`Select subject: ${m.name}, ${l} quiz${l!==1?"zes":""} available`,children:[e.jsx("span",{className:"text-lg font-semibold text-[var(--accent-primary)]",children:m.name}),e.jsxs("span",{className:"block text-sm text-[var(--text-secondary)] mt-1",children:[l," quiz",l!==1?"zes":""," available"]})]},m.id)})}),r.length<4&&e.jsx("p",{className:"text-center text-xs sm:text-sm text-[var(--text-secondary)] mt-4 mb-4 italic animate-fadeInUp",style:{animationDelay:`${.1+.1+r.length*.075}s`},children:"More subjects and quizzes are on the way. Stay tuned!"})]}),e.jsx("div",{className:"mt-auto pt-6 border-t border-[var(--border-color)] text-center animate-fadeInUp",style:{animationDelay:`${se}s`},children:e.jsxs("button",{ref:C,onClick:P,className:"px-6 py-3 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-lg transition-colors text-sm font-medium focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] flex items-center justify-center mx-auto","aria-label":"Open PDF export preferences",disabled:v!=="idle"&&v!=="finished",children:[e.jsx("i",{className:"fa-solid fa-file-pdf fa-lg mr-2.5"}),"Export Quizzes to PDF"]})})]}),e.jsx(Ht,{isOpen:k,onClose:W,subjects:r})]})},Wt=({subject:r,onSelectQuiz:c,onBackToSubjectList:i})=>{const t=r.quizzes.filter(a=>a.isStartable);return e.jsxs("div",{className:"w-full p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)]",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-primary)] truncate mb-2 sm:mb-0",title:`Quizzes in ${r.name}`,children:["Quizzes in ",r.name]}),e.jsx("button",{onClick:i,className:"px-4 py-2 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors text-sm sm:text-base w-full sm:w-auto focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]","aria-label":"Back to subject list",children:"â Back to Subject List"})]}),r.quizzes.length===0?e.jsx("p",{className:"text-lg text-[var(--text-secondary)] text-center py-6",children:"No quizzes created yet for this subject."}):t.length===0?e.jsx("p",{className:"text-lg text-[var(--text-secondary)] text-center py-6",children:"No quizzes are currently available for users in this subject. Please check back later."}):e.jsx("div",{className:"space-y-3",children:t.map(a=>e.jsxs("button",{onClick:()=>c(a.id),className:"quiz-select-button w-full text-left p-4 bg-[var(--bg-primary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-30 border border-[var(--border-color)] hover:border-[var(--accent-secondary)] rounded-lg text-[var(--text-primary)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]","aria-label":`Select quiz: ${a.name}, ${a.questions.length} question${a.questions.length!==1?"s":""}`,children:[e.jsx("span",{className:"text-lg font-semibold text-[var(--accent-primary)]",children:a.name}),e.jsxs("span",{className:"block text-sm text-[var(--text-secondary)] mt-1",children:[a.questions.length," question",a.questions.length!==1?"s":""]})]},a.id))})]})},Tt=({question:r,questionNumber:c,selectedOptionId:i,isSubmitted:t,onOptionSelect:a,correctOptionIdForDisplay:d})=>{const[p,x]=o.useState(!1),k=()=>{x(A=>!A)};return e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 text-[var(--text-primary)] whitespace-pre-wrap",id:`question-${r.id}-text`,children:[c,". ",r.questionText]}),r.type==="mcq"&&r.options&&e.jsx("div",{className:"space-y-3",role:"radiogroup","aria-labelledby":`question-${r.id}-text`,children:r.options.map((A,v)=>{const w=i===A.id,C=String.fromCharCode(65+v);let T="w-full text-left p-3 rounded-md transition-all duration-150 flex items-center text-sm sm:text-base ",g="",$="";if(t){T+=" border-2 ";const P=A.id===d;P?(g="border-[var(--accent-green)] text-[var(--accent-green)] bg-[var(--accent-green-bg-soft)] font-medium",$="fa-solid fa-check-circle text-[var(--accent-green)]",w&&(g+=" ring-2 ring-[var(--accent-green)] ring-offset-1 ring-offset-[var(--bg-primary)]")):w&&!P?(g="border-[var(--accent-red)] text-[var(--accent-red)] bg-[var(--accent-red-bg-soft)] font-medium",$="fa-solid fa-times-circle text-[var(--accent-red)]"):(g="border-[var(--border-color)] text-[var(--text-secondary)] bg-[var(--bg-primary)] opacity-60 cursor-not-allowed",$="fa-regular fa-circle text-[var(--text-secondary)] opacity-60")}else T+=" border ",w?(g="bg-[var(--accent-primary-bg-selection)] border-[var(--accent-primary)] text-[var(--btn-primary-text)] font-medium",$="fa-solid fa-dot-circle text-[var(--btn-primary-text)]"):(g="bg-[var(--bg-primary)] border-[var(--border-color)] text-[var(--text-secondary)]",$="fa-regular fa-circle text-[var(--text-secondary)]");const z=T+g;return e.jsxs("button",{"data-option-id":A.id,className:`user-option-button ${z}`,onClick:()=>a(A.id),disabled:t,role:"radio","aria-checked":w&&!t,"aria-label":`Option ${C}: ${A.text}`,children:[e.jsx("i",{className:`${$} mr-2.5 text-lg w-5 text-center`})," ",e.jsxs("span",{className:"font-semibold mr-1.5",children:[C,"."]}),e.jsx("span",{children:A.text})]},A.id)})}),r.type==="written"&&e.jsxs("div",{className:"p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md space-y-3",children:[e.jsx("p",{className:"text-[var(--text-primary)] italic",children:"This is a written response question."}),r.modelAnswer&&r.modelAnswer.trim()!==""&&e.jsxs("div",{children:[e.jsxs("button",{onClick:k,className:"flex items-center space-x-2 text-sm text-[var(--accent-primary)] hover:text-[var(--accent-primary-hover)] focus:outline-none focus:ring-1 focus:ring-[var(--accent-primary)] rounded px-2 py-1 bg-[var(--bg-secondary)] border border-[var(--accent-secondary)] hover:border-[var(--accent-primary)]","aria-expanded":p,"aria-controls":`model-answer-${r.id}`,children:[e.jsx("i",{className:`fa-solid ${p?"fa-angle-up":"fa-angle-down"} fa-fw`}),e.jsx("span",{children:p?"Hide Model Answer":"Show Model Answer"})]}),p&&e.jsx("div",{id:`model-answer-${r.id}`,className:"mt-2 p-3 bg-[var(--bg-secondary)] border border-[var(--accent-secondary)] rounded-md",children:e.jsx("p",{className:"text-sm text-[var(--text-primary)] whitespace-pre-wrap",children:r.modelAnswer})})]})]})]})},Vt=({quiz:r,currentQuestionIndex:c,userAnswers:i,currentUserSelectionAttempt:t,isQuizComplete:a,onOptionSelect:d,onListedOptionSelect:p,onSubmitAnswer:x,onNextQuestion:k,onPreviousQuestion:A,onBackToQuizList:v,onRestartQuiz:w,userCorrectionMode:C,userQuestionDisplayMode:T,onTogglePrefsModal:g})=>{const[$,z]=o.useState(!0);o.useEffect(()=>{z(!0);const E=setTimeout(()=>{z(!1)},1200);return()=>clearTimeout(E)},[r.id]);const P=T==="oneByOne"?r.questions[c]:null,W=T==="oneByOne"?i[c]:null,V=(P==null?void 0:P.type)==="mcq",ne=W!=null,Z=!!(W&&W.feedback!==null),se=C==="immediate"?Z:a,m=ne?W.selectedOptionId:t,s=(C==="immediate"||a)&&Z?W.feedback:null,l=r.questions.length>0&&T==="oneByOne"?(c+1)/r.questions.length*100:0,S=!a&&c>0&&T==="oneByOne",j=T==="oneByOne"&&c===r.questions.length-1,y=!a&&P&&T==="oneByOne",Y=!a&&P&&V&&!Z&&C==="immediate"&&T==="oneByOne",O=t===null,G=C==="immediate"&&Y,F=()=>{a&&T==="oneByOne"&&!P||k()},J="p-3 text-[var(--accent-primary)] transition-colors rounded-full focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] disabled:opacity-40 disabled:cursor-not-allowed",q="px-10 py-4 sm:px-12 sm:py-4 text-[var(--btn-primary-text)] bg-[var(--accent-primary)] transition-colors rounded-lg shadow-sm border border-[var(--accent-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] disabled:opacity-40 disabled:cursor-not-allowed",B="w-full sm:w-auto mt-8 px-8 py-3 text-lg font-semibold text-[var(--btn-primary-text)] bg-[var(--accent-primary)] hover:bg-[var(--accent-primary-hover)] transition-colors rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)]",L=()=>e.jsxs("div",{className:"py-6",children:[e.jsxs("h3",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-green)] text-center mb-6",children:['Quiz Results for: "',r.name,'"']}),e.jsx("div",{className:"space-y-4 max-h-[calc(55vh+5rem)] sm:max-h-[calc(55vh+3rem)] overflow-y-auto pr-2 custom-scrollbar",children:r.questions.map((E,R)=>{const U=i[R];return e.jsxs("div",{className:"p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md shadow-sm",children:[e.jsxs("p",{className:"text-md font-semibold text-[var(--text-primary)] mb-2 whitespace-pre-wrap",children:[R+1,". ",E.questionText," ",e.jsxs("span",{className:"text-xs text-[var(--accent-secondary)]",children:["(",E.type.toUpperCase(),")"]})]}),E.type==="mcq"&&E.options&&e.jsxs("div",{className:"text-sm space-y-2 mt-1",children:[!(U!=null&&U.selectedOptionId)&&E.type==="mcq"&&e.jsx("p",{className:"text-sm text-[var(--accent-amber)] italic mb-1.5",children:"You did not answer this question."}),e.jsx("ul",{className:"space-y-1.5",children:E.options.map((_,ae)=>{const te=U?U.selectedOptionId===_.id:!1,ee=E.correctOptionId===_.id,K=String.fromCharCode(65+ae);let oe="p-2 rounded-md border flex items-center text-sm transition-all duration-150 ",le=null,de=null;return ee?(oe+="bg-green-500 bg-opacity-20 border-green-600 text-green-300 font-medium ",le=e.jsx("i",{className:"fa-solid fa-check fa-fw mr-2 text-green-400"}),de=e.jsx("span",{className:"ml-auto text-xs font-normal",children:"(Correct answer)"}),te&&(oe+="ring-2 ring-green-500 shadow-md ",le=e.jsx("i",{className:"fa-solid fa-check fa-fw mr-2 text-green-300"}),de=e.jsx("span",{className:"ml-auto text-xs font-semibold",children:"(Your correct choice)"}))):te?(oe+="bg-red-500 bg-opacity-20 border-red-600 text-red-300 font-medium shadow-md ",le=e.jsx("i",{className:"fa-solid fa-times-circle fa-fw mr-2 text-red-400"}),de=e.jsx("span",{className:"ml-auto text-xs font-semibold",children:"(Your incorrect choice)"})):(oe+="bg-[var(--bg-secondary)] border-[var(--border-color)] text-[var(--text-secondary)] ",le=e.jsx("i",{className:"fa-regular fa-circle fa-fw mr-2 text-[var(--text-secondary)] opacity-70"})),e.jsxs("li",{className:oe,children:[le,e.jsxs("span",{className:"font-semibold mr-1.5",children:[K,"."]}),e.jsx("span",{className:"flex-grow min-w-0 break-words",children:_.text}),de]},_.id)})})]}),E.type==="written"&&((U==null?void 0:U.feedback)==="Seen"||a&&!U?e.jsx("p",{className:"text-sm text-[var(--text-secondary)] italic mt-1",children:"You viewed this written response question."}):e.jsx("p",{className:"text-sm text-[var(--text-secondary)] italic mt-1",children:"This is a written response question."}))]},E.id)})}),e.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4",children:[e.jsx("button",{onClick:w,className:"px-6 py-2.5 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-sm sm:text-base bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] w-full sm:w-auto",children:"Restart Quiz"}),e.jsx("button",{onClick:v,className:"px-6 py-2.5 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-sm sm:text-base bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] w-full sm:w-auto",children:"Back to Quiz List"})]})]});return e.jsxs("div",{className:"w-full p-4 sm:p-6",children:[!a&&e.jsxs("div",{className:"flex items-center justify-between mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)]",children:[e.jsx("button",{onClick:v,className:"px-4 py-2 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-xs sm:text-sm bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] shrink-0","aria-label":"Back to quiz list",children:"â Back to Quiz List"}),!a&&e.jsx("button",{onClick:g,className:"text-[var(--text-secondary)] hover:text-[var(--accent-primary)] focus:outline-none p-1 rounded-full mx-2","aria-label":"Quiz Preferences",title:"Quiz Preferences",children:e.jsx("i",{className:`fa-solid fa-gear text-base ${$?"animate-settings-init":""}`})})]}),r.questions.length===0?e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-lg text-[var(--text-secondary)]",children:"This quiz has no questions yet."})}):a?L():T==="oneByOne"&&P?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm text-[var(--text-secondary)] mb-1",children:[e.jsxs("span",{className:"flex-1",children:["Question ",c+1," of ",r.questions.length]}),V&&s&&e.jsx("span",{className:`font-semibold flex-1 text-right ${s==="Correct"?"text-[var(--accent-green)]":"text-[var(--accent-red)]"}`,children:s})]}),e.jsx("div",{className:"bg-[var(--border-color)] rounded-full h-2.5 w-full",role:"progressbar","aria-valuenow":c+1,"aria-valuemin":1,"aria-valuemax":r.questions.length,"aria-label":"Quiz progress",children:e.jsx("div",{className:"bg-[var(--accent-primary)] h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${l}%`}})})]}),e.jsx(Tt,{question:P,questionNumber:c+1,selectedOptionId:m,isSubmitted:se,onOptionSelect:d,correctOptionIdForDisplay:s&&V?P.correctOptionId:void 0}),e.jsxs("div",{className:"mt-8 sm:mt-10 flex justify-between items-center",children:[e.jsx("div",{className:"w-14 h-14 flex items-center justify-center",children:S&&e.jsx("button",{onClick:A,className:J,"aria-label":"Previous Question",title:"Previous Question",children:e.jsx("i",{className:"fa-solid fa-chevron-left fa-lg"})})}),e.jsx("div",{className:"flex-grow flex justify-center items-center min-h-[3.5rem] sm:min-h-[4rem]",children:Y&&e.jsx("button",{onClick:x,disabled:O,className:`${q} focus:ring-offset-[var(--bg-primary)]`,"aria-label":"Submit Answer",title:"Submit Answer",children:e.jsx("i",{className:"fa-solid fa-circle-check fa-xl"})})}),e.jsx("div",{className:"w-14 h-14 flex items-center justify-center",children:y&&e.jsx("button",{onClick:F,disabled:G,className:J,"aria-label":j?"Finish Quiz":"Next Question",title:j?"Finish Quiz":"Next Question",children:e.jsx("i",{className:`fa-solid ${j?"fa-flag-checkered":"fa-chevron-right"} fa-lg`})})})]})]}):T==="listed"?e.jsxs("div",{className:"space-y-8",children:[r.questions.map((E,R)=>{const U=i[R],_=U!=null,ae=!!(U&&U.feedback!==null),te=C==="immediate"?ae:a,ee=_?U.selectedOptionId:null,K=(C==="immediate"||a)&&ae&&E.type==="mcq"?E.correctOptionId:void 0;return e.jsx("div",{className:"py-4 border-b border-[var(--border-color)] last:border-b-0",children:e.jsx(Tt,{question:E,questionNumber:R+1,selectedOptionId:ee,isSubmitted:te,onOptionSelect:oe=>p(oe,R),correctOptionIdForDisplay:K})},E.id)}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:F,className:B,"aria-label":"Finish Quiz",title:"Finish Quiz",children:[e.jsx("i",{className:"fa-solid fa-flag-checkered fa-lg mr-2"}),"Finish Quiz"]})})]}):e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-lg text-[var(--text-secondary)]",children:"Loading questions..."})})]})},yt="w-full p-3 border rounded-md focus:ring-2 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",Je="block text-sm font-medium text-[var(--text-secondary)] mb-1",Yt="bg-[var(--bg-secondary)] p-4 sm:p-6 rounded-lg shadow-lg",Jt="w-full py-2.5 px-4 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",Et=({subjectId:r,quizId:c,quizName:i,existingQuestion:t,onSaveQuestion:a,maxOptions:d})=>{var se;const[p,x]=o.useState("mcq"),[k,A]=o.useState(""),[v,w]=o.useState(Array(d).fill(null).map(()=>({text:""}))),[C,T]=o.useState(null),[g,$]=o.useState(""),[z,P]=o.useState(null),W=m=>{if(x(m?"mcq":(t==null?void 0:t.type)||"mcq"),A(m?"":(t==null?void 0:t.questionText)||""),$(m?"":(t==null?void 0:t.modelAnswer)||""),!m&&(t==null?void 0:t.type)==="mcq"&&(t!=null&&t.options)){const s=Array(d).fill(null).map(()=>({text:""}));let l=null;t.options.forEach((j,y)=>{y<d&&(s[y]={text:j.text})});const S=t.options.find(j=>j.id===t.correctOptionId);if(S){const j=s.findIndex(y=>y.text===S.text);j!==-1&&(l=j)}w(s),T(l)}else w(Array(d).fill(null).map(()=>({text:""}))),T(null);P(null)};o.useEffect(()=>{W(!t)},[t,d]);const V=(m,s)=>{const l=[...v];l[m]={text:s},w(l),s.trim()===""&&C===m&&T(null)},ne=m=>{if(m.preventDefault(),P(null),!k.trim()){P("Question text cannot be empty.");return}let s;if(p==="mcq"){const l=v.map((O,G)=>({text:O.text.trim(),originalIndex:G})).filter(O=>O.text!=="");if(l.length<2){P("Please provide at least two answer options for an MCQ.");return}if(C===null||v[C].text.trim()===""){P("Please select a correct answer from the non-empty options for an MCQ.");return}const S=l.map((O,G)=>({id:`option-${G}`,text:O.text})),j=v[C].text.trim(),y=S.find(O=>O.text===j);if(!y){P("Error determining correct option ID. The selected correct option might be empty or not among the provided options.");return}const Y=y.id;s={questionText:k.trim(),type:"mcq",options:S,correctOptionId:Y,modelAnswer:void 0}}else s={questionText:k.trim(),type:"written",options:void 0,correctOptionId:void 0,modelAnswer:g.trim()||void 0};t?a(r,c,{...s,id:t.id}):(a(r,c,s),W(!0))},Z=t?"Update Question":"Add Question";return e.jsxs("div",{className:`${Yt} mt-3 mb-3 sm:mt-4 sm:mb-4`,children:[t&&e.jsxs("p",{className:"text-sm text-[var(--text-secondary)] mb-3 -mt-2",children:['Editing: "',t.questionText.substring(0,50),'..." (',(se=t.type)==null?void 0:se.toUpperCase(),")"]}),e.jsxs("form",{onSubmit:ne,className:"space-y-6 p-4 bg-[var(--bg-secondary)] rounded-md border border-[var(--border-color)] shadow-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:`${Je} text-[var(--text-primary)]`,children:"Question Type"}),e.jsxs("div",{className:"flex space-x-4 text-[var(--text-primary)]",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"questionType",value:"mcq",checked:p==="mcq",onChange:()=>x("mcq"),className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{children:"Multiple Choice (MCQ)"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"questionType",value:"written",checked:p==="written",onChange:()=>x("written"),className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{children:"Written Response"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"questionText",className:Je,children:"Question Text"}),e.jsx("textarea",{id:"questionText",rows:3,value:k,onChange:m=>A(m.target.value),className:yt,placeholder:"Enter the question"})]}),p==="mcq"&&e.jsxs("fieldset",{children:[e.jsxs("legend",{className:`text-md font-medium ${Je} mb-2`,children:["Answer Options (Provide 2 to ",d,")"]}),e.jsx("div",{className:"space-y-3",children:v.map((m,s)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",id:`correctAnswer-${s}-${t?t.id:"new"}`,name:`correctAnswer-${t?t.id:"new"}`,value:s,checked:C===s,onChange:()=>T(s),disabled:m.text.trim()==="",className:"h-4 w-4 text-[var(--accent-primary)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] shrink-0 cursor-pointer bg-[var(--input-bg)]","aria-label":`Mark option ${String.fromCharCode(65+s)} as correct`}),e.jsxs("label",{htmlFor:`optionText-${s}-${t?t.id:"new"}`,className:"text-[var(--text-primary)] w-6 text-left font-medium",children:[String.fromCharCode(65+s),"."]}),e.jsx("input",{id:`optionText-${s}-${t?t.id:"new"}`,type:"text",value:m.text,onChange:l=>V(s,l.target.value),className:`${yt} flex-grow option-text-input`,placeholder:`Option ${String.fromCharCode(65+s)} text`,"data-option-index":s})]},s))})]}),p==="written"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"modelAnswer",className:Je,children:"Model Answer (Optional)"}),e.jsx("textarea",{id:"modelAnswer",rows:4,value:g,onChange:m=>$(m.target.value),className:yt,placeholder:"Enter the model answer for this written question (optional)"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mt-1",children:"This answer can be shown to users in the quiz."})]}),z&&e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mt-2",children:z}),e.jsx("div",{className:"flex flex-col pt-2",children:e.jsx("button",{type:"submit",className:Jt,children:Z})})]})]})},Kt=({question:r,questionNumber:c,onEdit:i,onDelete:t})=>{var p,x,k;let a="";if(r.type==="written")a="Type: Written";else{const A=((x=(p=r.options)==null?void 0:p.find(v=>v.id===r.correctOptionId))==null?void 0:x.text)||"N/A";a=`${((k=r.options)==null?void 0:k.length)||0} options, Correct: ${A.substring(0,25)}${A.length>25?"...":""}`}const d={userSelect:"none",transition:"background-color 0.2s ease, border-color 0.2s ease"};return e.jsxs("li",{className:"flex items-center justify-between p-3 bg-[var(--bg-primary)] rounded-md border border-[var(--border-color)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20 hover:border-[var(--accent-secondary)] shadow-sm",style:d,children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-primary)] truncate",title:r.questionText,children:[e.jsxs("span",{className:"font-semibold",children:[c,"."]})," ",r.questionText,e.jsxs("span",{className:"text-xs text-[var(--text-secondary)] ml-1",children:["(",r.type==="written"?"Written":"MCQ",")"]})]}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)]",children:a})]}),e.jsxs("div",{className:"flex space-x-2 ml-2 shrink-0",children:[e.jsx("button",{onClick:i,className:"edit-question-button px-3 py-1 text-xs bg-[var(--accent-amber)] hover:bg-[var(--accent-amber-hover)] text-[var(--btn-amber-text)] rounded-md transition-colors","aria-label":`Edit question: ${r.questionText.substring(0,30)}...`,children:"Edit"}),e.jsxs("button",{onClick:t,className:"delete-question-button px-3 py-1 text-xs bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white rounded-md transition-colors flex items-center space-x-1","aria-label":`Delete question: ${r.questionText.substring(0,30)}...`,children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw"}),e.jsx("span",{children:"Delete"})]})]})]})},Xt=({onConfirm:r,label:c,holdTimeMs:i=3e3})=>{const[t,a]=o.useState(!1),[d,p]=o.useState(0),[x,k]=o.useState(c),A=o.useRef(null),v=o.useRef(null),w=o.useRef(null),C=o.useCallback(()=>{a(!1),p(0),k(c),A.current&&clearTimeout(A.current),w.current&&cancelAnimationFrame(w.current),v.current=null},[c]),T=o.useCallback(()=>{if(!v.current){C();return}const $=Date.now()-v.current,z=Math.min($/i*100,100);p(z);const P=Math.ceil(Math.max(0,i-$)/1e3);k(`${P}s`),z>=100?(r(),C()):w.current=requestAnimationFrame(T)},[i,r,C]),g=o.useCallback(()=>{t||(a(!0),v.current=Date.now(),p(0),w.current&&cancelAnimationFrame(w.current),w.current=requestAnimationFrame(T))},[t,T]);return o.useEffect(()=>()=>{C()},[C]),o.useEffect(()=>{t||k(c)},[c,t]),e.jsxs("button",{type:"button",className:"relative w-full px-3 py-1.5 text-sm text-white rounded-md transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center space-x-2 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] focus:ring-[var(--accent-red)] focus:ring-offset-[var(--bg-secondary)] overflow-hidden",onMouseDown:g,onMouseUp:C,onMouseLeave:C,onTouchStart:g,onTouchEnd:C,onTouchCancel:C,"aria-label":`Hold to confirm ${c}`,children:[e.jsx("span",{className:"button-hold-progress",style:{width:`${d}%`}}),e.jsxs("span",{className:"relative z-10 flex items-center space-x-1.5 select-none",children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw shrink-0"}),e.jsx("span",{className:"button-label truncate",children:x})]})]})},Zt=({isOpen:r,title:c,message:i,requiredPassword:t,onConfirm:a,onCancel:d,confirmButtonText:p="Confirm",cancelButtonText:x="Cancel"})=>{const[k,A]=o.useState(""),[v,w]=o.useState(null);if(o.useEffect(()=>{r&&(A(""),w(null))},[r]),!r)return null;const C=g=>{g==null||g.preventDefault(),t?k===t?a():w("Incorrect password. Please try again."):a()},T=document.getElementById("modal-root");return T?we.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"confirmation-modal-title",onClick:d,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",onClick:g=>g.stopPropagation(),children:[e.jsx("h2",{id:"confirmation-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)] mb-4 text-center",children:c}),e.jsx("div",{className:"text-sm text-[var(--text-primary)] mb-6 text-center",children:i}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[t&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-[var(--text-secondary)] mb-1",children:"Enter Password to Confirm"}),e.jsx("input",{type:"password",id:"confirmPassword",value:k,onChange:g=>A(g.target.value),className:"w-full p-3 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)] text-[var(--input-text)] focus:ring-2 focus:ring-[var(--input-focus-ring)] focus:border-[var(--input-focus-ring)] placeholder-[var(--placeholder-color)]",placeholder:"Enter confirmation password",required:!0})]}),v&&e.jsx("p",{className:"text-red-500 text-sm text-center -mt-2",children:v}),e.jsxs("div",{className:"flex flex-col sm:flex-row-reverse gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:p}),e.jsx("button",{type:"button",onClick:d,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:x})]})]})]})}),T):(console.error("Modal root element 'modal-root' not found for ConfirmationModal."),null)},er="YOUR_GITHUB_RAW_DATA_JSON_URL_HERE_OR_LEAVE_EMPTY_TO_ALWAYS_USE_LOCAL_FALLBACK",tr="YOUR_GOOGLE_APPS_SCRIPT_URL_FOR_PAT_HERE_IF_NOT_USING_DEFAULT",rr="YOUR_APPS_SCRIPT_SHARED_SECRET_HERE",Me={GITHUB_DATA_URL:"https://github.com/Rustova/Q/blob/main/data.json",DEFAULT_THEME:"dark",GOOGLE_APPS_SCRIPT_PAT_FETCHER_URL:"https://script.google.com/macros/s/AKfycbz-AFYjxhI7KH_IfXAfm1dr5C5XM3D1YKw8AkyljTvDS-dPbKDnYPYMlWnloQTvifDzdw/exec",APPS_SCRIPT_SHARED_SECRET:rr},sr=({isOpen:r,onClose:c,subjectId:i,quizId:t,quizName:a,existingQuestion:d,onSaveQuestion:p,maxOptions:x})=>{if(!r)return null;const k=document.getElementById("modal-root");if(!k)return console.error("Modal root element 'modal-root' not found."),null;const A=(v,w,C)=>{p(v,w,C)};return we.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"edit-question-modal-title",onClick:c,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:v=>v.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl",children:[e.jsxs("h2",{id:"edit-question-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:['Edit Question in: "',a,'"']}),e.jsx("button",{onClick:c,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close edit question modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsx("div",{className:"p-1 overflow-y-auto flex-grow custom-scrollbar",children:e.jsx(Et,{subjectId:i,quizId:t,quizName:a,existingQuestion:d,onSaveQuestion:A,maxOptions:x},d.id)})]})}),k)},ar=({isOpen:r,quizName:c,initialQuestions:i,onConfirmReorder:t,onClose:a})=>{const[d,p]=o.useState([]);if(o.useEffect(()=>{p([...i])},[i,r]),o.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]),!r)return null;const x=v=>{if(!v.destination)return;const w=Array.from(d),[C]=w.splice(v.source.index,1);w.splice(v.destination.index,0,C),p(w)},k=()=>{t(d)},A=document.getElementById("modal-root");return A?we.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-[51] p-4",role:"dialog","aria-modal":"true","aria-labelledby":"reorder-questions-modal-title",onClick:a,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:v=>v.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl",children:[e.jsxs("h2",{id:"reorder-questions-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)] truncate min-w-0 mr-2",title:`Reorder Questions for: "${c}"`,children:['Reorder Questions for: "',e.jsx("span",{className:"truncate",children:c}),'"']}),e.jsx("button",{onClick:a,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close reorder questions modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-xl"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 overflow-y-auto flex-grow custom-scrollbar",children:[e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-4",children:"Drag and drop the questions to change their order."}),e.jsx(Ft,{onDragEnd:x,children:e.jsx(Dt,{droppableId:"questionsReorderList",children:v=>e.jsxs("ul",{...v.droppableProps,ref:v.innerRef,className:"space-y-2",children:[d.map((w,C)=>e.jsx(Rt,{draggableId:w.id,index:C,children:(T,g)=>e.jsxs("li",{ref:T.innerRef,...T.draggableProps,className:`border rounded-md flex 
                            ${g.isDragging?"bg-[var(--accent-primary)] bg-opacity-20 shadow-lg border-[var(--accent-primary)]":"bg-[var(--bg-primary)] border-[var(--border-color)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20"}`,children:[e.jsx("div",{className:"p-3 flex-grow min-w-0",children:e.jsxs("span",{className:"text-sm text-[var(--text-primary)] truncate block",title:w.questionText,children:[e.jsxs("span",{className:"font-medium mr-1",children:[C+1,"."]}),w.questionText,e.jsxs("span",{className:"text-xs text-[var(--accent-secondary)] ml-1.5",children:["(",w.type==="mcq"?"MCQ":"Written",")"]})]})}),e.jsx("div",{...T.dragHandleProps,className:"px-5 py-3 bg-[var(--accent-secondary)] hover:bg-[var(--accent-secondary-hover)] text-[var(--text-primary)] rounded-r-md cursor-grab active:cursor-grabbing flex items-center justify-center shrink-0","aria-label":"Drag to reorder question",children:e.jsx("i",{className:"fa-solid fa-sort fa-fw fa-xl text-[var(--text-primary)]"})})]})},w.id)),v.placeholder]})})}),i.length===0&&e.jsx("p",{className:"text-[var(--text-secondary)] text-center py-4",children:"This quiz has no questions to reorder."})]}),e.jsx("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-end space-x-3",children:e.jsx("button",{onClick:k,disabled:i.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50",children:"Save Order"})})]})}),A):(console.error("Modal root element 'modal-root' not found."),null)},St=({textToType:r,className:c,title:i})=>{const t=r||"";return e.jsx("span",{className:c,title:i||r,children:t})},Ke="w-full p-3 border rounded-md focus:ring-2 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",kt="w-full p-3 border rounded-md focus:ring-2 bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",It="px-4 py-2 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)]",wt="px-4 py-2 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)]",nr="px-4 py-2 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]",or="px-4 py-2 bg-[var(--accent-green)] hover:bg-[var(--accent-green-hover)] text-white rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--accent-green)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",Re="block text-sm font-medium text-[var(--text-secondary)] mb-1",Xe="bg-[var(--bg-secondary)] p-4 sm:p-6 rounded-lg shadow-lg border border-[var(--border-color)]",ir="a7f39d5b1c",lr=r=>{try{const c=new URL(r);if(c.hostname==="raw.githubusercontent.com"){const i=c.pathname.split("/").filter(Boolean);return i.length<4?(console.error("Invalid GitHub Raw URL: Path too short. Expected owner/repo/branch/path... Given:",r),null):{owner:i[0],repo:i[1],branch:i[2],path:i.slice(3).join("/")}}if(c.hostname==="github.com"){const i=/^\/([^\/]+)\/([^\/]+)\/blob\/([^\/]+)\/(.+)$/,t=c.pathname.match(i);if(t){const[,a,d,p,x]=t;return{owner:a,repo:d,branch:p,path:x.replace(/\?.*$/,"")}}}if(c.hostname==="api.github.com"&&c.pathname.startsWith("/repos/")){const i=c.pathname.split("/").filter(Boolean);if(i.length>=5&&i[0]==="repos"&&i[3]==="contents"){const a=new URLSearchParams(c.search).get("ref")||"main";return{owner:i[1],repo:i[2],branch:a,path:i.slice(4).join("/")}}}return console.warn(`URL (${r}) is not a recognized GitHub raw, blob, or API URL for saving. Saving via GitHub API might fail.`),null}catch(c){return console.error("Error parsing GitHub URL for saving:",r,c),null}},cr=r=>{const{subjects:c,allSubjectsData:i,activeSubjectId:t,activeQuizId:a,editingQuestion:d,setEditingQuestion:p,onSetActiveSubjectId:x,onCreateSubject:k,onUpdateSubjectName:A,onDeleteSubject:v,onSetActiveQuizId:w,onCreateQuiz:C,onUpdateQuizName:T,onDeleteQuiz:g,onToggleQuizStartable:$,onAddQuestion:z,onUpdateQuestion:P,onDeleteQuestion:W,onReorderQuestions:V,onReorderAllQuizzesByTypeGlobal:ne,maxOptions:Z,showManageSubjectsSection:se,setShowManageSubjectsSection:m,showManageQuizzesSection:s,setShowManageQuizzesSection:l,activeAdminSubject:S,activeAdminQuiz:j,githubPat:y,setGithubPat:Y}=r,[O,G]=o.useState(""),[F,J]=o.useState(""),[q,B]=o.useState(""),[L,E]=o.useState(""),[R,U]=o.useState(!0),[_,ae]=o.useState(!1),[te,ee]=o.useState(null),K=Me.GITHUB_DATA_URL!==er,[oe,le]=o.useState(!1),[de,re]=o.useState(!1),[he,je]=o.useState(!1),[ie,xe]=o.useState(null),ge=Me.GOOGLE_APPS_SCRIPT_PAT_FETCHER_URL!==tr,[Oe,ze]=o.useState(!1),[Te,fe]=o.useState(null),[Ze,et]=o.useState(""),[tt,rt]=o.useState("");o.useEffect(()=>{le(!!d)},[d]),o.useEffect(()=>{J((S==null?void 0:S.name)||"")},[S]),o.useEffect(()=>{E((j==null?void 0:j.name)||"")},[j]);const Fe=o.useCallback(async()=>{je(!0),xe({message:"Fetching PAT...",type:"info"});try{const N=Me.GOOGLE_APPS_SCRIPT_PAT_FETCHER_URL,Q=await fetch(N,{method:"GET"}),X=await Q.json().catch(async()=>({error:`Non-JSON response from server: ${(await Q.text()).substring(0,150)}...`}));if(!Q.ok){const Ne=X.error||`${Q.status} ${Q.statusText}`;throw new Error(`Failed to fetch PAT: ${Ne}`)}if(X&&typeof X.pat=="string"&&X.pat.trim()!=="")Y(X.pat.trim()),xe({message:"PAT fetched and updated successfully!",type:"success"});else throw X.error?new Error(`Error from source: ${X.error}`):new Error('Invalid PAT data received. Expected a "pat" field with a non-empty string.')}catch(N){console.error("Error fetching PAT from sheet:",N);const Q=N instanceof Error?N.message:String(N);xe({message:`Error fetching PAT: ${Q}`,type:"error"})}finally{je(!1)}},[ge,xe,Y]);o.useEffect(()=>{Fe()},[ge,Fe]);const Se=(N,Q,X)=>{et(N),rt(Q),fe(()=>X),ze(!0)},st=()=>{Te&&Te(),ze(!1),fe(null)},at=()=>{ze(!1),fe(null)},qe=()=>{if(!O.trim()){alert("Subject name cannot be empty.");return}if(c.some(N=>N.name.toLowerCase()===O.trim().toLowerCase())){alert(`A subject with the name "${O.trim()}" already exists. Please choose a different name.`);return}Se("Confirm Create Subject",e.jsxs("p",{children:["Are you sure you want to create the subject: ",e.jsx("strong",{children:O.trim()}),"?"]}),()=>{k(O.trim()),G("")})},De=N=>{x(N.target.value||null)},ke=()=>{if(!t||!F.trim()){alert("No subject selected or name is empty.");return}const N=S==null?void 0:S.name;Se("Confirm Update Subject Name",e.jsxs("p",{children:['Are you sure you want to rename the subject from "',e.jsx("strong",{children:N}),'" to "',e.jsx("strong",{children:F.trim()}),'"?']}),()=>{A(t,F.trim())})},nt=()=>{t&&S?Se("Confirm Delete Subject",e.jsxs("p",{children:["Are you sure you want to delete the subject: ",e.jsx("strong",{children:S.name}),"? This action cannot be undone and will delete all its quizzes and questions."]}),()=>v(t)):alert("No subject selected to delete.")},ot=()=>{if(!t||!q.trim()){alert("No subject selected or quiz name is empty.");return}C(t,q.trim()),B("")},it=N=>{w(N.target.value||null)},lt=()=>{if(!t||!a||!L.trim()){alert("No subject/quiz selected or name is empty.");return}T(t,a,L.trim())},ct=()=>{t&&a&&j?g(t,a):alert("No quiz selected to delete.")},dt=()=>{t&&a&&$(t,a)},mt=N=>{p(N)},ut=N=>{console.log("[AdminView] handleDeleteQuestionClick called for question ID:",N),t&&a&&j?j.questions.find(X=>X.id===N)?W(t,a,N):(alert(`Question not found in the current quiz (ID: ${N}). It might have already been deleted.`),console.warn(`[AdminView] Attempted to delete question ID ${N}, but it was not found in activeAdminQuiz.questions.`)):(alert("Cannot delete question: context missing (subject/quiz). Please ensure a quiz is selected."),console.error(`[AdminView] handleDeleteQuestionClick: Context missing. activeSubjectId: ${t}, activeQuizId: ${a}.`))},Ue=(N,Q,X)=>{"id"in X?P(N,Q,X):z(N,Q,X),p(null)},ft=()=>{j&&re(!0)},pt=N=>{t&&a&&V(t,a,N),re(!1)},xt=()=>{Se("Confirm Global Question Reorder",e.jsxs("span",{children:["This will reorder questions in ",e.jsx("strong",{children:"ALL quizzes"})," across ",e.jsx("strong",{children:"ALL subjects"}),". Written questions will be moved before MCQ questions within each quiz. This action cannot be undone. Please enter the password to confirm."]}),()=>{ne()})},bt=async()=>{if(!y){ee({message:"A PAT is required to save data. Please ensure it is fetched successfully.",type:"error"});return}ae(!0),ee({message:"Saving Data...",type:"info"});const N=lr(Me.GITHUB_DATA_URL);if(!N){ee({message:"Could not parse GitHub URL. Check console for details and ensure it's a raw, blob, or API URL.",type:"error"}),ae(!1);return}console.log("GitHub Repo Info for Save:",N);const{owner:Q,repo:X,branch:Ne,path:ht}=N,Be=`https://api.github.com/repos/${Q}/${X}/contents/${ht}`,gt="Quiz App: Update application data via Web Editor",_e={lastUpdated:new Date().toISOString(),subjects:i},vt=JSON.stringify(_e,null,2),ue=btoa(unescape(encodeURIComponent(vt)));try{let pe;const be=new URL(Be);be.searchParams.append("ref",Ne),be.searchParams.append("_cb_sha",Date.now().toString());try{const ce=await fetch(be.toString(),{method:"GET",headers:{Authorization:`token ${y}`,Accept:"application/vnd.github.v3+json"}});if(ce.ok)pe=(await ce.json()).sha,console.log("Fetched current file SHA:",pe);else if(ce.status!==404){const Qe=await ce.text();throw new Error(`Failed to get current file SHA: ${ce.status} - ${Qe}`)}else console.log("File not found (404) when fetching SHA. Will attempt to create a new file.")}catch(ce){throw console.error("Error fetching file SHA:",ce),new Error(`Network or unexpected error fetching file SHA: ${ce.message}`)}const Ae=await fetch(Be,{method:"PUT",headers:{Authorization:`token ${y}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({message:gt,content:ue,sha:pe,branch:Ne})});if(!Ae.ok){const ce=await Ae.json();throw console.error("GitHub API Error Data during PUT:",ce),new Error(`GitHub API error: ${Ae.status} - ${ce.message||"Unknown error"}`)}const Nt=await Ae.json();console.log("Save successful:",Nt),ee({message:"Data saved successfully!",type:"success"})}catch(pe){console.error("Error saving data:",pe),ee({message:`Error saving data: ${pe.message}`,type:"error"})}finally{ae(!1)}},Ie=N=>{N(Q=>!Q)};let Pe="fa-cloud-arrow-down",Ee="Fetch PAT";return he?(Pe="fa-spinner fa-spin",Ee="Fetching PAT..."):(ie==null?void 0:ie.type)==="success"&&y?(Pe="fa-check",Ee="PAT Synced"):(ie==null?void 0:ie.type)==="error"&&(Pe="fa-rotate-right",Ee="Fetch Failed. Retry?"),e.jsxs("div",{className:"space-y-6 sm:space-y-8 pb-8",children:[e.jsxs("section",{className:Xe,"aria-labelledby":"manage-subjects-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Ie(m),children:[e.jsx("h2",{id:"manage-subjects-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:"Manage Subjects"}),e.jsx("i",{className:`fa-solid ${se?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),se&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newSubjectName",className:Re,children:"Create New Subject"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",id:"newSubjectName",value:O,onChange:N=>G(N.target.value),placeholder:"Enter name for new subject",className:Ke}),e.jsxs("button",{onClick:qe,className:It,"aria-label":"Create New Subject",children:[e.jsx("i",{className:"fa-solid fa-plus fa-fw"})," Create Subject"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectSubjectToManage",className:Re,children:"Select Subject to Manage"}),e.jsxs("select",{id:"selectSubjectToManage",value:t||"",onChange:De,className:kt,children:[e.jsx("option",{value:"",children:"-- Select a Subject --"}),c.map(N=>e.jsx("option",{value:N.id,children:N.name},N.id))]})]}),t&&S&&e.jsxs("div",{className:"p-3 border border-[var(--border-color)] bg-[var(--bg-primary)] rounded-md space-y-3 mt-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:["Managing:",e.jsx(St,{textToType:S.name,className:"font-semibold text-[var(--text-primary)] truncate max-w-[200px] sm:max-w-xs inline-block align-bottom",title:S.name},S.id)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",value:F,onChange:N=>J(N.target.value),placeholder:"New name for selected subject",className:Ke,"aria-label":"New name for selected subject"}),e.jsxs("button",{onClick:ke,className:wt,"aria-label":"Update Selected Subject Name",children:[e.jsx("i",{className:"fa-solid fa-pen-to-square fa-fw"})," Update Name"]})]}),e.jsxs("button",{onClick:nt,className:`${nr} w-full`,"aria-label":"Delete Selected Subject",children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw"})," Delete Subject"]})]}),!t&&e.jsx("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:"Select a subject above to manage its details and quizzes."})]})]}),t&&S&&e.jsxs("section",{className:Xe,"aria-labelledby":"manage-quizzes-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Ie(l),children:[e.jsxs("h2",{id:"manage-quizzes-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:["Manage Quizzes for: ",e.jsx("span",{className:"truncate",children:S.name})]}),e.jsx("i",{className:`fa-solid ${s?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newQuizName",className:Re,children:"Create New Quiz"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",id:"newQuizName",value:q,onChange:N=>B(N.target.value),placeholder:"Enter name for new quiz",className:Ke}),e.jsxs("button",{onClick:ot,className:It,"aria-label":"Create New Quiz",children:[e.jsx("i",{className:"fa-solid fa-plus fa-fw"})," Create Quiz"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectQuizToManage",className:Re,children:"Select Quiz to Manage"}),e.jsxs("select",{id:"selectQuizToManage",value:a||"",onChange:it,className:kt,children:[e.jsx("option",{value:"",children:"-- Select a Quiz --"}),S.quizzes.map(N=>e.jsxs("option",{value:N.id,children:[N.name,!N.isStartable&&" (Not Available)"]},N.id))]})]}),a&&j&&e.jsxs("div",{className:"p-3 border border-[var(--border-color)] bg-[var(--bg-primary)] rounded-md space-y-3 mt-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:["Managing:",e.jsx(St,{textToType:j.name,className:"font-semibold text-[var(--text-primary)]",title:j.name},j.id)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",value:L,onChange:N=>E(N.target.value),placeholder:"New name for selected quiz",className:Ke,"aria-label":"New name for selected quiz"}),e.jsxs("button",{onClick:lt,className:wt,"aria-label":"Update Selected Quiz Name",children:[e.jsx("i",{className:"fa-solid fa-pen-to-square fa-fw"})," Update Name"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md bg-[var(--input-bg)] border border-[var(--input-border)]",children:[e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"Available to users"}),e.jsx("button",{onClick:dt,className:`rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--input-bg)]
                          ${j.isStartable?"focus:ring-[var(--accent-green)]":"focus:ring-[var(--accent-secondary)]"} flex items-center justify-center p-1`,"aria-checked":j.isStartable,role:"switch",title:j.isStartable?"Click to make unavailable to users":"Click to make available to users",children:e.jsxs("div",{className:"relative inline-block w-12 h-6 select-none",children:[e.jsx("div",{className:`toggle-track absolute w-12 h-6 rounded-full shadow-inner transition-colors duration-200 ease-in-out ${j.isStartable?"bg-[var(--accent-green)]":"bg-[var(--accent-secondary)]"}`}),e.jsx("div",{className:`toggle-knob absolute w-5 h-5 bg-white rounded-full shadow top-0.5 left-0.5 transition-transform duration-200 ease-in-out transform ${j.isStartable?"translate-x-6":"translate-x-0"}`})]})})]}),e.jsx(Xt,{onConfirm:()=>ct(),label:"Delete Quiz",holdTimeMs:3e3})]}),!a&&S.quizzes.length>0&&e.jsx("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:"Select a quiz above to manage its questions and details."}),S.quizzes.length===0&&e.jsxs("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:['No quizzes created yet for "',S.name,'".']})]})]}),t&&a&&j&&e.jsxs("section",{className:`${Xe} mt-6`,"aria-labelledby":"manage-questions-heading",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h2",{id:"manage-questions-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:["Manage Questions for: ",e.jsx("span",{className:"truncate",children:j.name})]})}),e.jsx(Et,{subjectId:t,quizId:a,quizName:j.name,existingQuestion:null,onSaveQuestion:Ue,maxOptions:Z}),oe&&d&&e.jsx(sr,{isOpen:oe,onClose:()=>p(null),subjectId:t,quizId:a,quizName:j.name,existingQuestion:d,onSaveQuestion:Ue,maxOptions:Z}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center mb-3",children:[e.jsxs("h3",{className:"text-lg font-medium text-[var(--text-primary)]",children:["Current Questions (",j.questions.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[j.questions.length>0&&e.jsxs("button",{onClick:xt,className:"px-2.5 py-1 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center space-x-1","aria-label":"Sort all questions globally by type (Written then MCQ)",title:"Sort All Quizzes by Type (Global)",children:[e.jsx("i",{className:"fa-solid fa-arrow-up-wide-short"}),e.jsx("span",{children:"Sort All by Type (Global)"})]}),j.questions.length>1&&e.jsxs("button",{onClick:ft,className:"px-2.5 py-1 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center space-x-1","aria-label":"Reorder questions for current quiz",title:"Reorder Questions (Current Quiz)",children:[e.jsx("i",{className:"fa-solid fa-sort"})," ",e.jsx("span",{children:"Reorder"})]})]})]}),j.questions.length===0?e.jsx("p",{className:"text-[var(--text-secondary)] text-center py-3",children:"No questions added yet. Use the form above to add some!"}):e.jsx("ul",{className:"space-y-2",children:j.questions.map((N,Q)=>e.jsx(Kt,{question:N,questionNumber:Q+1,onEdit:()=>mt(N),onDelete:()=>ut(N.id)},N.id))}),de&&j&&e.jsx(ar,{isOpen:de,quizName:j.name,initialQuestions:j.questions,onConfirmReorder:pt,onClose:()=>re(!1)})]})]}),e.jsxs("section",{className:Xe,"aria-labelledby":"app-data-management-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Ie(U),children:[e.jsx("h2",{id:"app-data-management-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:"Application Data Management"}),e.jsx("i",{className:`fa-solid ${R?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),R&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:Re,children:"Personal Access Token (PAT)"}),e.jsxs("p",{className:"text-xs text-[var(--text-secondary)] mt-1 mb-2",children:["Your PAT is stored in browser localStorage. It needs 'repo' scope (Classic PAT) or 'Contents: Read & Write' (Fine-Grained PAT) for the repository containing the application data.",e.jsx("a",{href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens",target:"_blank",rel:"noopener noreferrer",className:"text-[var(--accent-primary)] hover:underline ml-1",children:"More info"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:Fe,disabled:he||!ge,className:`${wt} w-full sm:w-auto ${he||!ge?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("i",{className:`fa-solid ${Pe} fa-fw`}),Ee]}),ie&&e.jsx("p",{className:`text-xs mt-1.5 text-center ${ie.type==="error"?"text-red-400":ie.type==="success"?"text-green-400":"text-[var(--text-secondary)]"}`,children:ie.message})]}),e.jsxs("button",{onClick:bt,disabled:_||!K||!y,className:`${or} w-full sm:w-auto ${_||!K||!y?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("i",{className:`fa-solid ${_?"fa-spinner fa-spin":"fa-save"} fa-fw`}),_?"Saving Data...":"Save Data"]}),!K,!y&&K&&e.jsx("p",{className:"text-xs text-[var(--text-secondary)] text-center mt-1",children:'A PAT is required to enable saving. Please use the "Fetch PAT" button or ensure automatic fetching is successful.'}),te&&e.jsx("p",{className:`text-sm mt-2 text-center ${te.type==="error"?"text-red-400":te.type==="success"?"text-green-400":"text-[var(--text-secondary)]"}`,children:te.message}),e.jsx("div",{className:"mt-4 p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("i",{className:"fa-solid fa-circle-info text-[var(--accent-secondary)] mt-1 text-lg"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-[var(--text-primary)]",children:"Saving Your Work"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)]",children:"Manage your subjects, quizzes, and questions using the sections above. If data saving is configured, ensure your PAT is fetched successfully and click 'Save Data' to store all changes."})]})]})})]})]}),Oe&&e.jsx(Zt,{isOpen:Oe,title:Ze,message:tt,requiredPassword:ir,onConfirm:st,onCancel:at})]})},dr=({isOpen:r,onClose:c,timestamp:i})=>{if(!r)return null;let t="N/A",a="N/A",d="Timestamp not available.";if(i)try{const x=new Date(i);isNaN(x.getTime())?d="Invalid timestamp provided.":(t=x.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),a=x.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"}),d=`This content was last updated on: ${x.toString()}`)}catch(x){console.error("Error formatting timestamp for modal:",x),d="Error displaying timestamp."}const p=document.getElementById("modal-root");return p?we.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"timestamp-modal-title",onClick:c,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",onClick:x=>x.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between pb-4 mb-4 border-b border-[var(--border-color)]",children:[e.jsx("h2",{id:"timestamp-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)]",children:"Content Update Information"}),e.jsx("button",{onClick:c,className:"p-1.5 text-[var(--text-secondary)] hover:text-[var(--accent-red)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close timestamp information modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"text-sm text-[var(--text-primary)] space-y-2",children:[e.jsx("p",{children:d}),i&&!isNaN(new Date(i).getTime())&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",t]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",a]})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-[var(--border-color)] flex justify-end",children:e.jsx("button",{type:"button",onClick:c,className:"px-5 py-2 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] text-sm",children:"Close"})})]})}),p):(console.error("Modal root element 'modal-root' not found for TimestampModal."),null)},mr=({isOpen:r,onClose:c,currentCorrectionMode:i,onSetCorrectionMode:t,currentQuestionDisplayMode:a,onSetQuestionDisplayMode:d})=>{const[p,x]=o.useState(i),[k,A]=o.useState(a);if(o.useEffect(()=>{r&&(x(i),A(a))},[r,i,a]),!r)return null;const v=g=>{x(g.target.value)},w=g=>{A(g.target.value)},C=()=>{t(p),d(k)},T=document.getElementById("modal-root");return T?we.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"quiz-prefs-modal-title",onClick:c,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-lg border border-[var(--border-color)] max-h-[90vh] flex flex-col",onClick:g=>g.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between pb-4 mb-4 border-b border-[var(--border-color)] shrink-0",children:[e.jsx("h2",{id:"quiz-prefs-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)]",children:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§ÙØ§Ø®ØªØ¨Ø§Ø± (Quiz Preferences)"}),e.jsx("button",{onClick:c,className:"p-1.5 text-[var(--text-secondary)] hover:text-[var(--accent-red)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close preferences modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"space-y-6 mb-6 overflow-y-auto custom-scrollbar pr-1 flex-grow",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--text-primary)] mb-2",children:"ÙÙØ· Ø§ÙØªØµØ­ÙØ­ (Correction Mode)"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-2",children:"Choose how you want quiz answers to be graded:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"correctionMode",value:"immediate",checked:p==="immediate",onChange:v,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙÙØ°Ø§ÙØ±Ø© : ØªØµØ­ÙØ­ Ø§ÙØ³Ø¤Ø§Ù Ø§ÙÙ Ø¨Ø§ÙÙ"})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"correctionMode",value:"atEnd",checked:p==="atEnd",onChange:v,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙÙØ±Ø§Ø¬Ø¹Ø© : ØªØµØ­ÙØ­ Ø§ÙÙÙÙØ² Ø¹ÙØ¯ Ø§ÙØªØ³ÙÙÙ"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--text-primary)] mb-2",children:"ÙÙØ· Ø¹Ø±Ø¶ Ø§ÙØ£Ø³Ø¦ÙØ© (Question Display Mode)"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-2",children:"Choose how questions are presented during the quiz:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"questionDisplayMode",value:"oneByOne",checked:k==="oneByOne",onChange:w,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙØ³Ø¤Ø§Ù Ø§ÙÙØ§Ø­Ø¯: Ø¹Ø±Ø¶ Ø§ÙØ£Ø³Ø¦ÙØ© Ø³Ø¤Ø§ÙÙØ§ ØªÙÙ Ø§ÙØ¢Ø®Ø±"})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"questionDisplayMode",value:"listed",checked:k==="listed",onChange:w,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙÙØ§Ø¦ÙØ©: Ø¹Ø±Ø¶ Ø¬ÙÙØ¹ Ø£Ø³Ø¦ÙØ© Ø§ÙØ§Ø®ØªØ¨Ø§Ø± ÙÙ ÙØ§Ø¦ÙØ© ÙØ§Ø­Ø¯Ø©"})]})]})]})]}),e.jsxs("div",{className:"mt-auto pt-4 border-t border-[var(--border-color)] flex flex-col sm:flex-row-reverse gap-3 shrink-0",children:[e.jsx("button",{type:"button",onClick:C,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Save Preferences"}),e.jsx("button",{type:"button",onClick:c,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Cancel"})]})]})}),T):(console.error("Modal root element 'modal-root' not found for QuizPreferencesModal."),null)},ur=({onInteraction:r})=>{const[c,i]=o.useState(!1),[t,a]=o.useState(!1),d=o.useRef(null);o.useEffect(()=>{if(d.current){const A=d.current.children;Array.from(A).forEach((v,w)=>{v.style.animationDelay=`${w*.4}s`})}const k=setTimeout(()=>{a(!0)},3e3);return()=>clearTimeout(k)},[]);const p=()=>{!t||c||i(!0)},x=k=>{k.animationName==="fadeOutWelcomeScreen"&&r()};return e.jsxs("div",{className:`fixed inset-0 bg-black flex flex-col items-center justify-center z-[1001] transition-opacity duration-700 ease-in-out
                  ${c?"welcome-screen-fading-out":"opacity-100"}
                  ${t?"cursor-pointer":"cursor-default"}`,onClick:p,onAnimationEnd:x,role:"button",tabIndex:0,"aria-label":"Welcome screen, click to enter application when prompted",children:[e.jsx("style",{children:`
          @keyframes fadeOutWelcomeScreen {
            from { opacity: 1; }
            to { opacity: 0; pointer-events: none; }
          }
          .welcome-screen-fading-out {
            animation: fadeOutWelcomeScreen 0.7s ease-in-out forwards;
          }

          @keyframes pulseLogo {
            0%, 100% { transform: scale(1); box-shadow: 0 0 15px var(--accent-primary), 0 0 30px var(--accent-primary); }
            50% { transform: scale(1.05); box-shadow: 0 0 25px var(--accent-primary), 0 0 50px var(--accent-primary); }
          }
          
          @keyframes simpleFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
          }

          .welcome-q-logo-container {
            position: relative; /* For positioning circles */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 3rem; 
            animation: simpleFadeIn 0.8s 0.2s ease-out backwards;
          }

          .welcome-q-logo-actual {
            height: 100px; 
            width: 100px;
            border-width: 3px;
            /* Changed border color to be visible on black, e.g., using accent-primary or a light gray */
            border-color: var(--accent-primary); 
            background-color: var(--text-primary);
             /* Text color for 'Q' might need adjustment if --bg-primary is too dark for black */
            color: var(--bg-secondary); /* Using --bg-secondary which is #161616, should be ok on light beige bg of Q */
            font-size: 4rem; 
            animation: pulseLogo 2.5s infinite ease-in-out;
            z-index: 10; /* Above circles */
          }
          
          .welcome-message-text-wrapper {
            color: var(--text-primary);
            font-size: 1.75rem; 
            font-weight: 500;
            margin-bottom: 1.5rem;
            
            display: flex;
            align-items: center;
            justify-content: center;

            width: 290px; 
            height: calc(1.75rem * 1.45); 

            animation: simpleFadeIn 1s 0.4s ease-out backwards;
          }

          .typewriter-inner-span {
            display: inline-block; 
            height: 1em; 
            line-height: 1em; 
          }

          .welcome-prompt-text {
            color: var(--accent-primary);
            font-size: 1.1rem; /* approx 17.6px */
            text-align: center;
            opacity: 0; /* Starts hidden, fades in via animation */
            animation: simpleFadeIn 1s 3s ease-out forwards; /* This makes the box and its content appear - CHANGED TO 3 SECONDS */
            
            /* Fixed height for stability */
            height: calc(1.1rem * 1.6); /* font-size * generous line-height factor */
            display: flex; /* For centering content within fixed height */
            align-items: center;
            justify-content: center;

            width: 100%; 
            box-sizing: border-box; 
            margin-bottom: 3rem; /* More space below */
          }

          .emerging-circles-bg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 320px; 
            height: 320px; 
            pointer-events: none;
            z-index: 5; /* Behind logo */
          }
          .emerging-bg-circle {
            position: absolute;
            border-radius: 50%;
            border: 2px solid var(--accent-primary);
            opacity: 0;
            animation: emergeAndScaleFade 4s infinite ease-out;
            box-shadow: 0 0 8px var(--accent-primary);
          }
          .emerging-bg-circle:nth-child(1) { width: 160px; height: 160px; top: calc(50% - 80px); left: calc(50% - 80px); }
          .emerging-bg-circle:nth-child(2) { width: 220px; height: 220px; top: calc(50% - 110px); left: calc(50% - 110px); }
          .emerging-bg-circle:nth-child(3) { width: 280px; height: 280px; top: calc(50% - 140px); left: calc(50% - 140px); }
          
          @keyframes emergeAndScaleFade {
            0% { transform: scale(0.6); opacity: 0; }
            25% { opacity: 0.7; } 
            75% { opacity: 0.3; } 
            100% { transform: scale(1.1); opacity: 0; }
          }
        `}),e.jsxs("div",{className:"welcome-q-logo-container",children:[e.jsxs("div",{className:"emerging-circles-bg",ref:d,children:[e.jsx("div",{className:"emerging-bg-circle"}),e.jsx("div",{className:"emerging-bg-circle"}),e.jsx("div",{className:"emerging-bg-circle"})]}),e.jsx("div",{className:"welcome-q-logo-actual rounded-full shadow-lg flex items-center justify-center select-none","aria-label":"App Logo Q",children:e.jsx("span",{className:"font-bold",style:{fontFamily:"Roboto, sans-serif"},children:"Q"})})]}),e.jsx("div",{className:"welcome-message-text-wrapper",children:e.jsx(St,{textToType:"Welcome to Q!",speed:100,className:"typewriter-inner-span"})}),e.jsx("p",{className:"welcome-prompt-text",children:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-hand-pointer fa-beat-fade mr-2",style:{animationDuration:"1.5s",color:"var(--accent-primary)"}}),"Tap anywhere to begin"]})})]})},fr="e2c841f407",jt="Q",pr=5;function Le(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}async function xr(r){const c=/^https:\/\/github\.com\/([^\/]+)\/([^\/]+)\/blob\/([^\/]+)\/(.+)$/,i=r.match(c);if(i){const[,t,a,d,p]=i,x=`https://api.github.com/repos/${t}/${a}/contents/${p.replace(/\?.*$/,"")}?ref=${d}`;return console.log(`Resolved GitHub blob URL to API raw content URL: ${x}`),x}try{return new URL(r),/^https:\/\/raw\.githubusercontent\.com\//.test(r)||/^https:\/\/api\.github\.com\/repos\/[^\/]+\/[^\/]+\/contents\//.test(r)||!/^https:\/\/github\.com\//.test(r)?r:(console.warn(`The provided GITHUB_DATA_URL (${r}) is a github.com URL but not a 'blob' URL. This format is not directly processable for raw content in this version. Please use a blob URL or a raw content URL.`),null)}catch{return console.warn(`The GITHUB_DATA_URL (${r}) is not a valid absolute URL or a recognized GitHub format. Fallback will likely occur.`),null}}const br=()=>{const[r,c]=o.useState(()=>localStorage.getItem("isAdminAuthenticated")==="true"),[i,t]=o.useState(()=>localStorage.getItem("isAdminAuthenticated")==="true"&&localStorage.getItem("wasAdminViewBeforeRefresh")==="true"?"AdminPanel":"SubjectSelection"),[a,d]=o.useState(()=>localStorage.getItem("githubPat")||""),[p,x]=o.useState([]),[k,A]=o.useState(null),[v,w]=o.useState(null),[C,T]=o.useState(null),[g,$]=o.useState(null),[z,P]=o.useState(null),[W,V]=o.useState(!1),[ne,Z]=o.useState(!1),[se,m]=o.useState(null),[s,l]=o.useState(null),[S,j]=o.useState(!0),[y,Y]=o.useState("Gathering all the necessary app information, please hold on a moment..."),[O,G]=o.useState(0),[F,J]=o.useState(null),[q,B]=o.useState([]),[L,E]=o.useState(!1),[R,U]=o.useState("immediate"),[_,ae]=o.useState("oneByOne"),[te,ee]=o.useState(!1),[K,oe]=o.useState(!0),[le,de]=o.useState(!0),[re,he]=o.useState(()=>localStorage.getItem("pdfButtonAnimationPlayedOnce")==="true"),[je,ie]=o.useState(()=>!localStorage.getItem("pdfButtonAnimationPlayedOnce")),[xe,ge]=o.useState(()=>!!localStorage.getItem("pdfButtonAnimationPlayedOnce")),Oe=o.useRef(!1);o.useEffect(()=>{a?localStorage.setItem("githubPat",a):localStorage.removeItem("githubPat")},[a]),o.useEffect(()=>{(i==="UserQuiz"||i==="QuizSelection")&&window.scrollTo(0,0)},[i]);const ze=(f,h)=>{f&&typeof f=="object"&&!Array.isArray(f)?(Array.isArray(f.subjects)?x(f.subjects):(console.warn(`Loaded ${h} data object does not contain a 'subjects' array. Initializing with empty subjects.`),x([])),typeof f.lastUpdated=="string"?A(f.lastUpdated):(A(null),f.lastUpdated!==void 0&&console.warn(`Loaded ${h} 'lastUpdated' field found but is not a string. Timestamp will not be set.`))):Array.isArray(f)?(x(f),A(null),console.log(`Loaded ${h} data is in old array format. No timestamp available from data.json.`)):(console.warn(`Loaded ${h} data.json is not in the expected array or {lastUpdated, subjects} object format. Initializing with empty data.`),x([]),A(null))},Te=o.useCallback(async f=>{console.warn(f||"Falling back to local data.json.");try{const n=`./data.json?_cb_local=${Date.now().toString()}`,u=await fetch(n,{cache:"no-cache"});if(u.ok){const b=await u.json();ze(b,"local"),console.log("Successfully processed local data.json")}else if(u.status===404)console.warn("Local data.json not found, initializing with empty subjects array."),x([]),A(null);else{const b=await u.text();console.error(`Failed to fetch local data.json: ${u.status} ${u.statusText}. Response: ${b}`),x([]),A(null)}}catch(h){h instanceof Error?console.error(`Error loading or parsing local data.json: Name: ${h.name}, Message: ${h.message}. Stack: ${h.stack}`):console.error("Error loading or parsing local data.json (non-Error object):",h),x([]),A(null)}},[]);o.useEffect(()=>{(async()=>{if(Oe.current){console.log("Data fetch already attempted for this component instance. Skipping.");return}Oe.current=!0,j(!0),Y("Gathering all the necessary app information, please hold on a moment...");const h=await xr(Me.GITHUB_DATA_URL);if(h){console.info(`Attempting to fetch data from: ${h}`);try{const n=new URL(h);n.searchParams.append("_cb_data",Date.now().toString());const u=n.toString();console.log("Fetching final data from:",u);const b={cache:"no-cache"};let I=!1;n.hostname==="api.github.com"&&n.pathname.includes("/repos/")&&n.pathname.includes("/contents/")?(b.headers={Accept:"application/vnd.github.v3.raw"},I=!0,console.log("Using GitHub API raw content fetch method.")):console.log("Using standard fetch method for non-API or raw.githubusercontent.com URL.");const D=await fetch(u,b);if(!D.ok){const H=await D.text();throw new Error(`Failed to fetch from ${u}: ${D.status} ${D.statusText}. Body: ${H}`)}let M;if(I){const H=await D.text();M=JSON.parse(H)}else M=await D.json();ze(M,"remote"),console.log("Successfully processed data from remote source")}catch(n){n instanceof Error?console.error(`Error fetching or parsing data from (${h}). Type: ${n.name}, Message: ${n.message}. Stack: ${n.stack}`):console.error(`Error fetching or parsing data from (${h}). Caught non-Error object:`,n),await Te(`Failed to load from remote source (${h}).`)}finally{j(!1),Y(null)}}else console.info("No remote GITHUB_DATA_URL configured, URL is invalid/placeholder, or processing error prevented getting a usable URL."),await Te("No remote data URL usable or remote fetch failed."),j(!1),Y(null)})()},[Te]);const fe=()=>{G(0),J(null),B([]),E(!1)},Ze=()=>{t("AdminPanel"),$(null),P(null),fe(),r?localStorage.setItem("wasAdminViewBeforeRefresh","true"):V(!0)},et=()=>{t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"),w(null),T(null),l(null)},tt=f=>{f===fr?(c(!0),localStorage.setItem("isAdminAuthenticated","true"),t("AdminPanel"),localStorage.setItem("wasAdminViewBeforeRefresh","true"),V(!1),m(null)):m("Incorrect password. Please try again.")},rt=()=>{c(!1),localStorage.removeItem("isAdminAuthenticated"),t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"),w(null),T(null),l(null)},Fe=()=>{V(!1),m(null),r||(t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"))},Se=()=>{Z(f=>!f)},st=f=>{U(f)},at=f=>{ae(f),ee(!1)},qe=()=>{ee(f=>!f)},De=f=>{w(f),T(null),l(null)},ke=f=>{T(f),l(null)},nt=f=>{const h={id:Le(),name:f,quizzes:[]};x(n=>[...n,h])},ot=(f,h)=>p.some(n=>n.name.toLowerCase()===h.toLowerCase()&&n.id!==f)?(alert(`A subject with the name "${h}" already exists. Please choose a different name.`),!1):(x(n=>n.map(u=>u.id===f?{...u,name:h}:u)),!0),it=f=>{x(h=>{const n=h.findIndex(b=>b.id===f);if(n===-1)return h;const u=h.filter(b=>b.id!==f);if(v===f)if(u.length>0){const b=Math.min(n,u.length-1);De(u[b].id)}else De(null);return u})},lt=(f,h)=>{const n=p.find(b=>b.id===f);if(!n){alert("Error: Could not find the subject to add the quiz to. Please try again.");return}if(n.quizzes.some(b=>b.name.toLowerCase()===h.toLowerCase())){alert(`A quiz with the name "${h}" already exists in subject "${n.name}". Please choose a different name.`);return}const u={id:Le(),name:h,questions:[],isStartable:!0};x(b=>b.map(I=>I.id===f?{...I,quizzes:[...I.quizzes,u]}:I)),ke(u.id)},ct=(f,h,n)=>{var b;let u=!1;if(x(I=>I.map(D=>D.id===f?D.quizzes.some(M=>M.name.toLowerCase()===n.toLowerCase()&&M.id!==h)?(u=!0,D):{...D,quizzes:D.quizzes.map(M=>M.id===h?{...M,name:n}:M)}:D)),u){const I=((b=p.find(D=>D.id===f))==null?void 0:b.name)||"the current subject";return alert(`A quiz with the name "${n}" already exists in ${I}. Please choose a different name.`),!1}return!0},dt=(f,h)=>{x(n=>n.map(u=>{if(u.id===f){const b=u.quizzes.findIndex(D=>D.id===h);if(b===-1)return u;const I=u.quizzes.filter(D=>D.id!==h);if(C===h)if(I.length>0){const D=Math.min(b,I.length-1);ke(I[D].id)}else ke(null);return{...u,quizzes:I}}return u}))},mt=(f,h)=>{x(n=>n.map(u=>u.id===f?{...u,quizzes:u.quizzes.map(b=>b.id===h?{...b,isStartable:!b.isStartable}:b)}:u))},ut=f=>{l(f)},Ue=(f,h,n)=>{var b,I;const u={...n,id:Le(),modelAnswer:n.modelAnswer||void 0};if(u.type==="mcq"&&u.options){u.options=u.options.map((H,He)=>({...H,id:`option-${Le()}-${He}`}));const D=(I=(b=n.options)==null?void 0:b.find(H=>H.id===n.correctOptionId))==null?void 0:I.text,M=u.options.find(H=>H.text===D);if(u.correctOptionId=M?M.id:void 0,!u.correctOptionId&&typeof n.correctOptionId=="string"){const H=n.correctOptionId.match(/^option-(\d+)$/);if(H&&H[1]){const He=parseInt(H[1],10);u.options[He]&&(u.correctOptionId=u.options[He].id)}}!u.correctOptionId&&u.options.length>0&&(console.warn("Could not determine correct option for new MCQ, defaulting to first option."),u.correctOptionId=u.options[0].id)}x(D=>D.map(M=>M.id===f?{...M,quizzes:M.quizzes.map(H=>H.id===h?{...H,questions:[...H.questions,u]}:H)}:M)),l(null)},ft=(f,h,n)=>{var u;if(n.type==="mcq"&&n.options){if(n.options=n.options.map((b,I)=>({id:b.id&&b.id.startsWith("option-")?b.id:`option-${Le()}-${I}`,text:b.text})),typeof n.correctOptionId=="string"&&!n.options.find(b=>b.id===n.correctOptionId)){const b=(u=s==null?void 0:s.options)==null?void 0:u.find(M=>M.id===n.correctOptionId),I=b==null?void 0:b.text;let D=n.options.find(M=>M.text===I);if(D)n.correctOptionId=D.id;else{const M=n.correctOptionId.match(/^option-(\d+)$/);if(M&&M[1]){const H=parseInt(M[1],10);n.options[H]?n.correctOptionId=n.options[H].id:(console.warn("Correct option index out of bounds after update. Defaulting."),n.correctOptionId=n.options.length>0?n.options[0].id:void 0)}else console.warn("Correct option ID seems invalid after update and couldn't be re-mapped by text or index. Defaulting."),n.correctOptionId=n.options.length>0?n.options[0].id:void 0}}n.type==="mcq"&&n.options.length>0&&!n.options.find(b=>b.id===n.correctOptionId)&&(console.warn("Updated MCQ question has options, but correctOptionId is invalid. Defaulting to the first option."),n.correctOptionId=n.options[0].id)}x(b=>b.map(I=>I.id===f?{...I,quizzes:I.quizzes.map(D=>D.id===h?{...D,questions:D.questions.map(M=>M.id===n.id?n:M)}:D)}:I)),l(null)},pt=(f,h,n)=>{x(u=>u.map(b=>b.id===f?{...b,quizzes:b.quizzes.map(I=>I.id===h?{...I,questions:I.questions.filter(D=>D.id!==n)}:I)}:b)),(s==null?void 0:s.id)===n&&l(null)},xt=(f,h,n)=>{x(u=>u.map(b=>b.id===f?{...b,quizzes:b.quizzes.map(I=>I.id===h?{...I,questions:n}:I)}:b))},bt=()=>{x(f=>f.map(h=>({...h,quizzes:h.quizzes.map(n=>{const u=n.questions.filter(I=>I.type==="written"),b=n.questions.filter(I=>I.type==="mcq");return{...n,questions:[...u,...b]}})}))),alert("All quizzes have been successfully reordered (Written questions first, then MCQ).")},Ie=f=>{const h=p.find(n=>n.id===f);$(h||null),P(null),fe(),t("QuizSelection")},Pe=f=>{const h=g==null?void 0:g.quizzes.find(n=>n.id===f);P(h||null),fe(),h&&B(Array(h.questions.length).fill(null)),t("UserQuiz")},Ee=()=>{$(null),P(null),fe(),t("SubjectSelection")},N=()=>{P(null),fe(),t("QuizSelection")},Q=()=>{fe(),z&&B(Array(z.questions.length).fill(null))},X=f=>{if(J(f),z&&R==="atEnd"&&z.questions[O].type==="mcq"){const n=[...q];n[O]={selectedOptionId:f,feedback:null},B(n)}},Ne=(f,h)=>{if(z){const n=z.questions[h];if(n.type==="mcq"){const u=[...q];let b=null;R==="immediate"&&(b=f===n.correctOptionId?"Correct":"Incorrect"),u[h]={selectedOptionId:f,feedback:b},B(u)}}},ht=()=>{if(z&&R==="immediate"&&q[O]===null){const f=z.questions[O];if(f.type==="mcq"){if(!F){console.warn("Submit called for MCQ without a selection attempt.");return}const h=F===f.correctOptionId?"Correct":"Incorrect",n=[...q];n[O]={selectedOptionId:F,feedback:h},B(n)}}},Be=()=>{if(z){const n=z.questions[O];if(_==="oneByOne"&&(n==null?void 0:n.type)==="written"&&q[O]===null){const u=[...q],b={selectedOptionId:null,feedback:"Seen"};u[O]=b,B(u)}else if(_==="oneByOne"&&R==="atEnd"&&(n==null?void 0:n.type)==="mcq"&&F&&q[O]===null){const u=[...q],b={selectedOptionId:F,feedback:null};u[O]=b,B(u)}}J(null);const f=_==="oneByOne"&&z&&O>=z.questions.length-1,h=_==="listed";if(f||h){if(R==="atEnd"&&z){const n=q.map((u,b)=>{if(!u&&z.questions[b].type==="written")return{selectedOptionId:null,feedback:"Seen"};if(!u)return null;const I=z.questions[b];if(I.type==="mcq"&&u.selectedOptionId&&u.feedback===null){const D=u.selectedOptionId===I.correctOptionId?"Correct":"Incorrect";return{selectedOptionId:u.selectedOptionId,feedback:D}}return u});B(n)}else if(R==="immediate"&&h&&z){const n=q.map((u,b)=>!u&&z.questions[b].type==="written"?{selectedOptionId:null,feedback:"Seen"}:u);B(n)}E(!0)}else _==="oneByOne"&&z&&O<z.questions.length-1&&G(n=>n+1)},gt=()=>{if(z&&R==="atEnd"&&_==="oneByOne"&&z.questions[O].type==="mcq"&&F&&q[O]===null){const h=[...q],n={selectedOptionId:F,feedback:null};h[O]=n,B(h)}J(null),O>0&&G(f=>f-1)},_e=()=>{re||(he(!0),localStorage.setItem("pdfButtonAnimationPlayedOnce","true"))},vt=()=>{ie(!1),ge(!0)},ue=p.find(f=>f.id===v),pe=ue==null?void 0:ue.quizzes.find(f=>f.id===C);let be=jt;const Ae=i==="AdminPanel"&&r;if(Ae?be=pe?`Admin: ${(ue==null?void 0:ue.name)||"Unknown Subject"} > ${pe.name}`:ue?`Admin: ${ue.name}`:"Admin: Subject Management":i==="UserQuiz"&&z?be=`${(g==null?void 0:g.name)||"Quiz"}: ${z.name}`:i==="QuizSelection"&&g?be=`${g.name}: Select Quiz`:be=jt,S)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-[var(--bg-primary)] p-4 text-center",children:[e.jsx("div",{className:"h-20 w-20 rounded-full flex items-center justify-center bg-[var(--text-primary)] mb-6 shadow-md","aria-label":"App Logo Q",children:e.jsx("span",{className:"text-[var(--bg-primary)] font-bold text-4xl select-none",style:{fontFamily:"Roboto, sans-serif"},children:"Q"})}),e.jsx("h1",{className:"text-3xl font-bold text-[var(--text-primary)] mb-4",children:"Loading Application Data"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce"})]}),y&&e.jsx("p",{className:"text-[var(--text-secondary)] text-sm mt-3",children:y})]});const ce=`flex-grow p-4 sm:p-6 lg:p-8 max-w-5xl w-full mx-auto ${i==="UserQuiz"||i==="QuizSelection"?"pt-4 sm:pt-6":"pt-2 sm:pt-3"}`,Qe=()=>{switch(i){case"AdminPanel":return r?e.jsx(cr,{subjects:p,allSubjectsData:p,activeSubjectId:v,activeQuizId:C,editingQuestion:s,setEditingQuestion:ut,onSetActiveSubjectId:De,onCreateSubject:nt,onUpdateSubjectName:ot,onDeleteSubject:it,onSetActiveQuizId:ke,onCreateQuiz:lt,onUpdateQuizName:ct,onDeleteQuiz:dt,onToggleQuizStartable:mt,onAddQuestion:Ue,onUpdateQuestion:ft,onDeleteQuestion:pt,onReorderQuestions:xt,onReorderAllQuizzesByTypeGlobal:bt,maxOptions:pr,showManageSubjectsSection:K,setShowManageSubjectsSection:oe,showManageQuizzesSection:le,setShowManageQuizzesSection:de,activeAdminSubject:ue,activeAdminQuiz:pe,githubPat:a,setGithubPat:d}):e.jsx(zt,{subjects:p,onSelectSubject:Ie,onAnimationComplete:_e,hasPdfButtonAnimationPlayedOnceGlobal:re,userHasInteractedWithWelcome:xe});case"UserQuiz":return z?e.jsx(Vt,{quiz:z,currentQuestionIndex:O,userAnswers:q,currentUserSelectionAttempt:F,isQuizComplete:L,onOptionSelect:X,onListedOptionSelect:Ne,onSubmitAnswer:ht,onNextQuestion:Be,onPreviousQuestion:gt,onBackToQuizList:N,onRestartQuiz:Q,userCorrectionMode:R,userQuestionDisplayMode:_,onTogglePrefsModal:qe}):(t("QuizSelection"),null);case"QuizSelection":return g?e.jsx(Wt,{subject:g,onSelectQuiz:Pe,onBackToSubjectList:Ee}):(t("SubjectSelection"),null);case"SubjectSelection":default:return e.jsx(zt,{subjects:p,onSelectSubject:Ie,onAnimationComplete:_e,hasPdfButtonAnimationPlayedOnceGlobal:re,userHasInteractedWithWelcome:xe})}};return e.jsxs(e.Fragment,{children:[je&&e.jsx(ur,{onInteraction:vt}),!je&&e.jsxs(e.Fragment,{children:[e.jsx(qt,{contextTitle:be,isAdminView:Ae,isAdminAuthenticated:r,currentAppViewMode:i,onSwitchToAdminView:Ze,onSwitchToUserView:et,onAdminLogout:rt,dataTimestamp:k,onShowTimestampModal:Se}),e.jsx("main",{className:ce,children:Qe()}),e.jsx(Ut,{appName:jt})]}),W&&e.jsx(Bt,{onLogin:tt,onClose:Fe,error:se}),ne&&k&&e.jsx(dr,{isOpen:ne,onClose:Se,timestamp:k}),te&&e.jsx(mr,{isOpen:te,onClose:qe,currentCorrectionMode:R,onSetCorrectionMode:st,currentQuestionDisplayMode:_,onSetQuestionDisplayMode:at}),e.jsx("div",{className:`pdf-animation-overlay ${i==="SubjectSelection"&&!re?"visible":""}`,"aria-hidden":!(i==="SubjectSelection"&&!re)})]})},Pt=document.getElementById("app-root");Pt?$t.createRoot(Pt).render(e.jsx(br,{})):console.error("Failed to find the root element with ID 'app-root'");

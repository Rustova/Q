import{j as e,r as n}from"./react-ZpOpdbvF.js";import{r as fe,a as zt}from"./react-dom-BFJMa1Yr.js";import{E as kt}from"./jspdf-vr6wpoZK.js";import{D as It,C as Tt,P as Pt}from"./@hello-pangea-BHoMb5q8.js";import"./core-js--yVVgAJ6.js";import"./scheduler-SPyfQU6S.js";import"./@babel-CpGVvVoG.js";import"./fflate-BO5HMHBV.js";import"./redux-CqoN-cwI.js";import"./react-redux-DzurNSeR.js";import"./use-sync-external-store-DGADeII1.js";import"./css-box-model-SSI6wf-B.js";import"./tiny-invariant-BaFNuDhB.js";import"./raf-schd-CmoV45_-.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&t(u)}).observe(document,{childList:!0,subtree:!0});function o(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function t(a){if(a.ep)return;a.ep=!0;const c=o(a);fetch(a.href,c)}})();const $t=r=>{if(!r)return null;try{const i=new Date(r);if(isNaN(i.getTime()))return console.warn("Invalid date string received for formatting:",r),{timeDescription:"Invalid Date",tooltip:r};const t=Math.round((new Date().getTime()-i.getTime())/1e3),a=i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})+", "+i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});let c;if(t<0){const u=i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),b=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});c=`${u}, ${b}`}else if(t<60)c="just now";else if(t<3600)c=`${Math.floor(t/60)} min ago`;else if(t<86400)c=`${Math.floor(t/3600)} h ago`;else{const u=i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),b=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});c=`${u}, ${b}`}return{timeDescription:c,tooltip:a}}catch(i){return console.error("Error formatting date:",i),{timeDescription:"Error in timestamp",tooltip:r||"Error formatting timestamp"}}},Ot=()=>e.jsx("div",{className:"h-14 w-14 sm:h-16 sm:w-16 rounded-full border-2 border-[var(--bg-header)] shadow-md transition-transform duration-200 ease-in-out hover:scale-110 flex items-center justify-center bg-[var(--text-primary)] shrink-0","aria-label":"App Logo Q",children:e.jsx("span",{className:"text-[var(--bg-primary)] font-bold text-[2rem] sm:text-[2.4rem] select-none",style:{fontFamily:"Roboto, sans-serif"},children:"Q"})}),Dt=({contextTitle:r,isAdminView:i,isAdminAuthenticated:o,currentAppViewMode:t,onSwitchToAdminView:a,onSwitchToUserView:c,onAdminLogout:u,dataTimestamp:b,onShowTimestampModal:z})=>{const S=$t(b),g="211, 195, 185",v=i&&o&&e.jsx("button",{onClick:u,className:"p-2.5 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white border border-[var(--accent-red-hover)] rounded-full transition-colors shrink-0 text-xs sm:text-sm flex items-center justify-center h-9 w-9 sm:h-10 sm:w-10 focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)] focus:ring-offset-2 focus:ring-offset-[var(--bg-header)]","aria-label":"Logout from Admin Panel",title:"Admin Logout",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket fa-fw text-base"})}),w=i?e.jsxs("button",{onClick:c,className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-transparent hover:bg-[var(--text-primary)] text-[var(--text-primary)] hover:text-[var(--bg-primary)] border border-[var(--text-primary)] rounded-md transition-colors shrink-0 text-xs sm:text-sm flex items-center","aria-label":"Switch to User View",children:[e.jsx("i",{className:"fa-solid fa-user-graduate fa-fw mr-1.5 sm:mr-2"}),e.jsx("span",{children:"User View"})]}):e.jsxs("button",{onClick:a,className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-transparent hover:bg-[var(--text-primary)] text-[var(--text-primary)] hover:text-[var(--bg-primary)] border border-[var(--text-primary)] rounded-md transition-colors shrink-0 text-xs sm:text-sm flex items-center","aria-label":"Switch to Admin Panel",children:[e.jsx("i",{className:"fa-solid fa-headset mr-1.5 sm:mr-2"}),e.jsx("span",{children:"Admin Panel"})]}),k=S&&e.jsx("button",{onClick:z,className:"text-[var(--text-primary)] text-[0.6rem] sm:text-xs opacity-80 hover:opacity-100 cursor-pointer focus:outline-none focus:ring-1 focus:ring-[var(--text-primary)] rounded p-0.5",title:S.tooltip,"aria-label":`Content update details: ${S.tooltip}`,children:e.jsx("span",{className:"block",children:`last updated : ${S.timeDescription}`})});return e.jsx("header",{className:"bg-[var(--bg-header)] sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[" ",e.jsx(Ot,{}),k]}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[v,w]})]}),e.jsx("div",{style:{height:"1px",width:"100%",backgroundImage:`linear-gradient(to right, transparent, rgba(${g},0.5) 25%, rgba(${g},0.5) 75%, transparent)`}}),e.jsx("div",{className:"text-center pt-2.5",children:e.jsx("span",{className:"text-[var(--text-primary)] text-sm sm:text-base font-semibold truncate block",title:r,children:r})})]})})},Et=({appName:r})=>{const i=new Date().getFullYear();return e.jsx("footer",{className:"bg-[var(--bg-secondary)] text-[var(--text-secondary)] text-center py-4 sm:py-5 border-t border-[var(--border-color)]",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6",children:e.jsxs("p",{className:"text-xs sm:text-sm",children:["Â© ",i," ",r,". Made with ",e.jsx("i",{className:"fa-solid fa-heart text-[var(--accent-red)] animate-heartbeat"})]})})})},qt=({onLogin:r,onClose:i,error:o})=>{const[t,a]=n.useState(""),c=z=>{z.preventDefault(),r(t)},u=e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"admin-login-title",children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",children:[e.jsx("h2",{id:"admin-login-title",className:"text-2xl font-semibold text-[var(--accent-primary)] mb-6 text-center",children:"Admin Login"}),e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"adminPassword",className:"block text-sm font-medium text-[var(--text-secondary)] mb-1",children:"Password"}),e.jsx("input",{type:"password",id:"adminPassword",value:t,onChange:z=>a(z.target.value),className:"w-full p-3 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)] text-[var(--input-text)] focus:ring-2 focus:ring-[var(--input-focus-ring)] focus:border-[var(--input-focus-ring)] placeholder-[var(--placeholder-color)]",placeholder:"Enter admin password",required:!0})]}),o&&e.jsx("p",{className:"text-red-500 text-sm text-center -mt-2",children:o}),e.jsxs("div",{className:"flex flex-col sm:flex-row-reverse gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Login"}),e.jsx("button",{type:"button",onClick:i,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Cancel"})]})]})]})}),b=document.getElementById("modal-root");return b?fe.createPortal(u,b):(console.error("Modal root element 'modal-root' not found."),null)},Mt=({isOpen:r,onClose:i,allQuizzes:o,initiallySelectedQuizIds:t,onApplySelection:a})=>{const[c,u]=n.useState([]);n.useEffect(()=>{r&&u([...t])},[r,t]);const b=n.useMemo(()=>o.reduce((j,O)=>{const I=O.subjectId;return j[I]||(j[I]={subjectName:O.subjectName,quizzes:[]}),j[I].quizzes.push(O),j},{}),[o]);if(!r)return null;const z=j=>{u(O=>O.includes(j)?O.filter(I=>I!==j):[...O,j])},S=()=>{const j=o.map(O=>O.id);u(j)},g=()=>{u([])},v=()=>{a(c)},w=()=>c.length===0?"No quizzes selected. All quizzes from chosen subjects will be included if applied now.":c.length===o.length&&o.length>0?`All ${o.length} available quizzes selected.`:`${c.length} of ${o.length} available quizzes selected.`,k=document.getElementById("modal-root");return k?fe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[51] p-4",role:"dialog","aria-modal":"true","aria-labelledby":"quiz-multiselect-modal-title",onClick:i,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:j=>j.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl shrink-0",children:[e.jsx("h2",{id:"quiz-multiselect-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:"Select Quizzes for Export"}),e.jsx("button",{onClick:i,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close quiz selection modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 overflow-y-auto custom-scrollbar flex-grow",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-3",children:[e.jsx("p",{className:"text-sm text-[var(--text-secondary)] p-2 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md flex-grow",children:w()}),e.jsxs("div",{className:"flex space-x-2 shrink-0",children:[e.jsx("button",{onClick:S,disabled:o.length===0,className:"px-3 py-1.5 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors disabled:opacity-50",children:"Select All"}),e.jsx("button",{onClick:g,disabled:o.length===0||c.length===0,className:"px-3 py-1.5 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors disabled:opacity-50",children:"Deselect All"})]})]}),o.length===0?e.jsx("p",{className:"text-center text-[var(--text-secondary)] py-4",children:"No quizzes available from selected subjects to choose from."}):e.jsx("div",{className:"space-y-3 max-h-[calc(85vh-260px)] overflow-y-auto custom-scrollbar pr-2",children:Object.entries(b).map(([j,{subjectName:O,quizzes:I}])=>e.jsxs("div",{className:"py-1",children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--accent-primary)] mb-1.5 pb-1 border-b border-[var(--border-color)]",children:O}),e.jsx("div",{className:"space-y-1.5",children:I.map(M=>{const V=c.includes(M.id);return e.jsxs("label",{className:`flex items-center space-x-3 p-2.5 rounded-md transition-all duration-150 text-sm border cursor-pointer 
                            ${V?"bg-[var(--accent-primary)] bg-opacity-25 border-[var(--accent-primary)] text-[var(--text-primary)] font-medium":"bg-[var(--bg-primary)] border-[var(--border-color)] text-[var(--text-secondary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-10 hover:border-[var(--accent-secondary)]"}`,title:`${M.subjectName} - ${M.name}`,children:[e.jsx("input",{type:"checkbox",checked:V,onChange:()=>z(M.id),className:"h-4 w-4 text-[var(--accent-primary)] bg-transparent border-[var(--input-border)] rounded focus:ring-1 focus:ring-offset-0 focus:ring-[var(--accent-primary)] shrink-0"}),e.jsx("span",{className:"truncate flex-grow text-left",children:M.name})]},M.id)})})]},j))})]}),e.jsxs("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-between items-center shrink-0",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 text-sm font-medium bg-transparent hover:bg-[var(--accent-red)] hover:bg-opacity-20 text-[var(--accent-red)] border border-[var(--accent-red)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]",children:"Clear Current Selection"}),e.jsxs("div",{className:"space-x-3",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)]",children:"Cancel"}),e.jsx("button",{onClick:v,disabled:o.length===0&&c.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50",children:"Apply Selection"})]})]})]})}),k):(console.error("Modal root element 'modal-root' not found for QuizMultiSelectModal."),null)},bt={title:"#233239",questionText:"#000000",answerText:"#474747",correctAnswer:"#48BB78"},Lt="p-2 border rounded-md focus:ring-1 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)] text-sm",pt="block text-sm font-medium text-[var(--text-secondary)] mb-1",ct="text-md font-semibold text-[var(--accent-primary)] mb-2",je=595.28,pe=841.89,ce=40,ye=je-2*ce,he=1.4,ht="#000000",Ue=18,Be=135,Ft=({isOpen:r,onClose:i,subjects:o})=>{const[t,a]=n.useState({showAnswers:!0,fontSize:12,colors:{...bt},selectedSubjectIds:[]}),[c,u]=n.useState(!1),[b,z]=n.useState(!1),[S,g]=n.useState(!1),[v,w]=n.useState(null);n.useEffect(()=>{r&&(a({showAnswers:!0,fontSize:12,colors:{...bt},selectedSubjectIds:o.map(f=>f.id)}),u(!1),z(!1),g(!1),w(null))},[r,o]);const k=n.useMemo(()=>{if(!r)return[];const f=[];return o.forEach(x=>{t.selectedSubjectIds.includes(x.id)&&x.quizzes.filter(y=>y.isStartable).forEach(y=>{f.push({id:y.id,name:y.name,subjectName:x.name,subjectId:x.id})})}),f},[o,t.selectedSubjectIds,r]);if(!r&&!S)return null;const j=f=>{const{name:x,value:y,type:A}=f.target;if(A==="checkbox"){const{checked:C}=f.target;a(W=>({...W,[x]:C}))}else a(A==="number"?C=>({...C,[x]:parseInt(y,10)}):C=>({...C,[x]:y}))},O=(f,x)=>{a(y=>({...y,colors:{...y.colors,[f]:x}}))},I=f=>{a(x=>{const y=x.selectedSubjectIds.includes(f)?x.selectedSubjectIds.filter(A=>A!==f):[...x.selectedSubjectIds,f];return w(null),{...x,selectedSubjectIds:y}})},M=()=>{if(t.selectedSubjectIds.length===0){alert("Please select at least one subject before selecting specific quizzes.");return}g(!0)},V=f=>{w(f.length>0?f:null),g(!1)},Y=async(f,x)=>{let y;try{y=await fetch(f)}catch(C){throw console.error(`Network error loading file ${f}:`,C),new Error(`Network error loading file ${f}: ${C instanceof Error?C.message:String(C)}`)}if(!y.ok){const C=await y.text().catch(()=>"Could not retrieve error body.");throw console.error(`Failed to load file ${f}: ${y.status} ${y.statusText}. Body: ${C.substring(0,200)}`),new Error(`Failed to load file ${f}: ${y.status} ${y.statusText}`)}const A=y.headers.get("Content-Type");try{const C=await y.blob();return new Promise((W,L)=>{const Z=new FileReader;Z.onloadend=()=>{let D=Z.result;const J="data:application/octet-stream;base64,",B=x.startsWith("data:image/");if(D.startsWith(x))W(D);else if(B&&D.startsWith(J))console.warn(`File ${f} (expected ${x}) was received as octet-stream. Correcting MIME type for PDF.`),D=x+D.substring(J.length),W(D);else{const Q=D.substring(0,Math.min(D.indexOf(";")+8,D.length,50))+"...",q=`File ${f} loaded with unexpected type. Expected prefix: ${x}, but got: ${Q} (Full Content-Type from server: ${A||"N/A"}). Check if the file is correct and accessible.`;console.error(q),L(new Error(q))}},Z.onerror=D=>{var B,Q;const J=`FileReader error for ${f}: ${((Q=(B=D.target)==null?void 0:B.error)==null?void 0:Q.message)||"Unknown FileReader error"}`;console.error(J,D),L(new Error(J))},Z.readAsDataURL(C)})}catch(C){throw console.error(`Error processing blob for ${f}:`,C),new Error(`Error processing blob for ${f}: ${C instanceof Error?C.message:String(C)}`)}},X=async()=>{if(t.selectedSubjectIds.length===0){alert("Please select at least one subject to include in the PDF.");return}u(!0);let f=!1;try{const x=new kt({orientation:"p",unit:"pt",format:"a4"});try{const q=await Y("/assets/Amiri-Regular.ttf","data:application/octet-stream;base64,"),E=q.substring(q.indexOf(",")+1);x.addFileToVFS("Amiri-Regular.ttf",E),x.addFont("Amiri-Regular.ttf","Amiri","normal"),x.addFont("Amiri-Regular.ttf","Amiri","bold"),x.setFont("Amiri","normal"),f=!0,z(!0)}catch(q){console.warn("Failed to load Amiri-Regular.ttf. PDF will be generated with default fonts.",q),x.setFont("Helvetica","normal")}const y=await Y("/assets/main.PNG","data:image/png;base64,"),A=await Y("/assets/regular.PNG","data:image/png;base64,");let C=ce;const W=t.fontSize*1.5,L=(q,E,F=!1)=>{x.setFontSize(q),x.setTextColor(E),f?x.setFont("Amiri",F?"bold":"normal"):x.setFont("Helvetica",F?"bold":"normal")},Z=(q=t.fontSize*he)=>{C+q>pe-ce&&(x.addPage(),x.addImage(A,"PNG",0,0,je,pe,void 0,"FAST"),C=Be)},D=(q,E,F,_,G,se=!1,ee=!1)=>{L(_,G,se);const re=x.splitTextToSize(q,F),te=ee?he*1.1:he,K=re.length*_*(se?1.05:1)*te*.8;ee||Z(K),x.text(re,E,C),C+=K+_*(te*.2)};x.addImage(y,"PNG",0,0,je,pe,void 0,"FAST"),C=416+Ue*he*1.1,L(Ue,ht,!0),x.text("Subjects included:",28,416);const J=o.filter(q=>t.selectedSubjectIds.includes(q.id));J.length>0&&J.forEach(q=>{C+Ue*he*1.1>pe-ce&&(x.addPage(),x.addImage(A,"PNG",0,0,je,pe,void 0,"FAST"),C=Be),D(`- ${q.name}`,ce+20,ye-20,Ue,ht,!1,!0)});let B=[];o.forEach(q=>{t.selectedSubjectIds.includes(q.id)&&q.quizzes.filter(E=>E.isStartable&&E.questions.length>0).forEach(E=>{(v===null||v.includes(E.id))&&B.push({...E,subjectName:q.name,subjectId:q.id})})});let Q=!0;for(const q of B){if(Q)x.addPage(),x.addImage(A,"PNG",0,0,je,pe,void 0,"FAST"),C=Be,Q=!1;else{const F=W*he+t.fontSize*1.2*he;Z(F)}const E=ye-(70-ce);D(q.subjectName,70,E,W,t.colors.title,!0),C+=t.fontSize*.2,D(q.name,ce,ye,t.fontSize*1.2,t.colors.title,!0),C+=t.fontSize*.7,q.questions.forEach((F,_)=>{D(`${_+1}. ${F.questionText}`,ce,ye,t.fontSize,t.colors.questionText),C+=t.fontSize*.3,F.type==="mcq"&&F.options&&F.options.forEach((G,se)=>{let re=`${String.fromCharCode(65+se)}. ${G.text}`,te=t.colors.answerText;t.showAnswers&&G.id===F.correctOptionId&&(te=t.colors.correctAnswer),D(re,ce+20,ye-20,t.fontSize*.9,te),C+=t.fontSize*.1}),C+=t.fontSize*.5})}B.length===0&&t.selectedSubjectIds.length>0&&(Q&&(x.addPage(),x.addImage(A,"PNG",0,0,je,pe,void 0,"FAST")),C=Be,D("No quizzes match the current selection criteria.",ce,ye,t.fontSize,t.colors.questionText)),x.save("Quiz_Export.pdf")}catch(x){console.error("Error generating PDF:",x),alert(`Failed to generate PDF. Check console for details. Error: ${x instanceof Error?x.message:String(x)}`)}finally{u(!1),i()}},U=document.getElementById("modal-root");if(!U&&r)return console.error("Modal root element 'modal-root' not found for PdfPreferencesModal."),null;if(!r)return null;const l=[{key:"title",label:"Title Color (Content)"},{key:"questionText",label:"Question Text Color"},{key:"answerText",label:"Answer Text Color"},{key:"correctAnswer",label:"Correct Answer Highlight"}],T=()=>v===null?"Select Specific Quizzes... (All from selected subjects)":v.length===0?"Select Specific Quizzes... (None selected)":`${v.length} Quizzes Selected`;return fe.createPortal(e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"pdf-prefs-modal-title",onClick:c?void 0:i,children:[e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:f=>f.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl shrink-0",children:[e.jsx("h2",{id:"pdf-prefs-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:"PDF Export Preferences"}),e.jsx("button",{onClick:c?void 0:i,disabled:c,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)] disabled:opacity-50","aria-label":"Close PDF preferences modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-5 overflow-y-auto custom-scrollbar flex-grow",children:[e.jsxs("fieldset",{disabled:c,children:[e.jsx("legend",{className:ct,children:"General Options"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 items-end",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)]",children:[e.jsx("input",{type:"checkbox",id:"showAnswers",name:"showAnswers",checked:t.showAnswers,onChange:j,className:"h-4 w-4 text-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] rounded cursor-pointer"}),e.jsx("label",{htmlFor:"showAnswers",className:"text-sm text-[var(--input-text)] cursor-pointer",children:"Show Answers in PDF"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fontSize",className:pt,children:"Base Font Size (Content Pages)"}),e.jsx("input",{type:"number",id:"fontSize",name:"fontSize",value:t.fontSize,onChange:j,min:"8",max:"32",step:"1",className:`${Lt} w-full`})]})]})]}),e.jsxs("fieldset",{disabled:c,children:[e.jsx("legend",{className:ct,children:"Color Scheme (Content Pages)"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-3",children:l.map(f=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:f.key,className:`${pt} truncate`,title:f.label,children:f.label}),e.jsx("input",{type:"color",id:f.key,name:f.key,value:t.colors[f.key],onChange:x=>O(f.key,x.target.value),className:"w-full h-9 p-0.5 border rounded-md cursor-pointer bg-[var(--input-bg)] border-[var(--input-border)] focus:outline-none focus:ring-1 focus:ring-[var(--input-focus-ring)]"})]},f.key))})]}),e.jsxs("fieldset",{disabled:c,children:[e.jsx("legend",{className:ct,children:"Select Content"}),o.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3 items-center",children:e.jsx("button",{onClick:M,disabled:t.selectedSubjectIds.length===0,className:"px-3 py-1.5 text-xs bg-[var(--accent-primary)] hover:bg-[var(--accent-primary-hover)] text-[var(--btn-primary-text)] rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed truncate max-w-xs",title:T(),children:T()})}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 pr-2 custom-scrollbar border border-[var(--input-border)] bg-[var(--input-bg)] rounded-md p-3",children:o.map(f=>{const x=f.quizzes.filter(y=>y.isStartable).length;return e.jsxs("label",{className:"flex items-center space-x-2 p-2 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md cursor-pointer hover:bg-[var(--accent-secondary)] hover:bg-opacity-10",children:[e.jsx("input",{type:"checkbox",checked:t.selectedSubjectIds.includes(f.id),onChange:()=>I(f.id),className:"h-4 w-4 text-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] rounded"}),e.jsx("span",{className:"text-sm text-[var(--input-text)] flex-grow truncate",title:f.name,children:f.name}),e.jsxs("span",{className:"text-xs text-[var(--text-secondary)] shrink-0",children:["(",x," quiz",x!==1?"zes":"",")"]})]},f.id)})}),t.selectedSubjectIds.length===0&&e.jsx("p",{className:"text-xs text-[var(--text-secondary)] italic mt-1",children:"Select subjects to enable quiz selection."})]}):e.jsx("p",{className:"text-sm text-[var(--text-secondary)]",children:"No subjects available to select."})]})]}),e.jsxs("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-end space-x-3 shrink-0",children:[e.jsx("button",{onClick:c?void 0:i,disabled:c,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:X,disabled:c||o.length===0||t.selectedSubjectIds.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50 flex items-center justify-center min-w-[120px]",children:c?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"Generating..."]}):"Generate PDF"})]})]}),S&&e.jsx(Mt,{isOpen:S,onClose:()=>g(!1),allQuizzes:k,initiallySelectedQuizIds:v||[],onApplySelection:V})]}),U)},Rt=500,gt=({subjects:r,onSelectSubject:i,playAnimation:o,onAnimationComplete:t})=>{const[b,z]=n.useState(!1),[S,g]=n.useState("idle"),v=n.useRef(null),w=n.useRef(null),[k,j]=n.useState(!1),O=n.useRef(null),I=()=>{z(!0)},M=()=>{z(!1)};let V=0,Y=0,X=0;r.length===0&&(V=.1+.1,Y=V+.1,X=Y+.1);const U=n.useMemo(()=>{if(r.length===0)return X+.075+.2;{let l;const T=.2+(r.length-1)*.075;return r.length<4?l=.2+r.length*.075:l=T,l+.075+.2}},[r.length,.1,.075,4,X]);return n.useEffect(()=>{if(v.current&&!w.current&&r.length>0&&!k){const l=U*1e3+Rt+300,T=setTimeout(()=>{v.current&&(w.current=v.current.getBoundingClientRect(),j(!0))},l);return()=>clearTimeout(T)}r.length===0&&k&&(j(!1),w.current=null,g("idle"))},[r.length,U,k]),n.useEffect(()=>{const l=document.getElementById("shine-sound");l&&(O.current=l)},[]),n.useEffect(()=>{o&&S==="idle"&&k&&r.length>0&&v.current&&v.current&&g("growing");const l=v.current;if(!l)return;const T=w.current;if(!T&&["growing","shining","returning"].includes(S)){console.error("Animation stage attempted without initial rect. Resetting."),g("idle"),j(!1),o&&t();return}let f;l.classList.remove("pdf-button-growing","pdf-button-shining","pdf-button-returning");const x=T?window.innerWidth/2-(T.left+T.width/2):0,y=T?window.innerHeight/2-(T.top+T.height/2):0;if(S==="growing"){if(!T)return;l.style.position="fixed",l.style.top=`${T.top}px`,l.style.left=`${T.left}px`,l.style.width=`${T.width}px`,l.style.height=`${T.height}px`,l.style.margin="0",l.style.zIndex="1000",l.style.transformOrigin="center center",l.style.setProperty("--translate-to-center-x",`${x}px`),l.style.setProperty("--translate-to-center-y",`${y}px`),l.style.transform="translate(0px, 0px) scale(1)",l.offsetWidth,l.classList.add("pdf-button-growing"),f=window.setTimeout(()=>{g("shining")},800)}else if(S==="shining"){if(!T)return;l.style.position="fixed",l.style.top=`${T.top}px`,l.style.left=`${T.left}px`,l.style.width=`${T.width}px`,l.style.height=`${T.height}px`,l.style.margin="0",l.style.zIndex="1000",l.style.transformOrigin="center center",l.style.transform="translate(var(--translate-to-center-x), var(--translate-to-center-y)) scale(2.5)",l.style.overflow="hidden",l.offsetWidth,l.classList.add("pdf-button-shining"),O.current&&(O.current.currentTime=0,O.current.play().catch(A=>console.warn("Audio play failed:",A.name,A.message))),f=window.setTimeout(()=>{g("returning")},1500)}else if(S==="returning"){if(!T)return;l.style.overflow="",l.offsetWidth,l.classList.add("pdf-button-returning"),f=window.setTimeout(()=>{g("finished")},600)}else S==="finished"&&(l.style.transform="translate(0px, 0px) scale(1)",l.offsetWidth,l.style.position="",l.style.top="",l.style.left="",l.style.width="",l.style.height="",l.style.margin="",l.style.zIndex="",l.style.transformOrigin="",l.style.overflow="",l.style.removeProperty("--translate-to-center-x"),l.style.removeProperty("--translate-to-center-y"),l.style.transform="",t());return()=>{window.clearTimeout(f)}},[o,S,k,r.length,t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full max-w-2xl mx-auto px-4 sm:px-6 pb-4 sm:pb-6 flex flex-col flex-grow",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-primary)] text-center mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)] mt-4 sm:mt-6 shrink-0 animate-fadeInUp",style:{animationDelay:`${.1}s`},children:"Select a Subject"}),r.length===0?e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center py-10 px-4",children:[e.jsx("i",{className:"fa-solid fa-box-open text-5xl sm:text-6xl text-[var(--text-secondary)] opacity-60 mb-6 animate-fadeInUp",style:{animationDelay:`${V}s`}}),e.jsx("p",{className:"text-xl sm:text-2xl font-semibold text-[var(--text-primary)] mb-2 animate-fadeInUp",style:{animationDelay:`${Y}s`},children:"It's a bit quiet here..."}),e.jsx("p",{className:"text-sm sm:text-md text-[var(--text-secondary)] max-w-md animate-fadeInUp",style:{animationDelay:`${X}s`},children:"No subjects are available at the moment. Administrators can add new subjects and quizzes through the Admin Panel. Please check back soon!"})]}):e.jsxs("div",{className:`flex-grow flex flex-col items-center ${r.length<4?"justify-center":"justify-start"}`,children:[e.jsx("div",{className:"w-full space-y-3 py-4",children:r.map((l,T)=>{const f=l.quizzes.filter(y=>y.isStartable).length,x=.1+.1+T*.075;return e.jsxs("button",{onClick:()=>i(l.id),className:"w-full text-left p-4 bg-[var(--bg-primary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20 border border-[var(--border-color)] hover:border-[var(--accent-secondary)] rounded-lg text-[var(--text-primary)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] animate-fadeInUp",style:{animationDelay:`${x}s`},"aria-label":`Select subject: ${l.name}, ${f} quiz${f!==1?"zes":""} available`,children:[e.jsx("span",{className:"text-lg font-semibold text-[var(--accent-primary)]",children:l.name}),e.jsxs("span",{className:"block text-sm text-[var(--text-secondary)] mt-1",children:[f," quiz",f!==1?"zes":""," available"]})]},l.id)})}),r.length<4&&e.jsx("p",{className:"text-center text-xs sm:text-sm text-[var(--text-secondary)] mt-4 mb-4 italic animate-fadeInUp",style:{animationDelay:`${.1+.1+r.length*.075}s`},children:"More subjects and quizzes are on the way. Stay tuned!"})]}),e.jsx("div",{className:"mt-auto pt-6 border-t border-[var(--border-color)] text-center animate-fadeInUp",style:{animationDelay:`${U}s`},children:e.jsxs("button",{ref:v,onClick:I,className:"px-6 py-3 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-lg transition-colors text-sm font-medium focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] flex items-center justify-center mx-auto","aria-label":"Open PDF export preferences",disabled:S!=="idle"&&S!=="finished",children:[e.jsx("i",{className:"fa-solid fa-file-pdf fa-lg mr-2.5"}),"Export Quizzes to PDF"]})})]}),e.jsx(Ft,{isOpen:b,onClose:M,subjects:r})]})},Ut=({subject:r,onSelectQuiz:i,onBackToSubjectList:o})=>{const t=r.quizzes.filter(a=>a.isStartable);return e.jsxs("div",{className:"w-full p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)]",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-primary)] truncate mb-2 sm:mb-0",title:`Quizzes in ${r.name}`,children:["Quizzes in ",r.name]}),e.jsx("button",{onClick:o,className:"px-4 py-2 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors text-sm sm:text-base w-full sm:w-auto focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]","aria-label":"Back to subject list",children:"â Back to Subject List"})]}),r.quizzes.length===0?e.jsx("p",{className:"text-lg text-[var(--text-secondary)] text-center py-6",children:"No quizzes created yet for this subject."}):t.length===0?e.jsx("p",{className:"text-lg text-[var(--text-secondary)] text-center py-6",children:"No quizzes are currently available for users in this subject. Please check back later."}):e.jsx("div",{className:"space-y-3",children:t.map(a=>e.jsxs("button",{onClick:()=>i(a.id),className:"quiz-select-button w-full text-left p-4 bg-[var(--bg-primary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-30 border border-[var(--border-color)] hover:border-[var(--accent-secondary)] rounded-lg text-[var(--text-primary)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]","aria-label":`Select quiz: ${a.name}, ${a.questions.length} question${a.questions.length!==1?"s":""}`,children:[e.jsx("span",{className:"text-lg font-semibold text-[var(--accent-primary)]",children:a.name}),e.jsxs("span",{className:"block text-sm text-[var(--text-secondary)] mt-1",children:[a.questions.length," question",a.questions.length!==1?"s":""]})]},a.id))})]})},vt=({question:r,questionNumber:i,selectedOptionId:o,isSubmitted:t,onOptionSelect:a,correctOptionIdForDisplay:c})=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 text-[var(--text-primary)] whitespace-pre-wrap",id:`question-${r.id}-text`,children:[i,". ",r.questionText]}),r.type==="mcq"&&r.options&&e.jsx("div",{className:"space-y-3",role:"radiogroup","aria-labelledby":`question-${r.id}-text`,children:r.options.map((u,b)=>{const z=o===u.id,S=String.fromCharCode(65+b);let g="w-full text-left p-3 rounded-md transition-all duration-150 flex items-center text-sm sm:text-base ",v="",w="";if(t){g+=" border-2 ";const j=u.id===c;j?(v="border-[var(--accent-green)] text-[var(--accent-green)] bg-[var(--accent-green-bg-soft)] font-medium",w="fa-solid fa-check-circle text-[var(--accent-green)]",z&&(v+=" ring-2 ring-[var(--accent-green)] ring-offset-1 ring-offset-[var(--bg-primary)]")):z&&!j?(v="border-[var(--accent-red)] text-[var(--accent-red)] bg-[var(--accent-red-bg-soft)] font-medium",w="fa-solid fa-times-circle text-[var(--accent-red)]"):(v="border-[var(--border-color)] text-[var(--text-secondary)] bg-[var(--bg-primary)] opacity-60 cursor-not-allowed",w="fa-regular fa-circle text-[var(--text-secondary)] opacity-60")}else g+=" border ",z?(v="bg-[var(--accent-primary-bg-selection)] border-[var(--accent-primary)] text-[var(--btn-primary-text)] font-medium",w="fa-solid fa-dot-circle text-[var(--btn-primary-text)]"):(v="bg-[var(--bg-primary)] border-[var(--border-color)] text-[var(--text-secondary)]",w="fa-regular fa-circle text-[var(--text-secondary)]");const k=g+v;return e.jsxs("button",{"data-option-id":u.id,className:`user-option-button ${k}`,onClick:()=>a(u.id),disabled:t,role:"radio","aria-checked":z&&!t,"aria-label":`Option ${S}: ${u.text}`,children:[e.jsx("i",{className:`${w} mr-2.5 text-lg w-5 text-center`})," ",e.jsxs("span",{className:"font-semibold mr-1.5",children:[S,"."]}),e.jsx("span",{children:u.text})]},u.id)})}),r.type==="written"&&e.jsx("div",{className:"p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md",children:e.jsx("p",{className:"text-[var(--text-primary)] italic",children:"This is a written response question."})})]}),Bt=({quiz:r,currentQuestionIndex:i,userAnswers:o,currentUserSelectionAttempt:t,isQuizComplete:a,onOptionSelect:c,onListedOptionSelect:u,onSubmitAnswer:b,onNextQuestion:z,onPreviousQuestion:S,onBackToQuizList:g,onRestartQuiz:v,userCorrectionMode:w,userQuestionDisplayMode:k,onTogglePrefsModal:j})=>{const[O,I]=n.useState(!0);n.useEffect(()=>{I(!0);const E=setTimeout(()=>{I(!1)},1200);return()=>clearTimeout(E)},[r.id]);const M=k==="oneByOne"?r.questions[i]:null,V=k==="oneByOne"?o[i]:null,Y=(M==null?void 0:M.type)==="mcq",X=V!=null,U=V!==null&&V.feedback!==null,l=w==="immediate"?U:a,T=X?V.selectedOptionId:t,f=(w==="immediate"||a)&&U?V.feedback:null,x=r.questions.length>0&&k==="oneByOne"?(i+1)/r.questions.length*100:0,y=!a&&i>0&&k==="oneByOne",A=k==="oneByOne"&&i===r.questions.length-1,C=!a&&M&&k==="oneByOne",W=!a&&M&&Y&&!U&&w==="immediate"&&k==="oneByOne",L=t===null,Z=w==="immediate"&&W,D=()=>{a&&k==="oneByOne"&&!M||z()},J="p-3 text-[var(--accent-primary)] transition-colors rounded-full focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] disabled:opacity-40 disabled:cursor-not-allowed",B="px-10 py-4 sm:px-12 sm:py-4 text-[var(--btn-primary-text)] bg-[var(--accent-primary)] transition-colors rounded-lg shadow-sm border border-[var(--accent-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] disabled:opacity-40 disabled:cursor-not-allowed",Q="w-full sm:w-auto mt-8 px-8 py-3 text-lg font-semibold text-[var(--btn-primary-text)] bg-[var(--accent-primary)] hover:bg-[var(--accent-primary-hover)] transition-colors rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)]",q=()=>e.jsxs("div",{className:"py-6",children:[e.jsxs("h3",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-green)] text-center mb-6",children:['Quiz Results for: "',r.name,'"']}),e.jsx("div",{className:"space-y-4 max-h-[calc(55vh+5rem)] sm:max-h-[calc(55vh+3rem)] overflow-y-auto pr-2 custom-scrollbar",children:r.questions.map((E,F)=>{const _=o[F];return e.jsxs("div",{className:"p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md shadow-sm",children:[e.jsxs("p",{className:"text-md font-semibold text-[var(--text-primary)] mb-2 whitespace-pre-wrap",children:[F+1,". ",E.questionText," ",e.jsxs("span",{className:"text-xs text-[var(--accent-secondary)]",children:["(",E.type.toUpperCase(),")"]})]}),E.type==="mcq"&&E.options&&e.jsxs("div",{className:"text-sm space-y-2 mt-1",children:[!(_!=null&&_.selectedOptionId)&&E.type==="mcq"&&e.jsx("p",{className:"text-sm text-[var(--accent-amber)] italic mb-1.5",children:"You did not answer this question."}),e.jsx("ul",{className:"space-y-1.5",children:E.options.map((G,se)=>{const ee=_?_.selectedOptionId===G.id:!1,re=E.correctOptionId===G.id,te=String.fromCharCode(65+se);let K="p-2 rounded-md border flex items-center text-sm transition-all duration-150 ",ne=null,de=null;return re?(K+="bg-green-500 bg-opacity-20 border-green-600 text-green-300 font-medium ",ne=e.jsx("i",{className:"fa-solid fa-check fa-fw mr-2 text-green-400"}),de=e.jsx("span",{className:"ml-auto text-xs font-normal",children:"(Correct answer)"}),ee&&(K+="ring-2 ring-green-500 shadow-md ",ne=e.jsx("i",{className:"fa-solid fa-check fa-fw mr-2 text-green-300"}),de=e.jsx("span",{className:"ml-auto text-xs font-semibold",children:"(Your correct choice)"}))):ee?(K+="bg-red-500 bg-opacity-20 border-red-600 text-red-300 font-medium shadow-md ",ne=e.jsx("i",{className:"fa-solid fa-times-circle fa-fw mr-2 text-red-400"}),de=e.jsx("span",{className:"ml-auto text-xs font-semibold",children:"(Your incorrect choice)"})):(K+="bg-[var(--bg-secondary)] border-[var(--border-color)] text-[var(--text-secondary)] ",ne=e.jsx("i",{className:"fa-regular fa-circle fa-fw mr-2 text-[var(--text-secondary)] opacity-70"})),e.jsxs("li",{className:K,children:[ne,e.jsxs("span",{className:"font-semibold mr-1.5",children:[te,"."]}),e.jsx("span",{className:"flex-grow min-w-0 break-words",children:G.text}),de]},G.id)})})]}),E.type==="written"&&((_==null?void 0:_.feedback)==="Seen"||a&&!_?e.jsx("p",{className:"text-sm text-[var(--text-secondary)] italic mt-1",children:"You viewed this written response question."}):e.jsx("p",{className:"text-sm text-[var(--text-secondary)] italic mt-1",children:"This is a written response question."}))]},E.id)})}),e.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4",children:[e.jsx("button",{onClick:v,className:"px-6 py-2.5 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-sm sm:text-base bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] w-full sm:w-auto",children:"Restart Quiz"}),e.jsx("button",{onClick:g,className:"px-6 py-2.5 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-sm sm:text-base bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] w-full sm:w-auto",children:"Back to Quiz List"})]})]});return e.jsxs("div",{className:"w-full p-4 sm:p-6",children:[!a&&e.jsxs("div",{className:"flex items-center justify-between mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)]",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-xs sm:text-sm bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] shrink-0","aria-label":"Back to quiz list",children:"â Back to Quiz List"}),!a&&e.jsx("button",{onClick:j,className:"text-[var(--text-secondary)] hover:text-[var(--accent-primary)] focus:outline-none p-1 rounded-full mx-2","aria-label":"Quiz Preferences",title:"Quiz Preferences",children:e.jsx("i",{className:`fa-solid fa-gear text-base ${O?"animate-settings-init":""}`})})]}),r.questions.length===0?e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-lg text-[var(--text-secondary)]",children:"This quiz has no questions yet."})}):a?q():k==="oneByOne"&&M?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm text-[var(--text-secondary)] mb-1",children:[e.jsxs("span",{className:"flex-1",children:["Question ",i+1," of ",r.questions.length]}),Y&&f&&e.jsx("span",{className:`font-semibold flex-1 text-right ${f==="Correct"?"text-[var(--accent-green)]":"text-[var(--accent-red)]"}`,children:f})]}),e.jsx("div",{className:"bg-[var(--border-color)] rounded-full h-2.5 w-full",role:"progressbar","aria-valuenow":i+1,"aria-valuemin":1,"aria-valuemax":r.questions.length,"aria-label":"Quiz progress",children:e.jsx("div",{className:"bg-[var(--accent-primary)] h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${x}%`}})})]}),e.jsx(vt,{question:M,questionNumber:i+1,selectedOptionId:T,isSubmitted:l,onOptionSelect:c,correctOptionIdForDisplay:f&&Y?M.correctOptionId:void 0}),e.jsxs("div",{className:"mt-8 sm:mt-10 flex justify-between items-center",children:[e.jsx("div",{className:"w-14 h-14 flex items-center justify-center",children:y&&e.jsx("button",{onClick:S,className:J,"aria-label":"Previous Question",title:"Previous Question",children:e.jsx("i",{className:"fa-solid fa-chevron-left fa-lg"})})}),e.jsx("div",{className:"flex-grow flex justify-center items-center min-h-[3.5rem] sm:min-h-[4rem]",children:W&&e.jsx("button",{onClick:b,disabled:L,className:`${B} focus:ring-offset-[var(--bg-primary)]`,"aria-label":"Submit Answer",title:"Submit Answer",children:e.jsx("i",{className:"fa-solid fa-circle-check fa-xl"})})}),e.jsx("div",{className:"w-14 h-14 flex items-center justify-center",children:C&&e.jsx("button",{onClick:D,disabled:Z,className:J,"aria-label":A?"Finish Quiz":"Next Question",title:A?"Finish Quiz":"Next Question",children:e.jsx("i",{className:`fa-solid ${A?"fa-flag-checkered":"fa-chevron-right"} fa-lg`})})})]})]}):k==="listed"?e.jsxs("div",{className:"space-y-8",children:[r.questions.map((E,F)=>{const _=o[F],G=_!=null,se=_!==null&&_.feedback!==null,ee=w==="immediate"?se:a,re=G?_.selectedOptionId:null,te=(w==="immediate"||a)&&se&&E.type==="mcq"?E.correctOptionId:void 0;return e.jsx("div",{className:"py-4 border-b border-[var(--border-color)] last:border-b-0",children:e.jsx(vt,{question:E,questionNumber:F+1,selectedOptionId:re,isSubmitted:ee,onOptionSelect:K=>u(K,F),correctOptionIdForDisplay:te})},E.id)}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:D,className:Q,"aria-label":"Finish Quiz",title:"Finish Quiz",children:[e.jsx("i",{className:"fa-solid fa-flag-checkered fa-lg mr-2"}),"Finish Quiz"]})})]}):e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-lg text-[var(--text-secondary)]",children:"Loading questions..."})})]})},yt="w-full p-3 border rounded-md focus:ring-2 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",dt="block text-sm font-medium text-[var(--text-secondary)] mb-1",Qt="bg-[var(--bg-secondary)] p-4 sm:p-6 rounded-lg shadow-lg",_t="w-full py-2.5 px-4 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",At=({subjectId:r,quizId:i,quizName:o,existingQuestion:t,onSaveQuestion:a,maxOptions:c})=>{var X;const[u,b]=n.useState("mcq"),[z,S]=n.useState(""),[g,v]=n.useState(Array(c).fill(null).map(()=>({text:""}))),[w,k]=n.useState(null),[j,O]=n.useState(null),I=U=>{if(b(U?"mcq":(t==null?void 0:t.type)||"mcq"),S(U?"":(t==null?void 0:t.questionText)||""),!U&&(t==null?void 0:t.type)==="mcq"&&(t!=null&&t.options)){const l=Array(c).fill(null).map(()=>({text:""}));let T=null;t.options.forEach((x,y)=>{y<c&&(l[y]={text:x.text})});const f=t.options.find(x=>x.id===t.correctOptionId);if(f){const x=l.findIndex(y=>y.text===f.text);x!==-1&&(T=x)}v(l),k(T)}else v(Array(c).fill(null).map(()=>({text:""}))),k(null);O(null)};n.useEffect(()=>{I(!t)},[t,c]);const M=(U,l)=>{const T=[...g];T[U]={text:l},v(T),l.trim()===""&&w===U&&k(null)},V=U=>{if(U.preventDefault(),O(null),!z.trim()){O("Question text cannot be empty.");return}let l;if(u==="mcq"){const T=g.map((C,W)=>({text:C.text.trim(),originalIndex:W})).filter(C=>C.text!=="");if(T.length<2){O("Please provide at least two answer options for an MCQ.");return}if(w===null||g[w].text.trim()===""){O("Please select a correct answer from the non-empty options for an MCQ.");return}const f=T.map((C,W)=>({id:`option-${W}`,text:C.text})),x=g[w].text.trim(),y=f.find(C=>C.text===x);if(!y){O("Error determining correct option ID. The selected correct option might be empty or not among the provided options.");return}const A=y.id;l={questionText:z.trim(),type:"mcq",options:f,correctOptionId:A}}else l={questionText:z.trim(),type:"written",options:void 0,correctOptionId:void 0};t?a(r,i,{...l,id:t.id}):(a(r,i,l),I(!0))},Y=t?"Update Question":"Add Question";return e.jsxs("div",{className:`${Qt} mt-3 mb-3 sm:mt-4 sm:mb-4`,children:[t&&e.jsxs("p",{className:"text-sm text-[var(--text-secondary)] mb-3 -mt-2",children:['Editing: "',t.questionText.substring(0,50),'..." (',(X=t.type)==null?void 0:X.toUpperCase(),")"]}),e.jsxs("form",{onSubmit:V,className:"space-y-6 p-4 bg-[var(--bg-secondary)] rounded-md border border-[var(--border-color)] shadow-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:`${dt} text-[var(--text-primary)]`,children:"Question Type"}),e.jsxs("div",{className:"flex space-x-4 text-[var(--text-primary)]",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"questionType",value:"mcq",checked:u==="mcq",onChange:()=>b("mcq"),className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{children:"Multiple Choice (MCQ)"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"questionType",value:"written",checked:u==="written",onChange:()=>b("written"),className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{children:"Written Response"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"questionText",className:dt,children:"Question Text"}),e.jsx("textarea",{id:"questionText",rows:3,value:z,onChange:U=>S(U.target.value),className:yt,placeholder:"Enter the question"})]}),u==="mcq"&&e.jsxs("fieldset",{children:[e.jsxs("legend",{className:`text-md font-medium ${dt} mb-2`,children:["Answer Options (Provide 2 to ",c,")"]}),e.jsx("div",{className:"space-y-3",children:g.map((U,l)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",id:`correctAnswer-${l}-${t?t.id:"new"}`,name:`correctAnswer-${t?t.id:"new"}`,value:l,checked:w===l,onChange:()=>k(l),disabled:U.text.trim()==="",className:"h-4 w-4 text-[var(--accent-primary)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] shrink-0 cursor-pointer bg-[var(--input-bg)]","aria-label":`Mark option ${String.fromCharCode(65+l)} as correct`}),e.jsxs("label",{htmlFor:`optionText-${l}-${t?t.id:"new"}`,className:"text-[var(--text-primary)] w-6 text-left font-medium",children:[String.fromCharCode(65+l),"."]}),e.jsx("input",{id:`optionText-${l}-${t?t.id:"new"}`,type:"text",value:U.text,onChange:T=>M(l,T.target.value),className:`${yt} flex-grow option-text-input`,placeholder:`Option ${String.fromCharCode(65+l)} text`,"data-option-index":l})]},l))})]}),j&&e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mt-2",children:j}),e.jsx("div",{className:"flex flex-col pt-2",children:e.jsx("button",{type:"submit",className:_t,children:Y})})]})]})},Gt=({question:r,questionNumber:i,onEdit:o,onDelete:t})=>{var u,b,z;let a="";if(r.type==="written")a="Type: Written";else{const S=((b=(u=r.options)==null?void 0:u.find(g=>g.id===r.correctOptionId))==null?void 0:b.text)||"N/A";a=`${((z=r.options)==null?void 0:z.length)||0} options, Correct: ${S.substring(0,25)}${S.length>25?"...":""}`}const c={userSelect:"none",transition:"background-color 0.2s ease, border-color 0.2s ease"};return e.jsxs("li",{className:"flex items-center justify-between p-3 bg-[var(--bg-primary)] rounded-md border border-[var(--border-color)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20 hover:border-[var(--accent-secondary)] shadow-sm",style:c,children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-primary)] truncate",title:r.questionText,children:[e.jsxs("span",{className:"font-semibold",children:[i,"."]})," ",r.questionText,e.jsxs("span",{className:"text-xs text-[var(--text-secondary)] ml-1",children:["(",r.type==="written"?"Written":"MCQ",")"]})]}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)]",children:a})]}),e.jsxs("div",{className:"flex space-x-2 ml-2 shrink-0",children:[e.jsx("button",{onClick:o,className:"edit-question-button px-3 py-1 text-xs bg-[var(--accent-amber)] hover:bg-[var(--accent-amber-hover)] text-[var(--btn-amber-text)] rounded-md transition-colors","aria-label":`Edit question: ${r.questionText.substring(0,30)}...`,children:"Edit"}),e.jsxs("button",{onClick:t,className:"delete-question-button px-3 py-1 text-xs bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white rounded-md transition-colors flex items-center space-x-1","aria-label":`Delete question: ${r.questionText.substring(0,30)}...`,children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw"}),e.jsx("span",{children:"Delete"})]})]})]})},Ht=({onConfirm:r,label:i,holdTimeMs:o=3e3})=>{const[t,a]=n.useState(!1),[c,u]=n.useState(0),[b,z]=n.useState(i),S=n.useRef(null),g=n.useRef(null),v=n.useRef(null),w=n.useCallback(()=>{a(!1),u(0),z(i),S.current&&clearTimeout(S.current),v.current&&cancelAnimationFrame(v.current),g.current=null},[i]),k=n.useCallback(()=>{if(!g.current){w();return}const O=Date.now()-g.current,I=Math.min(O/o*100,100);u(I);const M=Math.ceil(Math.max(0,o-O)/1e3);z(`${M}s`),I>=100?(r(),w()):v.current=requestAnimationFrame(k)},[o,r,w]),j=n.useCallback(()=>{t||(a(!0),g.current=Date.now(),u(0),v.current&&cancelAnimationFrame(v.current),v.current=requestAnimationFrame(k))},[t,k]);return n.useEffect(()=>()=>{w()},[w]),n.useEffect(()=>{t||z(i)},[i,t]),e.jsxs("button",{type:"button",className:"relative w-full px-3 py-1.5 text-sm text-white rounded-md transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center space-x-2 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] focus:ring-[var(--accent-red)] focus:ring-offset-[var(--bg-secondary)] overflow-hidden",onMouseDown:j,onMouseUp:w,onMouseLeave:w,onTouchStart:j,onTouchEnd:w,onTouchCancel:w,"aria-label":`Hold to confirm ${i}`,children:[e.jsx("span",{className:"button-hold-progress",style:{width:`${c}%`}}),e.jsxs("span",{className:"relative z-10 flex items-center space-x-1.5 select-none",children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw shrink-0"}),e.jsx("span",{className:"button-label truncate",children:b})]})]})},Vt=({isOpen:r,title:i,message:o,requiredPassword:t,onConfirm:a,onCancel:c,confirmButtonText:u="Confirm",cancelButtonText:b="Cancel"})=>{const[z,S]=n.useState(""),[g,v]=n.useState(null);if(n.useEffect(()=>{r&&(S(""),v(null))},[r]),!r)return null;const w=j=>{j==null||j.preventDefault(),t?z===t?a():v("Incorrect password. Please try again."):a()},k=document.getElementById("modal-root");return k?fe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"confirmation-modal-title",onClick:c,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",onClick:j=>j.stopPropagation(),children:[e.jsx("h2",{id:"confirmation-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)] mb-4 text-center",children:i}),e.jsx("div",{className:"text-sm text-[var(--text-primary)] mb-6 text-center",children:o}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[t&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-[var(--text-secondary)] mb-1",children:"Enter Password to Confirm"}),e.jsx("input",{type:"password",id:"confirmPassword",value:z,onChange:j=>S(j.target.value),className:"w-full p-3 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)] text-[var(--input-text)] focus:ring-2 focus:ring-[var(--input-focus-ring)] focus:border-[var(--input-focus-ring)] placeholder-[var(--placeholder-color)]",placeholder:"Enter confirmation password",required:!0})]}),g&&e.jsx("p",{className:"text-red-500 text-sm text-center -mt-2",children:g}),e.jsxs("div",{className:"flex flex-col sm:flex-row-reverse gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:u}),e.jsx("button",{type:"button",onClick:c,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:b})]})]})]})}),k):(console.error("Modal root element 'modal-root' not found for ConfirmationModal."),null)},Wt="YOUR_GITHUB_RAW_DATA_JSON_URL_HERE_OR_LEAVE_EMPTY_TO_ALWAYS_USE_LOCAL_FALLBACK",ut={GITHUB_DATA_URL:"https://github.com/Rustova/Q/blob/main/data.json"},Yt=({isOpen:r,onClose:i,subjectId:o,quizId:t,quizName:a,existingQuestion:c,onSaveQuestion:u,maxOptions:b})=>{if(!r)return null;const z=document.getElementById("modal-root");if(!z)return console.error("Modal root element 'modal-root' not found."),null;const S=(g,v,w)=>{u(g,v,w)};return fe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"edit-question-modal-title",onClick:i,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:g=>g.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl",children:[e.jsxs("h2",{id:"edit-question-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:['Edit Question in: "',a,'"']}),e.jsx("button",{onClick:i,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close edit question modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsx("div",{className:"p-1 overflow-y-auto flex-grow custom-scrollbar",children:e.jsx(At,{subjectId:o,quizId:t,quizName:a,existingQuestion:c,onSaveQuestion:S,maxOptions:b},c.id)})]})}),z)},Jt=({isOpen:r,quizName:i,initialQuestions:o,onConfirmReorder:t,onClose:a})=>{const[c,u]=n.useState([]);if(n.useEffect(()=>{u([...o])},[o,r]),n.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]),!r)return null;const b=g=>{if(!g.destination)return;const v=Array.from(c),[w]=v.splice(g.source.index,1);v.splice(g.destination.index,0,w),u(v)},z=()=>{t(c)},S=document.getElementById("modal-root");return S?fe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-[51] p-4",role:"dialog","aria-modal":"true","aria-labelledby":"reorder-questions-modal-title",onClick:a,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:g=>g.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl",children:[e.jsxs("h2",{id:"reorder-questions-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)] truncate min-w-0 mr-2",title:`Reorder Questions for: "${i}"`,children:['Reorder Questions for: "',e.jsx("span",{className:"truncate",children:i}),'"']}),e.jsx("button",{onClick:a,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close reorder questions modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-xl"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 overflow-y-auto flex-grow custom-scrollbar",children:[e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-4",children:"Drag and drop the questions to change their order."}),e.jsx(It,{onDragEnd:b,children:e.jsx(Tt,{droppableId:"questionsReorderList",children:g=>e.jsxs("ul",{...g.droppableProps,ref:g.innerRef,className:"space-y-2",children:[c.map((v,w)=>e.jsx(Pt,{draggableId:v.id,index:w,children:(k,j)=>e.jsxs("li",{ref:k.innerRef,...k.draggableProps,className:`border rounded-md flex 
                            ${j.isDragging?"bg-[var(--accent-primary)] bg-opacity-20 shadow-lg border-[var(--accent-primary)]":"bg-[var(--bg-primary)] border-[var(--border-color)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20"}`,children:[e.jsx("div",{className:"p-3 flex-grow min-w-0",children:e.jsxs("span",{className:"text-sm text-[var(--text-primary)] truncate block",title:v.questionText,children:[e.jsxs("span",{className:"font-medium mr-1",children:[w+1,"."]}),v.questionText,e.jsxs("span",{className:"text-xs text-[var(--accent-secondary)] ml-1.5",children:["(",v.type==="mcq"?"MCQ":"Written",")"]})]})}),e.jsx("div",{...k.dragHandleProps,className:"px-5 py-3 bg-[var(--accent-secondary)] hover:bg-[var(--accent-secondary-hover)] text-[var(--text-primary)] rounded-r-md cursor-grab active:cursor-grabbing flex items-center justify-center shrink-0","aria-label":"Drag to reorder question",children:e.jsx("i",{className:"fa-solid fa-sort fa-fw fa-xl text-[var(--text-primary)]"})})]})},v.id)),g.placeholder]})})}),o.length===0&&e.jsx("p",{className:"text-[var(--text-secondary)] text-center py-4",children:"This quiz has no questions to reorder."})]}),e.jsx("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-end space-x-3",children:e.jsx("button",{onClick:z,disabled:o.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50",children:"Save Order"})})]})}),S):(console.error("Modal root element 'modal-root' not found."),null)},jt=({textToType:r,speed:i=50,className:o,title:t})=>{const[a,c]=n.useState("");return n.useEffect(()=>{c("");const u=r||"";if(u){let b=0;const z=setInterval(()=>{b++,c(u.substring(0,b)),b>=u.length&&clearInterval(z)},i);return()=>clearInterval(z)}else c("")},[r,i]),e.jsx("span",{className:o,title:t||r,children:a})},ke="w-full p-3 border rounded-md focus:ring-2 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",wt="w-full p-3 border rounded-md focus:ring-2 bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",Nt="px-4 py-2 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)]",St="px-4 py-2 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)]",Kt="px-4 py-2 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]",Xt="px-4 py-2 bg-[var(--accent-green)] hover:bg-[var(--accent-green-hover)] text-white rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--accent-green)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",Ie="block text-sm font-medium text-[var(--text-secondary)] mb-1",Qe="bg-[var(--bg-secondary)] p-4 sm:p-6 rounded-lg shadow-lg border border-[var(--border-color)]",Zt="a7f39d5b1c",er=r=>{try{const i=new URL(r);if(i.hostname==="raw.githubusercontent.com"){const o=i.pathname.split("/").filter(Boolean);return o.length<4?(console.error("Invalid GitHub Raw URL: Path too short. Expected owner/repo/branch/path... Given:",r),null):{owner:o[0],repo:o[1],branch:o[2],path:o.slice(3).join("/")}}if(i.hostname==="github.com"){const o=/^\/([^\/]+)\/([^\/]+)\/blob\/([^\/]+)\/(.+)$/,t=i.pathname.match(o);if(t){const[,a,c,u,b]=t;return{owner:a,repo:c,branch:u,path:b.replace(/\?.*$/,"")}}}if(i.hostname==="api.github.com"&&i.pathname.startsWith("/repos/")){const o=i.pathname.split("/").filter(Boolean);if(o.length>=5&&o[0]==="repos"&&o[3]==="contents"){const a=new URLSearchParams(i.search).get("ref")||"main";return{owner:o[1],repo:o[2],branch:a,path:o.slice(4).join("/")}}}return console.warn(`URL (${r}) is not a recognized GitHub raw, blob, or API URL for saving. Saving via GitHub API might fail.`),null}catch(i){return console.error("Error parsing GitHub URL for saving:",r,i),null}},tr=r=>{const{subjects:i,allSubjectsData:o,activeSubjectId:t,activeQuizId:a,editingQuestion:c,setEditingQuestion:u,onSetActiveSubjectId:b,onCreateSubject:z,onUpdateSubjectName:S,onDeleteSubject:g,onSetActiveQuizId:v,onCreateQuiz:w,onUpdateQuizName:k,onDeleteQuiz:j,onToggleQuizStartable:O,onAddQuestion:I,onUpdateQuestion:M,onDeleteQuestion:V,onReorderQuestions:Y,onReorderAllQuizzesByTypeGlobal:X,maxOptions:U,showManageSubjectsSection:l,setShowManageSubjectsSection:T,showManageQuizzesSection:f,setShowManageQuizzesSection:x,activeAdminSubject:y,activeAdminQuiz:A,githubPat:C,setGithubPat:W}=r,[L,Z]=n.useState(""),[D,J]=n.useState(""),[B,Q]=n.useState(""),[q,E]=n.useState(""),[F,_]=n.useState(!0),[G,se]=n.useState(!1),[ee,re]=n.useState(!1),[te,K]=n.useState(null),ne=ut.GITHUB_DATA_URL!==Wt,[de,we]=n.useState(!1),[ie,ge]=n.useState(!1),[_e,Pe]=n.useState(!1),[xe,ft]=n.useState(null),[$e,Ne]=n.useState(!1),[Oe,Se]=n.useState(null),[De,Ge]=n.useState(""),[He,Ee]=n.useState("");n.useEffect(()=>{we(!!c)},[c]),n.useEffect(()=>{J((y==null?void 0:y.name)||"")},[y]),n.useEffect(()=>{E((A==null?void 0:A.name)||"")},[A]);const me=(N,ae,le)=>{Ge(N),Ee(ae),Se(()=>le),Ne(!0)},ve=()=>{Oe&&Oe(),Ne(!1),Se(null)},Ve=()=>{Ne(!1),Se(null)},We=()=>{if(!L.trim()){alert("Subject name cannot be empty.");return}if(i.some(N=>N.name.toLowerCase()===L.trim().toLowerCase())){alert(`A subject with the name "${L.trim()}" already exists. Please choose a different name.`);return}me("Confirm Create Subject",e.jsxs("p",{children:["Are you sure you want to create the subject: ",e.jsx("strong",{children:L.trim()}),"?"]}),()=>{z(L.trim()),Z("")})},Ye=N=>{b(N.target.value||null)},Je=()=>{if(!t||!D.trim()){alert("No subject selected or name is empty.");return}const N=y==null?void 0:y.name;me("Confirm Update Subject Name",e.jsxs("p",{children:['Are you sure you want to rename the subject from "',e.jsx("strong",{children:N}),'" to "',e.jsx("strong",{children:D.trim()}),'"?']}),()=>{S(t,D.trim())})},Ke=()=>{t&&y?me("Confirm Delete Subject",e.jsxs("p",{children:["Are you sure you want to delete the subject: ",e.jsx("strong",{children:y.name}),"? This action cannot be undone and will delete all its quizzes and questions."]}),()=>g(t)):alert("No subject selected to delete.")},Xe=()=>{if(!t||!B.trim()){alert("No subject selected or quiz name is empty.");return}w(t,B.trim()),Q("")},Ze=N=>{v(N.target.value||null)},et=()=>{if(!t||!a||!q.trim()){alert("No subject/quiz selected or name is empty.");return}k(t,a,q.trim())},tt=()=>{t&&a&&A?j(t,a):alert("No quiz selected to delete.")},rt=()=>{t&&a&&O(t,a)},st=N=>{u(N)},at=N=>{console.log("[AdminView] handleDeleteQuestionClick called for question ID:",N),t&&a&&A?A.questions.find(le=>le.id===N)?V(t,a,N):(alert(`Question not found in the current quiz (ID: ${N}). It might have already been deleted.`),console.warn(`[AdminView] Attempted to delete question ID ${N}, but it was not found in activeAdminQuiz.questions.`)):(alert("Cannot delete question: context missing (subject/quiz). Please ensure a quiz is selected."),console.error(`[AdminView] handleDeleteQuestionClick: Context missing. activeSubjectId: ${t}, activeQuizId: ${a}.`))},qe=(N,ae,le)=>{"id"in le?M(N,ae,le):I(N,ae,le),u(null)},Me=()=>{A&&ge(!0)},nt=N=>{t&&a&&Y(t,a,N),ge(!1)},ot=()=>{me("Confirm Global Question Reorder",e.jsxs("span",{children:["This will reorder questions in ",e.jsx("strong",{children:"ALL quizzes"})," across ",e.jsx("strong",{children:"ALL subjects"}),". Written questions will be moved before MCQ questions within each quiz. This action cannot be undone. Please enter the password to confirm."]}),()=>{X()})},it=async()=>{if(!C){K({message:"A PAT is required to save data.",type:"error"});return}re(!0),K({message:"Saving Data...",type:"info"});const N=er(ut.GITHUB_DATA_URL);if(!N){K({message:"Could not parse GitHub URL. Check console for details and ensure it's a raw, blob, or API URL.",type:"error"}),re(!1);return}console.log("GitHub Repo Info for Save:",N);const{owner:ae,repo:le,branch:Le,path:lt}=N,oe=`https://api.github.com/repos/${ae}/${le}/contents/${lt}`,Ae="Quiz App: Update application data via Web Editor",be={lastUpdated:new Date().toISOString(),subjects:o},Fe=JSON.stringify(be,null,2),xt=btoa(unescape(encodeURIComponent(Fe)));try{let ue;const ze=new URL(oe);ze.searchParams.append("ref",Le),ze.searchParams.append("_cb_sha",Date.now().toString());try{const s=await fetch(ze.toString(),{method:"GET",headers:{Authorization:`token ${C}`,Accept:"application/vnd.github.v3+json"}});if(s.ok)ue=(await s.json()).sha,console.log("Fetched current file SHA:",ue);else if(s.status!==404){const m=await s.text();throw new Error(`Failed to get current file SHA: ${s.status} - ${m}`)}else console.log("File not found (404) when fetching SHA. Will attempt to create a new file.")}catch(s){throw console.error("Error fetching file SHA:",s),new Error(`Network or unexpected error fetching file SHA: ${s.message}`)}const d=await fetch(oe,{method:"PUT",headers:{Authorization:`token ${C}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({message:Ae,content:xt,sha:ue,branch:Le})});if(!d.ok){const s=await d.json();throw console.error("GitHub API Error Data during PUT:",s),new Error(`GitHub API error: ${d.status} - ${s.message||"Unknown error"}`)}const p=await d.json();console.log("Save successful:",p),K({message:"Data saved successfully!",type:"success"})}catch(ue){console.error("Error saving data:",ue),K({message:`Error saving data: ${ue.message}`,type:"error"})}finally{re(!1)}},Ce=N=>{N(ae=>!ae)};return e.jsxs("div",{className:"space-y-6 sm:space-y-8 pb-8",children:[e.jsxs("section",{className:Qe,"aria-labelledby":"manage-subjects-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Ce(T),children:[e.jsx("h2",{id:"manage-subjects-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:"Manage Subjects"}),e.jsx("i",{className:`fa-solid ${l?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newSubjectName",className:Ie,children:"Create New Subject"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",id:"newSubjectName",value:L,onChange:N=>Z(N.target.value),placeholder:"Enter name for new subject",className:ke}),e.jsxs("button",{onClick:We,className:Nt,"aria-label":"Create New Subject",children:[e.jsx("i",{className:"fa-solid fa-plus fa-fw"})," Create Subject"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectSubjectToManage",className:Ie,children:"Select Subject to Manage"}),e.jsxs("select",{id:"selectSubjectToManage",value:t||"",onChange:Ye,className:wt,children:[e.jsx("option",{value:"",children:"-- Select a Subject --"}),i.map(N=>e.jsx("option",{value:N.id,children:N.name},N.id))]})]}),t&&y&&e.jsxs("div",{className:"p-3 border border-[var(--border-color)] bg-[var(--bg-primary)] rounded-md space-y-3 mt-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:["Managing:",e.jsx(jt,{textToType:y.name,className:"font-semibold text-[var(--text-primary)] truncate max-w-[200px] sm:max-w-xs inline-block align-bottom",title:y.name},y.id)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",value:D,onChange:N=>J(N.target.value),placeholder:"New name for selected subject",className:ke,"aria-label":"New name for selected subject"}),e.jsxs("button",{onClick:Je,className:St,"aria-label":"Update Selected Subject Name",children:[e.jsx("i",{className:"fa-solid fa-pen-to-square fa-fw"})," Update Name"]})]}),e.jsxs("button",{onClick:Ke,className:`${Kt} w-full`,"aria-label":"Delete Selected Subject",children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw"})," Delete Subject"]})]}),!t&&e.jsx("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:"Select a subject above to manage its details and quizzes."})]})]}),t&&y&&e.jsxs("section",{className:Qe,"aria-labelledby":"manage-quizzes-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Ce(x),children:[e.jsxs("h2",{id:"manage-quizzes-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:["Manage Quizzes for: ",e.jsx("span",{className:"truncate",children:y.name})]}),e.jsx("i",{className:`fa-solid ${f?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),f&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newQuizName",className:Ie,children:"Create New Quiz"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",id:"newQuizName",value:B,onChange:N=>Q(N.target.value),placeholder:"Enter name for new quiz",className:ke}),e.jsxs("button",{onClick:Xe,className:Nt,"aria-label":"Create New Quiz",children:[e.jsx("i",{className:"fa-solid fa-plus fa-fw"})," Create Quiz"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectQuizToManage",className:Ie,children:"Select Quiz to Manage"}),e.jsxs("select",{id:"selectQuizToManage",value:a||"",onChange:Ze,className:wt,children:[e.jsx("option",{value:"",children:"-- Select a Quiz --"}),y.quizzes.map(N=>e.jsxs("option",{value:N.id,children:[N.name,!N.isStartable&&" (Not Available)"]},N.id))]})]}),a&&A&&e.jsxs("div",{className:"p-3 border border-[var(--border-color)] bg-[var(--bg-primary)] rounded-md space-y-3 mt-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:["Managing:",e.jsx(jt,{textToType:A.name,className:"font-semibold text-[var(--text-primary)]",title:A.name},A.id)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",value:q,onChange:N=>E(N.target.value),placeholder:"New name for selected quiz",className:ke,"aria-label":"New name for selected quiz"}),e.jsxs("button",{onClick:et,className:St,"aria-label":"Update Selected Quiz Name",children:[e.jsx("i",{className:"fa-solid fa-pen-to-square fa-fw"})," Update Name"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md bg-[var(--input-bg)] border border-[var(--input-border)]",children:[e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"Available to users"}),e.jsx("button",{onClick:rt,className:`rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--input-bg)]
                          ${A.isStartable?"focus:ring-[var(--accent-green)]":"focus:ring-[var(--accent-secondary)]"} flex items-center justify-center p-1`,"aria-checked":A.isStartable,role:"switch",title:A.isStartable?"Click to make unavailable to users":"Click to make available to users",children:e.jsxs("div",{className:"relative inline-block w-12 h-6 select-none",children:[e.jsx("div",{className:`toggle-track absolute w-12 h-6 rounded-full shadow-inner transition-colors duration-200 ease-in-out ${A.isStartable?"bg-[var(--accent-green)]":"bg-[var(--accent-secondary)]"}`}),e.jsx("div",{className:`toggle-knob absolute w-5 h-5 bg-white rounded-full shadow top-0.5 left-0.5 transition-transform duration-200 ease-in-out transform ${A.isStartable?"translate-x-6":"translate-x-0"}`})]})})]}),e.jsx(Ht,{onConfirm:()=>tt(),label:"Delete Quiz",holdTimeMs:3e3})]}),!a&&y.quizzes.length>0&&e.jsx("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:"Select a quiz above to manage its questions and details."}),y.quizzes.length===0&&e.jsxs("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:['No quizzes created yet for "',y.name,'".']})]})]}),t&&a&&A&&e.jsxs("section",{className:`${Qe} mt-6`,"aria-labelledby":"manage-questions-heading",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h2",{id:"manage-questions-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:["Manage Questions for: ",e.jsx("span",{className:"truncate",children:A.name})]})}),e.jsx(At,{subjectId:t,quizId:a,quizName:A.name,existingQuestion:null,onSaveQuestion:qe,maxOptions:U}),de&&c&&e.jsx(Yt,{isOpen:de,onClose:()=>u(null),subjectId:t,quizId:a,quizName:A.name,existingQuestion:c,onSaveQuestion:qe,maxOptions:U}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center mb-3",children:[e.jsxs("h3",{className:"text-lg font-medium text-[var(--text-primary)]",children:["Current Questions (",A.questions.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[A.questions.length>0&&e.jsxs("button",{onClick:ot,className:"px-2.5 py-1 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center space-x-1","aria-label":"Sort all questions globally by type (Written then MCQ)",title:"Sort All Quizzes by Type (Global)",children:[e.jsx("i",{className:"fa-solid fa-arrow-up-wide-short"}),e.jsx("span",{children:"Sort All by Type (Global)"})]}),A.questions.length>1&&e.jsxs("button",{onClick:Me,className:"px-2.5 py-1 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center space-x-1","aria-label":"Reorder questions for current quiz",title:"Reorder Questions (Current Quiz)",children:[e.jsx("i",{className:"fa-solid fa-sort"})," ",e.jsx("span",{children:"Reorder"})]})]})]}),A.questions.length===0?e.jsx("p",{className:"text-[var(--text-secondary)] text-center py-3",children:"No questions added yet. Use the form above to add some!"}):e.jsx("ul",{className:"space-y-2",children:A.questions.map((N,ae)=>e.jsx(Gt,{question:N,questionNumber:ae+1,onEdit:()=>st(N),onDelete:()=>at(N.id)},N.id))}),ie&&A&&e.jsx(Jt,{isOpen:ie,quizName:A.name,initialQuestions:A.questions,onConfirmReorder:nt,onClose:()=>ge(!1)})]})]}),e.jsxs("section",{className:Qe,"aria-labelledby":"app-data-management-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Ce(_),children:[e.jsx("h2",{id:"app-data-management-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:"Application Data Management"}),e.jsx("i",{className:`fa-solid ${F?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),F&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:Ie,children:["Personal Access Token (PAT) for Admin",e.jsxs("button",{onClick:()=>se(N=>!N),className:"ml-1.5 text-[var(--accent-secondary)] hover:text-[var(--accent-primary)] text-xs focus:outline-none","aria-label":G?"Hide PAT information":"Show PAT information",title:"Toggle PAT Information",children:[e.jsx("i",{className:`fa-solid ${G?"fa-eye-slash":"fa-eye"}`})," Info"]})]}),e.jsx("input",{type:"password",id:"adminGithubPat",value:C,onChange:N=>W(N.target.value),placeholder:"Enter GitHub PAT for saving data",className:`${ke} mt-1`}),G&&e.jsxs("p",{className:"text-xs text-[var(--text-secondary)] mt-1.5",children:["Your PAT is stored in browser localStorage. It needs 'repo' scope (Classic PAT) or 'Contents: Read & Write' (Fine-Grained PAT) for the repository containing the application data.",e.jsx("a",{href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens",target:"_blank",rel:"noopener noreferrer",className:"text-[var(--accent-primary)] hover:underline ml-1",children:"More info"})]})]}),e.jsxs("button",{onClick:it,disabled:ee||!ne||!C,className:`${Xt} w-full sm:w-auto ${ee||!ne||!C?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("i",{className:`fa-solid ${ee?"fa-spinner fa-spin":"fa-save"} fa-fw`}),ee?"Saving Data...":"Save Data"]}),!ne,!C&&ne&&e.jsx("p",{className:"text-xs text-[var(--text-secondary)] text-center mt-1",children:"A PAT is required to enable saving. Please enter it above."}),te&&e.jsx("p",{className:`text-sm mt-2 text-center ${te.type==="error"?"text-red-400":te.type==="success"?"text-green-400":"text-[var(--text-secondary)]"}`,children:te.message}),e.jsx("div",{className:"mt-4 p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("i",{className:"fa-solid fa-circle-info text-[var(--accent-secondary)] mt-1 text-lg"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-[var(--text-primary)]",children:"Saving Your Work"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)]",children:"Manage your subjects, quizzes, and questions using the sections above. If data saving is configured, ensure your PAT is entered and click 'Save Data' to store all changes."})]})]})})]})]}),$e&&e.jsx(Vt,{isOpen:$e,title:De,message:He,requiredPassword:Zt,onConfirm:ve,onCancel:Ve})]})},rr=({isOpen:r,onClose:i,timestamp:o})=>{if(!r)return null;let t="N/A",a="N/A",c="Timestamp not available.";if(o)try{const b=new Date(o);isNaN(b.getTime())?c="Invalid timestamp provided.":(t=b.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),a=b.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"}),c=`This content was last updated on: ${b.toString()}`)}catch(b){console.error("Error formatting timestamp for modal:",b),c="Error displaying timestamp."}const u=document.getElementById("modal-root");return u?fe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"timestamp-modal-title",onClick:i,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",onClick:b=>b.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between pb-4 mb-4 border-b border-[var(--border-color)]",children:[e.jsx("h2",{id:"timestamp-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)]",children:"Content Update Information"}),e.jsx("button",{onClick:i,className:"p-1.5 text-[var(--text-secondary)] hover:text-[var(--accent-red)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close timestamp information modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"text-sm text-[var(--text-primary)] space-y-2",children:[e.jsx("p",{children:c}),o&&!isNaN(new Date(o).getTime())&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",t]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",a]})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-[var(--border-color)] flex justify-end",children:e.jsx("button",{type:"button",onClick:i,className:"px-5 py-2 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] text-sm",children:"Close"})})]})}),u):(console.error("Modal root element 'modal-root' not found for TimestampModal."),null)},sr=({isOpen:r,onClose:i,currentCorrectionMode:o,onSetCorrectionMode:t,currentQuestionDisplayMode:a,onSetQuestionDisplayMode:c})=>{const[u,b]=n.useState(o),[z,S]=n.useState(a);if(n.useEffect(()=>{r&&(b(o),S(a))},[r,o,a]),!r)return null;const g=j=>{b(j.target.value)},v=j=>{S(j.target.value)},w=()=>{t(u),c(z)},k=document.getElementById("modal-root");return k?fe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"quiz-prefs-modal-title",onClick:i,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-lg border border-[var(--border-color)] max-h-[90vh] flex flex-col",onClick:j=>j.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between pb-4 mb-4 border-b border-[var(--border-color)] shrink-0",children:[e.jsx("h2",{id:"quiz-prefs-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)]",children:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§ÙØ§Ø®ØªØ¨Ø§Ø± (Quiz Preferences)"}),e.jsx("button",{onClick:i,className:"p-1.5 text-[var(--text-secondary)] hover:text-[var(--accent-red)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close preferences modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"space-y-6 mb-6 overflow-y-auto custom-scrollbar pr-1 flex-grow",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--text-primary)] mb-2",children:"ÙÙØ· Ø§ÙØªØµØ­ÙØ­ (Correction Mode)"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-2",children:"Choose how you want quiz answers to be graded:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"correctionMode",value:"immediate",checked:u==="immediate",onChange:g,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙÙØ°Ø§ÙØ±Ø© : ØªØµØ­ÙØ­ Ø§ÙØ³Ø¤Ø§Ù Ø§ÙÙ Ø¨Ø§ÙÙ"})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"correctionMode",value:"atEnd",checked:u==="atEnd",onChange:g,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙÙØ±Ø§Ø¬Ø¹Ø© : ØªØµØ­ÙØ­ Ø§ÙÙÙÙØ² Ø¹ÙØ¯ Ø§ÙØªØ³ÙÙÙ"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--text-primary)] mb-2",children:"ÙÙØ· Ø¹Ø±Ø¶ Ø§ÙØ£Ø³Ø¦ÙØ© (Question Display Mode)"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-2",children:"Choose how questions are presented during the quiz:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"questionDisplayMode",value:"oneByOne",checked:z==="oneByOne",onChange:v,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙØ³Ø¤Ø§Ù Ø§ÙÙØ§Ø­Ø¯: Ø¹Ø±Ø¶ Ø§ÙØ£Ø³Ø¦ÙØ© Ø³Ø¤Ø§ÙÙØ§ ØªÙÙ Ø§ÙØ¢Ø®Ø±"})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"questionDisplayMode",value:"listed",checked:z==="listed",onChange:v,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"ÙÙØ· Ø§ÙÙØ§Ø¦ÙØ©: Ø¹Ø±Ø¶ Ø¬ÙÙØ¹ Ø£Ø³Ø¦ÙØ© Ø§ÙØ§Ø®ØªØ¨Ø§Ø± ÙÙ ÙØ§Ø¦ÙØ© ÙØ§Ø­Ø¯Ø©"})]})]})]})]}),e.jsxs("div",{className:"mt-auto pt-4 border-t border-[var(--border-color)] flex flex-col sm:flex-row-reverse gap-3 shrink-0",children:[e.jsx("button",{type:"button",onClick:w,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Save Preferences"}),e.jsx("button",{type:"button",onClick:i,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Cancel"})]})]})}),k):(console.error("Modal root element 'modal-root' not found for QuizPreferencesModal."),null)},ar="e2c841f407",mt="Q",nr=5;function Te(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}async function or(r){const i=/^https:\/\/github\.com\/([^\/]+)\/([^\/]+)\/blob\/([^\/]+)\/(.+)$/,o=r.match(i);if(o){const[,t,a,c,u]=o,b=`https://api.github.com/repos/${t}/${a}/contents/${u.replace(/\?.*$/,"")}?ref=${c}`;return console.log(`Resolved GitHub blob URL to API raw content URL: ${b}`),b}try{return new URL(r),/^https:\/\/raw\.githubusercontent\.com\//.test(r)||/^https:\/\/api\.github\.com\/repos\/[^\/]+\/[^\/]+\/contents\//.test(r)||!/^https:\/\/github\.com\//.test(r)?r:(console.warn(`The provided GITHUB_DATA_URL (${r}) is a github.com URL but not a 'blob' URL. This format is not directly processable for raw content in this version. Please use a blob URL or a raw content URL.`),null)}catch{return console.warn(`The GITHUB_DATA_URL (${r}) is not a valid absolute URL or a recognized GitHub format. Fallback will likely occur.`),null}}const ir=()=>{const[r,i]=n.useState(()=>localStorage.getItem("isAdminAuthenticated")==="true"),[o,t]=n.useState(()=>localStorage.getItem("isAdminAuthenticated")==="true"&&localStorage.getItem("wasAdminViewBeforeRefresh")==="true"?"AdminPanel":"SubjectSelection"),[a,c]=n.useState(()=>localStorage.getItem("githubPat")||""),[u,b]=n.useState([]),[z,S]=n.useState(null),[g,v]=n.useState(null),[w,k]=n.useState(null),[j,O]=n.useState(null),[I,M]=n.useState(null),[V,Y]=n.useState(!1),[X,U]=n.useState(!1),[l,T]=n.useState(null),[f,x]=n.useState(null),[y,A]=n.useState(!0),[C,W]=n.useState("Gathering all the necessary app information, please hold on a moment..."),[L,Z]=n.useState(0),[D,J]=n.useState(null),[B,Q]=n.useState([]),[q,E]=n.useState(!1),[F,_]=n.useState("immediate"),[G,se]=n.useState("oneByOne"),[ee,re]=n.useState(!1),[te,K]=n.useState(!0),[ne,de]=n.useState(!0),[we,ie]=n.useState(!1),ge=n.useRef(!1);n.useEffect(()=>{a?localStorage.setItem("githubPat",a):localStorage.removeItem("githubPat")},[a]),n.useEffect(()=>{(o==="UserQuiz"||o==="QuizSelection")&&window.scrollTo(0,0)},[o]);const _e=(d,p)=>{d&&typeof d=="object"&&!Array.isArray(d)?(Array.isArray(d.subjects)?b(d.subjects):(console.warn(`Loaded ${p} data object does not contain a 'subjects' array. Initializing with empty subjects.`),b([])),typeof d.lastUpdated=="string"?S(d.lastUpdated):(S(null),d.lastUpdated!==void 0&&console.warn(`Loaded ${p} 'lastUpdated' field found but is not a string. Timestamp will not be set.`))):Array.isArray(d)?(b(d),S(null),console.log(`Loaded ${p} data is in old array format. No timestamp available from data.json.`)):(console.warn(`Loaded ${p} data.json is not in the expected array or {lastUpdated, subjects} object format. Initializing with empty data.`),b([]),S(null))},Pe=n.useCallback(async d=>{console.warn(d||"Falling back to local data.json.");try{const s=`./data.json?_cb_local=${Date.now().toString()}`,m=await fetch(s,{cache:"no-cache"});if(m.ok){const h=await m.json();_e(h,"local"),console.log("Successfully processed local data.json")}else if(m.status===404)console.warn("Local data.json not found, initializing with empty subjects array."),b([]),S(null);else{const h=await m.text();console.error(`Failed to fetch local data.json: ${m.status} ${m.statusText}. Response: ${h}`),b([]),S(null)}}catch(p){p instanceof Error?console.error(`Error loading or parsing local data.json: Name: ${p.name}, Message: ${p.message}. Stack: ${p.stack}`):console.error("Error loading or parsing local data.json (non-Error object):",p),b([]),S(null)}},[]);n.useEffect(()=>{(async()=>{if(ge.current){console.log("Data fetch already attempted for this component instance. Skipping.");return}ge.current=!0,A(!0),W("Gathering all the necessary app information, please hold on a moment...");const p=await or(ut.GITHUB_DATA_URL);if(p){console.info(`Attempting to fetch data from: ${p}`);try{const s=new URL(p);s.searchParams.append("_cb_data",Date.now().toString());const m=s.toString();console.log("Fetching final data from:",m);const h={cache:"no-cache"};let P=!1;s.hostname==="api.github.com"&&s.pathname.includes("/repos/")&&s.pathname.includes("/contents/")?(h.headers={Accept:"application/vnd.github.v3.raw"},P=!0,console.log("Using GitHub API raw content fetch method.")):console.log("Using standard fetch method for non-API or raw.githubusercontent.com URL.");const $=await fetch(m,h);if(!$.ok){const H=await $.text();throw new Error(`Failed to fetch from ${m}: ${$.status} ${$.statusText}. Body: ${H}`)}let R;if(P){const H=await $.text();R=JSON.parse(H)}else R=await $.json();_e(R,"remote"),console.log("Successfully processed data from remote source")}catch(s){s instanceof Error?console.error(`Error fetching or parsing data from (${p}). Type: ${s.name}, Message: ${s.message}. Stack: ${s.stack}`):console.error(`Error fetching or parsing data from (${p}). Caught non-Error object:`,s),await Pe(`Failed to load from remote source (${p}).`)}finally{A(!1),W(null)}}else console.info("No remote GITHUB_DATA_URL configured, URL is invalid/placeholder, or processing error prevented getting a usable URL."),await Pe("No remote data URL usable or remote fetch failed."),A(!1),W(null)})()},[Pe]);const xe=()=>{Z(0),J(null),Q([]),E(!1)},ft=()=>{t("AdminPanel"),O(null),M(null),xe(),ie(!1),r?localStorage.setItem("wasAdminViewBeforeRefresh","true"):Y(!0)},$e=()=>{t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"),v(null),k(null),x(null),ie(!1)},Ne=d=>{d===ar?(i(!0),localStorage.setItem("isAdminAuthenticated","true"),t("AdminPanel"),localStorage.setItem("wasAdminViewBeforeRefresh","true"),Y(!1),T(null)):T("Incorrect password. Please try again.")},Oe=()=>{i(!1),localStorage.removeItem("isAdminAuthenticated"),t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"),v(null),k(null),x(null),ie(!1)},Se=()=>{Y(!1),T(null),r||(t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"),ie(!1))},De=()=>{U(d=>!d)},Ge=d=>{_(d)},He=d=>{se(d),re(!1)},Ee=()=>{re(d=>!d)},me=d=>{v(d),k(null),x(null)},ve=d=>{k(d),x(null)},Ve=d=>{const p={id:Te(),name:d,quizzes:[]};b(s=>[...s,p])},We=(d,p)=>u.some(s=>s.name.toLowerCase()===p.toLowerCase()&&s.id!==d)?(alert(`A subject with the name "${p}" already exists. Please choose a different name.`),!1):(b(s=>s.map(m=>m.id===d?{...m,name:p}:m)),!0),Ye=d=>{b(p=>{const s=p.findIndex(h=>h.id===d);if(s===-1)return p;const m=p.filter(h=>h.id!==d);if(g===d)if(m.length>0){const h=Math.min(s,m.length-1);me(m[h].id)}else me(null);return m})},Je=(d,p)=>{const s=u.find(h=>h.id===d);if(!s){alert("Error: Could not find the subject to add the quiz to. Please try again.");return}if(s.quizzes.some(h=>h.name.toLowerCase()===p.toLowerCase())){alert(`A quiz with the name "${p}" already exists in subject "${s.name}". Please choose a different name.`);return}const m={id:Te(),name:p,questions:[],isStartable:!0};b(h=>h.map(P=>P.id===d?{...P,quizzes:[...P.quizzes,m]}:P)),ve(m.id)},Ke=(d,p,s)=>{var h;let m=!1;if(b(P=>P.map($=>$.id===d?$.quizzes.some(R=>R.name.toLowerCase()===s.toLowerCase()&&R.id!==p)?(m=!0,$):{...$,quizzes:$.quizzes.map(R=>R.id===p?{...R,name:s}:R)}:$)),m){const P=((h=u.find($=>$.id===d))==null?void 0:h.name)||"the current subject";return alert(`A quiz with the name "${s}" already exists in ${P}. Please choose a different name.`),!1}return!0},Xe=(d,p)=>{b(s=>s.map(m=>{if(m.id===d){const h=m.quizzes.findIndex($=>$.id===p);if(h===-1)return m;const P=m.quizzes.filter($=>$.id!==p);if(w===p)if(P.length>0){const $=Math.min(h,P.length-1);ve(P[$].id)}else ve(null);return{...m,quizzes:P}}return m}))},Ze=(d,p)=>{b(s=>s.map(m=>m.id===d?{...m,quizzes:m.quizzes.map(h=>h.id===p?{...h,isStartable:!h.isStartable}:h)}:m))},et=d=>{x(d)},tt=(d,p,s)=>{var h,P;const m={...s,id:Te()};if(m.type==="mcq"&&m.options){m.options=m.options.map((H,Re)=>({...H,id:`option-${Te()}-${Re}`}));const $=(P=(h=s.options)==null?void 0:h.find(H=>H.id===s.correctOptionId))==null?void 0:P.text,R=m.options.find(H=>H.text===$);if(m.correctOptionId=R?R.id:void 0,!m.correctOptionId&&typeof s.correctOptionId=="string"){const H=s.correctOptionId.match(/^option-(\d+)$/);if(H&&H[1]){const Re=parseInt(H[1],10);m.options[Re]&&(m.correctOptionId=m.options[Re].id)}}!m.correctOptionId&&m.options.length>0&&(console.warn("Could not determine correct option for new MCQ, defaulting to first option."),m.correctOptionId=m.options[0].id)}b($=>$.map(R=>R.id===d?{...R,quizzes:R.quizzes.map(H=>H.id===p?{...H,questions:[...H.questions,m]}:H)}:R)),x(null)},rt=(d,p,s)=>{var m;if(s.type==="mcq"&&s.options){if(s.options=s.options.map((h,P)=>({id:h.id&&h.id.startsWith("option-")?h.id:`option-${Te()}-${P}`,text:h.text})),typeof s.correctOptionId=="string"&&!s.options.find(h=>h.id===s.correctOptionId)){const h=(m=f==null?void 0:f.options)==null?void 0:m.find(R=>R.id===s.correctOptionId),P=h==null?void 0:h.text;let $=s.options.find(R=>R.text===P);if($)s.correctOptionId=$.id;else{const R=s.correctOptionId.match(/^option-(\d+)$/);if(R&&R[1]){const H=parseInt(R[1],10);s.options[H]?s.correctOptionId=s.options[H].id:(console.warn("Correct option index out of bounds after update. Defaulting."),s.correctOptionId=s.options.length>0?s.options[0].id:void 0)}else console.warn("Correct option ID seems invalid after update and couldn't be re-mapped by text or index. Defaulting."),s.correctOptionId=s.options.length>0?s.options[0].id:void 0}}s.type==="mcq"&&s.options.length>0&&!s.options.find(h=>h.id===s.correctOptionId)&&(console.warn("Updated MCQ question has options, but correctOptionId is invalid. Defaulting to the first option."),s.correctOptionId=s.options[0].id)}b(h=>h.map(P=>P.id===d?{...P,quizzes:P.quizzes.map($=>$.id===p?{...$,questions:$.questions.map(R=>R.id===s.id?s:R)}:$)}:P)),x(null)},st=(d,p,s)=>{b(m=>m.map(h=>h.id===d?{...h,quizzes:h.quizzes.map(P=>P.id===p?{...P,questions:P.questions.filter($=>$.id!==s)}:P)}:h)),(f==null?void 0:f.id)===s&&x(null)},at=(d,p,s)=>{b(m=>m.map(h=>h.id===d?{...h,quizzes:h.quizzes.map(P=>P.id===p?{...P,questions:s}:P)}:h))},qe=()=>{b(d=>d.map(p=>({...p,quizzes:p.quizzes.map(s=>{const m=s.questions.filter(P=>P.type==="written"),h=s.questions.filter(P=>P.type==="mcq");return{...s,questions:[...m,...h]}})}))),alert("All quizzes have been successfully reordered (Written questions first, then MCQ).")},Me=d=>{const p=u.find(s=>s.id===d);O(p||null),M(null),xe(),t("QuizSelection"),ie(!1)},nt=d=>{const p=j==null?void 0:j.quizzes.find(s=>s.id===d);M(p||null),xe(),p&&Q(Array(p.questions.length).fill(null)),t("UserQuiz")},ot=()=>{O(null),M(null),xe(),t("SubjectSelection"),ie(!0)},it=()=>{M(null),xe(),t("QuizSelection")},Ce=()=>{xe(),I&&Q(Array(I.questions.length).fill(null))},N=d=>{if(J(d),I&&F==="atEnd"&&I.questions[L].type==="mcq"){const s=[...B];s[L]={selectedOptionId:d,feedback:null},Q(s)}},ae=(d,p)=>{if(I){const s=I.questions[p];if(s.type==="mcq"){const m=[...B];let h=null;F==="immediate"&&(h=d===s.correctOptionId?"Correct":"Incorrect"),m[p]={selectedOptionId:d,feedback:h},Q(m)}}},le=()=>{if(I&&F==="immediate"&&B[L]===null){const d=I.questions[L];if(d.type==="mcq"){if(!D){console.warn("Submit called for MCQ without a selection attempt.");return}const p=D===d.correctOptionId?"Correct":"Incorrect",s=[...B];s[L]={selectedOptionId:D,feedback:p},Q(s)}}},Le=()=>{if(I){const s=I.questions[L];if(G==="oneByOne"&&(s==null?void 0:s.type)==="written"&&B[L]===null){const m=[...B],h={selectedOptionId:null,feedback:"Seen"};m[L]=h,Q(m)}else if(G==="oneByOne"&&F==="atEnd"&&(s==null?void 0:s.type)==="mcq"&&D&&B[L]===null){const m=[...B],h={selectedOptionId:D,feedback:null};m[L]=h,Q(m)}}J(null);const d=G==="oneByOne"&&I&&L>=I.questions.length-1,p=G==="listed";if(d||p){if(F==="atEnd"&&I){const s=B.map((m,h)=>{if(!m&&I.questions[h].type==="written")return{selectedOptionId:null,feedback:"Seen"};if(!m)return null;const P=I.questions[h];if(P.type==="mcq"&&m.selectedOptionId&&m.feedback===null){const $=m.selectedOptionId===P.correctOptionId?"Correct":"Incorrect";return{selectedOptionId:m.selectedOptionId,feedback:$}}return m});Q(s)}else if(F==="immediate"&&p&&I){const s=B.map((m,h)=>!m&&I.questions[h].type==="written"?{selectedOptionId:null,feedback:"Seen"}:m);Q(s)}E(!0)}else G==="oneByOne"&&I&&L<I.questions.length-1&&Z(s=>s+1)},lt=()=>{if(I&&F==="atEnd"&&G==="oneByOne"&&I.questions[L].type==="mcq"&&D&&B[L]===null){const p=[...B],s={selectedOptionId:D,feedback:null};p[L]=s,Q(p)}J(null),L>0&&Z(d=>d-1)},oe=u.find(d=>d.id===g),Ae=oe==null?void 0:oe.quizzes.find(d=>d.id===w);let be=mt;const Fe=o==="AdminPanel"&&r;if(Fe?be=Ae?`Admin: ${(oe==null?void 0:oe.name)||"Unknown Subject"} > ${Ae.name}`:oe?`Admin: ${oe.name}`:"Admin: Subject Management":o==="UserQuiz"&&I?be=`${(j==null?void 0:j.name)||"Quiz"}: ${I.name}`:o==="QuizSelection"&&j?be=`${j.name}: Select Quiz`:be=mt,y)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-[var(--bg-primary)] p-4 text-center",children:[e.jsx("div",{className:"h-20 w-20 rounded-full flex items-center justify-center bg-[var(--text-primary)] mb-6 shadow-md","aria-label":"App Logo Q",children:e.jsx("span",{className:"text-[var(--bg-primary)] font-bold text-4xl select-none",style:{fontFamily:"Roboto, sans-serif"},children:"Q"})}),e.jsx("h1",{className:"text-3xl font-bold text-[var(--text-primary)] mb-4",children:"Loading Application Data"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce"})]}),C&&e.jsx("p",{className:"text-[var(--text-secondary)] text-sm mt-3",children:C})]});const ue=`flex-grow p-4 sm:p-6 lg:p-8 max-w-5xl w-full mx-auto ${o==="UserQuiz"||o==="QuizSelection"?"pt-4 sm:pt-6":"pt-2 sm:pt-3"}`,ze=()=>{switch(o){case"AdminPanel":return r?e.jsx(tr,{subjects:u,allSubjectsData:u,activeSubjectId:g,activeQuizId:w,editingQuestion:f,setEditingQuestion:et,onSetActiveSubjectId:me,onCreateSubject:Ve,onUpdateSubjectName:We,onDeleteSubject:Ye,onSetActiveQuizId:ve,onCreateQuiz:Je,onUpdateQuizName:Ke,onDeleteQuiz:Xe,onToggleQuizStartable:Ze,onAddQuestion:tt,onUpdateQuestion:rt,onDeleteQuestion:st,onReorderQuestions:at,onReorderAllQuizzesByTypeGlobal:qe,maxOptions:nr,showManageSubjectsSection:te,setShowManageSubjectsSection:K,showManageQuizzesSection:ne,setShowManageQuizzesSection:de,activeAdminSubject:oe,activeAdminQuiz:Ae,githubPat:a,setGithubPat:c}):e.jsx(gt,{subjects:u,onSelectSubject:Me,playAnimation:we,onAnimationComplete:()=>ie(!1)});case"UserQuiz":return I?e.jsx(Bt,{quiz:I,currentQuestionIndex:L,userAnswers:B,currentUserSelectionAttempt:D,isQuizComplete:q,onOptionSelect:N,onListedOptionSelect:ae,onSubmitAnswer:le,onNextQuestion:Le,onPreviousQuestion:lt,onBackToQuizList:it,onRestartQuiz:Ce,userCorrectionMode:F,userQuestionDisplayMode:G,onTogglePrefsModal:Ee}):(t("QuizSelection"),null);case"QuizSelection":return j?e.jsx(Ut,{subject:j,onSelectQuiz:nt,onBackToSubjectList:ot}):(t("SubjectSelection"),null);case"SubjectSelection":default:return e.jsx(gt,{subjects:u,onSelectSubject:Me,playAnimation:we,onAnimationComplete:()=>ie(!1)})}};return e.jsxs(e.Fragment,{children:[e.jsx(Dt,{contextTitle:be,isAdminView:Fe,isAdminAuthenticated:r,currentAppViewMode:o,onSwitchToAdminView:ft,onSwitchToUserView:$e,onAdminLogout:Oe,dataTimestamp:z,onShowTimestampModal:De}),e.jsx("main",{className:ue,children:ze()}),e.jsx(Et,{appName:mt}),V&&e.jsx(qt,{onLogin:Ne,onClose:Se,error:l}),X&&z&&e.jsx(rr,{isOpen:X,onClose:De,timestamp:z}),ee&&e.jsx(sr,{isOpen:ee,onClose:Ee,currentCorrectionMode:F,onSetCorrectionMode:Ge,currentQuestionDisplayMode:G,onSetQuestionDisplayMode:He})]})},Ct=document.getElementById("app-root");Ct?zt.createRoot(Ct).render(e.jsx(ir,{})):console.error("Failed to find the root element with ID 'app-root'");

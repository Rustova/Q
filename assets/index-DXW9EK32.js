import{j as e,r as o}from"./react-ZpOpdbvF.js";import{r as ve,a as It}from"./react-dom-BFJMa1Yr.js";import{E as Pt}from"./jspdf-BVD6OXYK.js";import{D as Et,C as $t,P as Ot}from"./@hello-pangea-BHoMb5q8.js";import"./core-js--yVVgAJ6.js";import"./scheduler-SPyfQU6S.js";import"./@babel-CpGVvVoG.js";import"./fflate-BO5HMHBV.js";import"./redux-CqoN-cwI.js";import"./react-redux-DzurNSeR.js";import"./use-sync-external-store-DGADeII1.js";import"./css-box-model-SSI6wf-B.js";import"./tiny-invariant-BaFNuDhB.js";import"./raf-schd-CmoV45_-.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const d of s)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&t(p)}).observe(document,{childList:!0,subtree:!0});function i(s){const d={};return s.integrity&&(d.integrity=s.integrity),s.referrerPolicy&&(d.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?d.credentials="include":s.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function t(s){if(s.ep)return;s.ep=!0;const d=i(s);fetch(s.href,d)}})();const Dt=r=>{if(!r)return null;try{const l=new Date(r);if(isNaN(l.getTime()))return console.warn("Invalid date string received for formatting:",r),{timeDescription:"Invalid Date",tooltip:r};const t=Math.round((new Date().getTime()-l.getTime())/1e3),s=l.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})+", "+l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});let d;if(t<0){const p=l.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),x=l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});d=`${p}, ${x}`}else if(t<60)d="just now";else if(t<3600)d=`${Math.floor(t/60)} min ago`;else if(t<86400)d=`${Math.floor(t/3600)} h ago`;else{const p=l.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),x=l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});d=`${p}, ${x}`}return{timeDescription:d,tooltip:s}}catch(l){return console.error("Error formatting date:",l),{timeDescription:"Error in timestamp",tooltip:r||"Error formatting timestamp"}}},Ft=()=>e.jsx("div",{className:"h-14 w-14 sm:h-16 sm:w-16 rounded-full border-2 border-[var(--bg-header)] shadow-md transition-transform duration-200 ease-in-out hover:scale-110 flex items-center justify-center bg-[var(--text-primary)] shrink-0","aria-label":"App Logo Q",children:e.jsx("span",{className:"text-[var(--bg-primary)] font-bold text-[2rem] sm:text-[2.4rem] select-none",style:{fontFamily:"Roboto, sans-serif"},children:"Q"})}),Rt=({contextTitle:r,isAdminView:l,isAdminAuthenticated:i,currentAppViewMode:t,onSwitchToAdminView:s,onSwitchToUserView:d,onAdminLogout:p,dataTimestamp:x,onShowTimestampModal:k})=>{const v=Dt(x),y="211, 195, 185",j=l&&i&&e.jsx("button",{onClick:p,className:"p-2.5 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white border border-[var(--accent-red-hover)] rounded-full transition-colors shrink-0 text-xs sm:text-sm flex items-center justify-center h-9 w-9 sm:h-10 sm:w-10 focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)] focus:ring-offset-2 focus:ring-offset-[var(--bg-header)]","aria-label":"Logout from Admin Panel",title:"Admin Logout",children:e.jsx("i",{className:"fa-solid fa-right-from-bracket fa-fw text-base"})}),C=l?e.jsxs("button",{onClick:d,className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-transparent hover:bg-[var(--text-primary)] text-[var(--text-primary)] hover:text-[var(--bg-primary)] border border-[var(--text-primary)] rounded-md transition-colors shrink-0 text-xs sm:text-sm flex items-center","aria-label":"Switch to User View",children:[e.jsx("i",{className:"fa-solid fa-user-graduate fa-fw mr-1.5 sm:mr-2"}),e.jsx("span",{children:"User View"})]}):e.jsxs("button",{onClick:s,className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-transparent hover:bg-[var(--text-primary)] text-[var(--text-primary)] hover:text-[var(--bg-primary)] border border-[var(--text-primary)] rounded-md transition-colors shrink-0 text-xs sm:text-sm flex items-center","aria-label":"Switch to Admin Panel",children:[e.jsx("i",{className:"fa-solid fa-headset mr-1.5 sm:mr-2"}),e.jsx("span",{children:"Admin Panel"})]}),z=v&&e.jsx("button",{onClick:k,className:"text-[var(--text-primary)] text-[0.6rem] sm:text-xs opacity-80 hover:opacity-100 cursor-pointer focus:outline-none focus:ring-1 focus:ring-[var(--text-primary)] rounded p-0.5",title:v.tooltip,"aria-label":`Content update details: ${v.tooltip}`,children:e.jsx("span",{className:"block",children:`last updated : ${v.timeDescription}`})});return e.jsx("header",{className:"bg-[var(--bg-header)] sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between pb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[" ",e.jsx(Ft,{}),z]}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[j,C]})]}),e.jsx("div",{style:{height:"1px",width:"100%",backgroundImage:`linear-gradient(to right, transparent, rgba(${y},0.5) 25%, rgba(${y},0.5) 75%, transparent)`}}),e.jsx("div",{className:"text-center pt-2.5",children:e.jsx("span",{className:"text-[var(--text-primary)] text-sm sm:text-base font-semibold truncate block",title:r,children:r})})]})})},Lt=({appName:r})=>{const l=new Date().getFullYear();return e.jsx("footer",{className:"bg-[var(--bg-secondary)] text-[var(--text-secondary)] text-center py-4 sm:py-5 border-t border-[var(--border-color)]",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6",children:e.jsxs("p",{className:"text-xs sm:text-sm",children:["© ",l," ",r,". Made with ",e.jsx("i",{className:"fa-solid fa-heart text-[var(--accent-red)] animate-heartbeat"})]})})})},Mt=({onLogin:r,onClose:l,error:i})=>{const[t,s]=o.useState(""),d=k=>{k.preventDefault(),r(t)},p=e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"admin-login-title",children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",children:[e.jsx("h2",{id:"admin-login-title",className:"text-2xl font-semibold text-[var(--accent-primary)] mb-6 text-center",children:"Admin Login"}),e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"adminPassword",className:"block text-sm font-medium text-[var(--text-secondary)] mb-1",children:"Password"}),e.jsx("input",{type:"password",id:"adminPassword",value:t,onChange:k=>s(k.target.value),className:"w-full p-3 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)] text-[var(--input-text)] focus:ring-2 focus:ring-[var(--input-focus-ring)] focus:border-[var(--input-focus-ring)] placeholder-[var(--placeholder-color)]",placeholder:"Enter admin password",required:!0})]}),i&&e.jsx("p",{className:"text-red-500 text-sm text-center -mt-2",children:i}),e.jsxs("div",{className:"flex flex-col sm:flex-row-reverse gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Login"}),e.jsx("button",{type:"button",onClick:l,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Cancel"})]})]})]})}),x=document.getElementById("modal-root");return x?ve.createPortal(p,x):(console.error("Modal root element 'modal-root' not found."),null)},qt=({isOpen:r,onClose:l,allQuizzes:i,initiallySelectedQuizIds:t,onApplySelection:s})=>{const[d,p]=o.useState([]);o.useEffect(()=>{r&&p([...t])},[r,t]);const x=o.useMemo(()=>i.reduce((g,E)=>{const I=E.subjectId;return g[I]||(g[I]={subjectName:E.subjectName,quizzes:[]}),g[I].quizzes.push(E),g},{}),[i]);if(!r)return null;const k=g=>{p(E=>E.includes(g)?E.filter(I=>I!==g):[...E,g])},v=()=>{const g=i.map(E=>E.id);p(g)},y=()=>{p([])},j=()=>{s(d)},C=()=>d.length===0?"No quizzes selected. All quizzes from chosen subjects will be included if applied now.":d.length===i.length&&i.length>0?`All ${i.length} available quizzes selected.`:`${d.length} of ${i.length} available quizzes selected.`,z=document.getElementById("modal-root");return z?ve.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[51] p-4",role:"dialog","aria-modal":"true","aria-labelledby":"quiz-multiselect-modal-title",onClick:l,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:g=>g.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl shrink-0",children:[e.jsx("h2",{id:"quiz-multiselect-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:"Select Quizzes for Export"}),e.jsx("button",{onClick:l,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close quiz selection modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 overflow-y-auto custom-scrollbar flex-grow",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-3",children:[e.jsx("p",{className:"text-sm text-[var(--text-secondary)] p-2 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md flex-grow",children:C()}),e.jsxs("div",{className:"flex space-x-2 shrink-0",children:[e.jsx("button",{onClick:v,disabled:i.length===0,className:"px-3 py-1.5 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors disabled:opacity-50",children:"Select All"}),e.jsx("button",{onClick:y,disabled:i.length===0||d.length===0,className:"px-3 py-1.5 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors disabled:opacity-50",children:"Deselect All"})]})]}),i.length===0?e.jsx("p",{className:"text-center text-[var(--text-secondary)] py-4",children:"No quizzes available from selected subjects to choose from."}):e.jsx("div",{className:"space-y-3 max-h-[calc(85vh-260px)] overflow-y-auto custom-scrollbar pr-2",children:Object.entries(x).map(([g,{subjectName:E,quizzes:I}])=>e.jsxs("div",{className:"py-1",children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--accent-primary)] mb-1.5 pb-1 border-b border-[var(--border-color)]",children:E}),e.jsx("div",{className:"space-y-1.5",children:I.map($=>{const H=d.includes($.id);return e.jsxs("label",{className:`flex items-center space-x-3 p-2.5 rounded-md transition-all duration-150 text-sm border cursor-pointer 
                            ${H?"bg-[var(--accent-primary)] bg-opacity-25 border-[var(--accent-primary)] text-[var(--text-primary)] font-medium":"bg-[var(--bg-primary)] border-[var(--border-color)] text-[var(--text-secondary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-10 hover:border-[var(--accent-secondary)]"}`,title:`${$.subjectName} - ${$.name}`,children:[e.jsx("input",{type:"checkbox",checked:H,onChange:()=>k($.id),className:"h-4 w-4 text-[var(--accent-primary)] bg-transparent border-[var(--input-border)] rounded focus:ring-1 focus:ring-offset-0 focus:ring-[var(--accent-primary)] shrink-0"}),e.jsx("span",{className:"truncate flex-grow text-left",children:$.name})]},$.id)})})]},g))})]}),e.jsxs("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-between items-center shrink-0",children:[e.jsx("button",{onClick:y,className:"px-4 py-2 text-sm font-medium bg-transparent hover:bg-[var(--accent-red)] hover:bg-opacity-20 text-[var(--accent-red)] border border-[var(--accent-red)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]",children:"Clear Current Selection"}),e.jsxs("div",{className:"space-x-3",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)]",children:"Cancel"}),e.jsx("button",{onClick:j,disabled:i.length===0&&d.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50",children:"Apply Selection"})]})]})]})}),z):(console.error("Modal root element 'modal-root' not found for QuizMultiSelectModal."),null)},wt={title:"#233239",questionText:"#000000",answerText:"#474747",correctAnswer:"#48BB78",modelAnswerLabel:"#1a202c",modelAnswerHighlightColor:"#cccccc"},Ut="p-2 border rounded-md focus:ring-1 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)] text-sm",We="block text-sm font-medium text-[var(--text-secondary)] mb-1",Ye="text-md font-semibold text-[var(--accent-primary)] mb-2",Ie=595.28,Se=841.89,me=40,he=Ie-2*me,ge=1.4,jt="#000000",Je=18,Ke=135,Bt=({isOpen:r,onClose:l,subjects:i})=>{const[t,s]=o.useState({showAnswers:!0,fontSize:12,colors:{...wt},selectedSubjectIds:[],modelAnswerHighlightOpacity:.3}),[d,p]=o.useState(!1),[x,k]=o.useState(!1),[v,y]=o.useState(!1),[j,C]=o.useState(null);o.useEffect(()=>{r&&(s({showAnswers:!0,fontSize:12,colors:{...wt},selectedSubjectIds:i.map(n=>n.id),modelAnswerHighlightOpacity:.3}),p(!1),k(!1),y(!1),C(null))},[r,i]);const z=o.useMemo(()=>{if(!r)return[];const n=[];return i.forEach(c=>{t.selectedSubjectIds.includes(c.id)&&c.quizzes.filter(S=>S.isStartable).forEach(S=>{n.push({id:S.id,name:S.name,subjectName:c.name,subjectId:c.id})})}),n},[i,t.selectedSubjectIds,r]);if(!r&&!v)return null;const g=n=>{const{name:c,value:S,type:w}=n.target;if(w==="checkbox"){const{checked:N}=n.target;s(J=>({...J,[c]:N}))}else w==="number"||n.target.step==="0.05"?s(N=>({...N,[c]:parseFloat(S)})):s(N=>({...N,[c]:S}))},E=(n,c)=>{s(S=>({...S,colors:{...S.colors,[n]:c}}))},I=n=>{s(c=>{const S=c.selectedSubjectIds.includes(n)?c.selectedSubjectIds.filter(w=>w!==n):[...c.selectedSubjectIds,n];return C(null),{...c,selectedSubjectIds:S}})},$=()=>{if(t.selectedSubjectIds.length===0){alert("Please select at least one subject before selecting specific quizzes.");return}y(!0)},H=n=>{C(n.length>0?n:null),y(!1)},Y=async(n,c)=>{let S;try{S=await fetch(n)}catch(N){throw console.error(`Network error loading file ${n}:`,N),new Error(`Network error loading file ${n}: ${N instanceof Error?N.message:String(N)}`)}if(!S.ok){const N=await S.text().catch(()=>"Could not retrieve error body.");throw console.error(`Failed to load file ${n}: ${S.status} ${S.statusText}. Body: ${N.substring(0,200)}`),new Error(`Failed to load file ${n}: ${S.status} ${S.statusText}`)}const w=S.headers.get("Content-Type");try{const N=await S.blob();return new Promise((J,D)=>{const W=new FileReader;W.onloadend=()=>{let F=W.result;const K="data:application/octet-stream;base64,",U=c.startsWith("data:image/");if(F.startsWith(c))J(F);else if(U&&F.startsWith(K))console.warn(`File ${n} (expected ${c}) was received as octet-stream. Correcting MIME type for PDF.`),F=c+F.substring(K.length),J(F);else{const _=F.substring(0,Math.min(F.indexOf(";")+8,F.length,50))+"...",M=`File ${n} loaded with unexpected type. Expected prefix: ${c}, but got: ${_} (Full Content-Type from server: ${w||"N/A"}). Check if the file is correct and accessible.`;console.error(M),D(new Error(M))}},W.onerror=F=>{var U,_;const K=`FileReader error for ${n}: ${((_=(U=F.target)==null?void 0:U.error)==null?void 0:_.message)||"Unknown FileReader error"}`;console.error(K,F),D(new Error(K))},W.readAsDataURL(N)})}catch(N){throw console.error(`Error processing blob for ${n}:`,N),new Error(`Error processing blob for ${n}: ${N instanceof Error?N.message:String(N)}`)}},se=async()=>{if(t.selectedSubjectIds.length===0){alert("Please select at least one subject to include in the PDF.");return}p(!0);let n=!1;try{const c=new Pt({orientation:"p",unit:"pt",format:"a4"});try{const M=await Y("https://rustova.github.io/Q/assets/Amiri-Regular.ttf","data:font/ttf;base64,"),O=M.substring(M.indexOf(",")+1);c.addFileToVFS("Amiri-Regular.ttf",O),c.addFont("Amiri-Regular.ttf","Amiri","normal"),c.addFont("Amiri-Regular.ttf","Amiri","bold"),c.setFont("Amiri","normal"),n=!0,k(!0)}catch(M){console.warn("Failed to load Amiri-Regular.ttf. PDF will be generated with default fonts.",M),c.setFont("Helvetica","normal")}const S=await Y("https://rustova.github.io/Q/assets/main.PNG","data:image/png;base64,"),w=await Y("https://rustova.github.io/Q/assets/regular.PNG","data:image/png;base64,");let N=me;const J=t.fontSize*1.5,D=(M,O,L=!1)=>{c.setFontSize(M),c.setTextColor(O),n?c.setFont("Amiri",L?"bold":"normal"):c.setFont("Helvetica",L?"bold":"normal")},W=(M=t.fontSize*ge)=>{N+M>Se-me&&(c.addPage(),c.addImage(w,"PNG",0,0,Ie,Se,void 0,"FAST"),N=Ke)},F=(M,O,L,B,Q,ae=!1,re=!1,ee)=>{n?c.setFont("Amiri",ae?"bold":"normal"):c.setFont("Helvetica",ae?"bold":"normal"),c.setFontSize(B);const X=c.splitTextToSize(M,L),oe=re?ge*1.1:ge,ce=B*oe,de=X.length*ce;if(re||W(de),ee&&X.some(ne=>ne.trim()!=="")){c.saveGraphicsState(),c.setFillColor(ee.color),c.setGState(new c.GState({opacity:ee.opacity}));for(let ne=0;ne<X.length;ne++){const ie=X[ne];if(ie.trim()!==""){const ue=N+ne*ce,le=c.getStringUnitWidth(ie)*B/c.internal.scaleFactor,xe=B*1.05,be=ue-B*.82;c.rect(O,be,le,xe,"F")}}c.restoreGraphicsState()}c.setTextColor(Q),c.text(X,O,N),N+=de,re||(N+=B*(ge*.15))};c.addImage(S,"PNG",0,0,Ie,Se,void 0,"FAST"),N=416+Je*ge*1.1,D(Je,jt,!0),c.text("Subjects included:",28,416);const K=i.filter(M=>t.selectedSubjectIds.includes(M.id));K.length>0&&K.forEach(M=>{let O=N;O+Je*ge*1.1>Se-me&&(c.addPage(),c.addImage(w,"PNG",0,0,Ie,Se,void 0,"FAST"),N=Ke,O=N),F(`- ${M.name}`,me+20,he-20,Je,jt,!1,!0)});let U=[];i.forEach(M=>{t.selectedSubjectIds.includes(M.id)&&M.quizzes.filter(O=>O.isStartable&&O.questions.length>0).forEach(O=>{(j===null||j.includes(O.id))&&U.push({...O,subjectName:M.name,subjectId:M.id})})});let _=!0;for(const M of U){if(_)c.addPage(),c.addImage(w,"PNG",0,0,Ie,Se,void 0,"FAST"),N=Ke,_=!1;else{const L=J*ge+t.fontSize*1.2*ge;W(L)}const O=he-(70-me);F(M.subjectName,70,O,J,t.colors.title,!0),N+=t.fontSize*.2,F(M.name,me,he,t.fontSize*1.2,t.colors.title,!0),N+=t.fontSize*.7,M.questions.forEach((L,B)=>{F(`${B+1}. ${L.questionText}`,me,he,t.fontSize,t.colors.questionText),N+=t.fontSize*.3,L.type==="mcq"&&L.options?L.options.forEach((Q,ae)=>{let ee=`${String.fromCharCode(65+ae)}. ${Q.text}`,X=t.colors.answerText;t.showAnswers&&Q.id===L.correctOptionId&&(X=t.colors.correctAnswer),F(ee,me+20,he-20,t.fontSize*.9,X),N+=t.fontSize*.1}):L.type==="written"&&t.showAnswers&&L.modelAnswer&&L.modelAnswer.trim()!==""&&(N+=t.fontSize*.2,F("Model Answer:",me+10,he-10,t.fontSize*.85,t.colors.modelAnswerLabel,!0),F(L.modelAnswer,me+20,he-20,t.fontSize*.9,t.colors.answerText,!1,!1,{color:t.colors.modelAnswerHighlightColor,opacity:t.modelAnswerHighlightOpacity}),N+=t.fontSize*.1),N+=t.fontSize*.5})}U.length===0&&t.selectedSubjectIds.length>0&&(_&&(c.addPage(),c.addImage(w,"PNG",0,0,Ie,Se,void 0,"FAST")),N=Ke,F("No quizzes match the current selection criteria.",me,he,t.fontSize,t.colors.questionText)),c.save("Quiz_Export.pdf")}catch(c){console.error("Error generating PDF:",c),alert(`Failed to generate PDF. Check console for details. Error: ${c instanceof Error?c.message:String(c)}`)}finally{p(!1),l()}},te=document.getElementById("modal-root");if(!te&&r)return console.error("Modal root element 'modal-root' not found for PdfPreferencesModal."),null;if(!r)return null;const b=[{key:"title",label:"Title Color (Content)"},{key:"questionText",label:"Question Text Color"},{key:"answerText",label:"Answer Text Color"},{key:"correctAnswer",label:"Correct Answer Highlight"},{key:"modelAnswerLabel",label:"Model Answer Label Color"},{key:"modelAnswerHighlightColor",label:"Model Ans. Highlight Bg"}],T=()=>j===null?"Select Specific Quizzes... (All from selected subjects)":j.length===0?"Select Specific Quizzes... (None selected)":`${j.length} Quizzes Selected`;return ve.createPortal(e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"pdf-prefs-modal-title",onClick:d?void 0:l,children:[e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:n=>n.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl shrink-0",children:[e.jsx("h2",{id:"pdf-prefs-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:"PDF Export Preferences"}),e.jsx("button",{onClick:d?void 0:l,disabled:d,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)] disabled:opacity-50","aria-label":"Close PDF preferences modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-5 overflow-y-auto custom-scrollbar flex-grow",children:[e.jsxs("fieldset",{disabled:d,children:[e.jsx("legend",{className:Ye,children:"General Options"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 items-end",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)]",children:[e.jsx("input",{type:"checkbox",id:"showAnswers",name:"showAnswers",checked:t.showAnswers,onChange:g,className:"h-4 w-4 text-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] rounded cursor-pointer"}),e.jsx("label",{htmlFor:"showAnswers",className:"text-sm text-[var(--input-text)] cursor-pointer",children:"Show Answers in PDF"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fontSize",className:We,children:"Base Font Size (Content)"}),e.jsx("input",{type:"number",id:"fontSize",name:"fontSize",value:t.fontSize,onChange:g,min:"8",max:"32",step:"1",className:`${Ut} w-full`})]})]})]}),e.jsxs("fieldset",{disabled:d,children:[e.jsx("legend",{className:Ye,children:"Written Answer Highlight (PDF)"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"modelAnswerHighlightColor",className:We,children:"Highlight Background Color"}),e.jsx("input",{type:"color",id:"modelAnswerHighlightColor",name:"modelAnswerHighlightColor",value:t.colors.modelAnswerHighlightColor,onChange:n=>E("modelAnswerHighlightColor",n.target.value),className:"w-full h-9 p-0.5 border rounded-md cursor-pointer bg-[var(--input-bg)] border-[var(--input-border)] focus:outline-none focus:ring-1 focus:ring-[var(--input-focus-ring)]"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"modelAnswerHighlightOpacity",className:We,children:["Highlight Opacity: ",e.jsx("span",{className:"font-mono text-[var(--accent-primary)]",children:t.modelAnswerHighlightOpacity.toFixed(2)})]}),e.jsx("input",{type:"range",id:"modelAnswerHighlightOpacity",name:"modelAnswerHighlightOpacity",min:"0",max:"1",step:"0.05",value:t.modelAnswerHighlightOpacity,onChange:g,className:"w-full h-5 accent-[var(--accent-primary)] bg-[var(--input-bg)] rounded-lg appearance-none cursor-pointer"})]})]})]}),e.jsxs("fieldset",{disabled:d,children:[e.jsx("legend",{className:Ye,children:"Color Scheme (Content Pages Text)"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-3",children:b.filter(n=>n.key!=="modelAnswerHighlightColor").map(n=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:n.key,className:`${We} truncate`,title:n.label,children:n.label}),e.jsx("input",{type:"color",id:n.key,name:n.key,value:t.colors[n.key],onChange:c=>E(n.key,c.target.value),className:"w-full h-9 p-0.5 border rounded-md cursor-pointer bg-[var(--input-bg)] border-[var(--input-border)] focus:outline-none focus:ring-1 focus:ring-[var(--input-focus-ring)]"})]},n.key))})]}),e.jsxs("fieldset",{disabled:d,children:[e.jsx("legend",{className:Ye,children:"Select Content"}),i.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3 items-center",children:e.jsx("button",{onClick:$,disabled:t.selectedSubjectIds.length===0,className:"px-3 py-1.5 text-xs bg-[var(--accent-primary)] hover:bg-[var(--accent-primary-hover)] text-[var(--btn-primary-text)] rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed truncate max-w-xs",title:T(),children:T()})}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 pr-2 custom-scrollbar border border-[var(--input-border)] bg-[var(--input-bg)] rounded-md p-3",children:i.map(n=>{const c=n.quizzes.filter(S=>S.isStartable).length;return e.jsxs("label",{className:"flex items-center space-x-2 p-2 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md cursor-pointer hover:bg-[var(--accent-secondary)] hover:bg-opacity-10",children:[e.jsx("input",{type:"checkbox",checked:t.selectedSubjectIds.includes(n.id),onChange:()=>I(n.id),className:"h-4 w-4 text-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] rounded"}),e.jsx("span",{className:"text-sm text-[var(--input-text)] flex-grow truncate",title:n.name,children:n.name}),e.jsxs("span",{className:"text-xs text-[var(--text-secondary)] shrink-0",children:["(",c," quiz",c!==1?"zes":"",")"]})]},n.id)})}),t.selectedSubjectIds.length===0&&e.jsx("p",{className:"text-xs text-[var(--text-secondary)] italic mt-1",children:"Select subjects to enable quiz selection."})]}):e.jsx("p",{className:"text-sm text-[var(--text-secondary)]",children:"No subjects available to select."})]})]}),e.jsxs("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-end space-x-3 shrink-0",children:[e.jsx("button",{onClick:d?void 0:l,disabled:d,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:se,disabled:d||i.length===0||t.selectedSubjectIds.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50 flex items-center justify-center min-w-[120px]",children:d?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"Generating..."]}):"Generate PDF"})]})]}),v&&e.jsx(qt,{isOpen:v,onClose:()=>y(!1),allQuizzes:z,initiallySelectedQuizIds:j||[],onApplySelection:H})]}),te)},_t=500,St=({subjects:r,onSelectSubject:l,playAnimation:i,onAnimationComplete:t})=>{const[x,k]=o.useState(!1),[v,y]=o.useState("idle"),j=o.useRef(null),C=o.useRef(null),[z,g]=o.useState(!1),E=o.useRef(null),I=()=>{k(!0)},$=()=>{k(!1)};let H=0,Y=0,se=0;r.length===0&&(H=.1+.1,Y=H+.1,se=Y+.1);const te=o.useMemo(()=>{if(r.length===0)return se+.075+.2;{let b;const T=.2+(r.length-1)*.075;return r.length<4?b=.2+r.length*.075:b=T,b+.075+.2}},[r.length,.1,.075,4,se]);return o.useEffect(()=>{if(j.current&&!C.current&&r.length>0&&!z){const b=te*1e3+_t+300,T=setTimeout(()=>{j.current&&(C.current=j.current.getBoundingClientRect(),g(!0))},b);return()=>clearTimeout(T)}r.length===0&&z&&(g(!1),C.current=null,y("idle"))},[r.length,te,z]),o.useEffect(()=>{const b=document.getElementById("shine-sound");b&&(E.current=b)},[]),o.useEffect(()=>{i&&v==="idle"&&z&&r.length>0&&j.current&&j.current&&y("growing");const b=j.current;if(!b)return;const T=C.current;if(!T&&["growing","shining","returning"].includes(v)){console.error("Animation stage attempted without initial rect. Resetting."),y("idle"),g(!1),i&&t();return}let n;b.classList.remove("pdf-button-growing","pdf-button-shining","pdf-button-returning");const c=T?window.innerWidth/2-(T.left+T.width/2):0,S=T?window.innerHeight/2-(T.top+T.height/2):0;if(v==="growing"){if(!T)return;b.style.position="fixed",b.style.top=`${T.top}px`,b.style.left=`${T.left}px`,b.style.width=`${T.width}px`,b.style.height=`${T.height}px`,b.style.margin="0",b.style.zIndex="1000",b.style.transformOrigin="center center",b.style.setProperty("--translate-to-center-x",`${c}px`),b.style.setProperty("--translate-to-center-y",`${S}px`),b.style.transform="translate(0px, 0px) scale(1)",b.offsetWidth,b.classList.add("pdf-button-growing"),n=window.setTimeout(()=>{y("shining")},800)}else if(v==="shining"){if(!T)return;b.style.position="fixed",b.style.top=`${T.top}px`,b.style.left=`${T.left}px`,b.style.width=`${T.width}px`,b.style.height=`${T.height}px`,b.style.margin="0",b.style.zIndex="1000",b.style.transformOrigin="center center",b.style.transform="translate(var(--translate-to-center-x), var(--translate-to-center-y)) scale(1.5)",b.style.overflow="hidden",b.offsetWidth,b.classList.add("pdf-button-shining"),E.current&&(E.current.currentTime=0,E.current.play().catch(w=>console.warn("Audio play failed:",w.name,w.message))),n=window.setTimeout(()=>{y("returning")},1500)}else if(v==="returning"){if(!T)return;b.style.overflow="",b.offsetWidth,b.classList.add("pdf-button-returning"),n=window.setTimeout(()=>{y("finished")},600)}else v==="finished"&&(b.style.transform="translate(0px, 0px) scale(1)",b.offsetWidth,b.style.position="",b.style.top="",b.style.left="",b.style.width="",b.style.height="",b.style.margin="",b.style.zIndex="",b.style.transformOrigin="",b.style.overflow="",b.style.removeProperty("--translate-to-center-x"),b.style.removeProperty("--translate-to-center-y"),b.style.transform="",t(),y("idle"));return()=>{window.clearTimeout(n)}},[i,v,z,r.length,t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full max-w-2xl mx-auto px-4 sm:px-6 pb-4 sm:pb-6 flex flex-col flex-grow",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-primary)] text-center mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)] mt-4 sm:mt-6 shrink-0 animate-fadeInUp",style:{animationDelay:`${.1}s`},children:"Select a Subject"}),r.length===0?e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center py-10 px-4",children:[e.jsx("i",{className:"fa-solid fa-box-open text-5xl sm:text-6xl text-[var(--text-secondary)] opacity-60 mb-6 animate-fadeInUp",style:{animationDelay:`${H}s`}}),e.jsx("p",{className:"text-xl sm:text-2xl font-semibold text-[var(--text-primary)] mb-2 animate-fadeInUp",style:{animationDelay:`${Y}s`},children:"It's a bit quiet here..."}),e.jsx("p",{className:"text-sm sm:text-md text-[var(--text-secondary)] max-w-md animate-fadeInUp",style:{animationDelay:`${se}s`},children:"No subjects are available at the moment. Administrators can add new subjects and quizzes through the Admin Panel. Please check back soon!"})]}):e.jsxs("div",{className:`flex-grow flex flex-col items-center ${r.length<4?"justify-center":"justify-start"}`,children:[e.jsx("div",{className:"w-full space-y-3 py-4",children:r.map((b,T)=>{const n=b.quizzes.filter(S=>S.isStartable).length,c=.1+.1+T*.075;return e.jsxs("button",{onClick:()=>l(b.id),className:"w-full text-left p-4 bg-[var(--bg-primary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20 border border-[var(--border-color)] hover:border-[var(--accent-secondary)] rounded-lg text-[var(--text-primary)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] animate-fadeInUp",style:{animationDelay:`${c}s`},"aria-label":`Select subject: ${b.name}, ${n} quiz${n!==1?"zes":""} available`,children:[e.jsx("span",{className:"text-lg font-semibold text-[var(--accent-primary)]",children:b.name}),e.jsxs("span",{className:"block text-sm text-[var(--text-secondary)] mt-1",children:[n," quiz",n!==1?"zes":""," available"]})]},b.id)})}),r.length<4&&e.jsx("p",{className:"text-center text-xs sm:text-sm text-[var(--text-secondary)] mt-4 mb-4 italic animate-fadeInUp",style:{animationDelay:`${.1+.1+r.length*.075}s`},children:"More subjects and quizzes are on the way. Stay tuned!"})]}),e.jsx("div",{className:"mt-auto pt-6 border-t border-[var(--border-color)] text-center animate-fadeInUp",style:{animationDelay:`${te}s`},children:e.jsxs("button",{ref:j,onClick:I,className:"px-6 py-3 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-lg transition-colors text-sm font-medium focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] flex items-center justify-center mx-auto","aria-label":"Open PDF export preferences",disabled:v!=="idle"&&v!=="finished",children:[e.jsx("i",{className:"fa-solid fa-file-pdf fa-lg mr-2.5"}),"Export Quizzes to PDF"]})})]}),e.jsx(Bt,{isOpen:x,onClose:$,subjects:r})]})},Qt=({subject:r,onSelectQuiz:l,onBackToSubjectList:i})=>{const t=r.quizzes.filter(s=>s.isStartable);return e.jsxs("div",{className:"w-full p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)]",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-primary)] truncate mb-2 sm:mb-0",title:`Quizzes in ${r.name}`,children:["Quizzes in ",r.name]}),e.jsx("button",{onClick:i,className:"px-4 py-2 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors text-sm sm:text-base w-full sm:w-auto focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]","aria-label":"Back to subject list",children:"← Back to Subject List"})]}),r.quizzes.length===0?e.jsx("p",{className:"text-lg text-[var(--text-secondary)] text-center py-6",children:"No quizzes created yet for this subject."}):t.length===0?e.jsx("p",{className:"text-lg text-[var(--text-secondary)] text-center py-6",children:"No quizzes are currently available for users in this subject. Please check back later."}):e.jsx("div",{className:"space-y-3",children:t.map(s=>e.jsxs("button",{onClick:()=>l(s.id),className:"quiz-select-button w-full text-left p-4 bg-[var(--bg-primary)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-30 border border-[var(--border-color)] hover:border-[var(--accent-secondary)] rounded-lg text-[var(--text-primary)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]","aria-label":`Select quiz: ${s.name}, ${s.questions.length} question${s.questions.length!==1?"s":""}`,children:[e.jsx("span",{className:"text-lg font-semibold text-[var(--accent-primary)]",children:s.name}),e.jsxs("span",{className:"block text-sm text-[var(--text-secondary)] mt-1",children:[s.questions.length," question",s.questions.length!==1?"s":""]})]},s.id))})]})},Nt=({question:r,questionNumber:l,selectedOptionId:i,isSubmitted:t,onOptionSelect:s,correctOptionIdForDisplay:d})=>{const[p,x]=o.useState(!1),k=()=>{x(v=>!v)};return e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6 text-[var(--text-primary)] whitespace-pre-wrap",id:`question-${r.id}-text`,children:[l,". ",r.questionText]}),r.type==="mcq"&&r.options&&e.jsx("div",{className:"space-y-3",role:"radiogroup","aria-labelledby":`question-${r.id}-text`,children:r.options.map((v,y)=>{const j=i===v.id,C=String.fromCharCode(65+y);let z="w-full text-left p-3 rounded-md transition-all duration-150 flex items-center text-sm sm:text-base ",g="",E="";if(t){z+=" border-2 ";const $=v.id===d;$?(g="border-[var(--accent-green)] text-[var(--accent-green)] bg-[var(--accent-green-bg-soft)] font-medium",E="fa-solid fa-check-circle text-[var(--accent-green)]",j&&(g+=" ring-2 ring-[var(--accent-green)] ring-offset-1 ring-offset-[var(--bg-primary)]")):j&&!$?(g="border-[var(--accent-red)] text-[var(--accent-red)] bg-[var(--accent-red-bg-soft)] font-medium",E="fa-solid fa-times-circle text-[var(--accent-red)]"):(g="border-[var(--border-color)] text-[var(--text-secondary)] bg-[var(--bg-primary)] opacity-60 cursor-not-allowed",E="fa-regular fa-circle text-[var(--text-secondary)] opacity-60")}else z+=" border ",j?(g="bg-[var(--accent-primary-bg-selection)] border-[var(--accent-primary)] text-[var(--btn-primary-text)] font-medium",E="fa-solid fa-dot-circle text-[var(--btn-primary-text)]"):(g="bg-[var(--bg-primary)] border-[var(--border-color)] text-[var(--text-secondary)]",E="fa-regular fa-circle text-[var(--text-secondary)]");const I=z+g;return e.jsxs("button",{"data-option-id":v.id,className:`user-option-button ${I}`,onClick:()=>s(v.id),disabled:t,role:"radio","aria-checked":j&&!t,"aria-label":`Option ${C}: ${v.text}`,children:[e.jsx("i",{className:`${E} mr-2.5 text-lg w-5 text-center`})," ",e.jsxs("span",{className:"font-semibold mr-1.5",children:[C,"."]}),e.jsx("span",{children:v.text})]},v.id)})}),r.type==="written"&&e.jsxs("div",{className:"p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md space-y-3",children:[e.jsx("p",{className:"text-[var(--text-primary)] italic",children:"This is a written response question."}),r.modelAnswer&&r.modelAnswer.trim()!==""&&e.jsxs("div",{children:[e.jsxs("button",{onClick:k,className:"flex items-center space-x-2 text-sm text-[var(--accent-primary)] hover:text-[var(--accent-primary-hover)] focus:outline-none focus:ring-1 focus:ring-[var(--accent-primary)] rounded px-2 py-1 bg-[var(--bg-secondary)] border border-[var(--accent-secondary)] hover:border-[var(--accent-primary)]","aria-expanded":p,"aria-controls":`model-answer-${r.id}`,children:[e.jsx("i",{className:`fa-solid ${p?"fa-angle-up":"fa-angle-down"} fa-fw`}),e.jsx("span",{children:p?"Hide Model Answer":"Show Model Answer"})]}),p&&e.jsx("div",{id:`model-answer-${r.id}`,className:"mt-2 p-3 bg-[var(--bg-secondary)] border border-[var(--accent-secondary)] rounded-md",children:e.jsx("p",{className:"text-sm text-[var(--text-primary)] whitespace-pre-wrap",children:r.modelAnswer})})]})]})]})},Ht=({quiz:r,currentQuestionIndex:l,userAnswers:i,currentUserSelectionAttempt:t,isQuizComplete:s,onOptionSelect:d,onListedOptionSelect:p,onSubmitAnswer:x,onNextQuestion:k,onPreviousQuestion:v,onBackToQuizList:y,onRestartQuiz:j,userCorrectionMode:C,userQuestionDisplayMode:z,onTogglePrefsModal:g})=>{const[E,I]=o.useState(!0);o.useEffect(()=>{I(!0);const O=setTimeout(()=>{I(!1)},1200);return()=>clearTimeout(O)},[r.id]);const $=z==="oneByOne"?r.questions[l]:null,H=z==="oneByOne"?i[l]:null,Y=($==null?void 0:$.type)==="mcq",se=H!=null,te=!!(H&&H.feedback!==null),b=C==="immediate"?te:s,T=se?H.selectedOptionId:t,n=(C==="immediate"||s)&&te?H.feedback:null,c=r.questions.length>0&&z==="oneByOne"?(l+1)/r.questions.length*100:0,S=!s&&l>0&&z==="oneByOne",w=z==="oneByOne"&&l===r.questions.length-1,N=!s&&$&&z==="oneByOne",J=!s&&$&&Y&&!te&&C==="immediate"&&z==="oneByOne",D=t===null,W=C==="immediate"&&J,F=()=>{s&&z==="oneByOne"&&!$||k()},K="p-3 text-[var(--accent-primary)] transition-colors rounded-full focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] disabled:opacity-40 disabled:cursor-not-allowed",U="px-10 py-4 sm:px-12 sm:py-4 text-[var(--btn-primary-text)] bg-[var(--accent-primary)] transition-colors rounded-lg shadow-sm border border-[var(--accent-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] disabled:opacity-40 disabled:cursor-not-allowed",_="w-full sm:w-auto mt-8 px-8 py-3 text-lg font-semibold text-[var(--btn-primary-text)] bg-[var(--accent-primary)] hover:bg-[var(--accent-primary-hover)] transition-colors rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-[var(--accent-primary)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)]",M=()=>e.jsxs("div",{className:"py-6",children:[e.jsxs("h3",{className:"text-2xl sm:text-3xl font-semibold text-[var(--accent-green)] text-center mb-6",children:['Quiz Results for: "',r.name,'"']}),e.jsx("div",{className:"space-y-4 max-h-[calc(55vh+5rem)] sm:max-h-[calc(55vh+3rem)] overflow-y-auto pr-2 custom-scrollbar",children:r.questions.map((O,L)=>{const B=i[L];return e.jsxs("div",{className:"p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md shadow-sm",children:[e.jsxs("p",{className:"text-md font-semibold text-[var(--text-primary)] mb-2 whitespace-pre-wrap",children:[L+1,". ",O.questionText," ",e.jsxs("span",{className:"text-xs text-[var(--accent-secondary)]",children:["(",O.type.toUpperCase(),")"]})]}),O.type==="mcq"&&O.options&&e.jsxs("div",{className:"text-sm space-y-2 mt-1",children:[!(B!=null&&B.selectedOptionId)&&O.type==="mcq"&&e.jsx("p",{className:"text-sm text-[var(--accent-amber)] italic mb-1.5",children:"You did not answer this question."}),e.jsx("ul",{className:"space-y-1.5",children:O.options.map((Q,ae)=>{const re=B?B.selectedOptionId===Q.id:!1,ee=O.correctOptionId===Q.id,X=String.fromCharCode(65+ae);let oe="p-2 rounded-md border flex items-center text-sm transition-all duration-150 ",ce=null,de=null;return ee?(oe+="bg-green-500 bg-opacity-20 border-green-600 text-green-300 font-medium ",ce=e.jsx("i",{className:"fa-solid fa-check fa-fw mr-2 text-green-400"}),de=e.jsx("span",{className:"ml-auto text-xs font-normal",children:"(Correct answer)"}),re&&(oe+="ring-2 ring-green-500 shadow-md ",ce=e.jsx("i",{className:"fa-solid fa-check fa-fw mr-2 text-green-300"}),de=e.jsx("span",{className:"ml-auto text-xs font-semibold",children:"(Your correct choice)"}))):re?(oe+="bg-red-500 bg-opacity-20 border-red-600 text-red-300 font-medium shadow-md ",ce=e.jsx("i",{className:"fa-solid fa-times-circle fa-fw mr-2 text-red-400"}),de=e.jsx("span",{className:"ml-auto text-xs font-semibold",children:"(Your incorrect choice)"})):(oe+="bg-[var(--bg-secondary)] border-[var(--border-color)] text-[var(--text-secondary)] ",ce=e.jsx("i",{className:"fa-regular fa-circle fa-fw mr-2 text-[var(--text-secondary)] opacity-70"})),e.jsxs("li",{className:oe,children:[ce,e.jsxs("span",{className:"font-semibold mr-1.5",children:[X,"."]}),e.jsx("span",{className:"flex-grow min-w-0 break-words",children:Q.text}),de]},Q.id)})})]}),O.type==="written"&&((B==null?void 0:B.feedback)==="Seen"||s&&!B?e.jsx("p",{className:"text-sm text-[var(--text-secondary)] italic mt-1",children:"You viewed this written response question."}):e.jsx("p",{className:"text-sm text-[var(--text-secondary)] italic mt-1",children:"This is a written response question."}))]},O.id)})}),e.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4",children:[e.jsx("button",{onClick:j,className:"px-6 py-2.5 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-sm sm:text-base bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] w-full sm:w-auto",children:"Restart Quiz"}),e.jsx("button",{onClick:y,className:"px-6 py-2.5 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-sm sm:text-base bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] w-full sm:w-auto",children:"Back to Quiz List"})]})]});return e.jsxs("div",{className:"w-full p-4 sm:p-6",children:[!s&&e.jsxs("div",{className:"flex items-center justify-between mb-6 sm:mb-8 pb-4 border-b border-[var(--border-color)]",children:[e.jsx("button",{onClick:y,className:"px-4 py-2 font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 text-xs sm:text-sm bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-[var(--bg-secondary)] shrink-0","aria-label":"Back to quiz list",children:"← Back to Quiz List"}),!s&&e.jsx("button",{onClick:g,className:"text-[var(--text-secondary)] hover:text-[var(--accent-primary)] focus:outline-none p-1 rounded-full mx-2","aria-label":"Quiz Preferences",title:"Quiz Preferences",children:e.jsx("i",{className:`fa-solid fa-gear text-base ${E?"animate-settings-init":""}`})})]}),r.questions.length===0?e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-lg text-[var(--text-secondary)]",children:"This quiz has no questions yet."})}):s?M():z==="oneByOne"&&$?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm text-[var(--text-secondary)] mb-1",children:[e.jsxs("span",{className:"flex-1",children:["Question ",l+1," of ",r.questions.length]}),Y&&n&&e.jsx("span",{className:`font-semibold flex-1 text-right ${n==="Correct"?"text-[var(--accent-green)]":"text-[var(--accent-red)]"}`,children:n})]}),e.jsx("div",{className:"bg-[var(--border-color)] rounded-full h-2.5 w-full",role:"progressbar","aria-valuenow":l+1,"aria-valuemin":1,"aria-valuemax":r.questions.length,"aria-label":"Quiz progress",children:e.jsx("div",{className:"bg-[var(--accent-primary)] h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${c}%`}})})]}),e.jsx(Nt,{question:$,questionNumber:l+1,selectedOptionId:T,isSubmitted:b,onOptionSelect:d,correctOptionIdForDisplay:n&&Y?$.correctOptionId:void 0}),e.jsxs("div",{className:"mt-8 sm:mt-10 flex justify-between items-center",children:[e.jsx("div",{className:"w-14 h-14 flex items-center justify-center",children:S&&e.jsx("button",{onClick:v,className:K,"aria-label":"Previous Question",title:"Previous Question",children:e.jsx("i",{className:"fa-solid fa-chevron-left fa-lg"})})}),e.jsx("div",{className:"flex-grow flex justify-center items-center min-h-[3.5rem] sm:min-h-[4rem]",children:J&&e.jsx("button",{onClick:x,disabled:D,className:`${U} focus:ring-offset-[var(--bg-primary)]`,"aria-label":"Submit Answer",title:"Submit Answer",children:e.jsx("i",{className:"fa-solid fa-circle-check fa-xl"})})}),e.jsx("div",{className:"w-14 h-14 flex items-center justify-center",children:N&&e.jsx("button",{onClick:F,disabled:W,className:K,"aria-label":w?"Finish Quiz":"Next Question",title:w?"Finish Quiz":"Next Question",children:e.jsx("i",{className:`fa-solid ${w?"fa-flag-checkered":"fa-chevron-right"} fa-lg`})})})]})]}):z==="listed"?e.jsxs("div",{className:"space-y-8",children:[r.questions.map((O,L)=>{const B=i[L],Q=B!=null,ae=!!(B&&B.feedback!==null),re=C==="immediate"?ae:s,ee=Q?B.selectedOptionId:null,X=(C==="immediate"||s)&&ae&&O.type==="mcq"?O.correctOptionId:void 0;return e.jsx("div",{className:"py-4 border-b border-[var(--border-color)] last:border-b-0",children:e.jsx(Nt,{question:O,questionNumber:L+1,selectedOptionId:ee,isSubmitted:re,onOptionSelect:oe=>p(oe,L),correctOptionIdForDisplay:X})},O.id)}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:F,className:_,"aria-label":"Finish Quiz",title:"Finish Quiz",children:[e.jsx("i",{className:"fa-solid fa-flag-checkered fa-lg mr-2"}),"Finish Quiz"]})})]}):e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-lg text-[var(--text-secondary)]",children:"Loading questions..."})})]})},gt="w-full p-3 border rounded-md focus:ring-2 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",Xe="block text-sm font-medium text-[var(--text-secondary)] mb-1",Gt="bg-[var(--bg-secondary)] p-4 sm:p-6 rounded-lg shadow-lg",Vt="w-full py-2.5 px-4 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",kt=({subjectId:r,quizId:l,quizName:i,existingQuestion:t,onSaveQuestion:s,maxOptions:d})=>{var b;const[p,x]=o.useState("mcq"),[k,v]=o.useState(""),[y,j]=o.useState(Array(d).fill(null).map(()=>({text:""}))),[C,z]=o.useState(null),[g,E]=o.useState(""),[I,$]=o.useState(null),H=T=>{if(x(T?"mcq":(t==null?void 0:t.type)||"mcq"),v(T?"":(t==null?void 0:t.questionText)||""),E(T?"":(t==null?void 0:t.modelAnswer)||""),!T&&(t==null?void 0:t.type)==="mcq"&&(t!=null&&t.options)){const n=Array(d).fill(null).map(()=>({text:""}));let c=null;t.options.forEach((w,N)=>{N<d&&(n[N]={text:w.text})});const S=t.options.find(w=>w.id===t.correctOptionId);if(S){const w=n.findIndex(N=>N.text===S.text);w!==-1&&(c=w)}j(n),z(c)}else j(Array(d).fill(null).map(()=>({text:""}))),z(null);$(null)};o.useEffect(()=>{H(!t)},[t,d]);const Y=(T,n)=>{const c=[...y];c[T]={text:n},j(c),n.trim()===""&&C===T&&z(null)},se=T=>{if(T.preventDefault(),$(null),!k.trim()){$("Question text cannot be empty.");return}let n;if(p==="mcq"){const c=y.map((D,W)=>({text:D.text.trim(),originalIndex:W})).filter(D=>D.text!=="");if(c.length<2){$("Please provide at least two answer options for an MCQ.");return}if(C===null||y[C].text.trim()===""){$("Please select a correct answer from the non-empty options for an MCQ.");return}const S=c.map((D,W)=>({id:`option-${W}`,text:D.text})),w=y[C].text.trim(),N=S.find(D=>D.text===w);if(!N){$("Error determining correct option ID. The selected correct option might be empty or not among the provided options.");return}const J=N.id;n={questionText:k.trim(),type:"mcq",options:S,correctOptionId:J,modelAnswer:void 0}}else n={questionText:k.trim(),type:"written",options:void 0,correctOptionId:void 0,modelAnswer:g.trim()||void 0};t?s(r,l,{...n,id:t.id}):(s(r,l,n),H(!0))},te=t?"Update Question":"Add Question";return e.jsxs("div",{className:`${Gt} mt-3 mb-3 sm:mt-4 sm:mb-4`,children:[t&&e.jsxs("p",{className:"text-sm text-[var(--text-secondary)] mb-3 -mt-2",children:['Editing: "',t.questionText.substring(0,50),'..." (',(b=t.type)==null?void 0:b.toUpperCase(),")"]}),e.jsxs("form",{onSubmit:se,className:"space-y-6 p-4 bg-[var(--bg-secondary)] rounded-md border border-[var(--border-color)] shadow-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:`${Xe} text-[var(--text-primary)]`,children:"Question Type"}),e.jsxs("div",{className:"flex space-x-4 text-[var(--text-primary)]",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"questionType",value:"mcq",checked:p==="mcq",onChange:()=>x("mcq"),className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{children:"Multiple Choice (MCQ)"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"questionType",value:"written",checked:p==="written",onChange:()=>x("written"),className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{children:"Written Response"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"questionText",className:Xe,children:"Question Text"}),e.jsx("textarea",{id:"questionText",rows:3,value:k,onChange:T=>v(T.target.value),className:gt,placeholder:"Enter the question"})]}),p==="mcq"&&e.jsxs("fieldset",{children:[e.jsxs("legend",{className:`text-md font-medium ${Xe} mb-2`,children:["Answer Options (Provide 2 to ",d,")"]}),e.jsx("div",{className:"space-y-3",children:y.map((T,n)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",id:`correctAnswer-${n}-${t?t.id:"new"}`,name:`correctAnswer-${t?t.id:"new"}`,value:n,checked:C===n,onChange:()=>z(n),disabled:T.text.trim()==="",className:"h-4 w-4 text-[var(--accent-primary)] border-[var(--input-border)] focus:ring-[var(--accent-primary)] shrink-0 cursor-pointer bg-[var(--input-bg)]","aria-label":`Mark option ${String.fromCharCode(65+n)} as correct`}),e.jsxs("label",{htmlFor:`optionText-${n}-${t?t.id:"new"}`,className:"text-[var(--text-primary)] w-6 text-left font-medium",children:[String.fromCharCode(65+n),"."]}),e.jsx("input",{id:`optionText-${n}-${t?t.id:"new"}`,type:"text",value:T.text,onChange:c=>Y(n,c.target.value),className:`${gt} flex-grow option-text-input`,placeholder:`Option ${String.fromCharCode(65+n)} text`,"data-option-index":n})]},n))})]}),p==="written"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"modelAnswer",className:Xe,children:"Model Answer (Optional)"}),e.jsx("textarea",{id:"modelAnswer",rows:4,value:g,onChange:T=>E(T.target.value),className:gt,placeholder:"Enter the model answer for this written question (optional)"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mt-1",children:"This answer can be shown to users in the quiz."})]}),I&&e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mt-2",children:I}),e.jsx("div",{className:"flex flex-col pt-2",children:e.jsx("button",{type:"submit",className:Vt,children:te})})]})]})},Wt=({question:r,questionNumber:l,onEdit:i,onDelete:t})=>{var p,x,k;let s="";if(r.type==="written")s="Type: Written";else{const v=((x=(p=r.options)==null?void 0:p.find(y=>y.id===r.correctOptionId))==null?void 0:x.text)||"N/A";s=`${((k=r.options)==null?void 0:k.length)||0} options, Correct: ${v.substring(0,25)}${v.length>25?"...":""}`}const d={userSelect:"none",transition:"background-color 0.2s ease, border-color 0.2s ease"};return e.jsxs("li",{className:"flex items-center justify-between p-3 bg-[var(--bg-primary)] rounded-md border border-[var(--border-color)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20 hover:border-[var(--accent-secondary)] shadow-sm",style:d,children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-primary)] truncate",title:r.questionText,children:[e.jsxs("span",{className:"font-semibold",children:[l,"."]})," ",r.questionText,e.jsxs("span",{className:"text-xs text-[var(--text-secondary)] ml-1",children:["(",r.type==="written"?"Written":"MCQ",")"]})]}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)]",children:s})]}),e.jsxs("div",{className:"flex space-x-2 ml-2 shrink-0",children:[e.jsx("button",{onClick:i,className:"edit-question-button px-3 py-1 text-xs bg-[var(--accent-amber)] hover:bg-[var(--accent-amber-hover)] text-[var(--btn-amber-text)] rounded-md transition-colors","aria-label":`Edit question: ${r.questionText.substring(0,30)}...`,children:"Edit"}),e.jsxs("button",{onClick:t,className:"delete-question-button px-3 py-1 text-xs bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white rounded-md transition-colors flex items-center space-x-1","aria-label":`Delete question: ${r.questionText.substring(0,30)}...`,children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw"}),e.jsx("span",{children:"Delete"})]})]})]})},Yt=({onConfirm:r,label:l,holdTimeMs:i=3e3})=>{const[t,s]=o.useState(!1),[d,p]=o.useState(0),[x,k]=o.useState(l),v=o.useRef(null),y=o.useRef(null),j=o.useRef(null),C=o.useCallback(()=>{s(!1),p(0),k(l),v.current&&clearTimeout(v.current),j.current&&cancelAnimationFrame(j.current),y.current=null},[l]),z=o.useCallback(()=>{if(!y.current){C();return}const E=Date.now()-y.current,I=Math.min(E/i*100,100);p(I);const $=Math.ceil(Math.max(0,i-E)/1e3);k(`${$}s`),I>=100?(r(),C()):j.current=requestAnimationFrame(z)},[i,r,C]),g=o.useCallback(()=>{t||(s(!0),y.current=Date.now(),p(0),j.current&&cancelAnimationFrame(j.current),j.current=requestAnimationFrame(z))},[t,z]);return o.useEffect(()=>()=>{C()},[C]),o.useEffect(()=>{t||k(l)},[l,t]),e.jsxs("button",{type:"button",className:"relative w-full px-3 py-1.5 text-sm text-white rounded-md transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center space-x-2 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] focus:ring-[var(--accent-red)] focus:ring-offset-[var(--bg-secondary)] overflow-hidden",onMouseDown:g,onMouseUp:C,onMouseLeave:C,onTouchStart:g,onTouchEnd:C,onTouchCancel:C,"aria-label":`Hold to confirm ${l}`,children:[e.jsx("span",{className:"button-hold-progress",style:{width:`${d}%`}}),e.jsxs("span",{className:"relative z-10 flex items-center space-x-1.5 select-none",children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw shrink-0"}),e.jsx("span",{className:"button-label truncate",children:x})]})]})},Jt=({isOpen:r,title:l,message:i,requiredPassword:t,onConfirm:s,onCancel:d,confirmButtonText:p="Confirm",cancelButtonText:x="Cancel"})=>{const[k,v]=o.useState(""),[y,j]=o.useState(null);if(o.useEffect(()=>{r&&(v(""),j(null))},[r]),!r)return null;const C=g=>{g==null||g.preventDefault(),t?k===t?s():j("Incorrect password. Please try again."):s()},z=document.getElementById("modal-root");return z?ve.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"confirmation-modal-title",onClick:d,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",onClick:g=>g.stopPropagation(),children:[e.jsx("h2",{id:"confirmation-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)] mb-4 text-center",children:l}),e.jsx("div",{className:"text-sm text-[var(--text-primary)] mb-6 text-center",children:i}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[t&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-[var(--text-secondary)] mb-1",children:"Enter Password to Confirm"}),e.jsx("input",{type:"password",id:"confirmPassword",value:k,onChange:g=>v(g.target.value),className:"w-full p-3 border border-[var(--input-border)] rounded-md bg-[var(--input-bg)] text-[var(--input-text)] focus:ring-2 focus:ring-[var(--input-focus-ring)] focus:border-[var(--input-focus-ring)] placeholder-[var(--placeholder-color)]",placeholder:"Enter confirmation password",required:!0})]}),y&&e.jsx("p",{className:"text-red-500 text-sm text-center -mt-2",children:y}),e.jsxs("div",{className:"flex flex-col sm:flex-row-reverse gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:p}),e.jsx("button",{type:"button",onClick:d,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:x})]})]})]})}),z):(console.error("Modal root element 'modal-root' not found for ConfirmationModal."),null)},Kt="YOUR_GITHUB_RAW_DATA_JSON_URL_HERE_OR_LEAVE_EMPTY_TO_ALWAYS_USE_LOCAL_FALLBACK",Xt="YOUR_GOOGLE_APPS_SCRIPT_URL_FOR_PAT_HERE_IF_NOT_USING_DEFAULT",Zt="YOUR_APPS_SCRIPT_SHARED_SECRET_HERE",qe={GITHUB_DATA_URL:"https://github.com/Rustova/Q/blob/main/data.json",DEFAULT_THEME:"dark",GOOGLE_APPS_SCRIPT_PAT_FETCHER_URL:"https://script.google.com/macros/s/AKfycbz-AFYjxhI7KH_IfXAfm1dr5C5XM3D1YKw8AkyljTvDS-dPbKDnYPYMlWnloQTvifDzdw/exec",APPS_SCRIPT_SHARED_SECRET:Zt},er=({isOpen:r,onClose:l,subjectId:i,quizId:t,quizName:s,existingQuestion:d,onSaveQuestion:p,maxOptions:x})=>{if(!r)return null;const k=document.getElementById("modal-root");if(!k)return console.error("Modal root element 'modal-root' not found."),null;const v=(y,j,C)=>{p(y,j,C)};return ve.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"edit-question-modal-title",onClick:l,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:y=>y.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl",children:[e.jsxs("h2",{id:"edit-question-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)]",children:['Edit Question in: "',s,'"']}),e.jsx("button",{onClick:l,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close edit question modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsx("div",{className:"p-1 overflow-y-auto flex-grow custom-scrollbar",children:e.jsx(kt,{subjectId:i,quizId:t,quizName:s,existingQuestion:d,onSaveQuestion:v,maxOptions:x},d.id)})]})}),k)},tr=({isOpen:r,quizName:l,initialQuestions:i,onConfirmReorder:t,onClose:s})=>{const[d,p]=o.useState([]);if(o.useEffect(()=>{p([...i])},[i,r]),o.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]),!r)return null;const x=y=>{if(!y.destination)return;const j=Array.from(d),[C]=j.splice(y.source.index,1);j.splice(y.destination.index,0,C),p(j)},k=()=>{t(d)},v=document.getElementById("modal-root");return v?ve.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-[51] p-4",role:"dialog","aria-modal":"true","aria-labelledby":"reorder-questions-modal-title",onClick:s,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col overflow-hidden border border-[var(--border-color)]",onClick:y=>y.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-t-xl",children:[e.jsxs("h2",{id:"reorder-questions-modal-title",className:"text-lg sm:text-xl font-semibold text-[var(--accent-primary)] truncate min-w-0 mr-2",title:`Reorder Questions for: "${l}"`,children:['Reorder Questions for: "',e.jsx("span",{className:"truncate",children:l}),'"']}),e.jsx("button",{onClick:s,className:"p-2 text-[var(--accent-red)] hover:text-[var(--accent-red-hover)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close reorder questions modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-xl"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 overflow-y-auto flex-grow custom-scrollbar",children:[e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-4",children:"Drag and drop the questions to change their order."}),e.jsx(Et,{onDragEnd:x,children:e.jsx($t,{droppableId:"questionsReorderList",children:y=>e.jsxs("ul",{...y.droppableProps,ref:y.innerRef,className:"space-y-2",children:[d.map((j,C)=>e.jsx(Ot,{draggableId:j.id,index:C,children:(z,g)=>e.jsxs("li",{ref:z.innerRef,...z.draggableProps,className:`border rounded-md flex 
                            ${g.isDragging?"bg-[var(--accent-primary)] bg-opacity-20 shadow-lg border-[var(--accent-primary)]":"bg-[var(--bg-primary)] border-[var(--border-color)] hover:bg-[var(--accent-secondary)] hover:bg-opacity-20"}`,children:[e.jsx("div",{className:"p-3 flex-grow min-w-0",children:e.jsxs("span",{className:"text-sm text-[var(--text-primary)] truncate block",title:j.questionText,children:[e.jsxs("span",{className:"font-medium mr-1",children:[C+1,"."]}),j.questionText,e.jsxs("span",{className:"text-xs text-[var(--accent-secondary)] ml-1.5",children:["(",j.type==="mcq"?"MCQ":"Written",")"]})]})}),e.jsx("div",{...z.dragHandleProps,className:"px-5 py-3 bg-[var(--accent-secondary)] hover:bg-[var(--accent-secondary-hover)] text-[var(--text-primary)] rounded-r-md cursor-grab active:cursor-grabbing flex items-center justify-center shrink-0","aria-label":"Drag to reorder question",children:e.jsx("i",{className:"fa-solid fa-sort fa-fw fa-xl text-[var(--text-primary)]"})})]})},j.id)),y.placeholder]})})}),i.length===0&&e.jsx("p",{className:"text-[var(--text-secondary)] text-center py-4",children:"This quiz has no questions to reorder."})]}),e.jsx("footer",{className:"p-4 sm:p-5 border-t border-[var(--border-color)] bg-[var(--bg-secondary)] rounded-b-xl flex justify-end space-x-3",children:e.jsx("button",{onClick:k,disabled:i.length===0,className:"px-4 py-2 text-sm font-medium bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] disabled:opacity-50",children:"Save Order"})})]})}),v):(console.error("Modal root element 'modal-root' not found."),null)},At=({textToType:r,speed:l=50,className:i,title:t})=>{const[s,d]=o.useState("");return o.useEffect(()=>{d("");const p=r||"";if(p){let x=0;const k=setInterval(()=>{x++,d(p.substring(0,x)),x>=p.length&&clearInterval(k)},l);return()=>clearInterval(k)}else d("")},[r,l]),e.jsx("span",{className:i,title:t||r,children:s})},Ze="w-full p-3 border rounded-md focus:ring-2 placeholder-[var(--placeholder-color)] bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",Ct="w-full p-3 border rounded-md focus:ring-2 bg-[var(--input-bg)] text-[var(--input-text)] border-[var(--input-border)] focus:border-[var(--input-focus-ring)] focus:ring-[var(--input-focus-ring)]",zt="px-4 py-2 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)]",vt="px-4 py-2 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)]",rr="px-4 py-2 bg-[var(--accent-red)] hover:bg-[var(--accent-red-hover)] text-white rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]",sr="px-4 py-2 bg-[var(--accent-green)] hover:bg-[var(--accent-green-hover)] text-white rounded-md transition-colors flex items-center justify-center space-x-1.5 text-sm whitespace-nowrap shrink-0 focus:outline-none focus:ring-2 focus:ring-[var(--accent-green)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",Le="block text-sm font-medium text-[var(--text-secondary)] mb-1",et="bg-[var(--bg-secondary)] p-4 sm:p-6 rounded-lg shadow-lg border border-[var(--border-color)]",ar="a7f39d5b1c",nr=r=>{try{const l=new URL(r);if(l.hostname==="raw.githubusercontent.com"){const i=l.pathname.split("/").filter(Boolean);return i.length<4?(console.error("Invalid GitHub Raw URL: Path too short. Expected owner/repo/branch/path... Given:",r),null):{owner:i[0],repo:i[1],branch:i[2],path:i.slice(3).join("/")}}if(l.hostname==="github.com"){const i=/^\/([^\/]+)\/([^\/]+)\/blob\/([^\/]+)\/(.+)$/,t=l.pathname.match(i);if(t){const[,s,d,p,x]=t;return{owner:s,repo:d,branch:p,path:x.replace(/\?.*$/,"")}}}if(l.hostname==="api.github.com"&&l.pathname.startsWith("/repos/")){const i=l.pathname.split("/").filter(Boolean);if(i.length>=5&&i[0]==="repos"&&i[3]==="contents"){const s=new URLSearchParams(l.search).get("ref")||"main";return{owner:i[1],repo:i[2],branch:s,path:i.slice(4).join("/")}}}return console.warn(`URL (${r}) is not a recognized GitHub raw, blob, or API URL for saving. Saving via GitHub API might fail.`),null}catch(l){return console.error("Error parsing GitHub URL for saving:",r,l),null}},or=r=>{const{subjects:l,allSubjectsData:i,activeSubjectId:t,activeQuizId:s,editingQuestion:d,setEditingQuestion:p,onSetActiveSubjectId:x,onCreateSubject:k,onUpdateSubjectName:v,onDeleteSubject:y,onSetActiveQuizId:j,onCreateQuiz:C,onUpdateQuizName:z,onDeleteQuiz:g,onToggleQuizStartable:E,onAddQuestion:I,onUpdateQuestion:$,onDeleteQuestion:H,onReorderQuestions:Y,onReorderAllQuizzesByTypeGlobal:se,maxOptions:te,showManageSubjectsSection:b,setShowManageSubjectsSection:T,showManageQuizzesSection:n,setShowManageQuizzesSection:c,activeAdminSubject:S,activeAdminQuiz:w,githubPat:N,setGithubPat:J}=r,[D,W]=o.useState(""),[F,K]=o.useState(""),[U,_]=o.useState(""),[M,O]=o.useState(""),[L,B]=o.useState(!0),[Q,ae]=o.useState(!1),[re,ee]=o.useState(null),X=qe.GITHUB_DATA_URL!==Kt,[oe,ce]=o.useState(!1),[de,ne]=o.useState(!1),[ie,ue]=o.useState(!1),[le,xe]=o.useState(null),be=qe.GOOGLE_APPS_SCRIPT_PAT_FETCHER_URL!==Xt,[Ne,pe]=o.useState(!1),[Ue,Pe]=o.useState(null),[tt,rt]=o.useState(""),[st,Be]=o.useState("");o.useEffect(()=>{ce(!!d)},[d]),o.useEffect(()=>{K((S==null?void 0:S.name)||"")},[S]),o.useEffect(()=>{O((w==null?void 0:w.name)||"")},[w]);const Ee=o.useCallback(async()=>{ue(!0),xe({message:"Fetching PAT...",type:"info"});try{const A=qe.GOOGLE_APPS_SCRIPT_PAT_FETCHER_URL,G=await fetch(A,{method:"GET"}),Z=await G.json().catch(async()=>({error:`Non-JSON response from server: ${(await G.text()).substring(0,150)}...`}));if(!G.ok){const ye=Z.error||`${G.status} ${G.statusText}`;throw new Error(`Failed to fetch PAT: ${ye}`)}if(Z&&typeof Z.pat=="string"&&Z.pat.trim()!=="")J(Z.pat.trim()),xe({message:"PAT fetched and updated successfully!",type:"success"});else throw Z.error?new Error(`Error from source: ${Z.error}`):new Error('Invalid PAT data received. Expected a "pat" field with a non-empty string.')}catch(A){console.error("Error fetching PAT from sheet:",A);const G=A instanceof Error?A.message:String(A);xe({message:`Error fetching PAT: ${G}`,type:"error"})}finally{ue(!1)}},[be,xe,J]);o.useEffect(()=>{Ee()},[be,Ee]);const Ae=(A,G,Z)=>{rt(A),Be(G),Pe(()=>Z),pe(!0)},_e=()=>{Ue&&Ue(),pe(!1),Pe(null)},$e=()=>{pe(!1),Pe(null)},Ce=()=>{if(!D.trim()){alert("Subject name cannot be empty.");return}if(l.some(A=>A.name.toLowerCase()===D.trim().toLowerCase())){alert(`A subject with the name "${D.trim()}" already exists. Please choose a different name.`);return}Ae("Confirm Create Subject",e.jsxs("p",{children:["Are you sure you want to create the subject: ",e.jsx("strong",{children:D.trim()}),"?"]}),()=>{k(D.trim()),W("")})},at=A=>{x(A.target.value||null)},nt=()=>{if(!t||!F.trim()){alert("No subject selected or name is empty.");return}const A=S==null?void 0:S.name;Ae("Confirm Update Subject Name",e.jsxs("p",{children:['Are you sure you want to rename the subject from "',e.jsx("strong",{children:A}),'" to "',e.jsx("strong",{children:F.trim()}),'"?']}),()=>{v(t,F.trim())})},ot=()=>{t&&S?Ae("Confirm Delete Subject",e.jsxs("p",{children:["Are you sure you want to delete the subject: ",e.jsx("strong",{children:S.name}),"? This action cannot be undone and will delete all its quizzes and questions."]}),()=>y(t)):alert("No subject selected to delete.")},it=()=>{if(!t||!U.trim()){alert("No subject selected or quiz name is empty.");return}C(t,U.trim()),_("")},lt=A=>{j(A.target.value||null)},ct=()=>{if(!t||!s||!M.trim()){alert("No subject/quiz selected or name is empty.");return}z(t,s,M.trim())},dt=()=>{t&&s&&w?g(t,s):alert("No quiz selected to delete.")},mt=()=>{t&&s&&E(t,s)},ut=A=>{p(A)},ft=A=>{console.log("[AdminView] handleDeleteQuestionClick called for question ID:",A),t&&s&&w?w.questions.find(Z=>Z.id===A)?H(t,s,A):(alert(`Question not found in the current quiz (ID: ${A}). It might have already been deleted.`),console.warn(`[AdminView] Attempted to delete question ID ${A}, but it was not found in activeAdminQuiz.questions.`)):(alert("Cannot delete question: context missing (subject/quiz). Please ensure a quiz is selected."),console.error(`[AdminView] handleDeleteQuestionClick: Context missing. activeSubjectId: ${t}, activeQuizId: ${s}.`))},Qe=(A,G,Z)=>{"id"in Z?$(A,G,Z):I(A,G,Z),p(null)},pt=()=>{w&&ne(!0)},xt=A=>{t&&s&&Y(t,s,A),ne(!1)},He=()=>{Ae("Confirm Global Question Reorder",e.jsxs("span",{children:["This will reorder questions in ",e.jsx("strong",{children:"ALL quizzes"})," across ",e.jsx("strong",{children:"ALL subjects"}),". Written questions will be moved before MCQ questions within each quiz. This action cannot be undone. Please enter the password to confirm."]}),()=>{se()})},bt=async()=>{if(!N){ee({message:"A PAT is required to save data. Please ensure it is fetched successfully.",type:"error"});return}ae(!0),ee({message:"Saving Data...",type:"info"});const A=nr(qe.GITHUB_DATA_URL);if(!A){ee({message:"Could not parse GitHub URL. Check console for details and ensure it's a raw, blob, or API URL.",type:"error"}),ae(!1);return}console.log("GitHub Repo Info for Save:",A);const{owner:G,repo:Z,branch:ye,path:ht}=A,De=`https://api.github.com/repos/${G}/${Z}/contents/${ht}`,fe="Quiz App: Update application data via Web Editor",Fe={lastUpdated:new Date().toISOString(),subjects:i},we=JSON.stringify(Fe,null,2),Ge=btoa(unescape(encodeURIComponent(we)));try{let je;const Re=new URL(De);Re.searchParams.append("ref",ye),Re.searchParams.append("_cb_sha",Date.now().toString());try{const u=await fetch(Re.toString(),{method:"GET",headers:{Authorization:`token ${N}`,Accept:"application/vnd.github.v3+json"}});if(u.ok)je=(await u.json()).sha,console.log("Fetched current file SHA:",je);else if(u.status!==404){const a=await u.text();throw new Error(`Failed to get current file SHA: ${u.status} - ${a}`)}else console.log("File not found (404) when fetching SHA. Will attempt to create a new file.")}catch(u){throw console.error("Error fetching file SHA:",u),new Error(`Network or unexpected error fetching file SHA: ${u.message}`)}const ke=await fetch(De,{method:"PUT",headers:{Authorization:`token ${N}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({message:fe,content:Ge,sha:je,branch:ye})});if(!ke.ok){const u=await ke.json();throw console.error("GitHub API Error Data during PUT:",u),new Error(`GitHub API error: ${ke.status} - ${u.message||"Unknown error"}`)}const m=await ke.json();console.log("Save successful:",m),ee({message:"Data saved successfully!",type:"success"})}catch(je){console.error("Error saving data:",je),ee({message:`Error saving data: ${je.message}`,type:"error"})}finally{ae(!1)}},Oe=A=>{A(G=>!G)};let ze="fa-cloud-arrow-down",Te="Fetch PAT";return ie?(ze="fa-spinner fa-spin",Te="Fetching PAT..."):(le==null?void 0:le.type)==="success"&&N?(ze="fa-check",Te="PAT Synced"):(le==null?void 0:le.type)==="error"&&(ze="fa-rotate-right",Te="Fetch Failed. Retry?"),e.jsxs("div",{className:"space-y-6 sm:space-y-8 pb-8",children:[e.jsxs("section",{className:et,"aria-labelledby":"manage-subjects-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Oe(T),children:[e.jsx("h2",{id:"manage-subjects-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:"Manage Subjects"}),e.jsx("i",{className:`fa-solid ${b?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),b&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newSubjectName",className:Le,children:"Create New Subject"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",id:"newSubjectName",value:D,onChange:A=>W(A.target.value),placeholder:"Enter name for new subject",className:Ze}),e.jsxs("button",{onClick:Ce,className:zt,"aria-label":"Create New Subject",children:[e.jsx("i",{className:"fa-solid fa-plus fa-fw"})," Create Subject"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectSubjectToManage",className:Le,children:"Select Subject to Manage"}),e.jsxs("select",{id:"selectSubjectToManage",value:t||"",onChange:at,className:Ct,children:[e.jsx("option",{value:"",children:"-- Select a Subject --"}),l.map(A=>e.jsx("option",{value:A.id,children:A.name},A.id))]})]}),t&&S&&e.jsxs("div",{className:"p-3 border border-[var(--border-color)] bg-[var(--bg-primary)] rounded-md space-y-3 mt-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:["Managing:",e.jsx(At,{textToType:S.name,className:"font-semibold text-[var(--text-primary)] truncate max-w-[200px] sm:max-w-xs inline-block align-bottom",title:S.name},S.id)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",value:F,onChange:A=>K(A.target.value),placeholder:"New name for selected subject",className:Ze,"aria-label":"New name for selected subject"}),e.jsxs("button",{onClick:nt,className:vt,"aria-label":"Update Selected Subject Name",children:[e.jsx("i",{className:"fa-solid fa-pen-to-square fa-fw"})," Update Name"]})]}),e.jsxs("button",{onClick:ot,className:`${rr} w-full`,"aria-label":"Delete Selected Subject",children:[e.jsx("i",{className:"fa-solid fa-trash fa-fw"})," Delete Subject"]})]}),!t&&e.jsx("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:"Select a subject above to manage its details and quizzes."})]})]}),t&&S&&e.jsxs("section",{className:et,"aria-labelledby":"manage-quizzes-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Oe(c),children:[e.jsxs("h2",{id:"manage-quizzes-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:["Manage Quizzes for: ",e.jsx("span",{className:"truncate",children:S.name})]}),e.jsx("i",{className:`fa-solid ${n?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newQuizName",className:Le,children:"Create New Quiz"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",id:"newQuizName",value:U,onChange:A=>_(A.target.value),placeholder:"Enter name for new quiz",className:Ze}),e.jsxs("button",{onClick:it,className:zt,"aria-label":"Create New Quiz",children:[e.jsx("i",{className:"fa-solid fa-plus fa-fw"})," Create Quiz"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectQuizToManage",className:Le,children:"Select Quiz to Manage"}),e.jsxs("select",{id:"selectQuizToManage",value:s||"",onChange:lt,className:Ct,children:[e.jsx("option",{value:"",children:"-- Select a Quiz --"}),S.quizzes.map(A=>e.jsxs("option",{value:A.id,children:[A.name,!A.isStartable&&" (Not Available)"]},A.id))]})]}),s&&w&&e.jsxs("div",{className:"p-3 border border-[var(--border-color)] bg-[var(--bg-primary)] rounded-md space-y-3 mt-2",children:[e.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:["Managing:",e.jsx(At,{textToType:w.name,className:"font-semibold text-[var(--text-primary)]",title:w.name},w.id)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("input",{type:"text",value:M,onChange:A=>O(A.target.value),placeholder:"New name for selected quiz",className:Ze,"aria-label":"New name for selected quiz"}),e.jsxs("button",{onClick:ct,className:vt,"aria-label":"Update Selected Quiz Name",children:[e.jsx("i",{className:"fa-solid fa-pen-to-square fa-fw"})," Update Name"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md bg-[var(--input-bg)] border border-[var(--input-border)]",children:[e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"Available to users"}),e.jsx("button",{onClick:mt,className:`rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--input-bg)]
                          ${w.isStartable?"focus:ring-[var(--accent-green)]":"focus:ring-[var(--accent-secondary)]"} flex items-center justify-center p-1`,"aria-checked":w.isStartable,role:"switch",title:w.isStartable?"Click to make unavailable to users":"Click to make available to users",children:e.jsxs("div",{className:"relative inline-block w-12 h-6 select-none",children:[e.jsx("div",{className:`toggle-track absolute w-12 h-6 rounded-full shadow-inner transition-colors duration-200 ease-in-out ${w.isStartable?"bg-[var(--accent-green)]":"bg-[var(--accent-secondary)]"}`}),e.jsx("div",{className:`toggle-knob absolute w-5 h-5 bg-white rounded-full shadow top-0.5 left-0.5 transition-transform duration-200 ease-in-out transform ${w.isStartable?"translate-x-6":"translate-x-0"}`})]})})]}),e.jsx(Yt,{onConfirm:()=>dt(),label:"Delete Quiz",holdTimeMs:3e3})]}),!s&&S.quizzes.length>0&&e.jsx("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:"Select a quiz above to manage its questions and details."}),S.quizzes.length===0&&e.jsxs("p",{className:"text-sm text-[var(--text-secondary)] text-center py-2",children:['No quizzes created yet for "',S.name,'".']})]})]}),t&&s&&w&&e.jsxs("section",{className:`${et} mt-6`,"aria-labelledby":"manage-questions-heading",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h2",{id:"manage-questions-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:["Manage Questions for: ",e.jsx("span",{className:"truncate",children:w.name})]})}),e.jsx(kt,{subjectId:t,quizId:s,quizName:w.name,existingQuestion:null,onSaveQuestion:Qe,maxOptions:te}),oe&&d&&e.jsx(er,{isOpen:oe,onClose:()=>p(null),subjectId:t,quizId:s,quizName:w.name,existingQuestion:d,onSaveQuestion:Qe,maxOptions:te}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center mb-3",children:[e.jsxs("h3",{className:"text-lg font-medium text-[var(--text-primary)]",children:["Current Questions (",w.questions.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[w.questions.length>0&&e.jsxs("button",{onClick:He,className:"px-2.5 py-1 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center space-x-1","aria-label":"Sort all questions globally by type (Written then MCQ)",title:"Sort All Quizzes by Type (Global)",children:[e.jsx("i",{className:"fa-solid fa-arrow-up-wide-short"}),e.jsx("span",{children:"Sort All by Type (Global)"})]}),w.questions.length>1&&e.jsxs("button",{onClick:pt,className:"px-2.5 py-1 text-xs bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] rounded-md transition-colors flex items-center space-x-1","aria-label":"Reorder questions for current quiz",title:"Reorder Questions (Current Quiz)",children:[e.jsx("i",{className:"fa-solid fa-sort"})," ",e.jsx("span",{children:"Reorder"})]})]})]}),w.questions.length===0?e.jsx("p",{className:"text-[var(--text-secondary)] text-center py-3",children:"No questions added yet. Use the form above to add some!"}):e.jsx("ul",{className:"space-y-2",children:w.questions.map((A,G)=>e.jsx(Wt,{question:A,questionNumber:G+1,onEdit:()=>ut(A),onDelete:()=>ft(A.id)},A.id))}),de&&w&&e.jsx(tr,{isOpen:de,quizName:w.name,initialQuestions:w.questions,onConfirmReorder:xt,onClose:()=>ne(!1)})]})]}),e.jsxs("section",{className:et,"aria-labelledby":"app-data-management-heading",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>Oe(B),children:[e.jsx("h2",{id:"app-data-management-heading",className:"text-xl sm:text-2xl font-semibold text-[var(--accent-primary)]",children:"Application Data Management"}),e.jsx("i",{className:`fa-solid ${L?"fa-minus":"fa-plus"} text-[var(--text-secondary)] transition-transform`})]}),L&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:Le,children:"Personal Access Token (PAT)"}),e.jsxs("p",{className:"text-xs text-[var(--text-secondary)] mt-1 mb-2",children:["Your PAT is stored in browser localStorage. It needs 'repo' scope (Classic PAT) or 'Contents: Read & Write' (Fine-Grained PAT) for the repository containing the application data.",e.jsx("a",{href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens",target:"_blank",rel:"noopener noreferrer",className:"text-[var(--accent-primary)] hover:underline ml-1",children:"More info"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:Ee,disabled:ie||!be,className:`${vt} w-full sm:w-auto ${ie||!be?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("i",{className:`fa-solid ${ze} fa-fw`}),Te]}),le&&e.jsx("p",{className:`text-xs mt-1.5 text-center ${le.type==="error"?"text-red-400":le.type==="success"?"text-green-400":"text-[var(--text-secondary)]"}`,children:le.message})]}),e.jsxs("button",{onClick:bt,disabled:Q||!X||!N,className:`${sr} w-full sm:w-auto ${Q||!X||!N?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("i",{className:`fa-solid ${Q?"fa-spinner fa-spin":"fa-save"} fa-fw`}),Q?"Saving Data...":"Save Data"]}),!X,!N&&X&&e.jsx("p",{className:"text-xs text-[var(--text-secondary)] text-center mt-1",children:'A PAT is required to enable saving. Please use the "Fetch PAT" button or ensure automatic fetching is successful.'}),re&&e.jsx("p",{className:`text-sm mt-2 text-center ${re.type==="error"?"text-red-400":re.type==="success"?"text-green-400":"text-[var(--text-secondary)]"}`,children:re.message}),e.jsx("div",{className:"mt-4 p-3 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-md",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("i",{className:"fa-solid fa-circle-info text-[var(--accent-secondary)] mt-1 text-lg"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-[var(--text-primary)]",children:"Saving Your Work"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)]",children:"Manage your subjects, quizzes, and questions using the sections above. If data saving is configured, ensure your PAT is fetched successfully and click 'Save Data' to store all changes."})]})]})})]})]}),Ne&&e.jsx(Jt,{isOpen:Ne,title:tt,message:st,requiredPassword:ar,onConfirm:_e,onCancel:$e})]})},ir=({isOpen:r,onClose:l,timestamp:i})=>{if(!r)return null;let t="N/A",s="N/A",d="Timestamp not available.";if(i)try{const x=new Date(i);isNaN(x.getTime())?d="Invalid timestamp provided.":(t=x.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),s=x.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"}),d=`This content was last updated on: ${x.toString()}`)}catch(x){console.error("Error formatting timestamp for modal:",x),d="Error displaying timestamp."}const p=document.getElementById("modal-root");return p?ve.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"timestamp-modal-title",onClick:l,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md border border-[var(--border-color)]",onClick:x=>x.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between pb-4 mb-4 border-b border-[var(--border-color)]",children:[e.jsx("h2",{id:"timestamp-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)]",children:"Content Update Information"}),e.jsx("button",{onClick:l,className:"p-1.5 text-[var(--text-secondary)] hover:text-[var(--accent-red)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close timestamp information modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"text-sm text-[var(--text-primary)] space-y-2",children:[e.jsx("p",{children:d}),i&&!isNaN(new Date(i).getTime())&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",t]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",s]})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-[var(--border-color)] flex justify-end",children:e.jsx("button",{type:"button",onClick:l,className:"px-5 py-2 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)] text-sm",children:"Close"})})]})}),p):(console.error("Modal root element 'modal-root' not found for TimestampModal."),null)},lr=({isOpen:r,onClose:l,currentCorrectionMode:i,onSetCorrectionMode:t,currentQuestionDisplayMode:s,onSetQuestionDisplayMode:d})=>{const[p,x]=o.useState(i),[k,v]=o.useState(s);if(o.useEffect(()=>{r&&(x(i),v(s))},[r,i,s]),!r)return null;const y=g=>{x(g.target.value)},j=g=>{v(g.target.value)},C=()=>{t(p),d(k)},z=document.getElementById("modal-root");return z?ve.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"quiz-prefs-modal-title",onClick:l,children:e.jsxs("div",{className:"bg-[var(--bg-secondary)] p-6 md:p-8 rounded-lg shadow-xl w-full max-w-lg border border-[var(--border-color)] max-h-[90vh] flex flex-col",onClick:g=>g.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between pb-4 mb-4 border-b border-[var(--border-color)] shrink-0",children:[e.jsx("h2",{id:"quiz-prefs-modal-title",className:"text-xl font-semibold text-[var(--accent-primary)]",children:"إعدادات الاختبار (Quiz Preferences)"}),e.jsx("button",{onClick:l,className:"p-1.5 text-[var(--text-secondary)] hover:text-[var(--accent-red)] hover:bg-[var(--accent-red)] hover:bg-opacity-10 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--accent-red)]","aria-label":"Close preferences modal",children:e.jsx("i",{className:"fa-solid fa-xmark fa-lg"})})]}),e.jsxs("div",{className:"space-y-6 mb-6 overflow-y-auto custom-scrollbar pr-1 flex-grow",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--text-primary)] mb-2",children:"نمط التصحيح (Correction Mode)"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-2",children:"Choose how you want quiz answers to be graded:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"correctionMode",value:"immediate",checked:p==="immediate",onChange:y,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"نمط المذاكرة : تصحيح السؤال اول باول"})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"correctionMode",value:"atEnd",checked:p==="atEnd",onChange:y,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"نمط المراجعة : تصحيح الكويز عند التسليم"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--text-primary)] mb-2",children:"نمط عرض الأسئلة (Question Display Mode)"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-2",children:"Choose how questions are presented during the quiz:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"questionDisplayMode",value:"oneByOne",checked:k==="oneByOne",onChange:j,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"نمط السؤال الواحد: عرض الأسئلة سؤالًا تلو الآخر"})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-[var(--input-bg)] border border-[var(--input-border)] rounded-md cursor-pointer hover:border-[var(--accent-primary)] has-[:checked]:border-[var(--accent-primary)] has-[:checked]:ring-1 has-[:checked]:ring-[var(--accent-primary)] transition-all",children:[e.jsx("input",{type:"radio",name:"questionDisplayMode",value:"listed",checked:k==="listed",onChange:j,className:"form-radio h-4 w-4 text-[var(--accent-primary)] focus:ring-[var(--accent-primary)] bg-[var(--input-bg)] border-[var(--input-border)]"}),e.jsx("span",{className:"text-[var(--text-primary)] text-sm",children:"نمط القائمة: عرض جميع أسئلة الاختبار في قائمة واحدة"})]})]})]})]}),e.jsxs("div",{className:"mt-auto pt-4 border-t border-[var(--border-color)] flex flex-col sm:flex-row-reverse gap-3 shrink-0",children:[e.jsx("button",{type:"button",onClick:C,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-primary-bg)] hover:bg-[var(--btn-primary-hover-bg)] text-[var(--btn-primary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Save Preferences"}),e.jsx("button",{type:"button",onClick:l,className:"w-full sm:w-auto px-6 py-2.5 bg-[var(--btn-secondary-bg)] hover:bg-[var(--btn-secondary-hover-bg)] text-[var(--btn-secondary-text)] font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--btn-secondary-focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]",children:"Cancel"})]})]})}),z):(console.error("Modal root element 'modal-root' not found for QuizPreferencesModal."),null)},cr="e2c841f407",yt="Q",dr=5;function Me(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}async function mr(r){const l=/^https:\/\/github\.com\/([^\/]+)\/([^\/]+)\/blob\/([^\/]+)\/(.+)$/,i=r.match(l);if(i){const[,t,s,d,p]=i,x=`https://api.github.com/repos/${t}/${s}/contents/${p.replace(/\?.*$/,"")}?ref=${d}`;return console.log(`Resolved GitHub blob URL to API raw content URL: ${x}`),x}try{return new URL(r),/^https:\/\/raw\.githubusercontent\.com\//.test(r)||/^https:\/\/api\.github\.com\/repos\/[^\/]+\/[^\/]+\/contents\//.test(r)||!/^https:\/\/github\.com\//.test(r)?r:(console.warn(`The provided GITHUB_DATA_URL (${r}) is a github.com URL but not a 'blob' URL. This format is not directly processable for raw content in this version. Please use a blob URL or a raw content URL.`),null)}catch{return console.warn(`The GITHUB_DATA_URL (${r}) is not a valid absolute URL or a recognized GitHub format. Fallback will likely occur.`),null}}const ur=()=>{const[r,l]=o.useState(()=>localStorage.getItem("isAdminAuthenticated")==="true"),[i,t]=o.useState(()=>localStorage.getItem("isAdminAuthenticated")==="true"&&localStorage.getItem("wasAdminViewBeforeRefresh")==="true"?"AdminPanel":"SubjectSelection"),[s,d]=o.useState(()=>localStorage.getItem("githubPat")||""),[p,x]=o.useState([]),[k,v]=o.useState(null),[y,j]=o.useState(null),[C,z]=o.useState(null),[g,E]=o.useState(null),[I,$]=o.useState(null),[H,Y]=o.useState(!1),[se,te]=o.useState(!1),[b,T]=o.useState(null),[n,c]=o.useState(null),[S,w]=o.useState(!0),[N,J]=o.useState("Gathering all the necessary app information, please hold on a moment..."),[D,W]=o.useState(0),[F,K]=o.useState(null),[U,_]=o.useState([]),[M,O]=o.useState(!1),[L,B]=o.useState("immediate"),[Q,ae]=o.useState("oneByOne"),[re,ee]=o.useState(!1),[X,oe]=o.useState(!0),[ce,de]=o.useState(!0),[ne,ie]=o.useState(!1),[ue,le]=o.useState(()=>localStorage.getItem("pdfButtonAnimationPlayedOnce")==="true"),xe=o.useRef(!1);o.useEffect(()=>{s?localStorage.setItem("githubPat",s):localStorage.removeItem("githubPat")},[s]),o.useEffect(()=>{(i==="UserQuiz"||i==="QuizSelection")&&window.scrollTo(0,0)},[i]);const be=(m,u)=>{m&&typeof m=="object"&&!Array.isArray(m)?(Array.isArray(m.subjects)?x(m.subjects):(console.warn(`Loaded ${u} data object does not contain a 'subjects' array. Initializing with empty subjects.`),x([])),typeof m.lastUpdated=="string"?v(m.lastUpdated):(v(null),m.lastUpdated!==void 0&&console.warn(`Loaded ${u} 'lastUpdated' field found but is not a string. Timestamp will not be set.`))):Array.isArray(m)?(x(m),v(null),console.log(`Loaded ${u} data is in old array format. No timestamp available from data.json.`)):(console.warn(`Loaded ${u} data.json is not in the expected array or {lastUpdated, subjects} object format. Initializing with empty data.`),x([]),v(null))},Ne=o.useCallback(async m=>{console.warn(m||"Falling back to local data.json.");try{const a=`./data.json?_cb_local=${Date.now().toString()}`,f=await fetch(a,{cache:"no-cache"});if(f.ok){const h=await f.json();be(h,"local"),console.log("Successfully processed local data.json")}else if(f.status===404)console.warn("Local data.json not found, initializing with empty subjects array."),x([]),v(null);else{const h=await f.text();console.error(`Failed to fetch local data.json: ${f.status} ${f.statusText}. Response: ${h}`),x([]),v(null)}}catch(u){u instanceof Error?console.error(`Error loading or parsing local data.json: Name: ${u.name}, Message: ${u.message}. Stack: ${u.stack}`):console.error("Error loading or parsing local data.json (non-Error object):",u),x([]),v(null)}},[]);o.useEffect(()=>{(async()=>{if(xe.current){console.log("Data fetch already attempted for this component instance. Skipping.");return}xe.current=!0,w(!0),J("Gathering all the necessary app information, please hold on a moment...");const u=await mr(qe.GITHUB_DATA_URL);if(u){console.info(`Attempting to fetch data from: ${u}`);try{const a=new URL(u);a.searchParams.append("_cb_data",Date.now().toString());const f=a.toString();console.log("Fetching final data from:",f);const h={cache:"no-cache"};let P=!1;a.hostname==="api.github.com"&&a.pathname.includes("/repos/")&&a.pathname.includes("/contents/")?(h.headers={Accept:"application/vnd.github.v3.raw"},P=!0,console.log("Using GitHub API raw content fetch method.")):console.log("Using standard fetch method for non-API or raw.githubusercontent.com URL.");const R=await fetch(f,h);if(!R.ok){const V=await R.text();throw new Error(`Failed to fetch from ${f}: ${R.status} ${R.statusText}. Body: ${V}`)}let q;if(P){const V=await R.text();q=JSON.parse(V)}else q=await R.json();be(q,"remote"),console.log("Successfully processed data from remote source")}catch(a){a instanceof Error?console.error(`Error fetching or parsing data from (${u}). Type: ${a.name}, Message: ${a.message}. Stack: ${a.stack}`):console.error(`Error fetching or parsing data from (${u}). Caught non-Error object:`,a),await Ne(`Failed to load from remote source (${u}).`)}finally{w(!1),J(null)}}else console.info("No remote GITHUB_DATA_URL configured, URL is invalid/placeholder, or processing error prevented getting a usable URL."),await Ne("No remote data URL usable or remote fetch failed."),w(!1),J(null)})()},[Ne]);const pe=()=>{W(0),K(null),_([]),O(!1)},Ue=()=>{t("AdminPanel"),E(null),$(null),pe(),ie(!1),r?localStorage.setItem("wasAdminViewBeforeRefresh","true"):Y(!0)},Pe=()=>{t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"),j(null),z(null),c(null),ie(!1)},tt=m=>{m===cr?(l(!0),localStorage.setItem("isAdminAuthenticated","true"),t("AdminPanel"),localStorage.setItem("wasAdminViewBeforeRefresh","true"),Y(!1),T(null)):T("Incorrect password. Please try again.")},rt=()=>{l(!1),localStorage.removeItem("isAdminAuthenticated"),t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"),j(null),z(null),c(null),ie(!1)},st=()=>{Y(!1),T(null),r||(t("SubjectSelection"),localStorage.removeItem("wasAdminViewBeforeRefresh"),ie(!1))},Be=()=>{te(m=>!m)},Ee=m=>{B(m)},Ae=m=>{ae(m),ee(!1)},_e=()=>{ee(m=>!m)},$e=m=>{j(m),z(null),c(null)},Ce=m=>{z(m),c(null)},at=m=>{const u={id:Me(),name:m,quizzes:[]};x(a=>[...a,u])},nt=(m,u)=>p.some(a=>a.name.toLowerCase()===u.toLowerCase()&&a.id!==m)?(alert(`A subject with the name "${u}" already exists. Please choose a different name.`),!1):(x(a=>a.map(f=>f.id===m?{...f,name:u}:f)),!0),ot=m=>{x(u=>{const a=u.findIndex(h=>h.id===m);if(a===-1)return u;const f=u.filter(h=>h.id!==m);if(y===m)if(f.length>0){const h=Math.min(a,f.length-1);$e(f[h].id)}else $e(null);return f})},it=(m,u)=>{const a=p.find(h=>h.id===m);if(!a){alert("Error: Could not find the subject to add the quiz to. Please try again.");return}if(a.quizzes.some(h=>h.name.toLowerCase()===u.toLowerCase())){alert(`A quiz with the name "${u}" already exists in subject "${a.name}". Please choose a different name.`);return}const f={id:Me(),name:u,questions:[],isStartable:!0};x(h=>h.map(P=>P.id===m?{...P,quizzes:[...P.quizzes,f]}:P)),Ce(f.id)},lt=(m,u,a)=>{var h;let f=!1;if(x(P=>P.map(R=>R.id===m?R.quizzes.some(q=>q.name.toLowerCase()===a.toLowerCase()&&q.id!==u)?(f=!0,R):{...R,quizzes:R.quizzes.map(q=>q.id===u?{...q,name:a}:q)}:R)),f){const P=((h=p.find(R=>R.id===m))==null?void 0:h.name)||"the current subject";return alert(`A quiz with the name "${a}" already exists in ${P}. Please choose a different name.`),!1}return!0},ct=(m,u)=>{x(a=>a.map(f=>{if(f.id===m){const h=f.quizzes.findIndex(R=>R.id===u);if(h===-1)return f;const P=f.quizzes.filter(R=>R.id!==u);if(C===u)if(P.length>0){const R=Math.min(h,P.length-1);Ce(P[R].id)}else Ce(null);return{...f,quizzes:P}}return f}))},dt=(m,u)=>{x(a=>a.map(f=>f.id===m?{...f,quizzes:f.quizzes.map(h=>h.id===u?{...h,isStartable:!h.isStartable}:h)}:f))},mt=m=>{c(m)},ut=(m,u,a)=>{var h,P;const f={...a,id:Me(),modelAnswer:a.modelAnswer||void 0};if(f.type==="mcq"&&f.options){f.options=f.options.map((V,Ve)=>({...V,id:`option-${Me()}-${Ve}`}));const R=(P=(h=a.options)==null?void 0:h.find(V=>V.id===a.correctOptionId))==null?void 0:P.text,q=f.options.find(V=>V.text===R);if(f.correctOptionId=q?q.id:void 0,!f.correctOptionId&&typeof a.correctOptionId=="string"){const V=a.correctOptionId.match(/^option-(\d+)$/);if(V&&V[1]){const Ve=parseInt(V[1],10);f.options[Ve]&&(f.correctOptionId=f.options[Ve].id)}}!f.correctOptionId&&f.options.length>0&&(console.warn("Could not determine correct option for new MCQ, defaulting to first option."),f.correctOptionId=f.options[0].id)}x(R=>R.map(q=>q.id===m?{...q,quizzes:q.quizzes.map(V=>V.id===u?{...V,questions:[...V.questions,f]}:V)}:q)),c(null)},ft=(m,u,a)=>{var f;if(a.type==="mcq"&&a.options){if(a.options=a.options.map((h,P)=>({id:h.id&&h.id.startsWith("option-")?h.id:`option-${Me()}-${P}`,text:h.text})),typeof a.correctOptionId=="string"&&!a.options.find(h=>h.id===a.correctOptionId)){const h=(f=n==null?void 0:n.options)==null?void 0:f.find(q=>q.id===a.correctOptionId),P=h==null?void 0:h.text;let R=a.options.find(q=>q.text===P);if(R)a.correctOptionId=R.id;else{const q=a.correctOptionId.match(/^option-(\d+)$/);if(q&&q[1]){const V=parseInt(q[1],10);a.options[V]?a.correctOptionId=a.options[V].id:(console.warn("Correct option index out of bounds after update. Defaulting."),a.correctOptionId=a.options.length>0?a.options[0].id:void 0)}else console.warn("Correct option ID seems invalid after update and couldn't be re-mapped by text or index. Defaulting."),a.correctOptionId=a.options.length>0?a.options[0].id:void 0}}a.type==="mcq"&&a.options.length>0&&!a.options.find(h=>h.id===a.correctOptionId)&&(console.warn("Updated MCQ question has options, but correctOptionId is invalid. Defaulting to the first option."),a.correctOptionId=a.options[0].id)}x(h=>h.map(P=>P.id===m?{...P,quizzes:P.quizzes.map(R=>R.id===u?{...R,questions:R.questions.map(q=>q.id===a.id?a:q)}:R)}:P)),c(null)},Qe=(m,u,a)=>{x(f=>f.map(h=>h.id===m?{...h,quizzes:h.quizzes.map(P=>P.id===u?{...P,questions:P.questions.filter(R=>R.id!==a)}:P)}:h)),(n==null?void 0:n.id)===a&&c(null)},pt=(m,u,a)=>{x(f=>f.map(h=>h.id===m?{...h,quizzes:h.quizzes.map(P=>P.id===u?{...P,questions:a}:P)}:h))},xt=()=>{x(m=>m.map(u=>({...u,quizzes:u.quizzes.map(a=>{const f=a.questions.filter(P=>P.type==="written"),h=a.questions.filter(P=>P.type==="mcq");return{...a,questions:[...f,...h]}})}))),alert("All quizzes have been successfully reordered (Written questions first, then MCQ).")},He=m=>{const u=p.find(a=>a.id===m);E(u||null),$(null),pe(),t("QuizSelection"),ie(!1)},bt=m=>{const u=g==null?void 0:g.quizzes.find(a=>a.id===m);$(u||null),pe(),u&&_(Array(u.questions.length).fill(null)),t("UserQuiz")},Oe=()=>{E(null),$(null),pe(),t("SubjectSelection"),ue||ie(!0)},ze=()=>{$(null),pe(),t("QuizSelection")},Te=()=>{pe(),I&&_(Array(I.questions.length).fill(null))},A=m=>{if(K(m),I&&L==="atEnd"&&I.questions[D].type==="mcq"){const a=[...U];a[D]={selectedOptionId:m,feedback:null},_(a)}},G=(m,u)=>{if(I){const a=I.questions[u];if(a.type==="mcq"){const f=[...U];let h=null;L==="immediate"&&(h=m===a.correctOptionId?"Correct":"Incorrect"),f[u]={selectedOptionId:m,feedback:h},_(f)}}},Z=()=>{if(I&&L==="immediate"&&U[D]===null){const m=I.questions[D];if(m.type==="mcq"){if(!F){console.warn("Submit called for MCQ without a selection attempt.");return}const u=F===m.correctOptionId?"Correct":"Incorrect",a=[...U];a[D]={selectedOptionId:F,feedback:u},_(a)}}},ye=()=>{if(I){const a=I.questions[D];if(Q==="oneByOne"&&(a==null?void 0:a.type)==="written"&&U[D]===null){const f=[...U],h={selectedOptionId:null,feedback:"Seen"};f[D]=h,_(f)}else if(Q==="oneByOne"&&L==="atEnd"&&(a==null?void 0:a.type)==="mcq"&&F&&U[D]===null){const f=[...U],h={selectedOptionId:F,feedback:null};f[D]=h,_(f)}}K(null);const m=Q==="oneByOne"&&I&&D>=I.questions.length-1,u=Q==="listed";if(m||u){if(L==="atEnd"&&I){const a=U.map((f,h)=>{if(!f&&I.questions[h].type==="written")return{selectedOptionId:null,feedback:"Seen"};if(!f)return null;const P=I.questions[h];if(P.type==="mcq"&&f.selectedOptionId&&f.feedback===null){const R=f.selectedOptionId===P.correctOptionId?"Correct":"Incorrect";return{selectedOptionId:f.selectedOptionId,feedback:R}}return f});_(a)}else if(L==="immediate"&&u&&I){const a=U.map((f,h)=>!f&&I.questions[h].type==="written"?{selectedOptionId:null,feedback:"Seen"}:f);_(a)}O(!0)}else Q==="oneByOne"&&I&&D<I.questions.length-1&&W(a=>a+1)},ht=()=>{if(I&&L==="atEnd"&&Q==="oneByOne"&&I.questions[D].type==="mcq"&&F&&U[D]===null){const u=[...U],a={selectedOptionId:F,feedback:null};u[D]=a,_(u)}K(null),D>0&&W(m=>m-1)},De=()=>{ie(!1),ue||(le(!0),localStorage.setItem("pdfButtonAnimationPlayedOnce","true"))},fe=p.find(m=>m.id===y),Fe=fe==null?void 0:fe.quizzes.find(m=>m.id===C);let we=yt;const Ge=i==="AdminPanel"&&r;if(Ge?we=Fe?`Admin: ${(fe==null?void 0:fe.name)||"Unknown Subject"} > ${Fe.name}`:fe?`Admin: ${fe.name}`:"Admin: Subject Management":i==="UserQuiz"&&I?we=`${(g==null?void 0:g.name)||"Quiz"}: ${I.name}`:i==="QuizSelection"&&g?we=`${g.name}: Select Quiz`:we=yt,S)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-[var(--bg-primary)] p-4 text-center",children:[e.jsx("div",{className:"h-20 w-20 rounded-full flex items-center justify-center bg-[var(--text-primary)] mb-6 shadow-md","aria-label":"App Logo Q",children:e.jsx("span",{className:"text-[var(--bg-primary)] font-bold text-4xl select-none",style:{fontFamily:"Roboto, sans-serif"},children:"Q"})}),e.jsx("h1",{className:"text-3xl font-bold text-[var(--text-primary)] mb-4",children:"Loading Application Data"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("div",{className:"w-3 h-3 bg-[var(--text-secondary)] rounded-full animate-bounce"})]}),N&&e.jsx("p",{className:"text-[var(--text-secondary)] text-sm mt-3",children:N})]});const Re=`flex-grow p-4 sm:p-6 lg:p-8 max-w-5xl w-full mx-auto ${i==="UserQuiz"||i==="QuizSelection"?"pt-4 sm:pt-6":"pt-2 sm:pt-3"}`,ke=()=>{switch(i){case"AdminPanel":return r?e.jsx(or,{subjects:p,allSubjectsData:p,activeSubjectId:y,activeQuizId:C,editingQuestion:n,setEditingQuestion:mt,onSetActiveSubjectId:$e,onCreateSubject:at,onUpdateSubjectName:nt,onDeleteSubject:ot,onSetActiveQuizId:Ce,onCreateQuiz:it,onUpdateQuizName:lt,onDeleteQuiz:ct,onToggleQuizStartable:dt,onAddQuestion:ut,onUpdateQuestion:ft,onDeleteQuestion:Qe,onReorderQuestions:pt,onReorderAllQuizzesByTypeGlobal:xt,maxOptions:dr,showManageSubjectsSection:X,setShowManageSubjectsSection:oe,showManageQuizzesSection:ce,setShowManageQuizzesSection:de,activeAdminSubject:fe,activeAdminQuiz:Fe,githubPat:s,setGithubPat:d}):e.jsx(St,{subjects:p,onSelectSubject:He,playAnimation:ne&&!ue,onAnimationComplete:De});case"UserQuiz":return I?e.jsx(Ht,{quiz:I,currentQuestionIndex:D,userAnswers:U,currentUserSelectionAttempt:F,isQuizComplete:M,onOptionSelect:A,onListedOptionSelect:G,onSubmitAnswer:Z,onNextQuestion:ye,onPreviousQuestion:ht,onBackToQuizList:ze,onRestartQuiz:Te,userCorrectionMode:L,userQuestionDisplayMode:Q,onTogglePrefsModal:_e}):(t("QuizSelection"),null);case"QuizSelection":return g?e.jsx(Qt,{subject:g,onSelectQuiz:bt,onBackToSubjectList:Oe}):(t("SubjectSelection"),null);case"SubjectSelection":default:return e.jsx(St,{subjects:p,onSelectSubject:He,playAnimation:ne&&!ue,onAnimationComplete:De})}};return e.jsxs(e.Fragment,{children:[e.jsx(Rt,{contextTitle:we,isAdminView:Ge,isAdminAuthenticated:r,currentAppViewMode:i,onSwitchToAdminView:Ue,onSwitchToUserView:Pe,onAdminLogout:rt,dataTimestamp:k,onShowTimestampModal:Be}),e.jsx("main",{className:Re,children:ke()}),e.jsx(Lt,{appName:yt}),H&&e.jsx(Mt,{onLogin:tt,onClose:st,error:b}),se&&k&&e.jsx(ir,{isOpen:se,onClose:Be,timestamp:k}),re&&e.jsx(lr,{isOpen:re,onClose:_e,currentCorrectionMode:L,onSetCorrectionMode:Ee,currentQuestionDisplayMode:Q,onSetQuestionDisplayMode:Ae}),e.jsx("div",{className:`pdf-animation-overlay ${ne&&!ue?"visible":""}`,"aria-hidden":!(ne&&!ue)})]})},Tt=document.getElementById("app-root");Tt?It.createRoot(Tt).render(e.jsx(ur,{})):console.error("Failed to find the root element with ID 'app-root'");
